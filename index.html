<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”Œëœë¹„ - ì€í‡´ì„¤ê³„ ì»¤ë®¤ë‹ˆí‹°</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React 18 CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Meta Tags for SEO -->
    <meta name="description" content="ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê¸°ì™€ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼. ê°™ì€ ê³ ë¯¼ì„ ê°€ì§„ ì‚¬ëŒë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”.">
    <meta name="keywords" content="ì€í‡´ìƒí™œë¹„, ì¬ë¬´ì„¤ê³„, ì»¤ë®¤ë‹ˆí‹°, ì€í‡´ê³„íš, í”Œëœë¹„">
    <meta name="author" content="í”Œëœë¹„">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§®</text></svg>">
    
    <!-- í”Œëœë¹„ ì „ìš© ìŠ¤íƒ€ì¼ -->
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ë°°ê²½ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ (ì›ë³¸ ê·¸ëŒ€ë¡œ) */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 16px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ë“¤ (ì›ë³¸ ê·¸ëŒ€ë¡œ) */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ì¸í’‹ ìŠ¤íƒ€ì¼ ê°œì„  */
        input[type="text"], 
        input[type="number"], 
        select, 
        textarea {
            transition: all 0.2s;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        select:focus, 
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ê°œì„  */
        input[type="checkbox"] {
            accent-color: #3b82f6;
            /* transform: scale(1.2); í´ë¦­ ë¬¸ì œë¡œ ì„ì‹œ ì œê±° */
        }
        
        /* ì „ë¬¸ê°€ ë“±ë¡ ì²´í¬ë°•ìŠ¤ ê°•ì œ ìŠ¤íƒ€ì¼ */
        .expert-checkbox {
            pointer-events: auto !important;
            position: relative !important;
            z-index: 999 !important;
        }

        /* í˜¸ë²„ íš¨ê³¼ */
        .hover-lift {
            transition: transform 0.2s;
        }

        .hover-lift:hover {
            transform: translateY(-2px);
        }

        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .card {
                padding: 16px;
                margin-bottom: 12px;
            }
            
            .btn-primary {
                padding: 14px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 12px;
                border-radius: 12px;
            }
            
            .btn-primary {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        /* í•œê¸€ ì¤„ë°”ë€œ ë°©ì§€ */
        .no-break-korean {
            word-break: keep-all;
            white-space: nowrap;
        }

        .break-keep {
            word-break: keep-all;
        }

        /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ìë™ í¬ê¸° ì¡°ì • */
        .responsive-text {
            font-size: clamp(0.75rem, 3vw, 1rem);
        }

        .responsive-text-sm {
            font-size: clamp(0.65rem, 2.5vw, 0.875rem);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì´ë©”ì¼ ì•Œë¦¼ ì‹œìŠ¤í…œ
        const sendExpertNotification = async (expert, action, reason = '') => {
            try {
                // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì´ë©”ì¼ ì„œë¹„ìŠ¤ ì—°ë™ í•„ìš” (ì˜ˆ: Supabase Edge Functions)
                const emailData = {
                    to: expert.email,
                    subject: action === 'approve' ? 
                        '[í”Œëœë¹„] ì „ë¬¸ê°€ ìŠ¹ì¸ ì™„ë£Œ ğŸ‰' : 
                        '[í”Œëœë¹„] ì „ë¬¸ê°€ ì‹ ì²­ ê²€í†  ê²°ê³¼',
                    html: action === 'approve' ? 
                        `<h2>ğŸ‰ ì „ë¬¸ê°€ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                         <p>ì•ˆë…•í•˜ì„¸ìš” ${expert.nickname}ë‹˜,</p>
                         <p>í”Œëœë¹„ ì „ë¬¸ê°€ ì‹ ì²­ì´ <strong>ìŠ¹ì¸</strong>ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                         <p><strong>ìŠ¹ì¸ ì‚¬ìœ :</strong> ${reason || 'ì „ë¬¸ê°€ ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.'}</p>
                         <p>ì´ì œ í”Œëœë¹„ì—ì„œ ì „ë¬¸ê°€ë¡œ í™œë™í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                         <p><a href="https://jwpaparoy.github.io/planB/" style="background-color: #3b82f6; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">í”Œëœë¹„ ë°”ë¡œê°€ê¸°</a></p>
                         <p>ê°ì‚¬í•©ë‹ˆë‹¤.<br/>í”Œëœë¹„ ìš´ì˜íŒ€</p>` :
                        `<h2>ì „ë¬¸ê°€ ì‹ ì²­ ê²€í†  ê²°ê³¼</h2>
                         <p>ì•ˆë…•í•˜ì„¸ìš” ${expert.nickname}ë‹˜,</p>
                         <p>í”Œëœë¹„ ì „ë¬¸ê°€ ì‹ ì²­ì„ ê²€í† í•œ ê²°ê³¼ë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p>
                         <p><strong>ê²€í†  ê²°ê³¼:</strong> ìŠ¹ì¸ ë³´ë¥˜</p>
                         <p><strong>ì‚¬ìœ :</strong> ${reason || 'ìê²© ìš”ê±´ ë¯¸ë‹¬'}</p>
                         <p>ì¶”ê°€ ìê²©ì¦ì´ë‚˜ ê²½ë ¥ì„ ë³´ì™„í•˜ì‹  í›„ ë‹¤ì‹œ ì‹ ì²­í•´ì£¼ì„¸ìš”.</p>
                         <p>ê°ì‚¬í•©ë‹ˆë‹¤.<br/>í”Œëœë¹„ ìš´ì˜íŒ€</p>`
                };
                
                console.log('ì´ë©”ì¼ ë°œì†¡ ì˜ˆì •:', emailData);
                
                // TODO: ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ êµ¬í˜„
                // const { data, error } = await supabase.functions.invoke('send-email', { body: emailData });
                
                return { success: true, message: 'ì•Œë¦¼ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' };
            } catch (error) {
                console.error('ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:', error);
                return { success: false, message: 'ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
            }
        };

        // AmountInput ì»´í¬ë„ŒíŠ¸ (ì™¸ë¶€ì—ì„œ ì •ì˜í•˜ì—¬ ì¬ìƒì„± ë°©ì§€)
        const AmountInput = ({ label, value, onChange, placeholder }) => {
            const formatAmount = (value) => {
                if (!value || value === '' || value === '0') return 'ğŸ’° 0ì›';
                const num = parseInt(value);
                if (num >= 10000) return `ğŸ’° ${(num / 10000).toFixed(1)}ì–µì›`;
                if (num >= 1000) return `ğŸ’° ${Math.round(num / 1000)}ì²œë§Œì›`;
                return `ğŸ’° ${num.toLocaleString()}ë§Œì›`;
            };

            return (
                <div className="mb-6">
                    <label className="block text-xl font-semibold text-gray-800 mb-3">{label}</label>
                    <input
                        type="text"
                        inputMode="numeric"
                        pattern="[0-9]*"
                        value={value}
                        onChange={(e) => {
                            const numValue = e.target.value.replace(/[^0-9]/g, '');
                            onChange(numValue);
                        }}
                        className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                        placeholder={placeholder}
                        autoComplete="off"
                    />
                    <div className="text-green-600 font-semibold text-lg mt-1">
                        {formatAmount(value)}
                    </div>
                </div>
            );
        };

        // Supabase ì„¤ì • (í”Œëœë¹„ ì „ìš©)
        const supabaseUrl = 'https://iopidkmpoxcctixchkmv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvcGlka21wb3hjY3RpeGNoa212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NTY0MDIsImV4cCI6MjA3MTIzMjQwMn0.M_bvNzXqPFxmyj4n5xGi3L_eV5yP_8ex-5z8rhjltrQ';
        const supabase = window.supabase?.createClient ? window.supabase.createClient(supabaseUrl, supabaseKey) : null;

        // ìµëª… ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ
        class AnonymousSessionManager {
            constructor() {
                this.currentSession = null;
                this.tokenKey = 'planb_session_token';
            }

            // ë³´ì•ˆ í† í° ìƒì„±
            generateSecureToken() {
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
            }

            // ê³„ì‚° ê²°ê³¼ í•´ì‹œ ìƒì„± (ì¡°ì‘ ë°©ì§€)
            async hashCalculationResult(result) {
                const dataString = JSON.stringify({
                    monthlyLivingCost: result.monthlyLivingCost,
                    totalAssets: result.totalAssets,
                    assetSufficiencyYears: result.assetSufficiencyYears,
                    housingType: result.housingType
                });
                
                const encoder = new TextEncoder();
                const data = encoder.encode(dataString);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }

            // ê·¸ë£¹ ìë™ ë°°ì •
            assignGroup(calculationResult) {
                const monthlyBudget = calculationResult.monthlyLivingCost;
                const assetYears = calculationResult.assetSufficiencyYears;
                
                // ë³µí•© ì§€í‘œë¡œ ì€ë°€í•˜ê²Œ ë¶„ë¥˜
                if (monthlyBudget < 200 || assetYears < 15) return 'prudent';
                if (monthlyBudget < 400 || assetYears < 25) return 'balanced';
                return 'premium';
            }

            // ìµëª… ë‹‰ë„¤ì„ ìƒì„±
            generateNickname(group) {
                const groupNames = {
                    'prudent': 'ì•Œëœ°ë¼ì´í”„',
                    'balanced': 'ë°¸ëŸ°ìŠ¤ë¼ì´í”„', 
                    'premium': 'í”„ë¦¬ë¯¸ì—„ë¼ì´í”„'
                };
                const randomNum = Math.floor(Math.random() * 999) + 1;
                return `${groupNames[group]}${randomNum.toString().padStart(3, '0')}`;
            }

            // ê³„ì‚° ì™„ë£Œì‹œ ìµëª… ì„¸ì…˜ ìƒì„±
            async createSession(calculationResult) {
                try {
                    const sessionToken = this.generateSecureToken();
                    const calculationHash = await this.hashCalculationResult(calculationResult);
                    const assignedGroup = this.assignGroup(calculationResult);
                    const nickname = this.generateNickname(assignedGroup);

                    const sessionData = {
                        session_token: sessionToken,
                        calculation_hash: calculationHash,
                        assigned_group: assignedGroup,
                        nickname: nickname,
                        monthly_budget: calculationResult.monthlyLivingCost,
                        asset_years: calculationResult.assetSufficiencyYears,
                        housing_type: calculationResult.housingType,
                        created_at: new Date().toISOString(),
                        expires_at: new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(),
                        last_active: new Date().toISOString(),
                        community_posts_count: 0
                    };

                    if (supabase) {
                        // ì„œë²„ì— ìµëª… ì„¸ì…˜ ì €ì¥
                        const { data, error } = await supabase
                            .from('anonymous_sessions')
                            .insert([sessionData])
                            .select();

                        if (error) throw error;
                        
                        // ë¡œì»¬ì—ëŠ” í† í°ë§Œ ì €ì¥
                        localStorage.setItem(this.tokenKey, sessionToken);
                        this.currentSession = data[0];
                        
                        console.log(`ìµëª… ì„¸ì…˜ ìƒì„±: ${nickname} (${assignedGroup} ê·¸ë£¹)`);
                        return this.currentSession;
                    } else {
                        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: localStorageì— ì „ì²´ ë°ì´í„° ì €ì¥
                        const fallbackSession = { ...sessionData, id: Date.now() };
                        localStorage.setItem(this.tokenKey, sessionToken);
                        localStorage.setItem(`planb_session_${sessionToken}`, JSON.stringify(fallbackSession));
                        this.currentSession = fallbackSession;
                        return this.currentSession;
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨:', error);
                    // ë¡œì»¬ í´ë°±
                    return this.createLocalFallbackSession(calculationResult);
                }
            }

            // ì„¸ì…˜ ë³µêµ¬
            async restoreSession() {
                try {
                    const token = localStorage.getItem(this.tokenKey);
                    if (!token) return null;

                    if (supabase) {
                        // ì„œë²„ì—ì„œ ì„¸ì…˜ ì¡°íšŒ
                        const { data, error } = await supabase
                            .from('anonymous_sessions')
                            .select('*')
                            .eq('session_token', token)
                            .single();

                        if (error) {
                            if (error.code === 'PGRST116') { // ì„¸ì…˜ ì—†ìŒ
                                localStorage.removeItem(this.tokenKey);
                                return null;
                            }
                            throw error;
                        }

                        // ë§Œë£Œ í™•ì¸
                        if (new Date(data.expires_at) < new Date()) {
                            await this.deleteSession(token);
                            return null;
                        }

                        // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                        await supabase
                            .from('anonymous_sessions')
                            .update({ last_active: new Date().toISOString() })
                            .eq('session_token', token);

                        this.currentSession = data;
                        console.log(`ì„¸ì…˜ ë³µêµ¬: ${data.nickname} (${data.assigned_group} ê·¸ë£¹)`);
                        return this.currentSession;
                    } else {
                        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: localStorageì—ì„œ ë³µêµ¬
                        const sessionData = localStorage.getItem(`planb_session_${token}`);
                        if (sessionData) {
                            this.currentSession = JSON.parse(sessionData);
                            return this.currentSession;
                        }
                        return null;
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ë³µêµ¬ ì‹¤íŒ¨:', error);
                    return this.getLocalFallbackSession();
                }
            }

            // ì„¸ì…˜ ì—°ì¥
            async extendSession() {
                if (!this.currentSession) return;

                try {
                    const newExpiryDate = new Date(Date.now() + (30 * 24 * 60 * 60 * 1000));
                    
                    if (supabase) {
                        await supabase
                            .from('anonymous_sessions')
                            .update({ 
                                expires_at: newExpiryDate.toISOString(),
                                last_active: new Date().toISOString()
                            })
                            .eq('session_token', this.currentSession.session_token);
                    }
                    
                    this.currentSession.expires_at = newExpiryDate.toISOString();
                    console.log('ì„¸ì…˜ 30ì¼ ì—°ì¥ë¨');
                } catch (error) {
                    console.error('ì„¸ì…˜ ì—°ì¥ ì‹¤íŒ¨:', error);
                }
            }

            // ì»¤ë®¤ë‹ˆí‹° í™œë™ ê¸°ë¡
            async recordCommunityActivity(activityType = 'general') {
                if (!this.currentSession) return;

                try {
                    if (supabase) {
                        const updates = { 
                            last_active: new Date().toISOString()
                        };

                        if (activityType === 'post') {
                            updates.community_posts_count = (this.currentSession.community_posts_count || 0) + 1;
                        }

                        await supabase
                            .from('anonymous_sessions')
                            .update(updates)
                            .eq('session_token', this.currentSession.session_token);

                        this.currentSession = { ...this.currentSession, ...updates };
                    }
                } catch (error) {
                    console.error('í™œë™ ê¸°ë¡ ì‹¤íŒ¨:', error);
                }
            }

            // ì„¸ì…˜ ì‚­ì œ
            async deleteSession(token = null) {
                const targetToken = token || this.currentSession?.session_token;
                if (!targetToken) return;

                try {
                    if (supabase) {
                        await supabase
                            .from('anonymous_sessions')
                            .delete()
                            .eq('session_token', targetToken);
                    }
                    
                    localStorage.removeItem(this.tokenKey);
                    localStorage.removeItem(`planb_session_${targetToken}`);
                    this.currentSession = null;
                } catch (error) {
                    console.error('ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                }
            }

            // ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ê¶Œí•œ í™•ì¸
            checkCommunityAccess() {
                if (!this.currentSession) {
                    return {
                        hasAccess: false,
                        message: "ì€í‡´ìƒí™œë¹„ ê³„ì‚°ì„ ì™„ë£Œí•˜ì‹œë©´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                        action: "redirect_to_calculator"
                    };
                }

                // ì„¸ì…˜ ë§Œë£Œ í™•ì¸
                if (new Date(this.currentSession.expires_at) < new Date()) {
                    return {
                        hasAccess: false,
                        message: "ì»¤ë®¤ë‹ˆí‹° ì´ìš©ê¶Œì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°„ë‹¨íˆ ì¬ê³„ì‚°í•´ì£¼ì„¸ìš”",
                        action: "redirect_to_calculator"
                    };
                }

                return {
                    hasAccess: true,
                    userGroup: this.currentSession.assigned_group,
                    nickname: this.currentSession.nickname,
                    session: this.currentSession
                };
            }

            // QR ì½”ë“œìš© ë§í¬ ìƒì„± (ë‹¤ì¤‘ ê¸°ê¸° ì—°ë™)
            generateDeviceLink() {
                if (!this.currentSession) return null;
                
                const baseUrl = window.location.origin;
                return `${baseUrl}/?link_token=${this.currentSession.session_token}`;
            }

            // ë¡œì»¬ í´ë°± ì„¸ì…˜ ìƒì„±
            createLocalFallbackSession(calculationResult) {
                const assignedGroup = this.assignGroup(calculationResult);
                const nickname = this.generateNickname(assignedGroup);
                const token = this.generateSecureToken();

                const fallbackSession = {
                    session_token: token,
                    assigned_group: assignedGroup,
                    nickname: nickname,
                    monthly_budget: calculationResult.monthlyLivingCost,
                    asset_years: calculationResult.assetSufficiencyYears,
                    created_at: new Date().toISOString(),
                    expires_at: new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(),
                    is_local_fallback: true
                };

                localStorage.setItem(this.tokenKey, token);
                localStorage.setItem(`planb_session_${token}`, JSON.stringify(fallbackSession));
                this.currentSession = fallbackSession;
                
                console.log(`ë¡œì»¬ í´ë°± ì„¸ì…˜ ìƒì„±: ${nickname} (${assignedGroup} ê·¸ë£¹)`);
                return this.currentSession;
            }
        }

        // sessionManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const sessionManager = new AnonymousSessionManager();

        // SupabaseëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆìŒ

        // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±ê¸° 
        class NicknameGenerator {
            constructor() {
                this.adjectives = [
                    'í–‰ë³µí•œ', 'ì—¬ìœ ë¡œìš´', 'ì§€í˜œë¡œìš´', 'í™œê¸°ì°¬', 'ë‹¹ë‹¹í•œ', 'ë©‹ì§„', 
                    'ìš°ì•„í•œ', 'ë“ ë“ í•œ', 'ë¹›ë‚˜ëŠ”', 'í‰ì˜¨í•œ', 'ê±´ê°•í•œ', 'ë”°ëœ»í•œ',
                    'ììœ ë¡œìš´', 'ëŠ ë¦„í•œ', 'ì¹œê·¼í•œ', 'ì„±ì‹¤í•œ', 'ë‹¨ì•„í•œ', 'ì°¨ë¶„í•œ'
                ];
                
                this.nouns = [
                    'ë‚˜ë¬´', 'ë°”ë‹¤', 'ì‚°', 'ê½ƒ', 'ìƒˆ', 'êµ¬ë¦„', 'ë³„', 'ë‹¬', 
                    'ì—¬í–‰ì', 'ì •ì›ì‚¬', 'ë…ì„œê°€', 'ìš”ë¦¬ì‚¬', 'í™”ê°€', 'ìŒì•…ê°€',
                    'ì‚°ì±…ì', 'ì‚¬ìƒ‰ê°€', 'íƒí—˜ê°€', 'ìˆ˜ì§‘ê°€', 'ê´€ì°°ì', 'ì´ì•¼ê¸°ê¾¼'
                ];
            }
            
            generate() {
                const adj = this.adjectives[Math.floor(Math.random() * this.adjectives.length)];
                const noun = this.nouns[Math.floor(Math.random() * this.nouns.length)];
                const number = Math.floor(Math.random() * 9000) + 1000; // 1000-9999
                return `${adj}${noun}${number}`;
            }
        }

        // íšŒì› ì¸ì¦ ë§¤ë‹ˆì €
        class AuthManager {
            constructor() {
                this.nicknameGen = new NicknameGenerator();
                this.currentUser = null;
            }
            
            // íšŒì›ê°€ì…
            async signUp(email, password, nickname = null) {
                try {
                    const finalNickname = nickname || this.nicknameGen.generate();
                    
                    
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                nickname: finalNickname
                            }
                        }
                    });
                    
                    if (error) throw error;
                    
                    // ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„±
                    if (data.user) {
                        const { error: profileError } = await supabase
                            .from('user_profiles')
                            .insert({
                                id: data.user.id,
                                email: email,
                                nickname: finalNickname,
                                privacy_consent: true,
                                privacy_consent_date: new Date().toISOString(),
                                created_at: new Date().toISOString()
                            });
                        
                        if (profileError) throw profileError;
                    }
                    
                    return { success: true, user: data.user };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // ë¡œê·¸ì¸
            async signIn(email, password) {
                try {
                    
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    this.currentUser = data.user;
                    return { success: true, user: data.user };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (ë‹¨ìˆœ ì¤‘ë³µ í™•ì¸)
            async checkEmail(email) {
                try {
                    // ê¸°ì¡´ user_profiles í…Œì´ë¸”ì—ì„œ ì´ë©”ì¼ í™•ì¸
                    const { data: existingUser, error } = await supabase
                        .from('user_profiles')
                        .select('id, email')
                        .eq('email', email)
                        .single();
                    
                    if (existingUser) {
                        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼
                        return { 
                            success: false, 
                            error: 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë©”ì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.'
                        };
                    }
                    
                    return { success: true };
                } catch (error) {
                    // ì‚¬ìš©ìê°€ ì—†ëŠ” ê²½ìš° (ì •ìƒì ì¸ ìƒí™©)
                    return { success: true };
                }
            }

            // ë¡œê·¸ì•„ì›ƒ
            async signOut() {
                try {
                    const { error } = await supabase.auth.signOut();
                    if (error) throw error;
                    
                    this.currentUser = null;
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            async getCurrentUser() {
                try {
                    const { data: { user } } = await supabase.auth.getUser();
                    this.currentUser = user;
                    return user;
                } catch (error) {
                    console.error('Error getting current user:', error);
                    return null;
                }
            }
            
            // ë‹‰ë„¤ì„ ì—…ë°ì´íŠ¸
            async updateNickname(newNickname) {
                try {
                    if (!this.currentUser) throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                    
                    const { error } = await supabase
                        .from('user_profiles')
                        .update({ nickname: newNickname })
                        .eq('id', this.currentUser.id);
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        }

        // ì „ì—­ ì¸ì¦ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤
        const authManager = new AuthManager();

        // ê°œì¸ì •ë³´ë™ì˜ ì²´í¬ë°•ìŠ¤ ì»´í¬ë„ŒíŠ¸
        const PrivacyConsentCheckbox = ({ checked, onChange }) => {
            return (
                <label className="flex items-start space-x-3 cursor-pointer">
                    <input
                        type="checkbox"
                        checked={checked}
                        onChange={(e) => onChange(e.target.checked)}
                        className="mt-1 h-4 w-4 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                    />
                    <div className="flex-1">
                        <span className="text-sm text-gray-800 font-medium">
                            ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤ 
                            <span className="text-red-500 ml-1">(í•„ìˆ˜)</span>
                        </span>
                        <p className="text-xs text-gray-500 mt-1">
                            ìœ„ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë‚´ìš©ì„ ì½ê³  ë™ì˜í•©ë‹ˆë‹¤
                        </p>
                    </div>
                </label>
            );
        };

        // ì „ë¬¸ê°€ìš© ê°œì¸ì •ë³´ìˆ˜ì§‘ì´ìš©ë™ì˜ì„œ ì»´í¬ë„ŒíŠ¸
        const ExpertPrivacyConsentComponent = ({ checked, onChange }) => {
            const [showFullText, setShowFullText] = useState(false);

            return (
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <div className="mb-4">
                        <h3 className="text-lg font-semibold text-gray-800 mb-2">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h3>
                        <div className="text-sm text-gray-700 space-y-2">
                            <div className="bg-white p-3 rounded border">
                                <p><strong>â€¢ ìˆ˜ì§‘í•­ëª©:</strong> ì„±ëª…, ì´ë©”ì¼, ì—°ë½ì²˜, ì „ë¬¸ë¶„ì•¼, ìê²©ì¦Â·ê²½ë ¥ì •ë³´, ì‚¬ì—…ìë“±ë¡ì¦</p>
                                <p><strong>â€¢ ìˆ˜ì§‘ëª©ì :</strong> ì „ë¬¸ê°€ ì‹ ì›í™•ì¸, ìê²©ê²€ì¦, ìƒë‹´ì„œë¹„ìŠ¤ ì œê³µ, ìˆ˜ìˆ˜ë£Œ ì •ì‚°</p>
                                <p><strong>â€¢ ë³´ìœ ê¸°ê°„:</strong> ì„œë¹„ìŠ¤ íƒˆí‡´ í›„ 3ë…„ (ì „ììƒê±°ë˜ë²•)</p>
                                <p><strong>â€¢ ì œ3ì ì œê³µ:</strong> ìƒë‹´ ë§¤ì¹­ì„ ìœ„í•œ ìµœì†Œì •ë³´ë§Œ ê³ ê°ì—ê²Œ ì œê³µ</p>
                                <p className="text-red-600"><strong>â€¢ ë™ì˜ê±°ë¶€ê¶Œ:</strong> ë™ì˜ë¥¼ ê±°ë¶€í•  ìˆ˜ ìˆìœ¼ë‚˜, ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤</p>
                            </div>
                            
                            <button
                                type="button"
                                onClick={() => setShowFullText(!showFullText)}
                                className="text-blue-600 hover:text-blue-800 text-sm underline"
                            >
                                {showFullText ? 'ê°„ëµíˆ ë³´ê¸°' : 'ì „ë¬¸ ë³´ê¸°'}
                            </button>
                            
                            {showFullText && (
                                <div className="bg-white border border-gray-200 rounded p-4 text-xs text-gray-600 max-h-60 overflow-y-auto">
                                    <h4 className="font-semibold mb-2">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ (ì „ë¬¸)</h4>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <h5 className="font-medium">1. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì </h5>
                                            <p>- ì „ë¬¸ê°€ ì‹ ì› í™•ì¸ ë° ìê²© ê²€ì¦</p>
                                            <p>- ìƒë‹´ ì„œë¹„ìŠ¤ ì œê³µ ë° ë§¤ì¹­</p>
                                            <p>- ìˆ˜ìˆ˜ë£Œ ì •ì‚° ë° ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰</p>
                                            <p>- ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ í†µê³„ ë¶„ì„</p>
                                            <p>- ë²•ë ¹ìƒ ì˜ë¬´ì´í–‰ (ì „ììƒê±°ë˜ë²•, ì†Œë“ì„¸ë²• ë“±)</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">2. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª©</h5>
                                            <p><strong>í•„ìˆ˜í•­ëª©:</strong> ì„±ëª…, ì´ë©”ì¼, ì—°ë½ì²˜(íœ´ëŒ€í°), ì „ë¬¸ë¶„ì•¼, ê²½ë ¥ë…„ìˆ˜, ìê²©ì¦ ì •ë³´</p>
                                            <p><strong>ì„ íƒí•­ëª©:</strong> í”„ë¡œí•„ ì‚¬ì§„, ìƒì„¸ ì´ë ¥, ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</p>
                                            <p><strong>ìë™ìˆ˜ì§‘:</strong> IPì£¼ì†Œ, ì¿ í‚¤, ì ‘ì† ë¡œê·¸, ì„œë¹„ìŠ¤ ì´ìš©ê¸°ë¡</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</h5>
                                            <p>- ì„œë¹„ìŠ¤ ì´ìš©ê¸°ê°„ ì¤‘</p>
                                            <p>- ì„œë¹„ìŠ¤ íƒˆí‡´ í›„ 3ë…„ (ì „ììƒê±°ë˜ ë“±ì—ì„œì˜ ì†Œë¹„ìë³´í˜¸ì— ê´€í•œ ë²•ë¥ )</p>
                                            <p>- ì„¸ë²•ì— ë”°ë¥¸ ì¥ë¶€ë³´ê´€ì˜ë¬´: 5ë…„</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ</h5>
                                            <p>- ìƒë‹´ ì‹ ì²­ ê³ ê°ì—ê²Œ ì „ë¬¸ê°€ í”„ë¡œí•„ ì •ë³´ ì œê³µ (ì„±ëª…, ì „ë¬¸ë¶„ì•¼, ê²½ë ¥, í›„ê¸°)</p>
                                            <p>- ì„¸ë¬´ ì‹ ê³ ë¥¼ ìœ„í•œ êµ­ì„¸ì²­ ì œê³µ (ë²•ì •ì˜ë¬´ì‚¬í•­)</p>
                                            <p>- ê¸°íƒ€ ë²•ë ¹ì— ì˜í•œ ì œê³µ</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">5. ê°œì¸ì •ë³´ì²˜ë¦¬ì˜ ìœ„íƒ</h5>
                                            <p>- ê²°ì œëŒ€í–‰ì‚¬: ìˆ˜ìˆ˜ë£Œ ì •ì‚° (PGì‚¬)</p>
                                            <p>- í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤: ë°ì´í„° ì €ì¥ (Supabase)</p>
                                            <p>- ì•Œë¦¼í†¡ ë°œì†¡: ì˜ˆì•½ í™•ì¸ ì•Œë¦¼ (ë¬¸ìì„œë¹„ìŠ¤)</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">6. ì •ë³´ì£¼ì²´ì˜ ê¶Œë¦¬Â·ì˜ë¬´</h5>
                                            <p>- ê°œì¸ì •ë³´ ì—´ëŒÂ·ì •ì •Â·ì‚­ì œÂ·ì²˜ë¦¬ì •ì§€ ìš”êµ¬ê¶Œ</p>
                                            <p>- ì†í•´ë°°ìƒì²­êµ¬ê¶Œ</p>
                                            <p>- ê°œì¸ì •ë³´ë³´í˜¸ìœ„ì›íšŒ ì‹ ê³ ê¶Œ (privacy.go.kr, êµ­ë²ˆì—†ì´ 182)</p>
                                        </div>
                                        
                                        <div className="bg-yellow-50 border border-yellow-200 rounded p-2">
                                            <p className="text-red-700 font-medium">â€» ìœ„ ì‚¬í•­ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ìˆ˜ ìˆìœ¼ë‚˜, ë™ì˜ ê±°ë¶€ ì‹œ ì „ë¬¸ê°€ ë“±ë¡ ë° ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="p-3 border rounded-lg" style={{
                        borderColor: checked ? '#ea580c' : '#d1d5db',
                        backgroundColor: checked ? '#fff7ed' : 'white'
                    }}>
                        <label className="flex items-center space-x-3 cursor-pointer">
                            <input
                                type="checkbox"
                                checked={!!checked}
                                onClick={(e) => {
                                    const newValue = !checked;
                                    if (onChange) {
                                        onChange(newValue);
                                    }
                                }}
                                onChange={() => {
                                    // onClickì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜
                                }}
                                className="expert-checkbox mt-1 w-4 h-4 text-orange-600 border-2 border-gray-300 rounded focus:ring-orange-500 focus:ring-2 cursor-pointer"
                                style={{
                                    accentColor: '#ea580c'
                                }}
                            />
                            <div className="flex-1 text-sm text-gray-800 font-medium select-none">
                                ìœ„ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤
                                <span className="text-red-500 ml-1">*</span>
                            </div>
                        </label>
                    </div>
                </div>
            );
        };

        // íœ´ëŒ€í° ë²ˆí˜¸ ìë™ í¬ë§·íŒ… í•¨ìˆ˜
        const formatPhoneNumber = (value) => {
            // ìˆ«ìë§Œ ì¶”ì¶œ
            const numbers = value.replace(/[^\d]/g, '');
            
            // 11ìë¦¬ ì´ˆê³¼ì‹œ ìë¥´ê¸°
            if (numbers.length > 11) {
                return numbers.slice(0, 11);
            }
            
            // í¬ë§·íŒ…
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
            } else {
                return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7)}`;
            }
        };

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        const validatePassword = (password) => {
            const checks = {
                length: password.length >= 8,
                hasLetter: /[A-Za-z]/.test(password),
                hasNumber: /[0-9]/.test(password),
                hasSpecial: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            const typeCount = [checks.hasLetter, checks.hasNumber, checks.hasSpecial].filter(Boolean).length;
            
            return {
                isValid: checks.length && typeCount >= 2,
                checks: checks,
                typeCount: typeCount
            };
        };

        // ì „ë¬¸ê°€ í”„ë¡œí•„ í¼ ì»´í¬ë„ŒíŠ¸
        const ExpertProfileForm = ({ 
            expertProfile, updateExpertProfile, expertCategories,
            specialtyInput, setSpecialtyInput, credentialInput, setCredentialInput,
            addSpecialty, addCredential, removeSpecialty, removeCredential 
        }) => {
            return (
                <div className="space-y-6">
                    {/* ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-3">ì „ë¬¸ ë¶„ì•¼ *</label>
                        <div className="grid grid-cols-1 gap-3">
                            {Object.entries(expertCategories).map(([key, category]) => (
                                <div key={key} 
                                     className="border-2 rounded-lg p-4 transition-all duration-200 hover:bg-gray-50"
                                     style={{
                                         borderColor: expertProfile.expertType === key ? '#ea580c' : '#d1d5db',
                                         backgroundColor: expertProfile.expertType === key ? '#fff7ed' : 'white'
                                     }}>
                                    <label className="flex items-center gap-4 cursor-pointer">
                                        <input
                                            type="radio"
                                            name="expertType"
                                            value={key}
                                            checked={expertProfile.expertType === key}
                                            onClick={() => {
                                                updateExpertProfile('expertType', key);
                                                // specialties ë°°ì—´ë„ ë™ì‹œ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ê²€ì¦ ë¡œì§ê³¼ í˜¸í™˜ì„±)
                                                updateExpertProfile('specialties', [expertCategories[key].name]);
                                            }}
                                            onChange={() => {}}
                                            className="w-5 h-5 text-orange-600 border-2 border-gray-300 focus:ring-2 focus:ring-orange-500 cursor-pointer"
                                        />
                                        <div className="flex-1">
                                            <div className="text-lg font-medium">{category.icon} {category.name}</div>
                                            <div className="text-sm text-gray-500">{category.description}</div>
                                        </div>
                                    </label>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ì§ì±…/íƒ€ì´í‹€ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">ì§ì±…/íƒ€ì´í‹€ *</label>
                        <input
                            type="text"
                            required
                            value={expertProfile.title}
                            onChange={(e) => updateExpertProfile('title', e.target.value)}
                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                            placeholder="ì˜ˆ: ì‹œë‹ˆì–´ ì—¬í–‰ ì „ë¬¸ í”Œë˜ë„ˆ"
                        />
                    </div>

                    {/* ê²½ë ¥ ë…„ìˆ˜ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">ê²½ë ¥ (ë…„) *</label>
                        <input
                            type="number"
                            required
                            min="1"
                            max="50"
                            value={expertProfile.experienceYears}
                            onChange={(e) => updateExpertProfile('experienceYears', e.target.value)}
                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                            placeholder="ê²½ë ¥ ë…„ìˆ˜"
                        />
                    </div>

                    {/* ì†Œê°œ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">ìê¸°ì†Œê°œ</label>
                        <textarea
                            rows="3"
                            value={expertProfile.bio}
                            onChange={(e) => updateExpertProfile('bio', e.target.value)}
                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                            placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
                        />
                    </div>

                    {/* ì „ë¬¸ë¶„ì•¼ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">ì „ë¬¸ë¶„ì•¼ *</label>
                        <div className="flex gap-2 mt-1">
                            <input
                                type="text"
                                value={specialtyInput}
                                onChange={(e) => setSpecialtyInput(e.target.value)}
                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                placeholder="ì „ë¬¸ë¶„ì•¼ ì…ë ¥ í›„ ì¶”ê°€ ë²„íŠ¼"
                                onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addSpecialty())}
                            />
                            <button
                                type="button"
                                onClick={addSpecialty}
                                className="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600"
                            >
                                ì¶”ê°€
                            </button>
                        </div>
                        <div className="flex flex-wrap gap-2 mt-2">
                            {expertProfile.specialties.map((specialty, index) => (
                                <span key={index} className="inline-flex items-center px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm">
                                    {specialty}
                                    <button
                                        type="button"
                                        onClick={() => removeSpecialty(index)}
                                        className="ml-2 text-orange-600 hover:text-orange-800"
                                    >
                                        Ã—
                                    </button>
                                </span>
                            ))}
                        </div>
                    </div>

                    {/* ìê²©ì¦/ê²½ë ¥ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">ìê²©ì¦/ê²½ë ¥ì¦ëª… *</label>
                        <div className="flex gap-2 mt-1">
                            <input
                                type="text"
                                value={credentialInput}
                                onChange={(e) => setCredentialInput(e.target.value)}
                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                placeholder="ìê²©ì¦/ê²½ë ¥ ì…ë ¥ í›„ ì¶”ê°€ ë²„íŠ¼"
                                onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addCredential())}
                            />
                            <button
                                type="button"
                                onClick={addCredential}
                                className="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600"
                            >
                                ì¶”ê°€
                            </button>
                        </div>
                        <div className="flex flex-wrap gap-2 mt-2">
                            {expertProfile.credentials.map((credential, index) => (
                                <span key={index} className="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                    {credential}
                                    <button
                                        type="button"
                                        onClick={() => removeCredential(index)}
                                        className="ml-2 text-blue-600 hover:text-blue-800"
                                    >
                                        Ã—
                                    </button>
                                </span>
                            ))}
                        </div>
                    </div>


                    {/* ìƒë‹´ ë°©ì‹ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-3">ì œê³µ ê°€ëŠ¥í•œ ìƒë‹´ ë°©ì‹ *</label>
                        <div className="space-y-2">
                            {[
                                { value: 'phone', label: 'ğŸ“ ì „í™” ìƒë‹´', desc: 'ìŒì„± í†µí™”ë¡œ ìƒë‹´' },
                                { value: 'video', label: 'ğŸ“¹ í™”ìƒ ìƒë‹´', desc: 'Zoom, Meet ë“± í™”ìƒ í†µí™”' },
                                { value: 'chat', label: 'ğŸ’¬ ì±„íŒ… ìƒë‹´', desc: 'í…ìŠ¤íŠ¸ ê¸°ë°˜ ìƒë‹´' }
                            ].map(({ value, label, desc }) => (
                                <div key={value} 
                                     className="border-2 rounded-lg p-3 transition-all duration-200 hover:bg-gray-50"
                                     style={{
                                         borderColor: expertProfile.availableTypes.includes(value) ? '#ea580c' : '#d1d5db',
                                         backgroundColor: expertProfile.availableTypes.includes(value) ? '#fff7ed' : 'white'
                                     }}>
                                    <label className="flex items-center gap-4 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={expertProfile.availableTypes.includes(value)}
                                            onClick={() => {
                                                const isCurrentlyChecked = expertProfile.availableTypes.includes(value);
                                                const types = isCurrentlyChecked
                                                    ? expertProfile.availableTypes.filter(t => t !== value)
                                                    : [...expertProfile.availableTypes, value];
                                                updateExpertProfile('availableTypes', types);
                                            }}
                                            onChange={() => {}}
                                            className="w-5 h-5 text-orange-600 border-2 border-gray-300 rounded focus:ring-2 focus:ring-orange-500 cursor-pointer"
                                        />
                                        <div className="flex-1">
                                            <div className="font-medium">{label}</div>
                                            <div className="text-sm text-gray-500">{desc}</div>
                                        </div>
                                    </label>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ì—°ë½ì²˜ */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700">íœ´ëŒ€í° ë²ˆí˜¸ *</label>
                        <input
                            type="tel"
                            required
                            value={expertProfile.phone}
                            onChange={(e) => {
                                const formatted = formatPhoneNumber(e.target.value);
                                updateExpertProfile('phone', formatted);
                            }}
                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                            placeholder="010-1234-5678"
                        />
                        <p className="text-xs text-gray-500 mt-1">ìƒë‹´ ì˜ˆì•½ í™•ì¸ ë° ë³¸ì¸ ì¸ì¦ìš©</p>
                    </div>


                    {/* ìê²© ê²€ì¦ ì„¹ì…˜ */}
                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 className="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ”’ ìê²© ê²€ì¦ (ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ì´ìƒ í•„ìˆ˜)
                        </h4>
                        
                        <div className="space-y-6">
                            {/* ì˜µì…˜ 1: ì‚¬ì—…ìë“±ë¡ì¦ */}
                            <div className="border border-gray-200 rounded-lg p-4">
                                <h5 className="font-medium text-gray-800 mb-3">ğŸ“„ ì˜µì…˜ 1: ì‚¬ì—…ìë“±ë¡ ì •ë³´</h5>
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                                        <input
                                            type="text"
                                            value={expertProfile.businessLicense}
                                            onChange={(e) => {
                                                const value = e.target.value.replace(/[^0-9]/g, '');
                                                const formatted = value.length >= 10 ? 
                                                    `${value.slice(0,3)}-${value.slice(3,5)}-${value.slice(5,10)}` : 
                                                    value;
                                                updateExpertProfile('businessLicense', formatted);
                                            }}
                                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                            placeholder="1234567890 ë˜ëŠ” 123-45-67890"
                                            maxLength="12"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">ê°œì¸ì‚¬ì—…ì ë˜ëŠ” ë²•ì¸ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</p>
                                    </div>
                                    {expertProfile.businessLicense && expertProfile.businessLicense.length >= 10 && (
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 text-red-600">ì‚¬ì—…ìë“±ë¡ì¦ ì—…ë¡œë“œ *</label>
                                            <input
                                                type="file"
                                                accept="image/*,.pdf"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        // íŒŒì¼ í¬ê¸° ì œí•œ (5MB)
                                                        if (file.size > 5 * 1024 * 1024) {
                                                            alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
                                                            return;
                                                        }
                                                        updateExpertProfile('businessLicenseFile', file);
                                                    }
                                                }}
                                                className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                            />
                                            <p className="text-xs text-gray-500 mt-1">ì‚¬ì—…ìë“±ë¡ì¦ ì´ë¯¸ì§€ ë˜ëŠ” PDF (ìµœëŒ€ 5MB)</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* ì˜µì…˜ 2: êµ­ê°€ìê²©ì¦ */}
                            <div className="border border-gray-200 rounded-lg p-4">
                                <h5 className="font-medium text-gray-800 mb-3">ğŸ“ ì˜µì…˜ 2: êµ­ê°€ìê²©ì¦</h5>
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ìê²©ì¦ ë²ˆí˜¸</label>
                                        <input
                                            type="text"
                                            value={expertProfile.qualificationNumber}
                                            onChange={(e) => updateExpertProfile('qualificationNumber', e.target.value)}
                                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                            placeholder="ì˜ˆ: ê´€ê´‘í†µì—­ì•ˆë‚´ì‚¬ ì œ12345í˜¸"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">êµ­ê°€ìê²©ì¦, ë¯¼ê°„ìê²©ì¦ ë˜ëŠ” ì „ë¬¸ ë¼ì´ì„ ìŠ¤ ë²ˆí˜¸</p>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ìê²©ì¦/ë©´í—ˆì¦ ì‚¬ë³¸ ì—…ë¡œë“œ</label>
                                        <div className="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-orange-400 transition-colors">
                                            <div className="space-y-1 text-center">
                                                <svg className="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" strokeWidth={2} strokeLinecap="round" strokeLinejoin="round" />
                                                </svg>
                                                <div className="flex text-sm text-gray-600">
                                                    <label htmlFor="license-upload" className="relative cursor-pointer bg-white rounded-md font-medium text-orange-600 hover:text-orange-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-orange-500">
                                                        <span>ìê²©ì¦ íŒŒì¼ ì—…ë¡œë“œ</span>
                                                        <input id="license-upload" name="license-upload" type="file" className="sr-only" 
                                                               accept=".jpg,.jpeg,.png,.pdf"
                                                               onChange={(e) => {
                                                                   const file = e.target.files[0];
                                                                   if (file) {
                                                                       // íŒŒì¼ í¬ê¸° ì œí•œ (5MB)
                                                                       if (file.size > 5 * 1024 * 1024) {
                                                                           alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ë¡œ ì œí•œë©ë‹ˆë‹¤.');
                                                                           return;
                                                                       }
                                                                       updateExpertProfile('licenseFile', file);
                                                                   }
                                                               }}
                                                        />
                                                    </label>
                                                    <p className="pl-1">ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</p>
                                                </div>
                                                <p className="text-xs text-gray-500">JPG, PNG, PDF (ìµœëŒ€ 5MB)</p>
                                                {expertProfile.licenseFile && (
                                                    <p className="text-sm text-green-600 font-medium mt-2">
                                                        âœ“ {expertProfile.licenseFile.name}
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* ì˜µì…˜ 3: ê°œì¸ ì „ë¬¸ê°€ */}
                            <div className="border border-gray-200 rounded-lg p-4">
                                <h5 className="font-medium text-gray-800 mb-3">ğŸ‘¤ ì˜µì…˜ 3: ê°œì¸ ì „ë¬¸ê°€ (ì¶”ê°€ ì‹¬ì‚¬)</h5>
                                <div className="space-y-3">
                                    <div className="bg-blue-50 border border-blue-200 rounded p-3">
                                        <p className="text-sm text-blue-800">
                                            <strong>â„¹ï¸ ê°œì¸ ì „ë¬¸ê°€ ì‹¬ì‚¬ ê¸°ì¤€:</strong>
                                        </p>
                                        <ul className="text-xs text-blue-700 mt-1 space-y-1">
                                            <li>â€¢ í•´ë‹¹ ë¶„ì•¼ 5ë…„ ì´ìƒ ì‹¤ë¬´ ê²½í—˜</li>
                                            <li>â€¢ í¬íŠ¸í´ë¦¬ì˜¤, ê²½ë ¥ì¦ëª…ì„œ, ì¶”ì²œì„œ ë“± ì œì¶œ</li>
                                            <li>â€¢ ì‹¬í™” ì¸í„°ë·° ë˜ëŠ” ì‹¤ë¬´ í…ŒìŠ¤íŠ¸ ì§„í–‰</li>
                                            <li>â€¢ ì‹¬ì‚¬ ê¸°ê°„: ì˜ì—…ì¼ ê¸°ì¤€ 7-10ì¼</li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ê²½ë ¥/í¬íŠ¸í´ë¦¬ì˜¤ íŒŒì¼ ì—…ë¡œë“œ</label>
                                        <div className="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-orange-400 transition-colors">
                                            <div className="space-y-1 text-center">
                                                <svg className="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" strokeWidth={2} strokeLinecap="round" strokeLinejoin="round" />
                                                </svg>
                                                <div className="flex text-sm text-gray-600">
                                                    <label htmlFor="portfolio-upload" className="relative cursor-pointer bg-white rounded-md font-medium text-orange-600 hover:text-orange-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-orange-500">
                                                        <span>ê²½ë ¥ì¦ëª… íŒŒì¼ ì—…ë¡œë“œ</span>
                                                        <input id="portfolio-upload" name="portfolio-upload" type="file" className="sr-only" 
                                                               accept=".jpg,.jpeg,.png,.pdf,.doc,.docx"
                                                               multiple
                                                               onChange={(e) => {
                                                                   const files = Array.from(e.target.files);
                                                                   const totalSize = files.reduce((sum, file) => sum + file.size, 0);
                                                                   if (totalSize > 20 * 1024 * 1024) {
                                                                       alert('ì „ì²´ íŒŒì¼ í¬ê¸°ëŠ” 20MB ì´í•˜ë¡œ ì œí•œë©ë‹ˆë‹¤.');
                                                                       return;
                                                                   }
                                                                   updateExpertProfile('portfolioFiles', files);
                                                               }}
                                                        />
                                                    </label>
                                                    <p className="pl-1">ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</p>
                                                </div>
                                                <p className="text-xs text-gray-500">JPG, PNG, PDF, DOC (ì „ì²´ ìµœëŒ€ 20MB, ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥)</p>
                                                {expertProfile.portfolioFiles && expertProfile.portfolioFiles.length > 0 && (
                                                    <div className="mt-2 space-y-1">
                                                        {Array.from(expertProfile.portfolioFiles).map((file, index) => (
                                                            <p key={index} className="text-sm text-green-600 font-medium">
                                                                âœ“ {file.name}
                                                            </p>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ì „ë¬¸ì„± ì„¤ëª…</label>
                                        <textarea
                                            rows="4"
                                            value={expertProfile.expertiseDescription || ''}
                                            onChange={(e) => updateExpertProfile('expertiseDescription', e.target.value)}
                                            className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500"
                                            placeholder="ìê²©ì¦ì´ë‚˜ ì‚¬ì—…ìë“±ë¡ì´ ì—†ì§€ë§Œ í•´ë‹¹ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ì¸ ì´ìœ ë¥¼ ìƒì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”. (ê²½ë ¥, ì‹¤ì , ì „ë¬¸ì„±ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ )"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">ìµœì†Œ 200ì ì´ìƒ ìƒì„¸ ê¸°ìˆ  ê¶Œì¥</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white border border-orange-200 rounded p-3">
                                <p className="text-sm text-orange-800">
                                    <strong>âš ï¸ ê²€ì¦ ì•ˆë‚´:</strong> 
                                </p>
                                <ul className="text-xs text-orange-700 mt-1 space-y-1">
                                    <li>â€¢ ì˜µì…˜ 1,2: ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” êµ­ì„¸ì²­, ìê²©ì¦ì€ ë°œê¸‰ê¸°ê´€ì—ì„œ ê²€ì¦</li>
                                    <li>â€¢ ì˜µì…˜ 3: ì œì¶œ ì„œë¥˜ ë° ì‹¬í™” ì‹¬ì‚¬ë¥¼ í†µí•´ ì „ë¬¸ì„± ê²€ì¦</li>
                                    <li>â€¢ í—ˆìœ„ ì •ë³´ ì œì¶œì‹œ ë“±ë¡ ê±°ë¶€ ë° ì„œë¹„ìŠ¤ ì´ìš© ì œí•œ</li>
                                    <li>â€¢ ê²€í†  ê¸°ê°„: ì˜µì…˜ 1,2ëŠ” 3-5ì¼, ì˜µì…˜ 3ì€ 7-10ì¼</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        // ë§ˆì´í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        const MyPageComponent = ({ currentUser, onClose, getUserType, getUserTypeName, isAdminUser, isGuest }) => {
            const [userType, setUserType] = useState('member');
            const [userTypeName, setUserTypeName] = useState('ì¼ë°˜íšŒì›');
            const [activeTab, setActiveTab] = useState('profile');
            
            // ì‚¬ìš©ì íƒ€ì… í™•ì¸ (async)
            useEffect(() => {
                const checkUserType = async () => {
                    const type = await getUserType(currentUser);
                    const typeName = getUserTypeName(type);
                    setUserType(type);
                    setUserTypeName(typeName);
                };
                
                if (currentUser) {
                    checkUserType();
                }
            }, [currentUser]);

            // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìëŠ” ë‚´ ì •ë³´ë§Œ ì‚¬ìš© ê°€ëŠ¥ - currentUser.isGuest ì‚¬ìš©
            const isCurrentUserGuest = currentUser?.isGuest;
            const tabs = [
                { id: 'profile', name: 'ë‚´ ì •ë³´', icon: 'ğŸ‘¤' },
                // ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆê±°ë‚˜ ì „ë¬¸ê°€/ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ
                ...(!isCurrentUserGuest ? [
                    { id: 'activity', name: 'í™œë™ ë‚´ì—­', icon: 'ğŸ“Š' },
                    { id: 'contact', name: 'ì—°ë½ì²˜ êµí™˜', icon: 'ğŸ“' }
                ] : []),
                // ê´€ë¦¬ìëŠ” ëª¨ë“  íƒ­ ì ‘ê·¼ ê°€ëŠ¥, ì „ë¬¸ê°€ëŠ” ì „ë¬¸ê°€ íƒ­ë§Œ
                ...(userType === 'expert' || userType === 'admin' ? [{ id: 'expert', name: 'ì „ë¬¸ê°€ ê´€ë¦¬', icon: 'ğŸ¯' }] : []),
                ...(userType === 'admin' ? [{ id: 'admin', name: 'ê´€ë¦¬ì', icon: 'ğŸ‘‘' }] : [])
            ];

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* í—¤ë” */}
                    <div className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-4xl mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
                                        <span className="text-white font-bold text-lg">
                                            {userType === 'admin' ? 'ğŸ‘‘' : userType === 'expert' ? 'ğŸ¯' : 'ğŸ‘¤'}
                                        </span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-800">ë§ˆì´í˜ì´ì§€</h1>
                                        <div className="flex items-center space-x-2">
                                            <span className="text-gray-600">{currentUser?.nickname || currentUser?.email}</span>
                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                userType === 'admin' ? 'bg-red-100 text-red-800' :
                                                userType === 'expert' ? 'bg-orange-100 text-orange-800' :
                                                'bg-blue-100 text-blue-800'
                                            }`}>
                                                {userTypeName}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <button
                                    onClick={onClose}
                                    className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                                >
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* íƒ­ ë©”ë‰´ */}
                    <div className="bg-white border-b border-gray-200">
                        <div className="max-w-4xl mx-auto px-4">
                            <div className="flex space-x-8">
                                {tabs.map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${
                                            activeTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.icon} {tab.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* íƒ­ ì»¨í…ì¸  */}
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        {activeTab === 'profile' && (
                            <ProfileTab currentUser={currentUser} userType={userType} userTypeName={userTypeName} />
                        )}
                        {/* ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆê±°ë‚˜ ì „ë¬¸ê°€/ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ */}
                        {activeTab === 'activity' && !isCurrentUserGuest && (
                            <ActivityTab currentUser={currentUser} userType={userType} />
                        )}
                        {activeTab === 'contact' && !isCurrentUserGuest && (
                            <ContactExchangeComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                        )}
                        {activeTab === 'expert' && userType === 'expert' && (
                            <ExpertTab currentUser={currentUser} />
                        )}
                        {activeTab === 'admin' && userType === 'admin' && (
                            <AdminTab currentUser={currentUser} />
                        )}
                        
                        {/* ê²ŒìŠ¤íŠ¸ê°€ ì œí•œëœ íƒ­ì— ì ‘ê·¼í•œ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ */}
                        {isCurrentUserGuest && (activeTab === 'activity' || activeTab === 'contact') && (
                            <div className="text-center py-12">
                                <div className="bg-amber-50 border border-amber-200 rounded-lg p-8 max-w-md mx-auto">
                                    <div className="text-4xl mb-4">ğŸš«</div>
                                    <h3 className="text-lg font-semibold text-amber-800 mb-2">ê²ŒìŠ¤íŠ¸ ì‚¬ìš© ì œí•œ</h3>
                                    <p className="text-amber-600 mb-4">ì´ ê¸°ëŠ¥ì€ ì •ì‹ íšŒì›ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                    <button 
                                        onClick={() => {
                                            setAuthMode('signup');
                                            setCurrentView('login');
                                            setShowAuthForm(true);
                                        }}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                    >
                                        íšŒì›ê°€ì…í•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ë‚´ ì •ë³´ íƒ­
        const ProfileTab = ({ currentUser, userType, userTypeName }) => (
            <div className="space-y-6">
                <div className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-xl font-semibold mb-4">ê¸°ë³¸ ì •ë³´</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                            <div className="p-3 bg-gray-50 rounded-lg text-gray-800">{currentUser?.email}</div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">ë‹‰ë„¤ì„</label>
                            <div className="p-3 bg-gray-50 rounded-lg text-gray-800">{currentUser?.nickname || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ'}</div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">íšŒì› ìœ í˜•</label>
                            <div className="p-3 bg-gray-50 rounded-lg">
                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                    userType === 'admin' ? 'bg-red-100 text-red-800' :
                                    userType === 'expert' ? 'bg-orange-100 text-orange-800' :
                                    'bg-blue-100 text-blue-800'
                                }`}>
                                    {userTypeName}
                                </span>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">ê°€ì…ì¼</label>
                            <div className="p-3 bg-gray-50 rounded-lg text-gray-800">
                                {currentUser?.created_at ? new Date(currentUser.created_at).toLocaleDateString() : 'ì •ë³´ ì—†ìŒ'}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // í™œë™ ë‚´ì—­ íƒ­
        const ActivityTab = ({ currentUser, userType }) => {
            const [bookingHistory, setBookingHistory] = React.useState([]);
            const [paymentHistory, setPaymentHistory] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [activeSubTab, setActiveSubTab] = React.useState('overview');

            // ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            React.useEffect(() => {
                // ëª¨ì˜ ì˜ˆì•½ ë‚´ì—­ ë°ì´í„°
                const mockBookings = [
                    {
                        id: 1,
                        expertName: 'ê¹€ì „ë¬¸ê°€',
                        consultationType: 'íˆ¬ì ìƒë‹´',
                        date: '2025-08-20',
                        time: '14:00',
                        status: 'completed',
                        price: 50000,
                        duration: 60,
                        rating: 5,
                        review: 'ë§¤ìš° ìœ ìš©í•œ ìƒë‹´ì´ì—ˆìŠµë‹ˆë‹¤.'
                    },
                    {
                        id: 2,
                        expertName: 'ì´ì „ë¬¸ê°€',
                        consultationType: 'ë¶€ë™ì‚° ìƒë‹´',
                        date: '2025-08-18',
                        time: '16:30',
                        status: 'completed',
                        price: 75000,
                        duration: 90,
                        rating: 4,
                        review: null
                    },
                    {
                        id: 3,
                        expertName: 'ë°•ì „ë¬¸ê°€',
                        consultationType: 'ì„¸ê¸ˆ ìƒë‹´',
                        date: '2025-08-25',
                        time: '10:00',
                        status: 'scheduled',
                        price: 60000,
                        duration: 60,
                        rating: null,
                        review: null
                    }
                ];

                // ëª¨ì˜ ê²°ì œ ë‚´ì—­ ë°ì´í„°
                const mockPayments = [
                    {
                        id: 1,
                        bookingId: 1,
                        date: '2025-08-19',
                        amount: 50000,
                        method: 'ì‹ ìš©ì¹´ë“œ',
                        status: 'completed',
                        transactionId: 'TXN123456789'
                    },
                    {
                        id: 2,
                        bookingId: 2,
                        date: '2025-08-17',
                        amount: 75000,
                        method: 'ê³„ì¢Œì´ì²´',
                        status: 'completed',
                        transactionId: 'TXN987654321'
                    },
                    {
                        id: 3,
                        bookingId: 3,
                        date: '2025-08-24',
                        amount: 60000,
                        method: 'ì‹ ìš©ì¹´ë“œ',
                        status: 'pending',
                        transactionId: 'TXN456789123'
                    }
                ];

                setTimeout(() => {
                    setBookingHistory(mockBookings);
                    setPaymentHistory(mockPayments);
                    setLoading(false);
                }, 1000);
            }, []);

            const getStatusBadge = (status) => {
                const statusConfig = {
                    completed: { bg: 'bg-green-100', text: 'text-green-800', label: 'ì™„ë£Œ' },
                    scheduled: { bg: 'bg-blue-100', text: 'text-blue-800', label: 'ì˜ˆì •' },
                    cancelled: { bg: 'bg-red-100', text: 'text-red-800', label: 'ì·¨ì†Œ' },
                    pending: { bg: 'bg-yellow-100', text: 'text-yellow-800', label: 'ëŒ€ê¸°ì¤‘' }
                };
                const config = statusConfig[status] || statusConfig.pending;
                return (
                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${config.bg} ${config.text}`}>
                        {config.label}
                    </span>
                );
            };

            const renderStars = (rating) => {
                if (!rating) return null;
                return (
                    <div className="flex items-center">
                        {[...Array(5)].map((_, i) => (
                            <svg
                                key={i}
                                className={`w-4 h-4 ${i < rating ? 'text-yellow-400' : 'text-gray-300'}`}
                                fill="currentColor"
                                viewBox="0 0 20 20"
                            >
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                        ))}
                        <span className="ml-1 text-sm text-gray-600">({rating}/5)</span>
                    </div>
                );
            };

            return (
                <div className="space-y-6">
                    {/* í™œë™ í†µê³„ */}
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-xl font-semibold mb-4">í™œë™ í†µê³„</h2>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">{bookingHistory.filter(b => b.status === 'completed').length}</div>
                                <div className="text-sm text-gray-600">ì™„ë£Œëœ ìƒë‹´</div>
                            </div>
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-2xl font-bold text-green-600">{bookingHistory.filter(b => b.status === 'scheduled').length}</div>
                                <div className="text-sm text-gray-600">ì˜ˆì •ëœ ìƒë‹´</div>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <div className="text-2xl font-bold text-purple-600">
                                    {paymentHistory.reduce((sum, p) => p.status === 'completed' ? sum + p.amount : sum, 0).toLocaleString()}ì›
                                </div>
                                <div className="text-sm text-gray-600">ì´ ê²°ì œ ê¸ˆì•¡</div>
                            </div>
                            <div className="text-center p-4 bg-orange-50 rounded-lg">
                                <div className="text-2xl font-bold text-orange-600">
                                    {bookingHistory.filter(b => b.rating).reduce((sum, b) => sum + b.rating, 0) / bookingHistory.filter(b => b.rating).length || 0}
                                </div>
                                <div className="text-sm text-gray-600">í‰ê·  í‰ì </div>
                            </div>
                        </div>
                    </div>

                    {/* ì„œë¸Œíƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
                    <div className="bg-white rounded-lg shadow">
                        <div className="border-b border-gray-200">
                            <nav className="flex space-x-8 px-6">
                                {[
                                    { id: 'overview', label: 'ê°œìš”' },
                                    { id: 'bookings', label: 'ìƒë‹´ ë‚´ì—­' },
                                    { id: 'payments', label: 'ê²°ì œ ë‚´ì—­' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveSubTab(tab.id)}
                                        className={`py-4 px-1 border-b-2 font-medium text-sm ${
                                            activeSubTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </nav>
                        </div>

                        <div className="p-6">
                            {loading ? (
                                <div className="text-center py-8">
                                    <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                    <p className="mt-2 text-gray-600">ë¡œë”© ì¤‘...</p>
                                </div>
                            ) : (
                                <>
                                    {/* ê°œìš” íƒ­ */}
                                    {activeSubTab === 'overview' && (
                                        <div className="space-y-4">
                                            <h3 className="text-lg font-semibold">ìµœê·¼ í™œë™</h3>
                                            <div className="space-y-3">
                                                {bookingHistory.slice(0, 3).map(booking => (
                                                    <div key={booking.id} className="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                                        <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                                                        <div className="flex-1">
                                                            <div className="text-sm font-medium">{booking.consultationType} - {booking.expertName}</div>
                                                            <div className="text-xs text-gray-500">{booking.date} {booking.time}</div>
                                                        </div>
                                                        {getStatusBadge(booking.status)}
                                                    </div>
                                                ))}
                                                {bookingHistory.length === 0 && (
                                                    <div className="text-center text-gray-500 py-4">
                                                        ì•„ì§ ìƒë‹´ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* ìƒë‹´ ë‚´ì—­ íƒ­ */}
                                    {activeSubTab === 'bookings' && (
                                        <div className="space-y-4">
                                            <h3 className="text-lg font-semibold">ì „ì²´ ìƒë‹´ ë‚´ì—­</h3>
                                            <div className="space-y-4">
                                                {bookingHistory.map(booking => (
                                                    <div key={booking.id} className="border border-gray-200 rounded-lg p-4">
                                                        <div className="flex justify-between items-start mb-3">
                                                            <div>
                                                                <h4 className="font-semibold text-lg">{booking.consultationType}</h4>
                                                                <p className="text-gray-600">ì „ë¬¸ê°€: {booking.expertName}</p>
                                                                <p className="text-sm text-gray-500">
                                                                    {booking.date} {booking.time} ({booking.duration}ë¶„)
                                                                </p>
                                                            </div>
                                                            <div className="text-right">
                                                                {getStatusBadge(booking.status)}
                                                                <p className="text-lg font-bold text-gray-900 mt-1">
                                                                    {booking.price.toLocaleString()}ì›
                                                                </p>
                                                            </div>
                                                        </div>
                                                        {booking.rating && (
                                                            <div className="mt-3 pt-3 border-t border-gray-100">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm font-medium">ë‚´ í‰ê°€:</p>
                                                                        {renderStars(booking.rating)}
                                                                    </div>
                                                                </div>
                                                                {booking.review && (
                                                                    <p className="mt-2 text-sm text-gray-700 italic">"{booking.review}"</p>
                                                                )}
                                                            </div>
                                                        )}
                                                        {booking.status === 'scheduled' && (
                                                            <div className="mt-3 pt-3 border-t border-gray-100 flex space-x-2">
                                                                <button className="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                                                                    ìƒë‹´ ì¤€ë¹„í•˜ê¸°
                                                                </button>
                                                                <button className="px-4 py-2 border border-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-50">
                                                                    ì¼ì • ë³€ê²½
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                                {bookingHistory.length === 0 && (
                                                    <div className="text-center text-gray-500 py-8">
                                                        <p>ì•„ì§ ìƒë‹´ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                                        <button className="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                                            ì²« ìƒë‹´ ì˜ˆì•½í•˜ê¸°
                                                        </button>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* ê²°ì œ ë‚´ì—­ íƒ­ */}
                                    {activeSubTab === 'payments' && (
                                        <div className="space-y-4">
                                            <h3 className="text-lg font-semibold">ê²°ì œ ë‚´ì—­</h3>
                                            <div className="overflow-x-auto">
                                                <table className="min-w-full divide-y divide-gray-200">
                                                    <thead className="bg-gray-50">
                                                        <tr>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê²°ì œì¼</th>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒë‹´ ìœ í˜•</th>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê¸ˆì•¡</th>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê²°ì œ ë°©ë²•</th>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê±°ë˜ë²ˆí˜¸</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white divide-y divide-gray-200">
                                                        {paymentHistory.map(payment => {
                                                            const booking = bookingHistory.find(b => b.id === payment.bookingId);
                                                            return (
                                                                <tr key={payment.id}>
                                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{payment.date}</td>
                                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                        {booking?.consultationType || 'ìƒë‹´'}
                                                                    </td>
                                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                                        {payment.amount.toLocaleString()}ì›
                                                                    </td>
                                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{payment.method}</td>
                                                                    <td className="px-6 py-4 whitespace-nowrap">{getStatusBadge(payment.status)}</td>
                                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">
                                                                        {payment.transactionId}
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                                {paymentHistory.length === 0 && (
                                                    <div className="text-center text-gray-500 py-8">
                                                        ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ì „ë¬¸ê°€ ê´€ë¦¬ íƒ­
        const ExpertTab = ({ currentUser }) => (
            <div className="space-y-6">
                <div className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-xl font-semibold mb-4">ì „ë¬¸ê°€ ëŒ€ì‹œë³´ë“œ</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="text-center p-4 bg-orange-50 rounded-lg">
                            <div className="text-2xl font-bold text-orange-600">8</div>
                            <div className="text-sm text-gray-600">ì´ ìƒë‹´ ê±´ìˆ˜</div>
                        </div>
                        <div className="text-center p-4 bg-green-50 rounded-lg">
                            <div className="text-2xl font-bold text-green-600">4.8</div>
                            <div className="text-sm text-gray-600">í‰ê·  í‰ì </div>
                        </div>
                        <div className="text-center p-4 bg-blue-50 rounded-lg">
                            <div className="text-2xl font-bold text-blue-600">95%</div>
                            <div className="text-sm text-gray-600">ì‘ë‹µë¥ </div>
                        </div>
                    </div>
                </div>
                
                <div className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-xl font-semibold mb-4">ì˜ˆì•½ ê´€ë¦¬</h2>
                    <div className="text-center text-gray-500 py-8">
                        ì˜ˆì•½ ê´€ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤
                    </div>
                </div>
            </div>
        );

        // ê´€ë¦¬ì íƒ­
        const AdminTab = ({ currentUser }) => {
            const [activeSection, setActiveSection] = useState('dashboard');
            const [stats, setStats] = useState({
                totalUsers: 156,
                totalExperts: 12,
                totalPosts: 234,
                completedCalculations: 89,
                totalRevenue: 2450000,
                pendingSettlements: 5,
                thisMonthRevenue: 890000,
                platformFee: 245000
            });

            return (
                <div className="space-y-6">
                    {/* íƒ­ ë©”ë‰´ */}
                    <div className="bg-white rounded-lg shadow">
                        <div className="border-b border-gray-200">
                            <div className="flex space-x-8 px-6">
                                {[
                                    { id: 'dashboard', name: 'ëŒ€ì‹œë³´ë“œ', icon: 'ğŸ“Š' },
                                    { id: 'settlements', name: 'ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬', icon: 'ğŸ’°' },
                                    { id: 'experts', name: 'ì „ë¬¸ê°€ ê´€ë¦¬', icon: 'ğŸ¯' },
                                    { id: 'users', name: 'íšŒì› ê´€ë¦¬', icon: 'ğŸ‘¥' }
                                ].map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveSection(tab.id)}
                                        className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${
                                            activeSection === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.icon} {tab.name}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="p-6">
                            {activeSection === 'dashboard' && <AdminDashboard stats={stats} setActiveSection={setActiveSection} />}
                            {activeSection === 'settlements' && <FeeManagementSection currentUser={currentUser} />}
                            {activeSection === 'experts' && <ExpertManagementSection currentUser={currentUser} />}
                            {activeSection === 'users' && <UserManagementSection currentUser={currentUser} />}
                        </div>
                    </div>
                </div>
            );
        };

        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
        const AdminDashboard = ({ stats, setActiveSection }) => (
            <div className="space-y-6">
                <h2 className="text-xl font-semibold">ğŸ“Š í”Œë«í¼ í˜„í™©</h2>
                
                {/* ì£¼ìš” ì§€í‘œ */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div className="text-center p-4 bg-red-50 rounded-lg">
                        <div className="text-2xl font-bold text-red-600">{stats.totalUsers}</div>
                        <div className="text-sm text-gray-600">ì „ì²´ íšŒì›ìˆ˜</div>
                    </div>
                    <div className="text-center p-4 bg-orange-50 rounded-lg">
                        <div className="text-2xl font-bold text-orange-600">{stats.totalExperts}</div>
                        <div className="text-sm text-gray-600">ë“±ë¡ëœ ì „ë¬¸ê°€</div>
                    </div>
                    <div className="text-center p-4 bg-blue-50 rounded-lg">
                        <div className="text-2xl font-bold text-blue-600">{stats.totalPosts}</div>
                        <div className="text-sm text-gray-600">ì´ ê²Œì‹œê¸€</div>
                    </div>
                    <div className="text-center p-4 bg-green-50 rounded-lg">
                        <div className="text-2xl font-bold text-green-600">{stats.completedCalculations}</div>
                        <div className="text-sm text-gray-600">ê³„ì‚° ì™„ë£Œ</div>
                    </div>
                </div>

                {/* ìˆ˜ìµ ì§€í‘œ */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div className="text-center p-4 bg-purple-50 rounded-lg">
                        <div className="text-2xl font-bold text-purple-600">{stats.totalRevenue.toLocaleString()}ì›</div>
                        <div className="text-sm text-gray-600">ëˆ„ì  ê±°ë˜ì•¡</div>
                    </div>
                    <div className="text-center p-4 bg-indigo-50 rounded-lg">
                        <div className="text-2xl font-bold text-indigo-600">{stats.thisMonthRevenue.toLocaleString()}ì›</div>
                        <div className="text-sm text-gray-600">ì´ë²ˆ ë‹¬ ê±°ë˜ì•¡</div>
                    </div>
                    <div className="text-center p-4 bg-emerald-50 rounded-lg">
                        <div className="text-2xl font-bold text-emerald-600">{stats.platformFee.toLocaleString()}ì›</div>
                        <div className="text-sm text-gray-600">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</div>
                    </div>
                    <div className="text-center p-4 bg-amber-50 rounded-lg">
                        <div className="text-2xl font-bold text-amber-600">{stats.pendingSettlements}</div>
                        <div className="text-sm text-gray-600">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚°</div>
                    </div>
                </div>

                {/* ë¹ ë¥¸ ì•¡ì…˜ */}
                <div className="bg-gray-50 rounded-lg p-4">
                    <h3 className="font-medium mb-4">ğŸ“‹ ë¹ ë¥¸ ì‘ì—…</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <button className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm">
                            <div className="font-medium text-blue-600">ğŸ’° ì •ì‚° ì²˜ë¦¬</div>
                            <div className="text-gray-500">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚° í™•ì¸</div>
                        </button>
                        <button className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm">
                            <div className="font-medium text-green-600">ğŸ“Š ì›”ê°„ ë¦¬í¬íŠ¸</div>
                            <div className="text-gray-500">ì›”ê°„ ìˆ˜ìµ ë³´ê³ ì„œ ìƒì„±</div>
                        </button>
                        <button 
                            onClick={() => setActiveSection('experts')}
                            className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm cursor-pointer hover:border-purple-300 transition-colors"
                        >
                            <div className="font-medium text-purple-600">ğŸ‘‘ ì „ë¬¸ê°€ ìŠ¹ì¸</div>
                            <div className="text-gray-500">ì‹ ê·œ ì „ë¬¸ê°€ ê²€í† </div>
                        </button>
                    </div>
                </div>
            </div>
        );

        // ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬ ì„¹ì…˜
        const FeeManagementSection = ({ currentUser }) => {
            const [settlements, setSettlements] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedPeriod, setSelectedPeriod] = useState('current');
            const [showCreateSettlement, setShowCreateSettlement] = useState(false);

            // ì •ì‚° ëª©ë¡ ë¡œë“œ
            const loadSettlements = async () => {
                try {
                    setLoading(true);
                    // ì‹¤ì œë¡œëŠ” Supabaseì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                    // const { data, error } = await supabase...
                    
                    // ìƒ˜í”Œ ë°ì´í„°
                    const sampleSettlements = [
                        {
                            id: 1,
                            expert_id: 'expert1',
                            expert_name: 'ê¹€ì „ë¬¸ê°€',
                            settlement_period: '2024-08',
                            total_bookings: 15,
                            total_revenue: 1500000,
                            platform_fee: 150000,
                            expert_payout: 1350000,
                            status: 'pending',
                            created_at: '2024-08-31T09:00:00Z'
                        },
                        {
                            id: 2,
                            expert_id: 'expert2',
                            expert_name: 'ì´ì „ë¬¸ê°€',
                            settlement_period: '2024-08',
                            total_bookings: 8,
                            total_revenue: 800000,
                            platform_fee: 80000,
                            expert_payout: 720000,
                            status: 'completed',
                            created_at: '2024-08-25T14:30:00Z'
                        },
                        {
                            id: 3,
                            expert_id: 'expert3',
                            expert_name: 'ë°•ì „ë¬¸ê°€',
                            settlement_period: '2024-08',
                            total_bookings: 12,
                            total_revenue: 1200000,
                            platform_fee: 120000,
                            expert_payout: 1080000,
                            status: 'processing',
                            created_at: '2024-08-28T11:15:00Z'
                        }
                    ];
                    
                    setSettlements(sampleSettlements);
                } catch (error) {
                    console.error('ì •ì‚° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì •ì‚° ìŠ¹ì¸
            const approveSettlement = async (settlementId) => {
                try {
                    // ì‹¤ì œë¡œëŠ” Supabase ì—…ë°ì´íŠ¸
                    // await supabase.from('fee_settlements').update({ status: 'completed' }).eq('id', settlementId);
                    
                    alert('ì •ì‚°ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadSettlements();
                } catch (error) {
                    console.error('ì •ì‚° ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                    alert('ì •ì‚° ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ì •ì‚° ìƒì„±
            const createSettlement = async () => {
                try {
                    // ì‹¤ì œë¡œëŠ” ì •ì‚° ë¡œì§ ì‹¤í–‰
                    alert('ì •ì‚°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    setShowCreateSettlement(false);
                    loadSettlements();
                } catch (error) {
                    console.error('ì •ì‚° ìƒì„± ì˜¤ë¥˜:', error);
                    alert('ì •ì‚° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ìƒíƒœë³„ ë°°ì§€ ìƒ‰ìƒ
            const getStatusBadge = (status) => {
                switch (status) {
                    case 'pending':
                        return <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">ìŠ¹ì¸ ëŒ€ê¸°</span>;
                    case 'processing':
                        return <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">ì²˜ë¦¬ ì¤‘</span>;
                    case 'completed':
                        return <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">ì™„ë£Œ</span>;
                    case 'failed':
                        return <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">ì‹¤íŒ¨</span>;
                    default:
                        return <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">{status}</span>;
                }
            };

            useEffect(() => {
                loadSettlements();
            }, []);

            if (loading) {
                return (
                    <div className="flex items-center justify-center py-12">
                        <div className="text-center">
                            <div className="text-4xl mb-4">ğŸ’°</div>
                            <p className="text-gray-500">ì •ì‚° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {/* í—¤ë” */}
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-semibold">ğŸ’° ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬</h2>
                        <div className="flex gap-3">
                            <select
                                value={selectedPeriod}
                                onChange={(e) => setSelectedPeriod(e.target.value)}
                                className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="current">ì´ë²ˆ ë‹¬</option>
                                <option value="last">ì§€ë‚œ ë‹¬</option>
                                <option value="all">ì „ì²´</option>
                            </select>
                            <button
                                onClick={() => setShowCreateSettlement(true)}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                â• ì •ì‚° ìƒì„±
                            </button>
                        </div>
                    </div>

                    {/* ì •ì‚° ìš”ì•½ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <div className="text-sm text-blue-600 font-medium">ì´ ì •ì‚° ê±´ìˆ˜</div>
                            <div className="text-2xl font-bold text-blue-700">{settlements.length}</div>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                            <div className="text-sm text-green-600 font-medium">ì™„ë£Œëœ ì •ì‚°</div>
                            <div className="text-2xl font-bold text-green-700">
                                {settlements.filter(s => s.status === 'completed').length}
                            </div>
                        </div>
                        <div className="bg-yellow-50 p-4 rounded-lg">
                            <div className="text-sm text-yellow-600 font-medium">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚°</div>
                            <div className="text-2xl font-bold text-yellow-700">
                                {settlements.filter(s => s.status === 'pending').length}
                            </div>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <div className="text-sm text-purple-600 font-medium">ì´ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</div>
                            <div className="text-2xl font-bold text-purple-700">
                                {settlements.reduce((sum, s) => sum + s.platform_fee, 0).toLocaleString()}ì›
                            </div>
                        </div>
                    </div>

                    {/* ì •ì‚° ëª©ë¡ */}
                    <div className="bg-white rounded-lg border border-gray-200">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h3 className="font-medium text-gray-800">ì •ì‚° ë‚´ì—­</h3>
                        </div>
                        
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì „ë¬¸ê°€</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì •ì‚° ê¸°ê°„</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒë‹´ ê±´ìˆ˜</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì´ ë§¤ì¶œ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì „ë¬¸ê°€ ìˆ˜ë ¹ì•¡</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì•¡ì…˜</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {settlements.map((settlement) => (
                                        <tr key={settlement.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="font-medium text-gray-900">{settlement.expert_name}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {settlement.settlement_period}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.total_bookings}ê±´
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.total_revenue.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.platform_fee.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                {settlement.expert_payout.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                {getStatusBadge(settlement.status)}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                                                {settlement.status === 'pending' && (
                                                    <button
                                                        onClick={() => approveSettlement(settlement.id)}
                                                        className="text-green-600 hover:text-green-900 font-medium"
                                                    >
                                                        ìŠ¹ì¸
                                                    </button>
                                                )}
                                                <button className="text-blue-600 hover:text-blue-900 font-medium">
                                                    ìƒì„¸
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* ì •ì‚° ìƒì„± ëª¨ë‹¬ */}
                    {showCreateSettlement && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold text-gray-800">ì •ì‚° ìƒì„±</h3>
                                    <button
                                        onClick={() => setShowCreateSettlement(false)}
                                        className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                                    >
                                        Ã—
                                    </button>
                                </div>

                                <div className="space-y-4 mb-6">
                                    <p className="text-gray-600">
                                        ì´ë²ˆ ë‹¬ ì™„ë£Œëœ ìƒë‹´ì— ëŒ€í•œ ì •ì‚°ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                                    </p>
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <div className="text-sm space-y-1">
                                            <div>â€¢ ëŒ€ìƒ ê¸°ê°„: 2024ë…„ 8ì›”</div>
                                            <div>â€¢ ì²˜ë¦¬ ì˜ˆìƒ ì‹œê°„: 5-10ë¶„</div>
                                            <div>â€¢ ì •ì‚° ì™„ë£Œ í›„ ì „ë¬¸ê°€ì—ê²Œ ìë™ ì•Œë¦¼</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowCreateSettlement(false)}
                                        className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={createSettlement}
                                        className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                    >
                                        ì •ì‚° ìƒì„±
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì „ë¬¸ê°€ ê´€ë¦¬ ì„¹ì…˜ - ì™„ì „ êµ¬í˜„
        const ExpertManagementSection = ({ currentUser }) => {
            const [activeTab, setActiveTab] = useState('pending');
            const [experts, setExperts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [processingId, setProcessingId] = useState(null);
            const [selectedExpert, setSelectedExpert] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [actionReason, setActionReason] = useState('');

            // ì „ë¬¸ê°€ ëª©ë¡ ë¡œë“œ
            useEffect(() => {
                loadExperts();
            }, [activeTab]);

            const loadExperts = async () => {
                try {
                    setLoading(true);
                    if (supabase) {
                        const { data, error } = await supabase
                            .from('user_profiles')
                            .select('*')
                            .eq('role', 'expert')
                            .eq('expert_status', activeTab)
                            .order('created_at', { ascending: false });
                        
                        if (error) throw error;
                        setExperts(data || []);
                    } else {
                        // ë°ëª¨ ë°ì´í„°
                        const demoExperts = [
                            {
                                id: 1,
                                user_id: 'expert1',
                                email: 'expert1@example.com',
                                nickname: 'ê¹€ì¬ë¬´ì „ë¬¸ê°€',
                                expert_type: 'legal',
                                expert_title: 'ê³µì¸íšŒê³„ì‚¬ â€¢ ì„¸ë¬´ì‚¬',
                                expert_specialties: ['ì„¸ë¬´ìƒë‹´', 'ìì‚°ê´€ë¦¬', 'ì ˆì„¸ì „ëµ'],
                                expert_credentials: ['ê³µì¸íšŒê³„ì‚¬', 'ì„¸ë¬´ì‚¬', 'CFP'],
                                expert_experience_years: '15',
                                expert_bio: '15ë…„ ê²½ë ¥ì˜ ì„¸ë¬´ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê°œì¸ ë° ë²•ì¸ ì„¸ë¬´ ìƒë‹´ì„ ì „ë¬¸ìœ¼ë¡œ í•©ë‹ˆë‹¤.',
                                expert_hourly_rate: '100000',
                                expert_phone: '010-1234-5678',
                                expert_business_license: 'BL-2024-001',
                                expert_qualification_number: 'CPA-12345',
                                expert_status: activeTab,
                                created_at: '2024-08-20T10:30:00Z',
                                expert_available_types: ['phone', 'video']
                            },
                            {
                                id: 2,
                                user_id: 'expert2',
                                email: 'expert2@example.com',
                                nickname: 'ë°•ì—¬í–‰ì „ë¬¸ê°€',
                                expert_type: 'travel',
                                expert_title: 'ì‹œë‹ˆì–´ ì—¬í–‰ í”Œë˜ë„ˆ',
                                expert_specialties: ['ì‹œë‹ˆì–´ì—¬í–‰', 'êµ­ë‚´ì—¬í–‰', 'í•´ì™¸ì—¬í–‰'],
                                expert_credentials: ['ê´€ê´‘í†µì—­ì•ˆë‚´ì‚¬', 'ì—¬í–‰ìƒí’ˆê¸°íšì‚¬'],
                                expert_experience_years: '8',
                                expert_bio: 'ì‹œë‹ˆì–´ ì—¬í–‰ ì „ë¬¸ í”Œë˜ë„ˆë¡œ ì•ˆì „í•˜ê³  ì¦ê±°ìš´ ì—¬í–‰ì„ ê¸°íší•©ë‹ˆë‹¤.',
                                expert_hourly_rate: '80000',
                                expert_phone: '010-9876-5432',
                                expert_business_license: '',
                                expert_qualification_number: 'TG-67890',
                                expert_status: activeTab,
                                created_at: '2024-08-19T14:20:00Z',
                                expert_available_types: ['phone', 'video', 'chat']
                            }
                        ];
                        setExperts(activeTab === 'pending' ? demoExperts : []);
                    }
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    setExperts([]);
                } finally {
                    setLoading(false);
                }
            };

            // ì „ë¬¸ê°€ ìŠ¹ì¸/ê±°ì ˆ ì²˜ë¦¬
            const handleExpertAction = async (expertId, action, reason = '') => {
                if (!confirm(`ì •ë§ë¡œ ì´ ì „ë¬¸ê°€ë¥¼ ${action === 'approve' ? 'ìŠ¹ì¸' : 'ê±°ì ˆ'}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }

                try {
                    setProcessingId(expertId);
                    const newStatus = action === 'approve' ? 'approved' : 'rejected';
                    
                    if (supabase) {
                        const { error } = await supabase
                            .from('user_profiles')
                            .update({ 
                                expert_status: newStatus,
                                expert_status_updated_at: new Date().toISOString(),
                                expert_status_reason: reason || (action === 'approve' ? 'ì „ë¬¸ê°€ ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.' : 'ìê²© ìš”ê±´ ë¯¸ë‹¬')
                            })
                            .eq('user_id', expertId);
                        
                        if (error) throw error;
                        
                        // ìŠ¹ì¸/ê±°ì ˆ ì´ë©”ì¼ ë°œì†¡
                        const currentExpert = experts.find(e => e.user_id === expertId);
                        if (currentExpert) {
                            const emailResult = await sendExpertNotification(currentExpert, action, reason);
                            if (!emailResult.success) {
                                console.warn('ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailResult.message);
                            }
                        }
                    }
                    
                    alert(`ì „ë¬¸ê°€ ${action === 'approve' ? 'ìŠ¹ì¸' : 'ê±°ì ˆ'} ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    setActionReason('');
                    setShowDetailModal(false);
                    loadExperts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                    alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setProcessingId(null);
                }
            };

            // ì „ë¬¸ê°€ ìƒì„¸ ì •ë³´ ë³´ê¸°
            const showExpertDetail = (expert) => {
                setSelectedExpert(expert);
                setShowDetailModal(true);
            };

            const tabs = [
                { id: 'pending', name: 'ìŠ¹ì¸ ëŒ€ê¸°', icon: 'â³', count: experts.filter(e => e.expert_status === 'pending').length },
                { id: 'approved', name: 'ìŠ¹ì¸ë¨', icon: 'âœ…', count: experts.filter(e => e.expert_status === 'approved').length },
                { id: 'rejected', name: 'ê±°ì ˆë¨', icon: 'âŒ', count: experts.filter(e => e.expert_status === 'rejected').length },
                { id: 'all', name: 'ì „ì²´', icon: 'ğŸ“‹', count: experts.length }
            ];

            return (
                <div className="space-y-6">
                    {/* í—¤ë” */}
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl font-semibold">ğŸ¯ ì „ë¬¸ê°€ ìŠ¹ì¸ ê´€ë¦¬</h2>
                        <div className="text-sm text-gray-500">
                            ì´ {experts.length}ëª…ì˜ ì „ë¬¸ê°€
                        </div>
                    </div>

                    {/* íƒ­ ë©”ë‰´ */}
                    <div className="border-b border-gray-200">
                        <div className="flex space-x-8">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`py-2 px-1 border-b-2 font-medium text-sm transition-colors flex items-center space-x-2 ${
                                        activeTab === tab.id
                                            ? 'border-blue-500 text-blue-600'
                                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                    }`}
                                >
                                    <span>{tab.icon}</span>
                                    <span>{tab.name}</span>
                                    {activeTab !== 'all' && (
                                        <span className={`px-2 py-0.5 text-xs rounded-full ${
                                            activeTab === tab.id ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-500'
                                        }`}>
                                            {experts.length}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* ì „ë¬¸ê°€ ëª©ë¡ */}
                    {loading ? (
                        <div className="text-center py-12">
                            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p className="mt-2 text-gray-500">ì „ë¬¸ê°€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    ) : experts.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                            <div className="text-4xl mb-4">ğŸ“</div>
                            <p>{activeTab === 'pending' ? 'ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì „ë¬¸ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'í•´ë‹¹í•˜ëŠ” ì „ë¬¸ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {experts.map((expert) => (
                                <div key={expert.id || expert.user_id} className="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            {/* ê¸°ë³¸ ì •ë³´ */}
                                            <div className="flex items-center space-x-3 mb-3">
                                                <div className="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center">
                                                    <span className="text-white font-bold text-lg">ğŸ¯</span>
                                                </div>
                                                <div>
                                                    <h3 className="text-lg font-semibold text-gray-800">{expert.nickname}</h3>
                                                    <p className="text-orange-600 font-medium">{expert.expert_title}</p>
                                                    <p className="text-sm text-gray-500">{expert.email}</p>
                                                </div>
                                                <div className={`px-3 py-1 rounded-full text-xs font-medium ${
                                                    expert.expert_status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                    expert.expert_status === 'approved' ? 'bg-green-100 text-green-800' :
                                                    'bg-red-100 text-red-800'
                                                }`}>
                                                    {expert.expert_status === 'pending' ? 'â³ ìŠ¹ì¸ëŒ€ê¸°' :
                                                     expert.expert_status === 'approved' ? 'âœ… ìŠ¹ì¸ì™„ë£Œ' : 'âŒ ê±°ì ˆë¨'}
                                                </div>
                                            </div>

                                            {/* ì „ë¬¸ ì •ë³´ */}
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                                <div>
                                                    <label className="text-xs text-gray-500 uppercase tracking-wide">ì¹´í…Œê³ ë¦¬</label>
                                                    <p className="text-sm font-medium">
                                                        {expert.expert_type === 'legal' ? 'ğŸ“‹ ì„¸ë¬´/ë²•ë¬´/ìì‚°ê´€ë¦¬' :
                                                         expert.expert_type === 'travel' ? 'âœˆï¸ ì—¬í–‰/ì·¨ë¯¸' : 'ğŸ  ì£¼ê±°/ìƒí™œ'}
                                                    </p>
                                                </div>
                                                <div>
                                                    <label className="text-xs text-gray-500 uppercase tracking-wide">ê²½ë ¥</label>
                                                    <p className="text-sm font-medium">{expert.expert_experience_years}ë…„</p>
                                                </div>
                                                <div>
                                                    <label className="text-xs text-gray-500 uppercase tracking-wide">ìƒë‹´ë£Œ</label>
                                                    <p className="text-sm font-medium">{Number(expert.expert_hourly_rate).toLocaleString()}ì›/ì‹œê°„</p>
                                                </div>
                                            </div>

                                            {/* ì „ë¬¸ë¶„ì•¼ */}
                                            <div className="mb-3">
                                                <label className="text-xs text-gray-500 uppercase tracking-wide">ì „ë¬¸ë¶„ì•¼</label>
                                                <div className="flex flex-wrap gap-2 mt-1">
                                                    {expert.expert_specialties.map((specialty, index) => (
                                                        <span key={index} className="px-2 py-1 bg-blue-50 text-blue-600 text-xs rounded-full">
                                                            {specialty}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* ìê²©ì¦ */}
                                            <div className="mb-4">
                                                <label className="text-xs text-gray-500 uppercase tracking-wide">ìê²©ì¦</label>
                                                <div className="flex flex-wrap gap-2 mt-1">
                                                    {expert.expert_credentials.map((credential, index) => (
                                                        <span key={index} className="px-2 py-1 bg-green-50 text-green-600 text-xs rounded-full">
                                                            {credential}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* ë“±ë¡ì¼ */}
                                            <p className="text-xs text-gray-500">
                                                ë“±ë¡ì¼: {new Date(expert.created_at).toLocaleDateString('ko-KR')}
                                            </p>
                                        </div>

                                        {/* ì•¡ì…˜ ë²„íŠ¼ */}
                                        <div className="flex flex-col space-y-2 ml-4">
                                            <button
                                                onClick={() => showExpertDetail(expert)}
                                                className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm rounded-lg transition-colors"
                                            >
                                                ğŸ“‹ ìƒì„¸ë³´ê¸°
                                            </button>
                                            
                                            {expert.expert_status === 'pending' && (
                                                <>
                                                    <button
                                                        onClick={() => handleExpertAction(expert.user_id, 'approve')}
                                                        disabled={processingId === expert.user_id}
                                                        className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg transition-colors disabled:bg-gray-400"
                                                    >
                                                        {processingId === expert.user_id ? 'ì²˜ë¦¬ì¤‘...' : 'âœ… ìŠ¹ì¸'}
                                                    </button>
                                                    <button
                                                        onClick={() => handleExpertAction(expert.user_id, 'reject')}
                                                        disabled={processingId === expert.user_id}
                                                        className="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors disabled:bg-gray-400"
                                                    >
                                                        {processingId === expert.user_id ? 'ì²˜ë¦¬ì¤‘...' : 'âŒ ê±°ì ˆ'}
                                                    </button>
                                                </>
                                            )}
                                            
                                            {expert.expert_status === 'approved' && (
                                                <button
                                                    onClick={() => handleExpertAction(expert.user_id, 'reject')}
                                                    disabled={processingId === expert.user_id}
                                                    className="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white text-sm rounded-lg transition-colors disabled:bg-gray-400"
                                                >
                                                    ğŸ”„ ìŠ¹ì¸ì·¨ì†Œ
                                                </button>
                                            )}
                                            
                                            {expert.expert_status === 'rejected' && (
                                                <button
                                                    onClick={() => handleExpertAction(expert.user_id, 'approve')}
                                                    disabled={processingId === expert.user_id}
                                                    className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg transition-colors disabled:bg-gray-400"
                                                >
                                                    ğŸ”„ ì¬ìŠ¹ì¸
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* ì „ë¬¸ê°€ ìƒì„¸ ëª¨ë‹¬ */}
                    {showDetailModal && selectedExpert && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl max-w-2xl w-full max-h-90vh overflow-y-auto">
                                <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                                    <h3 className="text-lg font-semibold">ì „ë¬¸ê°€ ìƒì„¸ ì •ë³´</h3>
                                    <button
                                        onClick={() => setShowDetailModal(false)}
                                        className="text-gray-400 hover:text-gray-600 transition-colors"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="p-6 space-y-6">
                                    {/* ê¸°ë³¸ ì •ë³´ */}
                                    <div>
                                        <h4 className="font-medium text-gray-900 mb-3">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</h4>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="text-sm text-gray-500">ì´ë©”ì¼</label>
                                                <p className="font-medium">{selectedExpert.email}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ë‹‰ë„¤ì„</label>
                                                <p className="font-medium">{selectedExpert.nickname}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ì „í™”ë²ˆí˜¸</label>
                                                <p className="font-medium">{selectedExpert.expert_phone}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                                                <p className="font-medium">{selectedExpert.expert_business_license || 'ê°œì¸ ì „ë¬¸ê°€'}</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ì „ë¬¸ê°€ ì •ë³´ */}
                                    <div>
                                        <h4 className="font-medium text-gray-900 mb-3">ğŸ¯ ì „ë¬¸ê°€ ì •ë³´</h4>
                                        <div className="space-y-3">
                                            <div>
                                                <label className="text-sm text-gray-500">ì „ë¬¸ê°€ íƒ€ì´í‹€</label>
                                                <p className="font-medium text-orange-600">{selectedExpert.expert_title}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ê²½ë ¥</label>
                                                <p className="font-medium">{selectedExpert.expert_experience_years}ë…„</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ìê¸°ì†Œê°œ</label>
                                                <p className="text-gray-700 whitespace-pre-wrap">{selectedExpert.expert_bio}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ì‹œê°„ë‹¹ ìƒë‹´ë£Œ</label>
                                                <p className="font-medium text-green-600">{Number(selectedExpert.expert_hourly_rate).toLocaleString()}ì›</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ìƒë‹´ ê°€ëŠ¥ ë°©ì‹</label>
                                                <div className="flex gap-2 mt-1">
                                                    {selectedExpert.expert_available_types.map((type) => (
                                                        <span key={type} className="px-2 py-1 bg-blue-50 text-blue-600 text-sm rounded">
                                                            {type === 'phone' ? 'ğŸ“ ì „í™”' : type === 'video' ? 'ğŸ“¹ ì˜ìƒ' : 'ğŸ’¬ ì±„íŒ…'}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ìê²© ì •ë³´ */}
                                    <div>
                                        <h4 className="font-medium text-gray-900 mb-3">ğŸ“œ ìê²© ì •ë³´</h4>
                                        <div className="space-y-3">
                                            <div>
                                                <label className="text-sm text-gray-500">ìê²©ì¦ë²ˆí˜¸</label>
                                                <p className="font-medium">{selectedExpert.expert_qualification_number}</p>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ì „ë¬¸ë¶„ì•¼</label>
                                                <div className="flex flex-wrap gap-2 mt-1">
                                                    {selectedExpert.expert_specialties.map((specialty, index) => (
                                                        <span key={index} className="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                                                            {specialty}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-500">ë³´ìœ  ìê²©ì¦</label>
                                                <div className="flex flex-wrap gap-2 mt-1">
                                                    {selectedExpert.expert_credentials.map((credential, index) => (
                                                        <span key={index} className="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">
                                                            {credential}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ìŠ¹ì¸/ê±°ì ˆ ì²˜ë¦¬ */}
                                    {selectedExpert.expert_status === 'pending' && (
                                        <div className="border-t pt-6">
                                            <h4 className="font-medium text-gray-900 mb-3">âš¡ ìŠ¹ì¸ ì²˜ë¦¬</h4>
                                            <div className="space-y-3">
                                                <div>
                                                    <label className="block text-sm text-gray-500 mb-1">ì²˜ë¦¬ ì‚¬ìœ </label>
                                                    <textarea
                                                        value={actionReason}
                                                        onChange={(e) => setActionReason(e.target.value)}
                                                        placeholder="ìŠ¹ì¸ ë˜ëŠ” ê±°ì ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                                        className="w-full p-3 border border-gray-200 rounded-lg resize-none"
                                                        rows="3"
                                                    />
                                                </div>
                                                <div className="flex space-x-3">
                                                    <button
                                                        onClick={() => handleExpertAction(selectedExpert.user_id, 'approve', actionReason)}
                                                        disabled={processingId === selectedExpert.user_id}
                                                        className="flex-1 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors disabled:bg-gray-400"
                                                    >
                                                        âœ… ìŠ¹ì¸í•˜ê¸°
                                                    </button>
                                                    <button
                                                        onClick={() => handleExpertAction(selectedExpert.user_id, 'reject', actionReason)}
                                                        disabled={processingId === selectedExpert.user_id}
                                                        className="flex-1 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:bg-gray-400"
                                                    >
                                                        âŒ ê±°ì ˆí•˜ê¸°
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // íšŒì› ê´€ë¦¬ ì„¹ì…˜ (ê¸°ë³¸ êµ¬í˜„)  
        const UserManagementSection = ({ currentUser }) => (
            <div className="space-y-6">
                <h2 className="text-xl font-semibold">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
                <div className="text-center py-12 text-gray-500">
                    <div className="text-4xl mb-4">ğŸ”§</div>
                    <p>íšŒì› ê´€ë¦¬ ê¸°ëŠ¥ì´ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
                </div>
            </div>
        );

        // íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
        const AuthComponent = ({ onAuthSuccess, initialMode = 'login', generateGuestUser }) => {
            const [isLogin, setIsLogin] = useState(initialMode === 'login');
            const [authMode, setAuthMode] = useState(initialMode); // 'login', 'signup', 'expert'
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [generatedNickname, setGeneratedNickname] = useState('');
            const [customNickname, setCustomNickname] = useState('');
            const [useCustomNickname, setUseCustomNickname] = useState(false);
            const [privacyConsent, setPrivacyConsent] = useState(false);
            const [expertPrivacyConsent, setExpertPrivacyConsent] = useState(false); // ì „ë¬¸ê°€ ë“±ë¡ ì „ìš©
            
            // ì „ë¬¸ê°€ ë“±ë¡ ê´€ë ¨ ìƒíƒœ
            const [expertProfile, setExpertProfile] = useState({
                name: '',
                title: '',
                expertType: 'travel',
                experienceYears: '',
                bio: '',
                specialties: [],
                credentials: [],
                hourlyRate: '',
                consultationDuration: 60,
                phone: '',
                businessLicense: '',
                qualificationNumber: '',
                availableTypes: ['phone']
            });
            const [specialtyInput, setSpecialtyInput] = useState('');
            const [credentialInput, setCredentialInput] = useState('');
            const [currentStep, setCurrentStep] = useState(1); // ì „ë¬¸ê°€ ë“±ë¡ ë‹¨ê³„

            useEffect(() => {
                if (!isLogin) {
                    // íšŒì›ê°€ì… ëª¨ë“œì¼ ë•Œ ë‹‰ë„¤ì„ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                    const nickname = authManager.nicknameGen.generate();
                    setGeneratedNickname(nickname);
                }
            }, [isLogin]);

            // ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬ ì •ì˜
            const expertCategories = {
                'travel': { name: 'ì—¬í–‰/ì·¨ë¯¸', icon: 'âœˆï¸', description: 'ì‹œë‹ˆì–´ ì—¬í–‰ ë° ì·¨ë¯¸ í™œë™ ì „ë¬¸ê°€' },
                'legal': { name: 'ì„¸ë¬´/ë²•ë¬´/ìì‚°ê´€ë¦¬', icon: 'ğŸ“‹', description: 'ì„¸ë¬´, ë²•ë¬´, ìì‚°ê´€ë¦¬ ì „ë¬¸ê°€ (ìƒë‹´ë§Œ)' },
                'living': { name: 'ì£¼ê±°/ìƒí™œ', icon: 'ğŸ ', description: 'ì£¼ê±° ë° ìƒí™œí™˜ê²½ ì„¤ê³„ ì „ë¬¸ê°€' }
            };

            // ì „ë¬¸ê°€ í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            const updateExpertProfile = (field, value) => {
                setExpertProfile(prev => ({ ...prev, [field]: value }));
            };

            // ì „ë¬¸ë¶„ì•¼ ì¶”ê°€
            const addSpecialty = () => {
                if (specialtyInput.trim() && !expertProfile.specialties.includes(specialtyInput.trim())) {
                    updateExpertProfile('specialties', [...expertProfile.specialties, specialtyInput.trim()]);
                    setSpecialtyInput('');
                }
            };

            // ìê²©ì¦ ì¶”ê°€
            const addCredential = () => {
                if (credentialInput.trim() && !expertProfile.credentials.includes(credentialInput.trim())) {
                    updateExpertProfile('credentials', [...expertProfile.credentials, credentialInput.trim()]);
                    setCredentialInput('');
                }
            };

            // ì „ë¬¸ë¶„ì•¼ ì œê±°
            const removeSpecialty = (index) => {
                const newSpecialties = expertProfile.specialties.filter((_, i) => i !== index);
                updateExpertProfile('specialties', newSpecialties);
            };

            // ìê²©ì¦ ì œê±°
            const removeCredential = (index) => {
                const newCredentials = expertProfile.credentials.filter((_, i) => i !== index);
                updateExpertProfile('credentials', newCredentials);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');

                try {
                    if (authMode === 'login') {
                        // ë¡œê·¸ì¸
                        const result = await authManager.signIn(email, password);
                        if (result.success) {
                            onAuthSuccess(result.user);
                        } else {
                            setError(result.error);
                        }
                    } else if (authMode === 'signup') {
                        // ì¼ë°˜ íšŒì›ê°€ì…
                        if (password !== confirmPassword) {
                            setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                            return;
                        }
                        // ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ ê²€ì¦ (í‘œì¤€ ì¤€ìˆ˜)
                        const passwordValidation = validatePassword(password);
                        if (!passwordValidation.isValid) {
                            setError('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•©ì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                            return;
                        }
                        
                        // ë‹‰ë„¤ì„ ê²€ì¦
                        const finalNickname = useCustomNickname ? customNickname.trim() : generatedNickname;
                        if (!finalNickname) {
                            setError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                            return;
                        }
                        if (useCustomNickname) {
                            if (finalNickname.length < 2 || finalNickname.length > 20) {
                                setError('ë‹‰ë„¤ì„ì€ 2-20ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                                return;
                            }
                            if (!/^[ê°€-í£a-zA-Z0-9]+$/.test(finalNickname)) {
                                setError('ë‹‰ë„¤ì„ì€ í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤');
                                return;
                            }
                        }
                        if (!expertPrivacyConsent) {
                            setError('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                            return;
                        }

                        const result = await authManager.signUp(email, password, finalNickname);
                        if (result.success) {
                            setError('');
                            showNotification('íšŒì›ê°€ì… ì™„ë£Œ!', `ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤, ${finalNickname}ë‹˜!\nâœ¨ ë°”ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nğŸ“Š ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê³¼ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'success');
                            setAuthMode('login');
                            setIsLogin(true);
                        } else {
                            setError(result.error);
                        }
                    } else if (authMode === 'expert') {
                        // ì „ë¬¸ê°€ ë“±ë¡
                        await handleExpertRegistration();
                    }
                } catch (err) {
                    setError('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            };

            const handleExpertRegistration = async () => {
                if (currentStep === 1) {
                    // 1ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ ê²€ì¦ë§Œ ìˆ˜í–‰ (íšŒì›ê°€ì…ì€ í•˜ì§€ ì•ŠìŒ)
                    if (password !== confirmPassword) {
                        setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                        return;
                    }
                    const passwordValidation = validatePassword(password);
                    if (!passwordValidation.isValid) {
                        setError('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•©ì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                        return;
                    }
                    if (!expertPrivacyConsent) {
                        setError('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertProfile.phone) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!/^010-\d{4}-\d{4}$/.test(expertProfile.phone)) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }

                    // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
                    const emailCheck = await authManager.checkEmail(email);
                    if (!emailCheck.success) {
                        setError(emailCheck.error);
                        return;
                    }

                    // 1ë‹¨ê³„ í†µê³¼ - 2ë‹¨ê³„ë¡œ ì´ë™ (ì•„ì§ íšŒì›ê°€ì…ì€ í•˜ì§€ ì•ŠìŒ)
                    setCurrentStep(2);
                    setError('');
                    
                    // 2ë‹¨ê³„ë¡œ ì´ë™í•  ë•Œ ìŠ¤í¬ë¡¤ì„ ìƒë‹¨ìœ¼ë¡œ ì´ë™
                    setTimeout(() => {
                        window.scrollTo({ 
                            top: 0, 
                            behavior: 'smooth' 
                        });
                    }, 100);
                    
                } else if (currentStep === 2) {
                    // 2ë‹¨ê³„: ì „ë¬¸ê°€ í”„ë¡œí•„ ì™„ì „ ê²€ì¦ ë° ë“±ë¡
                    if (!expertProfile.name || !expertProfile.title || !expertProfile.experienceYears) {
                        setError('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertProfile.expertType) {
                        setError('ì „ë¬¸ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (expertProfile.credentials.length === 0) {
                        setError('ìê²©ì¦/ê²½ë ¥ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    
                    // ìƒë‹´ ë°©ì‹ ê²€ì¦
                    if (expertProfile.availableTypes.length === 0) {
                        setError('ì œê³µ ê°€ëŠ¥í•œ ìƒë‹´ ë°©ì‹ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”');
                        return;
                    }

                    // ì—„ê²©í•œ ê²€ì¦ ì¶”ê°€
                    if (!expertProfile.businessLicense && !expertProfile.qualificationNumber) {
                        setError('ì‚¬ì—…ìë“±ë¡ì¦ ë˜ëŠ” ìê²©ì¦ë²ˆí˜¸ ì¤‘ í•˜ë‚˜ëŠ” í•„ìˆ˜ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤');
                        return;
                    }
                    
                    // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì…ë ¥ ì‹œ ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ í•„ìˆ˜ ê²€ì¦
                    if (expertProfile.businessLicense && expertProfile.businessLicense.length >= 10 && !expertProfile.businessLicenseFile) {
                        setError('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì‹  ê²½ìš° ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    if (parseInt(expertProfile.experienceYears) < 1) {
                        setError('ìµœì†Œ 1ë…„ ì´ìƒì˜ ê²½ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤');
                        return;
                    }


                    // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
                    if (expertProfile.businessLicense) {
                        const businessNumber = expertProfile.businessLicense.replace(/[^0-9]/g, '');
                        if (businessNumber.length !== 10) {
                            setError('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” 10ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                            return;
                        }
                        // ê²€ì¦ìš©ìœ¼ë¡œ ì •ê·œí™”ëœ í˜•ì‹ìœ¼ë¡œ ì €ì¥
                        const formatted = `${businessNumber.slice(0,3)}-${businessNumber.slice(3,5)}-${businessNumber.slice(5,10)}`;
                        updateExpertProfile('businessLicense', formatted);
                    }

                    // íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
                    if (!/^010-\d{4}-\d{4}$/.test(expertProfile.phone)) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }

                    try {
                        // ì´ì œ ì‹¤ì œ íšŒì›ê°€ì… ìˆ˜í–‰
                        const signUpResult = await authManager.signUp(email, password, expertProfile.name);
                        if (!signUpResult.success) {
                            setError(signUpResult.error);
                            return;
                        }

                        // ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ (ê²€í†  ëŒ€ê¸° ìƒíƒœ)
                        const { data: expertData, error: expertError } = await supabase
                            .from('financial_experts')
                            .insert({
                                email: email,
                                name: expertProfile.name,
                                phone: expertProfile.phone,
                                title: expertProfile.title,
                                category: expertProfile.category,
                                specialties: expertProfile.specialties,
                                bio: expertProfile.bio,
                                experience_years: parseInt(expertProfile.experienceYears),
                                credentials: expertProfile.credentials,
                                business_license: expertProfile.businessLicense || null,
                                qualification_number: expertProfile.qualificationNumber || null,
                                available_types: expertProfile.availableTypes,
                                verification_status: 'pending'
                            })
                            .select()
                            .single();

                        if (expertError) {
                            throw new Error('ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨: ' + expertError.message);
                        }

                        console.log('ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ:', expertData);
                        
                        showNotification('ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ ì™„ë£Œ!', `ğŸ“ ${expertProfile.name}ë‹˜ì˜ ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nğŸ” ì œì¶œí•˜ì‹  ì„œë¥˜ë¥¼ ê²€í†  ì¤‘ì…ë‹ˆë‹¤.\nğŸ“§ ìŠ¹ì¸ ê²°ê³¼ë¥¼ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë¦´ê²Œìš”.\n\nâ° ê²€í†  ê¸°ê°„: ì˜ì—…ì¼ ê¸°ì¤€ 3-5ì¼`, 'success');
                        setAuthMode('login');
                        setCurrentStep(1);
                        resetExpertForm();
                    } catch (error) {
                        setError('ì „ë¬¸ê°€ ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                    }
                }
            };

            // ì „ë¬¸ê°€ í¼ ì´ˆê¸°í™”
            const resetExpertForm = () => {
                setExpertProfile({
                    name: '',
                    title: '',
                    expertType: 'travel',
                    experienceYears: '',
                    bio: '',
                    specialties: [],
                    credentials: [],
                    hourlyRate: '',
                    consultationDuration: 60,
                    phone: '',
                    businessLicense: '',
                    qualificationNumber: '',
                    availableTypes: ['phone']
                });
                setEmail('');
                setPassword('');
                setConfirmPassword('');
                setPrivacyConsent(false);
                setSpecialtyInput('');
                setCredentialInput('');
            };

            const regenerateNickname = () => {
                const newNickname = authManager.nicknameGen.generate();
                setGeneratedNickname(newNickname);
            };

            // ì „ë¬¸ê°€ ë“±ë¡ UI ë Œë”ë§
            if (authMode === 'expert') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-red-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
                        <div className="max-w-2xl w-full space-y-8">
                            <div className="text-center">
                                <div className="mb-6">
                                    <div className="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-full mx-auto flex items-center justify-center">
                                        <span className="text-white font-bold text-xl">ğŸ¯</span>
                                    </div>
                                </div>
                                <h1 className="text-4xl font-bold text-gray-900 mb-2">
                                    ì „ë¬¸ê°€ ë“±ë¡
                                </h1>
                                <p className="text-xl text-gray-600 mb-8">
                                    {currentStep === 1 ? 'ê¸°ë³¸ ì •ë³´ ì…ë ¥' : 'ì „ë¬¸ê°€ í”„ë¡œí•„ ë“±ë¡'}
                                </p>
                                <div className="flex justify-center space-x-4 mb-8">
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${currentStep >= 1 ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-500'}`}>1</div>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${currentStep >= 2 ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-500'}`}>2</div>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <form className="space-y-6" onSubmit={handleSubmit}>
                                    {currentStep === 1 ? (
                                        // 1ë‹¨ê³„: ê¸°ë³¸ íšŒì›ê°€ì…
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">ì‹¤ëª… *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={expertProfile.name}
                                                    onChange={(e) => updateExpertProfile('name', e.target.value)}
                                                    className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-lg"
                                                    placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                />
                                                <p className="text-xs text-gray-500 mt-1">ì „ë¬¸ê°€ ì¸ì¦ì„ ìœ„í•´ ì‹¤ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">ì´ë©”ì¼ *</label>
                                                <input
                                                    type="email"
                                                    required
                                                    value={email}
                                                    onChange={(e) => setEmail(e.target.value)}
                                                    className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-lg"
                                                    placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">íœ´ëŒ€í° ë²ˆí˜¸ *</label>
                                                <input
                                                    type="tel"
                                                    required
                                                    value={expertProfile.phone}
                                                    onChange={(e) => {
                                                        const formatted = formatPhoneNumber(e.target.value);
                                                        updateExpertProfile('phone', formatted);
                                                    }}
                                                    className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-lg"
                                                    placeholder="010-1234-5678"
                                                />
                                                <p className="text-xs text-gray-500 mt-1">ë³¸ì¸ í™•ì¸ ë° ìƒë‹´ ì˜ˆì•½ ì—°ë½ìš©</p>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">ë¹„ë°€ë²ˆí˜¸ *</label>
                                                <input
                                                    type="password"
                                                    required
                                                    value={password}
                                                    onChange={(e) => setPassword(e.target.value)}
                                                    className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-lg"
                                                    placeholder="ë¹„ë°€ë²ˆí˜¸"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                                                <input
                                                    type="password"
                                                    required
                                                    value={confirmPassword}
                                                    onChange={(e) => setConfirmPassword(e.target.value)}
                                                    className="mt-1 w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-lg"
                                                    placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                                                />
                                            </div>

                                            
                                            <ExpertPrivacyConsentComponent 
                                                checked={expertPrivacyConsent}
                                                onChange={setExpertPrivacyConsent}
                                            />
                                        </div>
                                    ) : (
                                        // 2ë‹¨ê³„: ì „ë¬¸ê°€ í”„ë¡œí•„
                                        <ExpertProfileForm 
                                            expertProfile={expertProfile}
                                            updateExpertProfile={updateExpertProfile}
                                            expertCategories={expertCategories}
                                            specialtyInput={specialtyInput}
                                            setSpecialtyInput={setSpecialtyInput}
                                            credentialInput={credentialInput}
                                            setCredentialInput={setCredentialInput}
                                            addSpecialty={addSpecialty}
                                            addCredential={addCredential}
                                            removeSpecialty={removeSpecialty}
                                            removeCredential={removeCredential}
                                        />
                                    )}
                                    
                                    {error && (
                                        <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                            <p className="text-red-800 text-sm">{error}</p>
                                        </div>
                                    )}
                                    
                                    <div className="flex space-x-4">
                                        {currentStep === 2 && (
                                            <button
                                                type="button"
                                                onClick={() => setCurrentStep(1)}
                                                className="w-full py-3 px-4 border border-gray-300 text-lg font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50"
                                            >
                                                ì´ì „ ë‹¨ê³„
                                            </button>
                                        )}
                                        <button
                                            type="submit"
                                            className="w-full py-3 px-4 border border-transparent text-lg font-medium rounded-lg text-white bg-orange-600 hover:bg-orange-700"
                                        >
                                            {currentStep === 1 ? 'ë‹¤ìŒ ë‹¨ê³„' : 'ì „ë¬¸ê°€ ë“±ë¡ ì™„ë£Œ'}
                                        </button>
                                    </div>
                                    
                                    <div className="text-center">
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setAuthMode('login');
                                                setCurrentStep(1);
                                                setError('');
                                            }}
                                            className="text-orange-600 hover:text-orange-500 text-sm font-medium"
                                        >
                                            ì¼ë°˜ ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-md w-full space-y-8">
                        <div className="text-center">
                            {/* ë¡œê³  ìë¦¬ - PB ë¡œê³  */}
                            <div className="mb-6">
                                <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto flex items-center justify-center">
                                    <span className="text-white font-bold text-xl">PB</span>
                                </div>
                            </div>
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">
                                í”Œëœë¹„
                            </h1>
                            <p className="text-xl text-gray-600 mb-6">
                                í–‰ë³µí•œ ì€í‡´ìƒí™œì˜ ì‹œì‘
                            </p>
                            
                        </div>
                        
                        {/* ë¡œê·¸ì¸/íšŒì›ê°€ì… í¼ */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <form className="space-y-6" onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                                        ì´ë©”ì¼
                                    </label>
                                    <input
                                        id="email"
                                        name="email"
                                        type="email"
                                        required
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                        placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                                    />
                                </div>
                                <div>
                                    <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                                        ë¹„ë°€ë²ˆí˜¸
                                    </label>
                                    <input
                                        id="password"
                                        name="password"
                                        type="password"
                                        required
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                        placeholder="ë¹„ë°€ë²ˆí˜¸"
                                    />
                                    {authMode === 'signup' && (
                                        <div className="mt-2 text-xs text-gray-500">
                                            <p className="mb-1">ë¹„ë°€ë²ˆí˜¸ ìš”êµ¬ì‚¬í•­:</p>
                                            <ul className="space-y-0.5">
                                                {(() => {
                                                    const validation = validatePassword(password);
                                                    return (
                                                        <>
                                                            <li className={`flex items-center ${validation.checks.length ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.length ? 'âœ“' : 'â—‹'}</span>
                                                                8ì ì´ìƒ
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasLetter ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasLetter ? 'âœ“' : 'â—‹'}</span>
                                                                ì˜ë¬¸ í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasNumber ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasNumber ? 'âœ“' : 'â—‹'}</span>
                                                                ìˆ«ì í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasSpecial ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasSpecial ? 'âœ“' : 'â—‹'}</span>
                                                                íŠ¹ìˆ˜ë¬¸ì í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center text-xs mt-1 ${validation.typeCount >= 2 ? 'text-green-600' : 'text-orange-500'}`}>
                                                                <span className="mr-2">{validation.typeCount >= 2 ? 'âœ“' : '!'}</span>
                                                                ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•© í•„ìˆ˜
                                                            </li>
                                                        </>
                                                    );
                                                })()}
                                            </ul>
                                        </div>
                                    )}
                                </div>
                                {authMode === 'signup' && (
                                    <>
                                        <div>
                                            <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700">
                                                ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                                            </label>
                                            <input
                                                id="confirmPassword"
                                                name="confirmPassword"
                                                type="password"
                                                required
                                                value={confirmPassword}
                                                onChange={(e) => setConfirmPassword(e.target.value)}
                                                className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                                placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                                            />
                                        </div>
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <h4 className="text-sm font-medium text-blue-800 mb-3">ë‹‰ë„¤ì„ ì„ íƒ</h4>
                                            
                                            {/* ë‹‰ë„¤ì„ ì„ íƒ ì˜µì…˜ */}
                                            <div className="space-y-3">
                                                {/* ìë™ ìƒì„± ë‹‰ë„¤ì„ ì˜µì…˜ */}
                                                <label className="flex items-center space-x-3 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="nicknameOption"
                                                        checked={!useCustomNickname}
                                                        onChange={() => setUseCustomNickname(false)}
                                                        className="h-4 w-4 text-blue-600 border-2 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="flex items-center justify-between">
                                                            <div>
                                                                <span className="text-sm font-medium text-blue-800">ìë™ ìƒì„±</span>
                                                                <p className="text-lg font-bold text-blue-900">{generatedNickname}</p>
                                                            </div>
                                                            <button
                                                                type="button"
                                                                onClick={regenerateNickname}
                                                                className="px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded text-sm font-medium transition-colors"
                                                            >
                                                                ğŸ² ë‹¤ì‹œìƒì„±
                                                            </button>
                                                        </div>
                                                    </div>
                                                </label>
                                                
                                                {/* ì§ì ‘ ì…ë ¥ ë‹‰ë„¤ì„ ì˜µì…˜ */}
                                                <label className="flex items-start space-x-3 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="nicknameOption"
                                                        checked={useCustomNickname}
                                                        onChange={() => setUseCustomNickname(true)}
                                                        className="mt-1 h-4 w-4 text-blue-600 border-2 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <div className="flex-1">
                                                        <span className="text-sm font-medium text-blue-800">ì§ì ‘ ì…ë ¥</span>
                                                        <input
                                                            type="text"
                                                            value={customNickname}
                                                            onChange={(e) => setCustomNickname(e.target.value)}
                                                            disabled={!useCustomNickname}
                                                            placeholder="ì›í•˜ëŠ” ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                            className={`mt-1 w-full px-3 py-2 border rounded-lg text-sm ${
                                                                useCustomNickname 
                                                                    ? 'border-blue-300 focus:border-blue-500 focus:ring-blue-500' 
                                                                    : 'border-gray-200 bg-gray-50 text-gray-400'
                                                            }`}
                                                        />
                                                        {useCustomNickname && (
                                                            <p className="text-xs text-gray-500 mt-1">
                                                                2-20ì, í•œê¸€/ì˜ë¬¸/ìˆ«ì ì‚¬ìš© ê°€ëŠ¥
                                                            </p>
                                                        )}
                                                    </div>
                                                </label>
                                            </div>
                                            
                                            <p className="text-xs text-blue-600 mt-3">ğŸ’¡ ê°€ì… í›„ ì–¸ì œë“ ì§€ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”</p>
                                        </div>
                                        
                                        {/* ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ */}
                                        <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                            <h4 className="text-sm font-medium text-gray-800 mb-3">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜</h4>
                                            <div className="bg-white border border-gray-200 rounded p-3 text-xs text-gray-600 mb-3 max-h-32 overflow-y-auto">
                                                <div className="space-y-2">
                                                    <div>
                                                        <strong className="text-gray-800">â–  ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</strong>
                                                        <p>- ì´ë©”ì¼ ì£¼ì†Œ, ë‹‰ë„¤ì„</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì </strong>
                                                        <p>- íšŒì› ê°€ì… ë° ê´€ë¦¬</p>
                                                        <p>- ì„œë¹„ìŠ¤ ì œê³µ ë° ë³¸ì¸í™•ì¸</p>
                                                        <p>- ê³„ì‚° ê²°ê³¼ ì €ì¥ ë° ì»¤ë®¤ë‹ˆí‹° ì´ìš©</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ê°œì¸ì •ë³´ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</strong>
                                                        <p>- íšŒì›íƒˆí‡´ ì‹œê¹Œì§€</p>
                                                        <p>- ë‹¨, ê´€ê³„ë²•ë ¹ì— ì˜í•´ ë³´ì¡´í•  í•„ìš”ê°€ ìˆëŠ” ê²½ìš° í•´ë‹¹ ê¸°ê°„ê¹Œì§€</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ë™ì˜ ê±°ë¶€ ê¶Œë¦¬</strong>
                                                        <p>- ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤</p>
                                                        <p>- ë‹¤ë§Œ, ë™ì˜ ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <PrivacyConsentCheckbox 
                                                checked={privacyConsent}
                                                onChange={setPrivacyConsent}
                                            />
                                        </div>
                                    </>
                                )}
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                    <p className="text-red-800 text-sm">{error}</p>
                                </div>
                            )}

                            <div>
                                <button
                                    type="submit"
                                    className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-lg font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                                >
                                    {authMode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}
                                </button>
                            </div>

                            <div className="text-center">
                                <button
                                    type="button"
                                    onClick={() => {
                                        setAuthMode(authMode === 'login' ? 'signup' : 'login');
                                        setIsLogin(authMode !== 'login');
                                        setError('');
                                        setEmail('');
                                        setPassword('');
                                        setConfirmPassword('');
                                        setPrivacyConsent(false);
                                        setCustomNickname('');
                                        setUseCustomNickname(false);
                                    }}
                                    className="text-blue-600 hover:text-blue-500 text-sm font-medium"
                                >
                                    {authMode === 'login' ? 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…' : 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸'}
                                </button>
                            </div>
                            </form>
                        </div>
                        
                        <div className="flex items-center text-sm text-gray-500 mb-6">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="mx-4">ë˜ëŠ”</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>
                        
                        {/* ê²ŒìŠ¤íŠ¸ë¡œ ì´ìš©í•´ë³´ê¸° */}
                        <div className="text-center space-y-3">
                            <button
                                onClick={() => onAuthSuccess(generateGuestUser())}
                                className="group relative w-full flex justify-center py-3 px-4 border border-gray-300 text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300"
                            >
                                ğŸ§® ê²ŒìŠ¤íŠ¸ë¡œ ì´ìš©í•´ë³´ê¸°
                            </button>
                            <p className="text-center text-sm text-gray-500">
                                íšŒì›ê°€ì… ì—†ì´ ê³„ì‚°ê¸°ë§Œ ì´ìš© (ì»¤ë®¤ë‹ˆí‹° ì´ìš© ë¶ˆê°€)
                            </p>
                        </div>
                        
                        {/* ì „ë¬¸ê°€ ë“±ë¡ */}
                        <div className="flex items-center text-sm text-gray-500 mb-6">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="mx-4">ì „ë¬¸ê°€ì´ì‹ ê°€ìš”?</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>
                        
                        <div className="text-center">
                            <button
                                onClick={() => setAuthMode('expert')}
                                className="group relative w-full flex justify-center py-3 px-4 border-2 border-orange-500 text-base font-medium rounded-lg text-orange-600 bg-orange-50 hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all duration-300"
                            >
                                ğŸ¯ ì „ë¬¸ê°€ë¡œ ë“±ë¡í•˜ê¸°
                            </button>
                            <p className="text-center text-sm text-gray-500 mt-2">
                                ì—¬í–‰/ì·¨ë¯¸, ì„¸ë¬´/ë²•ë¬´, ì£¼ê±°/ìƒí™œ ì „ë¬¸ê°€ ëª¨ì§‘
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // ë¸”ë¼ì¸ë“œì‹ ì»¤ë®¤ë‹ˆí‹° ì•±
        const CommunityApp = ({ setCurrentView, currentUser, checkCalculationForInteraction, handlePostClick, isAdminUser }) => {
            const [activeTopic, setActiveTopic] = useState('retirement');
            const [posts, setPosts] = useState([]);
            const [newPost, setNewPost] = useState({ title: '', content: '', topic: 'retirement', is_anonymous: true });
            const [showWriteForm, setShowWriteForm] = useState(false);
            const [showExpertWriteForm, setShowExpertWriteForm] = useState(false);
            const [expertPost, setExpertPost] = useState({
                title: '',
                content: '',
                category: 'travel',
                consultation_price: '20000',
                consultation_duration: '30',
                consultation_types: ['phone'],
                expert_title: '',
                expert_name: ''
            });
            const [newReply, setNewReply] = useState('');
            const [userProfile, setUserProfile] = useState(null);
            const [showExpertBookingModal, setShowExpertBookingModal] = useState(false);
            const [selectedExpertFromPost, setSelectedExpertFromPost] = useState(null);

            // ì „ë¬¸ê°€ ê²Œì‹œê¸€ì—ì„œ ì „ë¬¸ê°€ ì •ë³´ ì¶”ì¶œ
            const getExpertFromPost = (post) => {
                if (post.topic !== 'expert') return null;
                
                return {
                    id: post.user_hash,
                    name: post.expert_name,
                    title: post.expert_title,
                    profileImage: 'ğŸ¯',
                    price: post.consultation_price,
                    hourlyRate: post.consultation_price?.replace(/[^0-9]/g, '') || '50000',
                    availableTypes: ['phone', 'video', 'chat']
                };
            };

            // ë¼ì´í”„ìŠ¤íƒ€ì¼ ê·¸ë£¹ ì •ì˜ (ì¤‘ì„±ì ì´ê³  í¬ìš©ì ì¸ í‘œí˜„)
            const lifestyleGroups = {
                'prudent': { 
                    name: 'ì•Œëœ° ë¼ì´í”„', 
                    description: 'ì‹¤ì†ìˆëŠ” ì€í‡´ìƒí™œì„ ì¶”êµ¬í•˜ëŠ” ë¶„ë“¤',
                    color: 'bg-blue-500', 
                    emoji: 'ğŸŒ±',
                    tagline: 'ì‘ì€ ê²ƒì—ì„œ ì°¾ëŠ” í° í–‰ë³µ'
                },
                'balanced': { 
                    name: 'ë°¸ëŸ°ìŠ¤ ë¼ì´í”„', 
                    description: 'ê· í˜•ì¡íŒ ì€í‡´ìƒí™œì„ ì›í•˜ëŠ” ë¶„ë“¤',
                    color: 'bg-green-500', 
                    emoji: 'âš–ï¸',
                    tagline: 'ì•ˆì •ê³¼ ì—¬ìœ ì˜ ì¡°í™”'
                },
                'premium': { 
                    name: 'í”„ë¦¬ë¯¸ì—„ ë¼ì´í”„', 
                    description: 'í’ìš”ë¡œìš´ ì€í‡´ìƒí™œì„ ê³„íší•˜ëŠ” ë¶„ë“¤',
                    color: 'bg-purple-500', 
                    emoji: 'ğŸŒŸ',
                    tagline: 'ê¿ˆê¾¸ë˜ ì€í‡´ì˜ ì‹¤í˜„'
                }
            };

            // í† í”½ ë³´ë“œ (ë¸”ë¼ì¸ë“œì˜ í† í”½ê³¼ ìœ ì‚¬)
            const topics = {
                'retirement': { name: 'ì€í‡´ê³„íš', icon: 'ğŸ–ï¸', description: 'ì€í‡´ ì¤€ë¹„ì™€ ì€í‡´ì„¤ê³„' },
                'asset': { name: 'ì¬í…Œí¬', icon: 'ğŸ’°', description: 'íˆ¬ìì™€ ìì‚° ìš´ìš©' },
                'pension': { name: 'ì—°ê¸ˆì´ì•¼ê¸°', icon: 'ğŸ“‹', description: 'êµ­ë¯¼ì—°ê¸ˆ, ê°œì¸ì—°ê¸ˆ' },
                'health': { name: 'ê±´ê°•ê´€ë¦¬', icon: 'ğŸ¥', description: 'ì˜ë£Œë¹„, ê±´ê°•ë³´í—˜' },
                'life': { name: 'ì‹œë‹ˆì–´ìƒí™œ', icon: 'ğŸŒ»', description: 'ì¼ìƒ, ì·¨ë¯¸, ì—¬í–‰' },
                'housing': { name: 'ë¶€ë™ì‚°', icon: 'ğŸ ', description: 'ì£¼íƒ, ì„ëŒ€, ì´ì‚¬' },
                'family': { name: 'ê°€ì¡±ê´€ê³„', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', description: 'ë¶€ë¶€, í˜•ì œìë§¤, ìë…€ ì´ì•¼ê¸°' },
                'work': { name: 'ì¬ì·¨ì—…', icon: 'ğŸ’¼', description: 'ì‹œë‹ˆì–´ ì¼ìë¦¬' },
                'expert': { name: 'ì „ë¬¸ê°€ ìƒë‹´', icon: 'ğŸ¯', description: 'ì „ë¬¸ê°€ ì„œë¹„ìŠ¤ ì†Œê°œ ë° ìƒë‹´ ì•ˆë‚´', isExpertOnly: true }
            };

            // ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ë³´ê¸°ìš© ìƒ˜í”Œ ë°ì´í„° (ìƒì„¸ë³´ê¸°ëŠ” ê³„ì‚° í›„ ê°€ëŠ¥)
            const samplePosts = [
                {
                    id: '1',
                    title: '3ì–µ ìì‚°ìœ¼ë¡œ ë¶€ë¶€ ì€í‡´ ê°€ëŠ¥í• ê¹Œìš”?',
                    content: 'ì•„íŒŒíŠ¸ 2ì–µ + í˜„ê¸ˆ 1ì–µì…ë‹ˆë‹¤. ì›” 200ë§Œì› ì •ë„ë¡œ ì‚´ ê³„íšì¸ë° ê´œì°®ì„ê¹Œìš”?',
                    topic: 'retirement',
                    asset_group: 'middle',
                    user_hash: 'user123',
                    age_badge: '60-64ì„¸',
                    asset_badge: 'ì•ˆì •í˜•',
                    is_hot: true,
                    replies_count: 12,
                    likes_count: 8,
                    created_at: '2025-01-20T10:30:00Z'
                },
                {
                    id: '2',
                    title: 'ì—°ê¸ˆ ë°›ëŠ” ì‹œê¸° ê³ ë¯¼ë©ë‹ˆë‹¤',
                    content: 'êµ­ë¯¼ì—°ê¸ˆ 60ì„¸ë¶€í„° ë°›ì„ì§€ 65ì„¸ë¶€í„° ë°›ì„ì§€... ê±´ê°•í•œ í¸ì´ë¼ ê³ ë¯¼ì´ì—ìš”.',
                    topic: 'pension',
                    asset_group: 'middle', 
                    user_hash: 'user456',
                    age_badge: '55-59ì„¸',
                    asset_badge: 'ì•ˆì •í˜•',
                    is_hot: false,
                    replies_count: 7,
                    likes_count: 5,
                    created_at: '2025-01-20T09:15:00Z'
                },
                {
                    id: '3',
                    title: '10ì–µ ìì‚° ì–´ë–»ê²Œ êµ´ë¦´ê¹Œìš”?',
                    content: 'í˜„ê¸ˆ 5ì–µ, ë¶€ë™ì‚° 5ì–µ ìˆëŠ”ë° ì•ˆì „í•˜ê²Œ ìˆ˜ìµ ë‚´ëŠ” ë°©ë²• ìˆì„ê¹Œìš”?',
                    topic: 'asset',
                    asset_group: 'high',
                    user_hash: 'user789',
                    age_badge: '65-69ì„¸',
                    asset_badge: 'ì—¬ìœ í˜•',
                    is_hot: true,
                    replies_count: 15,
                    likes_count: 12,
                    created_at: '2025-01-20T08:45:00Z'
                },
                {
                    id: '4',
                    title: 'ê¸°ì´ˆì—°ê¸ˆìœ¼ë¡œë§Œ ì‚¬ëŠ” ë¶„ ê³„ì‹ ê°€ìš”?',
                    content: 'ìì‚°ì´ ë§ì§€ ì•Šì•„ì„œ ê¸°ì´ˆì—°ê¸ˆì— ì˜ì¡´í•˜ê²Œ ë  ê²ƒ ê°™ì€ë°... ê²½í—˜ë‹´ ë“£ê³  ì‹¶ì–´ìš”.',
                    topic: 'life',
                    asset_group: 'low',
                    user_hash: 'user101', 
                    age_badge: '60-64ì„¸',
                    asset_badge: 'ìƒí™œí˜•',
                    is_hot: false,
                    replies_count: 9,
                    likes_count: 6,
                    created_at: '2025-01-19T16:20:00Z'
                },
                {
                    id: '5',
                    title: 'ì‹¤ë²„ë³´í—˜ ê°€ì… í•„ìš”í• ê¹Œìš”?',
                    content: '60ëŒ€ ì¤‘ë°˜ì¸ë° ì‹¤ë²„ë³´í—˜ ê°€ì…ì„ ê¶Œìœ ë°›ì•˜ì–´ìš”. ë³´í—˜ë£Œê°€ ë§Œë§Œì¹˜ ì•Šì€ë°...',
                    topic: 'health',
                    asset_group: 'middle',
                    user_hash: 'user202',
                    age_badge: '60-64ì„¸', 
                    asset_badge: 'ì•ˆì •í˜•',
                    is_hot: false,
                    replies_count: 4,
                    likes_count: 3,
                    created_at: '2025-01-19T14:30:00Z'
                },
                // ì „ë¬¸ê°€ ê²Œì‹œê¸€ ìƒ˜í”Œ
                {
                    id: '6',
                    title: 'ì‹œë‹ˆì–´ ì—¬í–‰ ê³„íš, ì´ê²ƒë§Œì€ ê¼­ í™•ì¸í•˜ì„¸ìš”!',
                    content: 'ì•ˆë…•í•˜ì„¸ìš”, ì‹œë‹ˆì–´ ì—¬í–‰ ì „ë¬¸ í”Œë˜ë„ˆ ê¹€ì—¬í–‰ì…ë‹ˆë‹¤. ì€í‡´ í›„ ì²« í•´ì™¸ì—¬í–‰ì„ ê³„íší•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤...',
                    topic: 'expert',
                    expert_category: 'travel',
                    user_hash: 'expert_kim_travel',
                    expert_badge: 'ì¸ì¦ ì „ë¬¸ê°€',
                    expert_name: 'ê¹€ì—¬í–‰í”Œë˜ë„ˆ',
                    expert_title: 'ì‹œë‹ˆì–´ ì—¬í–‰ ì „ë¬¸ í”Œë˜ë„ˆ',
                    consultation_price: '60,000ì›/60ë¶„',
                    is_hot: true,
                    replies_count: 23,
                    likes_count: 45,
                    created_at: '2025-01-21T09:00:00Z'
                },
                {
                    id: '7', 
                    title: 'ìƒì†ì„¸ ì ˆì„¸ ì „ëµ - ì¦ì—¬ì™€ ìƒì†ì˜ ìµœì  íƒ€ì´ë°',
                    content: 'ìƒì†ì„¸ ì „ë¬¸ ì„¸ë¬´ì‚¬ ìµœì„¸ë¬´ì…ë‹ˆë‹¤. ë§ì€ ë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œëŠ” ì¦ì—¬ì™€ ìƒì†ì˜ ìµœì  íƒ€ì´ë°ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤...',
                    topic: 'expert',
                    expert_category: 'legal',
                    user_hash: 'expert_choi_tax',
                    expert_badge: 'ì¸ì¦ ì „ë¬¸ê°€',
                    expert_name: 'ìµœì„¸ë¬´ì‚¬',
                    expert_title: 'ìƒì†ì„¸ ì ˆì„¸ ì „ë¬¸ ì„¸ë¬´ì‚¬',
                    consultation_price: '100,000ì›/60ë¶„',
                    is_hot: true,
                    replies_count: 18,
                    likes_count: 32,
                    created_at: '2025-01-20T15:30:00Z'
                },
                {
                    id: '8',
                    title: 'ì€í‡´ í›„ ë‹¤ìš´ì‚¬ì´ì§•, ì„±ê³µì ì¸ ì´ì‚¬ ê°€ì´ë“œ',
                    content: 'ì‹œë‹ˆì–´ ì£¼ê±° ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ ìœ¤ë¶€ë™ì‚°ì…ë‹ˆë‹¤. ì€í‡´ í›„ ì§‘ì„ ì¤„ì´ëŠ” ë‹¤ìš´ì‚¬ì´ì§•ì— ëŒ€í•œ ì‹¤ì „ ê°€ì´ë“œë¥¼ ê³µìœ í•©ë‹ˆë‹¤...',
                    topic: 'expert',
                    expert_category: 'living',
                    user_hash: 'expert_yoon_housing',
                    expert_badge: 'ì¸ì¦ ì „ë¬¸ê°€',
                    expert_name: 'ìœ¤ë¶€ë™ì‚°ì»¨ì„¤í„´íŠ¸',
                    expert_title: 'ì‹œë‹ˆì–´ ì£¼ê±° ì „ë¬¸ ì»¨ì„¤í„´íŠ¸',
                    consultation_price: '80,000ì›/60ë¶„',
                    is_hot: false,
                    replies_count: 12,
                    likes_count: 28,
                    created_at: '2025-01-19T11:20:00Z'
                }
            ];

            // ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”ì‹œ ì„¸ì…˜ í™•ì¸
            useEffect(() => {
                initializeCommunity();
            }, [currentUser]);

            // í† í”½ ë³€ê²½ì‹œ ê²Œì‹œê¸€ ë‹¤ì‹œ ë¡œë“œ
            useEffect(() => {
                if (currentUser) {
                    loadPosts();
                }
            }, [activeTopic, currentUser]);

            const initializeCommunity = async () => {
                try {
                    if (currentUser) {
                        // Supabase ì—°ê²°ì´ ìˆì„ ë•Œë§Œ ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ
                        if (supabase) {
                            try {
                                const { data: profile, error } = await supabase
                                    .from('user_profiles')
                                    .select('*')
                                    .eq('id', currentUser.id)
                                    .single();
                                
                                if (!error && profile) {
                                    setUserProfile(profile);
                                    console.log(`ì»¤ë®¤ë‹ˆí‹° ì ‘ì†: ${profile.nickname}`);
                                }
                            } catch (supabaseError) {
                                console.log('Supabase ì—°ê²° ì—†ìŒ, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©');
                            }
                        } else {
                            // Supabaseê°€ ì—†ì„ ë•Œ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ë¡œ ì„ì‹œ í”„ë¡œí•„ ìƒì„±
                            setUserProfile({
                                id: currentUser.id,
                                nickname: currentUser.nickname || currentUser.email,
                                email: currentUser.email
                            });
                            console.log('ì»¤ë®¤ë‹ˆí‹° ì ‘ì† (ë¡œì»¬ ëª¨ë“œ)');
                        }
                        
                        // ê²Œì‹œê¸€ ë¡œë“œ (í•­ìƒ ì‹¤í–‰)
                        await loadPosts();
                    }
                } catch (error) {
                    console.error('ì»¤ë®¤ë‹ˆí‹° ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ê²Œì‹œê¸€ UIëŠ” í‘œì‹œ
                    await loadPosts();
                }
            };

            const loadPosts = async () => {
                if (!currentUser) return;
                try {
                    if (supabase) {
                        const { data, error } = await supabase
                            .from('community_posts')
                            .select('*')
                            .eq('category', activeTopic)
                            .order('created_at', { ascending: false });
                        
                        if (error) throw error;
                        setPosts(data || []);
                    } else {
                        // Supabase ì—°ê²°ì´ ì—†ì„ ë•Œ ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
                        const filteredPosts = samplePosts.filter(post => 
                            post.topic === activeTopic
                        );
                        setPosts(filteredPosts);
                    }
                } catch (error) {
                    console.error('ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ë°œìƒì‹œ ìƒ˜í”Œ ë°ì´í„°ë¡œ í´ë°±
                    const filteredPosts = samplePosts.filter(post => 
                        post.topic === activeTopic
                    );
                    setPosts(filteredPosts);
                }
            };

            // ë‚´ ìì‚° ê·¸ë£¹ ìë™ ê°ì§€ (ê³„ì‚°ê¸° ê²°ê³¼ ê¸°ë°˜)
            const detectMyAssetGroup = () => {
                // ì‹¤ì œë¡œëŠ” ê³„ì‚°ê¸° ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìì‚° ê·¸ë£¹ì„ ê°ì§€
                // í˜„ì¬ëŠ” ìƒ˜í”Œë¡œ 'middle' ë°˜í™˜
                return 'middle';
            };

            // ê²Œì‹œê¸€ í•„í„°ë§ (í˜„ì¬ ì„ íƒëœ ìì‚°ê·¸ë£¹ê³¼ í† í”½)
            const getFilteredPosts = () => {
                return posts.filter(post => 
                    post.asset_group === selectedAssetGroup && 
                    post.topic === activeTopic
                );
            };

            // ì‹œê°„ í¬ë§·íŒ… (ë¸”ë¼ì¸ë“œì‹)
            const formatTime = (dateString) => {
                const now = new Date();
                const posted = new Date(dateString);
                const diffMs = now - posted;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffHours / 24);
                
                if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                return posted.toLocaleDateString();
            };

            const createPost = async () => {
                if (!userSession) {
                    showNotification('ë¡œê·¸ì¸ í•„ìš”', 'ê²Œì‹œê¸€ ì‘ì„±ì„ ìœ„í•´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                    return;
                }

                if (!newPost.title.trim() || !newPost.content.trim()) {
                    showNotification('ì…ë ¥ ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                try {
                    const postData = {
                        ...newPost,
                        topic: activeTopic,
                        author_nickname: userProfile?.nickname || 'ìµëª…',
                        author_id: currentUser.id,
                        age_badge: '60-64ì„¸', // í–¥í›„ í”„ë¡œí•„ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
                        is_hot: false,
                        replies_count: 0,
                        likes_count: 0,
                        created_at: new Date().toISOString()
                    };

                    if (supabase) {
                        const { data, error } = await supabase
                            .from('community_posts')
                            .insert([postData])
                            .select();
                        
                        if (error) throw error;
                        setPosts([data[0], ...posts]);
                    } else {
                        // ë¡œì»¬ ìƒíƒœì—ë§Œ ì¶”ê°€
                        const newId = String(Date.now());
                        setPosts([{ ...postData, id: newId }, ...posts]);
                    }

                    // í™œë™ ê¸°ë¡ (í•„ìš”ì‹œ ì¶”ê°€)

                    setNewPost({ title: '', content: '', topic: activeTopic, is_anonymous: true });
                    setShowWriteForm(false);
                    showNotification('ê²Œì‹œê¸€ ë“±ë¡ ì™„ë£Œ', 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                } catch (error) {
                    console.error('ê²Œì‹œê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
                    showNotification('ì˜¤ë¥˜ ë°œìƒ', 'ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                }
            };


            // í”„ë¡œê·¸ë ˆì‹œë¸Œ ì ‘ê·¼: ë¨¼ì € ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë³´ì—¬ì£¼ê³ , ìƒí˜¸ì‘ìš© ì‹œì—ë§Œ ê³„ì‚° ì²´í¬

            // ì •ìƒ ì ‘ê·¼: ì»¤ë®¤ë‹ˆí‹° í™”ë©´
            // ê¸°ë³¸ ì»¤ë®¤ë‹ˆí‹° ê·¸ë£¹ (ë‚˜ì¤‘ì— ê³„ì‚° ê²°ê³¼ ê¸°ë°˜ ê·¸ë£¹ ë°°ì • ê°€ëŠ¥)
            const currentGroup = lifestyleGroups['balanced'];

            return (
                <div className="max-w-4xl mx-auto space-y-4">
                    {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
                    <div className="flex justify-between items-center mb-4">
                        <button
                            onClick={() => setCurrentView('main')}
                            className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                            </svg>
                            ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                        <div className="flex-1"></div>
                    </div>
                    
                    {/* í—¤ë” - ê°„ì†Œí™” */}
                    <div className="bg-white rounded-lg shadow-md p-4">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center space-x-3">
                                <span className="text-2xl">{currentGroup.emoji}</span>
                                <h1 className="text-xl md:text-2xl font-bold text-gray-800">ì»¤ë®¤ë‹ˆí‹°</h1>
                                {isAdminUser(currentUser) && (
                                    <span className="px-2 py-1 bg-red-100 text-red-600 text-xs font-medium rounded-full">
                                        ğŸ‘‘ ê´€ë¦¬ì
                                    </span>
                                )}
                            </div>
                            <div className="flex items-center">
                                <button
                                    onClick={() => {
                                        if (checkCalculationForInteraction()) {
                                            setShowWriteForm(true);
                                        }
                                    }}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg font-medium text-sm md:text-base whitespace-nowrap"
                                >
                                    âœï¸ ê¸€ì“°ê¸°
                                </button>
                            </div>
                        </div>

                        {/* í† í”½ ë³´ë“œ - ì»´íŒ©íŠ¸ */}
                        <div>
                            <h3 className="text-sm font-medium text-gray-600 mb-2">ğŸ“‚ í† í”½ ë³´ë“œ</h3>
                            <div className="grid grid-cols-4 md:grid-cols-8 gap-1">
                                {Object.entries(topics)
                                    .filter(([key, topic]) => {
                                        // ì „ë¬¸ê°€ ì „ìš© í† í”½ì€ ê´€ë¦¬ìì™€ ì „ë¬¸ê°€ë§Œ í‘œì‹œ
                                        if (topic.isExpertOnly) {
                                            return isAdminUser(currentUser) || 
                                                   (currentUser && currentUser.user_type === 'expert');
                                        }
                                        return true;
                                    })
                                    .map(([key, topic]) => (
                                    <button
                                        key={key}
                                        onClick={() => setActiveTopic(key)}
                                        className={`p-2 rounded-lg text-center transition-colors ${
                                            activeTopic === key
                                                ? 'bg-blue-50 border border-blue-300'
                                                : 'bg-gray-50 hover:bg-gray-100 border border-transparent'
                                        }`}
                                        title={topic.description}
                                    >
                                        <div className="text-base mb-1">{topic.icon}</div>
                                        <div className="font-medium text-gray-800 text-xs leading-tight">{topic.name}</div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* ê¸€ì“°ê¸° ëª¨ë‹¬ */}
                    {showWriteForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                                <div className="p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-xl font-bold">âœï¸ ìƒˆ ê¸€ ì‘ì„±</h3>
                                        <button
                                            onClick={() => setShowWriteForm(false)}
                                            className="text-gray-400 hover:text-gray-600"
                                        >
                                            âœ•
                                        </button>
                                    </div>
                                    
                                    <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                                        <p className="text-sm text-blue-800">
                                            <strong>{currentGroup.name}</strong> ì»¤ë®¤ë‹ˆí‹°ì˜{' '}
                                            <strong>{topics[activeTopic].name}</strong> í† í”½ì— ê¸€ì„ ì‘ì„±í•©ë‹ˆë‹¤
                                        </p>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">ì œëª©</label>
                                            <input
                                                type="text"
                                                value={newPost.title}
                                                onChange={(e) => setNewPost({...newPost, title: e.target.value})}
                                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                maxLength={100}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">ë‚´ìš©</label>
                                            <textarea
                                                value={newPost.content}
                                                onChange={(e) => setNewPost({...newPost, content: e.target.value})}
                                                className="w-full p-3 border rounded-lg h-40 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ê¶ê¸ˆí•œ ì ì´ë‚˜ ê²½í—˜ë‹´ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"
                                                maxLength={1000}
                                            />
                                            <p className="text-xs text-gray-500 mt-1">{newPost.content.length}/1000</p>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <input
                                                type="checkbox"
                                                id="anonymous"
                                                checked={newPost.is_anonymous}
                                                onChange={(e) => setNewPost({...newPost, is_anonymous: e.target.checked})}
                                                className="rounded"
                                            />
                                            <label htmlFor="anonymous" className="text-sm text-gray-600">
                                                ìµëª…ìœ¼ë¡œ ê²Œì‹œ (ì¶”ì²œ)
                                            </label>
                                        </div>
                                        <div className="flex space-x-3 pt-4">
                                            <button
                                                onClick={createPost}
                                                className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium"
                                            >
                                                ê²Œì‹œí•˜ê¸°
                                            </button>
                                            <button
                                                onClick={() => setShowWriteForm(false)}
                                                className="px-6 py-3 border rounded-lg hover:bg-gray-50"
                                            >
                                                ì·¨ì†Œ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* í˜„ì¬ ì„ íƒëœ í† í”½ ì •ë³´ */}
                    <div className="bg-white rounded-lg shadow-md p-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <span className="text-lg">{topics[activeTopic].icon}</span>
                                <div>
                                    <h2 className="font-bold text-lg">{topics[activeTopic].name}</h2>
                                    <p className="text-sm text-gray-600">{currentGroup.name} ì»¤ë®¤ë‹ˆí‹°</p>
                                </div>
                            </div>
                            <div className="text-right text-sm text-gray-500">
                                <p>ê²Œì‹œê¸€ {posts.length}ê°œ</p>
                                <p>{topics[activeTopic].description}</p>
                            </div>
                        </div>
                    </div>


                    {/* ê²Œì‹œê¸€ ëª©ë¡ - ë¸”ë¼ì¸ë“œì‹ */}
                    <div className="space-y-2">
                                {posts.map(post => (
                                    <div key={post.id} className={`rounded-lg shadow-md hover:shadow-lg transition-shadow ${
                                        post.topic === 'expert' ? 'bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500' : 'bg-white'
                                    }`}>
                                        <div className="p-4">
                                            <div className="flex items-start justify-between mb-3">
                                                <div className="flex-1">
                                                    {/* ë±ƒì§€ë“¤ */}
                                                    <div className="flex items-center space-x-2 mb-2">
                                                        {post.topic === 'expert' ? (
                                                            <>
                                                                <span className="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold">
                                                                    ğŸ¯ {post.expert_badge}
                                                                </span>
                                                                <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                                                    {post.expert_name}
                                                                </span>
                                                                {post.consultation_price && (
                                                                    <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                                                                        ğŸ’° {post.consultation_price}
                                                                    </span>
                                                                )}
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">
                                                                    {post.asset_badge}
                                                                </span>
                                                                <span className="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">
                                                                    {post.age_badge}
                                                                </span>
                                                            </>
                                                        )}
                                                        {post.is_hot && (
                                                            <span className="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-medium">
                                                                ğŸ”¥ HOT
                                                            </span>
                                                        )}
                                                    </div>
                                                    
                                                    {/* ì œëª© */}
                                                    <h3 
                                                        className={`font-bold cursor-pointer hover:text-blue-600 transition-colors line-clamp-2 ${
                                                            post.topic === 'expert' ? 'text-orange-900' : 'text-gray-800'
                                                        }`}
                                                        onClick={() => handlePostClick(post)}
                                                    >
                                                        {post.title}
                                                    </h3>
                                                    
                                                    {/* ì „ë¬¸ê°€ íƒ€ì´í‹€ */}
                                                    {post.topic === 'expert' && post.expert_title && (
                                                        <p className="text-orange-700 text-sm font-medium mt-1">
                                                            {post.expert_title}
                                                        </p>
                                                    )}
                                                    
                                                    {/* ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° */}
                                                    <p className="text-gray-600 text-sm mt-2 line-clamp-2">
                                                        {post.content.length > 120 ? `${post.content.substring(0, 120)}...` : post.content}
                                                    </p>
                                                    
                                                    {/* ì „ë¬¸ê°€ ê²Œì‹œê¸€ ì•¡ì…˜ ë²„íŠ¼ */}
                                                    {post.topic === 'expert' && (
                                                        <div className="mt-3 flex space-x-2">
                                                            <button 
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    if (currentUser?.isGuest) {
                                                                        setShowSignupModal(true);
                                                                        return;
                                                                    }
                                                                    const expert = getExpertFromPost(post);
                                                                    if (expert) {
                                                                        setSelectedExpertFromPost(expert);
                                                                        setShowExpertBookingModal(true);
                                                                    }
                                                                }}
                                                                className="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs font-medium"
                                                            >
                                                                ğŸ“ ìƒë‹´ ì˜ˆì•½
                                                            </button>
                                                            <button 
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handlePostClick(post);
                                                                }}
                                                                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium"
                                                            >
                                                                ğŸ“ ì§ˆë¬¸í•˜ê¸°
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                {/* ìš°ì¸¡ ë©”íƒ€ ì •ë³´ */}
                                                <div className="text-right text-sm text-gray-500 ml-4">
                                                    <p>{formatTime(post.created_at)}</p>
                                                    <div className="flex items-center justify-end space-x-2 mt-1">
                                                        <span className="flex items-center">ğŸ’¬ {post.replies_count}</span>
                                                        <span className="flex items-center">ğŸ‘ {post.likes_count}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                
                                {posts.length === 0 && (
                                    <div className="bg-white rounded-lg p-12 text-center">
                                        <div className="text-6xl mb-4">ğŸ“</div>
                                        <h3 className="text-lg font-semibold text-gray-800 mb-2">
                                            {currentGroup.name}ì˜ {topics[activeTopic].name}
                                        </h3>
                                        <p className="text-gray-600 mb-4">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                        <button
                                            onClick={() => {
                                                if (checkCalculationForInteraction()) {
                                                    setShowWriteForm(true);
                                                }
                                            }}
                                            className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg"
                                        >
                                            ì²« ë²ˆì§¸ ê¸€ ì‘ì„±í•˜ê¸° âœï¸
                                        </button>
                                    </div>
                                )}
                    </div>
                    
                    {/* ì „ë¬¸ê°€ ìƒë‹´ ì˜ˆì•½ ëª¨ë‹¬ */}
                    {showExpertBookingModal && selectedExpertFromPost && (
                        <ConsultationBookingComponent
                            expert={selectedExpertFromPost}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowExpertBookingModal(false);
                                setSelectedExpertFromPost(null);
                            }}
                        />
                    )}
                </div>
            );
        };

        // ìƒë‹´ ì™„ë£Œ í™•ì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ConsultationCompletionComponent = ({ consultation, onClose, userType }) => {
            const [isCompleting, setIsCompleting] = useState(false);
            const [showReviewForm, setShowReviewForm] = useState(false);
            const [review, setReview] = useState({
                rating: 5,
                reviewTitle: '',
                reviewContent: '',
                professionalismRating: 5,
                communicationRating: 5,
                satisfactionRating: 5,
                wouldRecommend: true
            });

            const handleComplete = async () => {
                setIsCompleting(true);
                try {
                    // TODO: Supabaseì— ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const completionData = {
                        consultationId: consultation.id,
                        userType, // 'expert' ë˜ëŠ” 'client'
                        completedAt: new Date().toISOString()
                    };
                    
                    console.log('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬:', completionData);
                    
                    if (userType === 'client') {
                        setShowReviewForm(true);
                    } else {
                        alert('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                        onClose();
                    }
                } catch (error) {
                    console.error('ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                } finally {
                    setIsCompleting(false);
                }
            };

            const handleReviewSubmit = async () => {
                try {
                    // TODO: Supabaseì— í›„ê¸° ì €ì¥
                    const reviewData = {
                        consultationId: consultation.id,
                        ...review,
                        createdAt: new Date().toISOString()
                    };
                    
                    console.log('í›„ê¸° ì €ì¥:', reviewData);
                    
                    alert('í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
                    onClose();
                } catch (error) {
                    console.error('í›„ê¸° ì €ì¥ ì˜¤ë¥˜:', error);
                    alert('í›„ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            };

            if (showReviewForm) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl max-h-90vh overflow-y-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-xl font-bold text-gray-900">ìƒë‹´ í›„ê¸° ì‘ì„±</h3>
                                <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                            </div>

                            <div className="space-y-6">
                                {/* ì „ì²´ í‰ì  */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ì „ì²´ ë§Œì¡±ë„ *</label>
                                    <div className="flex space-x-1">
                                        {[1, 2, 3, 4, 5].map(star => (
                                            <button
                                                key={star}
                                                onClick={() => setReview(prev => ({ ...prev, rating: star }))}
                                                className={`text-2xl ${star <= review.rating ? 'text-yellow-400' : 'text-gray-300'}`}
                                            >
                                                â­
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ì„¸ë¶€ í‰ê°€ */}
                                <div className="space-y-4">
                                    <h4 className="font-medium">ì„¸ë¶€ í‰ê°€</h4>
                                    
                                    {[
                                        { key: 'professionalismRating', label: 'ì „ë¬¸ì„±' },
                                        { key: 'communicationRating', label: 'ì†Œí†µ' },
                                        { key: 'satisfactionRating', label: 'ë§Œì¡±ë„' }
                                    ].map(({ key, label }) => (
                                        <div key={key}>
                                            <label className="block text-sm text-gray-600 mb-1">{label}</label>
                                            <div className="flex space-x-1">
                                                {[1, 2, 3, 4, 5].map(star => (
                                                    <button
                                                        key={star}
                                                        onClick={() => setReview(prev => ({ ...prev, [key]: star }))}
                                                        className={`text-lg ${star <= review[key] ? 'text-yellow-400' : 'text-gray-300'}`}
                                                    >
                                                        â­
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* í›„ê¸° ì œëª© */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">í›„ê¸° ì œëª©</label>
                                    <input
                                        type="text"
                                        value={review.reviewTitle}
                                        onChange={(e) => setReview(prev => ({ ...prev, reviewTitle: e.target.value }))}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        placeholder="í›„ê¸° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    />
                                </div>

                                {/* í›„ê¸° ë‚´ìš© */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒì„¸ í›„ê¸°</label>
                                    <textarea
                                        value={review.reviewContent}
                                        onChange={(e) => setReview(prev => ({ ...prev, reviewContent: e.target.value }))}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        rows="4"
                                        placeholder="ìƒë‹´ ê²½í—˜ì„ ë‹¤ë¥¸ ë¶„ë“¤ê³¼ ê³µìœ í•´ì£¼ì„¸ìš”"
                                    />
                                </div>

                                {/* ì¶”ì²œ ì—¬ë¶€ */}
                                <div>
                                    <label className="flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={review.wouldRecommend}
                                            onChange={(e) => setReview(prev => ({ ...prev, wouldRecommend: e.target.checked }))}
                                            className="h-4 w-4 text-blue-600"
                                        />
                                        <span className="ml-2 text-sm text-gray-700">ì´ ì „ë¬¸ê°€ë¥¼ ë‹¤ë¥¸ ë¶„ë“¤ê»˜ ì¶”ì²œí•˜ì‹œê² ì–´ìš”?</span>
                                    </label>
                                </div>

                                <div className="flex space-x-4">
                                    <button
                                        onClick={() => setShowReviewForm(false)}
                                        className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ë‚˜ì¤‘ì— ì‘ì„±
                                    </button>
                                    <button
                                        onClick={handleReviewSubmit}
                                        className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                    >
                                        í›„ê¸° ë“±ë¡
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                        <div className="text-center">
                            <div className="text-6xl mb-4">âœ…</div>
                            <h3 className="text-xl font-bold text-gray-900 mb-4">ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆë‚˜ìš”?</h3>
                            
                            <div className="bg-gray-50 p-4 rounded-lg mb-6 text-left">
                                <div className="space-y-2 text-sm">
                                    <div><strong>ì „ë¬¸ê°€:</strong> {consultation.expertName}</div>
                                    <div><strong>ìƒë‹´ ì¼ì‹œ:</strong> {consultation.scheduledTime}</div>
                                    <div><strong>ìƒë‹´ ì£¼ì œ:</strong> {consultation.topic}</div>
                                </div>
                            </div>
                            
                            <p className="text-gray-600 mb-6">
                                {userType === 'expert' ? 
                                    'ìƒë‹´ì„ ì™„ë£Œí•˜ì…¨ìœ¼ë©´ ì™„ë£Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.' :
                                    'ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ì™„ë£Œ í™•ì¸ í›„ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.'
                                }
                            </p>
                            
                            <div className="flex space-x-4">
                                <button
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ë‚˜ì¤‘ì—
                                </button>
                                <button
                                    onClick={handleComplete}
                                    disabled={isCompleting}
                                    className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300"
                                >
                                    {isCompleting ? 'ì²˜ë¦¬ì¤‘...' : 'ìƒë‹´ ì™„ë£Œ'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ì˜ˆì•½ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ConsultationBookingComponent = ({ expert, onClose, currentUser }) => {
            const [selectedDate, setSelectedDate] = useState('');
            const [selectedTime, setSelectedTime] = useState('');
            const [consultationType, setConsultationType] = useState('phone');
            const [consultationTopic, setConsultationTopic] = useState('');
            const [clientQuestions, setClientQuestions] = useState('');
            const [phoneNumber, setPhoneNumber] = useState('');
            const [currentStep, setCurrentStep] = useState(1);
            const [bookingResult, setBookingResult] = useState(null);

            // ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ ìƒì„± (ì˜¤ëŠ˜ë¶€í„° 30ì¼ê°„)
            const getAvailableDates = () => {
                const dates = [];
                const today = new Date();
                for (let i = 1; i <= 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    // ì£¼ë§ ì œì™¸ (í† : 6, ì¼: 0)
                    if (date.getDay() !== 0 && date.getDay() !== 6) {
                        dates.push(date);
                    }
                }
                return dates;
            };

            // ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ ìƒì„±
            const getAvailableTimes = () => {
                const times = [];
                for (let hour = 9; hour <= 18; hour++) {
                    times.push(`${hour.toString().padStart(2, '0')}:00`);
                    if (hour < 18) {
                        times.push(`${hour.toString().padStart(2, '0')}:30`);
                    }
                }
                return times;
            };

            const handleBooking = async () => {
                if (!selectedDate || !selectedTime || !consultationTopic) {
                    alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }

                // ê²°ì œ ë‹¨ê³„ë¡œ ì´ë™
                const bookingData = {
                    expertId: expert.id,
                    clientUserHash: currentUser?.id || 'guest_' + Date.now(),
                    scheduledTime: `${selectedDate} ${selectedTime}`,
                    consultationType,
                    consultationTopic,
                    clientQuestions,
                    phoneNumber: consultationType === 'phone' ? phoneNumber : '',
                    paymentAmount: parseInt(expert.hourlyRate),
                    platformFee: Math.round(parseInt(expert.hourlyRate) * 0.1),
                    expertPayout: Math.round(parseInt(expert.hourlyRate) * 0.9)
                };
                
                setBookingResult(bookingData);
                setCurrentStep(3); // ê²°ì œ ë‹¨ê³„
            };

            const handlePayment = async (paymentMethod) => {
                try {
                    // ê²°ì œ ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                    console.log('ê²°ì œ ì²˜ë¦¬:', { 
                        method: paymentMethod, 
                        amount: bookingResult.paymentAmount 
                    });
                    
                    // TODO: ì‹¤ì œ ê²°ì œ API ì—°ë™
                    // await processPayment(paymentMethod, bookingResult.paymentAmount);
                    
                    // Supabaseì— ì˜ˆì•½ ì •ë³´ ì €ì¥
                    const { error } = await supabase
                        .from('consultation_sessions')
                        .insert({
                            expert_id: bookingResult.expertId,
                            client_id: currentUser.id,
                            scheduled_time: bookingResult.scheduledTime,
                            consultation_type: bookingResult.consultationType,
                            consultation_topic: bookingResult.consultationTopic,
                            client_questions: bookingResult.clientQuestions,
                            payment_amount: bookingResult.paymentAmount,
                            platform_fee: bookingResult.platformFee,
                            expert_payout: bookingResult.expertPayout,
                            payment_method: paymentMethod,
                            status: 'confirmed'
                        });

                    if (error) throw error;
                    
                    setCurrentStep(4); // ì™„ë£Œ ë‹¨ê³„
                } catch (error) {
                    console.error('ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            };

            // ê²°ì œ ë‹¨ê³„ (3ë‹¨ê³„)
            if (currentStep === 3 && bookingResult) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                            <div className="text-center mb-6">
                                <div className="text-4xl mb-4">ğŸ’³</div>
                                <h3 className="text-xl font-bold text-gray-900">ê²°ì œí•˜ê¸°</h3>
                                <p className="text-sm text-gray-600 mt-2">ìƒë‹´ ì˜ˆì•½ì„ ì™„ë£Œí•˜ê¸° ìœ„í•´ ê²°ì œí•´ì£¼ì„¸ìš”</p>
                            </div>

                            {/* ê²°ì œ ì •ë³´ ìš”ì•½ */}
                            <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span>ì „ë¬¸ê°€:</span>
                                        <span className="font-medium">{expert.name}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>ìƒë‹´ ì‹œê°„:</span>
                                        <span className="font-medium">{bookingResult.scheduledTime}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>ìƒë‹´ ë°©ì‹:</span>
                                        <span className="font-medium">
                                            {consultationType === 'phone' ? 'ğŸ“ ì „í™”' :
                                             consultationType === 'video' ? 'ğŸ“¹ í™”ìƒ' : 'ğŸ’¬ ì±„íŒ…'}
                                        </span>
                                    </div>
                                    <hr className="my-2 border-blue-200" />
                                    <div className="flex justify-between font-bold text-lg">
                                        <span>ì´ ê²°ì œê¸ˆì•¡:</span>
                                        <span className="text-blue-600">{bookingResult.paymentAmount.toLocaleString()}ì›</span>
                                    </div>
                                    <div className="text-xs text-gray-500 text-right">
                                        (í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ {bookingResult.platformFee.toLocaleString()}ì› í¬í•¨)
                                    </div>
                                </div>
                            </div>

                            {/* ê²°ì œ ë°©ë²• ì„ íƒ */}
                            <div className="space-y-3 mb-6">
                                <h4 className="font-medium text-gray-800">ê²°ì œ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</h4>
                                
                                <button
                                    onClick={() => handlePayment('card')}
                                    className="w-full p-4 border-2 border-blue-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors text-left"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ’³</span>
                                            <div>
                                                <div className="font-medium">ì‹ ìš©ì¹´ë“œ</div>
                                                <div className="text-sm text-gray-500">ì¼ë°˜ì ì¸ ì‹ ìš©ì¹´ë“œ ê²°ì œ</div>
                                            </div>
                                        </div>
                                        <div className="text-blue-600 font-medium">ì„ íƒ</div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => handlePayment('kakaopay')}
                                    className="w-full p-4 border-2 border-yellow-200 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 transition-colors text-left"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ’°</span>
                                            <div>
                                                <div className="font-medium">ì¹´ì¹´ì˜¤í˜ì´</div>
                                                <div className="text-sm text-gray-500">ê°„í¸í•˜ê³  ì•ˆì „í•œ ê²°ì œ</div>
                                            </div>
                                        </div>
                                        <div className="text-yellow-600 font-medium">ì„ íƒ</div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => handlePayment('toss')}
                                    className="w-full p-4 border-2 border-blue-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors text-left"
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ¦</span>
                                            <div>
                                                <div className="font-medium">í† ìŠ¤í˜ì´</div>
                                                <div className="text-sm text-gray-500">í† ìŠ¤ ê°„í¸ê²°ì œ</div>
                                            </div>
                                        </div>
                                        <div className="text-blue-600 font-medium">ì„ íƒ</div>
                                    </div>
                                </button>
                            </div>

                            <div className="flex gap-3">
                                <button
                                    onClick={() => setCurrentStep(2)}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì´ì „
                                </button>
                                <button
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ì˜ˆì•½ ì™„ë£Œ ë‹¨ê³„ (4ë‹¨ê³„)
            if (currentStep === 4 && bookingResult) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                            <div className="text-center">
                                <div className="text-6xl mb-4">ğŸ‰</div>
                                <h3 className="text-xl font-bold text-gray-900 mb-4">ê²°ì œ ì™„ë£Œ!</h3>
                                <div className="bg-green-50 p-4 rounded-lg mb-4 text-left">
                                    <div className="space-y-2 text-sm">
                                        <div><strong>ì „ë¬¸ê°€:</strong> {expert.name}</div>
                                        <div><strong>ì¼ì‹œ:</strong> {bookingResult.scheduledTime}</div>
                                        <div><strong>ìƒë‹´ ë°©ì‹:</strong> {
                                            consultationType === 'phone' ? 'ğŸ“ ì „í™” ìƒë‹´' :
                                            consultationType === 'video' ? 'ğŸ“¹ í™”ìƒ ìƒë‹´' : 'ğŸ’¬ ì±„íŒ… ìƒë‹´'
                                        }</div>
                                        <div><strong>ê²°ì œ ê¸ˆì•¡:</strong> {bookingResult.paymentAmount.toLocaleString()}ì›</div>
                                    </div>
                                </div>
                                <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                    <h4 className="font-medium text-blue-800 mb-2">ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„</h4>
                                    <ul className="text-sm text-blue-700 text-left space-y-1">
                                        <li>â€¢ ì „ë¬¸ê°€ê°€ 24ì‹œê°„ ë‚´ ì—°ë½ë“œë¦½ë‹ˆë‹¤</li>
                                        <li>â€¢ ìƒë‹´ ì „ ì¤€ë¹„ì‚¬í•­ì„ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤</li>
                                        <li>â€¢ ë§ˆì´í˜ì´ì§€ì—ì„œ ì˜ˆì•½ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                        <li>â€¢ ì·¨ì†ŒëŠ” ìƒë‹´ 24ì‹œê°„ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                                    </ul>
                                </div>
                                <button
                                    onClick={onClose}
                                    className="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                >
                                    í™•ì¸
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full shadow-xl max-h-90vh overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold text-gray-900">ìƒë‹´ ì˜ˆì•½</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>

                        {/* ì „ë¬¸ê°€ ì •ë³´ */}
                        <div className="bg-orange-50 p-4 rounded-lg mb-6">
                            <div className="flex items-center gap-4">
                                <div className="text-3xl">{expert.profileImage}</div>
                                <div>
                                    <h4 className="font-bold text-gray-800">{expert.name}</h4>
                                    <p className="text-sm text-gray-600">{expert.title}</p>
                                    <p className="text-sm font-medium text-orange-600">{expert.price}</p>
                                </div>
                            </div>
                        </div>

                        {currentStep === 1 && (
                            <div className="space-y-6">
                                <h4 className="font-bold text-lg">1ë‹¨ê³„: ë‚ ì§œ ë° ì‹œê°„ ì„ íƒ</h4>
                                
                                {/* ë‚ ì§œ ì„ íƒ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ë‚ ì§œ *</label>
                                    <select
                                        value={selectedDate}
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        required
                                    >
                                        <option value="">ë‚ ì§œ ì„ íƒ</option>
                                        {getAvailableDates().map(date => (
                                            <option key={date.toISOString()} value={date.toISOString().split('T')[0]}>
                                                {date.toLocaleDateString('ko-KR', { 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric',
                                                    weekday: 'short'
                                                })}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                {/* ì‹œê°„ ì„ íƒ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ì‹œê°„ *</label>
                                    <div className="grid grid-cols-4 gap-2">
                                        {getAvailableTimes().map(time => (
                                            <button
                                                key={time}
                                                onClick={() => setSelectedTime(time)}
                                                className={`p-2 text-sm rounded-lg border transition-colors ${
                                                    selectedTime === time
                                                        ? 'bg-orange-500 text-white border-orange-500'
                                                        : 'bg-white text-gray-700 border-gray-300 hover:bg-orange-50'
                                                }`}
                                            >
                                                {time}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ìƒë‹´ ë°©ì‹ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ë°©ì‹ *</label>
                                    <div className="space-y-2">
                                        {expert.availableTypes?.map(type => (
                                            <label key={type} className="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                                <input
                                                    type="radio"
                                                    name="consultationType"
                                                    value={type}
                                                    checked={consultationType === type}
                                                    onChange={(e) => setConsultationType(e.target.value)}
                                                    className="h-4 w-4 text-orange-600"
                                                />
                                                <div className="ml-3">
                                                    <div className="font-medium">
                                                        {type === 'phone' ? 'ğŸ“ ì „í™” ìƒë‹´' :
                                                         type === 'video' ? 'ğŸ“¹ í™”ìƒ ìƒë‹´' : 'ğŸ’¬ ì±„íŒ… ìƒë‹´'}
                                                    </div>
                                                </div>
                                            </label>
                                        )) || (
                                            <label className="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                                <input
                                                    type="radio"
                                                    name="consultationType"
                                                    value="phone"
                                                    checked={true}
                                                    onChange={() => setConsultationType('phone')}
                                                    className="h-4 w-4 text-orange-600"
                                                />
                                                <div className="ml-3">
                                                    <div className="font-medium">ğŸ“ ì „í™” ìƒë‹´</div>
                                                </div>
                                            </label>
                                        )}
                                    </div>
                                </div>

                                <div className="flex justify-between">
                                    <button
                                        onClick={onClose}
                                        className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={() => setCurrentStep(2)}
                                        disabled={!selectedDate || !selectedTime}
                                        className="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:bg-gray-300"
                                    >
                                        ë‹¤ìŒ ë‹¨ê³„
                                    </button>
                                </div>
                            </div>
                        )}

                        {currentStep === 2 && (
                            <div className="space-y-6">
                                <h4 className="font-bold text-lg">2ë‹¨ê³„: ìƒë‹´ ë‚´ìš©</h4>
                                
                                {/* ìƒë‹´ ì£¼ì œ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ì£¼ì œ *</label>
                                    <input
                                        type="text"
                                        value={consultationTopic}
                                        onChange={(e) => setConsultationTopic(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        placeholder="ìƒë‹´ë°›ê³  ì‹¶ì€ ì£¼ì œë¥¼ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”"
                                        required
                                    />
                                </div>

                                {/* êµ¬ì²´ì ì¸ ì§ˆë¬¸ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">êµ¬ì²´ì ì¸ ì§ˆë¬¸ì´ë‚˜ ìƒí™©</label>
                                    <textarea
                                        value={clientQuestions}
                                        onChange={(e) => setClientQuestions(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        rows="4"
                                        placeholder="ìƒë‹´ì„ ìœ„í•´ ì „ë¬¸ê°€ê°€ ë¯¸ë¦¬ ì•Œì•„ì•¼ í•  ë‚´ìš©ì´ë‚˜ ì§ˆë¬¸ì„ ì ì–´ì£¼ì„¸ìš”"
                                    />
                                </div>

                                {/* ì „í™”ë²ˆí˜¸ (ì „í™” ìƒë‹´ì¸ ê²½ìš°) */}
                                {consultationType === 'phone' && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">ì—°ë½ì²˜ *</label>
                                        <input
                                            type="tel"
                                            value={phoneNumber}
                                            onChange={(e) => setPhoneNumber(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                            placeholder="010-1234-5678"
                                            required
                                        />
                                    </div>
                                )}

                                {/* ì˜ˆì•½ ìš”ì•½ */}
                                <div className="bg-gray-50 p-4 rounded-lg">
                                    <h5 className="font-medium mb-2">ì˜ˆì•½ ìš”ì•½</h5>
                                    <div className="text-sm space-y-1">
                                        <div>ğŸ“… ë‚ ì§œ: {selectedDate}</div>
                                        <div>â° ì‹œê°„: {selectedTime}</div>
                                        <div>ğŸ“ ë°©ì‹: {consultationType === 'phone' ? 'ì „í™” ìƒë‹´' : consultationType === 'video' ? 'í™”ìƒ ìƒë‹´' : 'ì±„íŒ… ìƒë‹´'}</div>
                                        <div>ğŸ’° ìƒë‹´ë£Œ: {expert.price}</div>
                                    </div>
                                </div>

                                <div className="flex justify-between">
                                    <button
                                        onClick={() => setCurrentStep(1)}
                                        className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì´ì „
                                    </button>
                                    <button
                                        onClick={handleBooking}
                                        className="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600"
                                    >
                                        ì˜ˆì•½ í™•ì •
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ì „ë¬¸ê°€ ê¸€ ì‘ì„± ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
        const ExpertPostWriteModal = ({ isOpen, onClose, currentUser, onSuccess, isAdminUser }) => {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                category: 'travel',
                serviceType: 'phone',
                price: '',
                duration: '30',
                availableDays: [],
                availableTimeSlots: [],
                tags: []
            });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [error, setError] = useState('');
            const [tagInput, setTagInput] = useState('');

            // ì¹´í…Œê³ ë¦¬ ì •ì˜
            const categories = {
                'travel': { name: 'ì—¬í–‰/ì·¨ë¯¸', icon: 'âœˆï¸', color: 'orange' },
                'legal': { name: 'ì„¸ë¬´/ë²•ë¬´/ìì‚°ê´€ë¦¬', icon: 'ğŸ“‹', color: 'blue' },
                'living': { name: 'ì£¼ê±°/ìƒí™œ', icon: 'ğŸ ', color: 'green' }
            };

            // ì„œë¹„ìŠ¤ ìœ í˜• (ìƒë‹´ ë°©ì‹)
            const serviceTypes = {
                'phone': 'ì „í™” ìƒë‹´',
                'chat': 'ì±„íŒ… ìƒë‹´',
                'video': 'ì˜ìƒ í†µí™”'
            };

            // ìš”ì¼ ì˜µì…˜
            const dayOptions = [
                { value: 'mon', label: 'ì›”' },
                { value: 'tue', label: 'í™”' },
                { value: 'wed', label: 'ìˆ˜' },
                { value: 'thu', label: 'ëª©' },
                { value: 'fri', label: 'ê¸ˆ' },
                { value: 'sat', label: 'í† ' },
                { value: 'sun', label: 'ì¼' }
            ];

            // ì‹œê°„ ìŠ¬ë¡¯ ì˜µì…˜ (9ì‹œ-18ì‹œ, 1ì‹œê°„ ë‹¨ìœ„)
            const timeSlotOptions = [
                { value: '09:00', label: '09:00' },
                { value: '10:00', label: '10:00' },
                { value: '11:00', label: '11:00' },
                { value: '12:00', label: '12:00' },
                { value: '13:00', label: '13:00' },
                { value: '14:00', label: '14:00' },
                { value: '15:00', label: '15:00' },
                { value: '16:00', label: '16:00' },
                { value: '17:00', label: '17:00' },
                { value: '18:00', label: '18:00' },
                { value: '19:00', label: '19:00' },
                { value: '20:00', label: '20:00' }
            ];

            // í¼ ì´ˆê¸°í™”
            useEffect(() => {
                if (isOpen) {
                    setFormData({
                        title: '',
                        content: '',
                        category: 'travel',
                        serviceType: 'phone',
                        price: '',
                        duration: '30',
                        availableDays: [],
                        availableTimeSlots: [],
                        tags: []
                    });
                    setError('');
                    setTagInput('');
                }
            }, [isOpen]);

            // ì…ë ¥ê°’ ë³€ê²½ í•¸ë“¤ëŸ¬
            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                setError('');
            };

            // ìš”ì¼ ì„ íƒ í•¸ë“¤ëŸ¬
            const handleDayToggle = (dayValue) => {
                setFormData(prev => ({
                    ...prev,
                    availableDays: prev.availableDays.includes(dayValue)
                        ? prev.availableDays.filter(day => day !== dayValue)
                        : [...prev.availableDays, dayValue]
                }));
            };

            // ì‹œê°„ ìŠ¬ë¡¯ ì„ íƒ í•¸ë“¤ëŸ¬
            const handleTimeSlotToggle = (timeValue) => {
                setFormData(prev => ({
                    ...prev,
                    availableTimeSlots: prev.availableTimeSlots.includes(timeValue)
                        ? prev.availableTimeSlots.filter(time => time !== timeValue)
                        : [...prev.availableTimeSlots, timeValue]
                }));
            };

            // íƒœê·¸ ì¶”ê°€
            const handleAddTag = () => {
                const trimmedTag = tagInput.trim();
                if (trimmedTag && !formData.tags.includes(trimmedTag) && formData.tags.length < 5) {
                    setFormData(prev => ({
                        ...prev,
                        tags: [...prev.tags, trimmedTag]
                    }));
                    setTagInput('');
                }
            };

            // íƒœê·¸ ì‚­ì œ
            const handleRemoveTag = (tagToRemove) => {
                setFormData(prev => ({
                    ...prev,
                    tags: prev.tags.filter(tag => tag !== tagToRemove)
                }));
            };

            // í¼ ìœ íš¨ì„± ê²€ì‚¬
            const validateForm = () => {
                if (!formData.title.trim()) return 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (!formData.content.trim()) return 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (!formData.price.trim()) return 'ìƒë‹´ë£Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (formData.availableDays.length === 0) return 'ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                if (formData.availableTimeSlots.length === 0) return 'ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                
                const price = parseInt(formData.price.replace(/,/g, ''));
                if (isNaN(price) || price < 30000) return 'ìƒë‹´ë£ŒëŠ” ìµœì†Œ 30,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                if (price > 500000) return 'ìƒë‹´ë£ŒëŠ” ìµœëŒ€ 500,000ì› ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';

                return null;
            };

            // ê¸€ ì‘ì„± ì œì¶œ
            const handleSubmit = async () => {
                const validationError = validateForm();
                if (validationError) {
                    setError(validationError);
                    return;
                }

                setIsSubmitting(true);
                
                try {
                    let expertProfile = null;

                    // ê´€ë¦¬ìëŠ” ì „ë¬¸ê°€ í”„ë¡œí•„ ì—†ì´ë„ ê¸€ ì‘ì„± ê°€ëŠ¥
                    if (isAdminUser && isAdminUser(currentUser)) {
                        // ê´€ë¦¬ììš© ì„ì‹œ í”„ë¡œí•„ ìƒì„±
                        expertProfile = {
                            id: 'admin-' + currentUser.id,
                            name: currentUser.email?.split('@')[0] || 'ê´€ë¦¬ì',
                            title: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                            user_id: currentUser.id
                        };
                    } else {
                        // ì¼ë°˜ ì‚¬ìš©ìëŠ” ì „ë¬¸ê°€ í”„ë¡œí•„ í™•ì¸
                        const { data: profile } = await supabase
                            .from('financial_experts')
                            .select('*')
                            .eq('user_id', currentUser.id)
                            .eq('is_verified', true)
                            .eq('is_active', true)
                            .single();

                        if (!profile) {
                            setError('ìŠ¹ì¸ëœ ì „ë¬¸ê°€ë§Œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                            return;
                        }
                        expertProfile = profile;
                    }

                    // ì¼ë°˜ ì „ë¬¸ê°€ì˜ ê²½ìš° expert_posts í…Œì´ë¸”ì— ì €ì¥
                    if (!isAdminUser || !isAdminUser(currentUser)) {
                        const postData = {
                            expert_id: expertProfile.id,
                            title: formData.title.trim(),
                            content: formData.content.trim(),
                            service_description: `ì„œë¹„ìŠ¤ ìœ í˜•: ${serviceTypes[formData.serviceType]}\nì†Œìš” ì‹œê°„: ${formData.duration}ë¶„\nìƒë‹´ë£Œ: ${formData.price}ì›\nê°€ëŠ¥ ìš”ì¼: ${formData.availableDays.map(d => dayOptions.find(opt => opt.value === d)?.label).join(', ')}\nê°€ëŠ¥ ì‹œê°„: ${formData.availableTimeSlots.join(', ')}\nğŸ’¬ í”Œë«í¼ ë‚´ ì±„íŒ…ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ìƒë‹´ë°›ìœ¼ì„¸ìš”`,
                            category: formData.category,
                            consultation_type: [formData.serviceType],
                            price_info: `${formData.price}ì› / ${formData.duration}ë¶„`,
                            sample_questions: formData.tags
                        };

                        // expert_posts í…Œì´ë¸”ì— ì €ì¥
                        const { data: expertPost, error: expertError } = await supabase
                            .from('expert_posts')
                            .insert([postData])
                            .select()
                            .single();

                        if (expertError) {
                            throw expertError;
                        }
                    }

                    // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ë¡œë„ ë™ì‹œ ë“±ë¡ (ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬)
                    const communityPostData = {
                        user_hash: currentUser.userHash,
                        topic: 'expert',
                        title: formData.title.trim(),
                        content: formData.content.trim(),
                        expert_category: formData.category,
                        expert_name: expertProfile.name,
                        expert_title: expertProfile.title,
                        expert_badge: isAdminUser && isAdminUser(currentUser) ? 'ğŸ‘‘ ìŠˆí¼ê´€ë¦¬ì' : 'ì¸ì¦ ì „ë¬¸ê°€',
                        created_at: new Date().toISOString()
                    };

                    const { error: communityError } = await supabase
                        .from('community_posts')
                        .insert([communityPostData]);

                    if (communityError) {
                        console.warn('ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ë“±ë¡ ì‹¤íŒ¨:', communityError);
                    }

                    showNotification(
                        'ì„œë¹„ìŠ¤ ê²Œì‹œ ì™„ë£Œ!',
                        'ì„œë¹„ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì „ë¬¸ê°€ ì°¾ê¸°ì—ì„œ ê³ ê°ë“¤ì´ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                        'success'
                    );

                    onSuccess && onSuccess();
                    onClose();

                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
                    setError('ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } finally {
                    setIsSubmitting(false);
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        {/* í—¤ë” */}
                        <div className="sticky top-0 bg-white border-b p-4 flex items-center justify-between">
                            <h2 className="text-lg font-bold">ğŸ“ ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700 text-xl"
                            >
                                âœ•
                            </button>
                        </div>

                        {/* ë‚´ìš© */}
                        <div className="p-6 space-y-6">
                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded p-3 text-red-700 text-sm">
                                    {error}
                                </div>
                            )}

                            {/* ì¹´í…Œê³ ë¦¬ ì„ íƒ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì „ë¬¸ ë¶„ì•¼ *
                                </label>
                                <div className="grid grid-cols-3 gap-2">
                                    {Object.entries(categories).map(([key, category]) => (
                                        <button
                                            key={key}
                                            onClick={() => handleInputChange('category', key)}
                                            className={`p-3 rounded-lg text-center transition-all ${
                                                formData.category === key
                                                    ? `bg-${category.color}-500 text-white`
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            <div className="text-lg mb-1">{category.icon}</div>
                                            <div className="font-semibold text-xs">{category.name}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* ì œëª© */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì œëª© *
                                </label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => handleInputChange('title', e.target.value)}
                                    placeholder="ì˜ˆ: ì€í‡´ í›„ í•´ì™¸ ì¥ê¸°ì²´ë¥˜ ì™„ì „ ê°€ì´ë“œ"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    maxLength={100}
                                />
                                <div className="text-xs text-gray-500 mt-1">
                                    {formData.title.length}/100
                                </div>
                            </div>

                            {/* ë‚´ìš© */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë‚´ìš© *
                                </label>
                                <textarea
                                    value={formData.content}
                                    onChange={(e) => handleInputChange('content', e.target.value)}
                                    placeholder="ì „ë¬¸ê°€ë¡œì„œ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ìƒì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.&#10;- ìƒë‹´ ë‚´ìš©&#10;- ê²½ë ¥ ë° ì „ë¬¸ì„±&#10;- ê³ ê°ì—ê²Œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê°€ì¹˜"
                                    rows={8}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    maxLength={2000}
                                />
                                <div className="text-xs text-gray-500 mt-1">
                                    {formData.content.length}/2000
                                </div>
                            </div>

                            {/* ì„œë¹„ìŠ¤ ì •ë³´ */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* ì„œë¹„ìŠ¤ ìœ í˜• */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ì„œë¹„ìŠ¤ ìœ í˜•
                                    </label>
                                    <select
                                        value={formData.serviceType}
                                        onChange={(e) => handleInputChange('serviceType', e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                        {Object.entries(serviceTypes).map(([key, label]) => (
                                            <option key={key} value={key}>{label}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* ì†Œìš” ì‹œê°„ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ì†Œìš” ì‹œê°„ (ë¶„)
                                    </label>
                                    <select
                                        value={formData.duration}
                                        onChange={(e) => handleInputChange('duration', e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                        <option value="15">15ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="60">60ë¶„</option>
                                    </select>
                                </div>
                            </div>

                            {/* ìƒë‹´ë£Œ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ìƒë‹´ë£Œ (ì›) *
                                </label>
                                <input
                                    type="text"
                                    value={formData.price}
                                    onChange={(e) => {
                                        const value = e.target.value.replace(/[^0-9]/g, '');
                                        const formatted = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                                        handleInputChange('price', formatted);
                                    }}
                                    placeholder="30,000"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                                <div className="text-xs text-gray-500 mt-1">
                                    ìµœì†Œ 30,000ì› ì´ìƒ, ìµœëŒ€ 500,000ì› ì´í•˜
                                </div>
                            </div>

                            {/* ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ *
                                </label>
                                <div className="flex flex-wrap gap-2">
                                    {dayOptions.map(day => (
                                        <button
                                            key={day.value}
                                            onClick={() => handleDayToggle(day.value)}
                                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                formData.availableDays.includes(day.value)
                                                    ? 'bg-blue-500 text-white'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {day.label}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ * (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)
                                </label>
                                <div className="grid grid-cols-4 gap-2">
                                    {timeSlotOptions.map(time => (
                                        <button
                                            key={time.value}
                                            type="button"
                                            onClick={() => handleTimeSlotToggle(time.value)}
                                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                formData.availableTimeSlots.includes(time.value)
                                                    ? 'bg-green-500 text-white'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {time.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                    ì„ íƒí•œ ì‹œê°„ëŒ€ì— ìƒë‹´ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤
                                </div>
                            </div>

                            {/* íƒœê·¸ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì „ë¬¸ íƒœê·¸ (ìµœëŒ€ 5ê°œ)
                                </label>
                                <div className="flex gap-2 mb-2">
                                    <input
                                        type="text"
                                        value={tagInput}
                                        onChange={(e) => setTagInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                                        placeholder="íƒœê·¸ ì…ë ¥ í›„ ì—”í„°"
                                        className="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                    <button
                                        onClick={handleAddTag}
                                        disabled={!tagInput.trim() || formData.tags.length >= 5}
                                        className="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 disabled:bg-gray-300"
                                    >
                                        ì¶”ê°€
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-1">
                                    {formData.tags.map((tag, index) => (
                                        <span
                                            key={index}
                                            className="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded"
                                        >
                                            {tag}
                                            <button
                                                onClick={() => handleRemoveTag(tag)}
                                                className="ml-1 text-blue-500 hover:text-blue-700"
                                            >
                                                âœ•
                                            </button>
                                        </span>
                                    ))}
                                </div>
                            </div>

                            {/* ë²„íŠ¼ */}
                            <div className="flex gap-3 pt-4">
                                <button
                                    onClick={onClose}
                                    disabled={isSubmitting}
                                    className="flex-1 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 disabled:opacity-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    disabled={isSubmitting}
                                    className="flex-1 py-3 px-4 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isSubmitting ? 'ë“±ë¡ ì¤‘...' : 'ê¸€ ë“±ë¡'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ì—°ë½ì²˜ êµí™˜ ì»´í¬ë„ŒíŠ¸
        const ContactExchangeComponent = ({ currentUser, isAdminUser }) => {
            const [exchangeRequests, setExchangeRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedRequest, setSelectedRequest] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);

            // ì—°ë½ì²˜ êµí™˜ ìš”ì²­ ëª©ë¡ ë¡œë“œ
            const loadExchangeRequests = async () => {
                try {
                    setLoading(true);
                    const { data, error } = await supabase
                        .from('contact_exchange_requests')
                        .select(`
                            *,
                            expert:expert_id (nickname, email),
                            client:client_id (nickname, email),
                            booking:booking_id (
                                consultation_type,
                                scheduled_time,
                                payment_amount,
                                status
                            )
                        `)
                        .or(`expert_id.eq.${currentUser.id},client_id.eq.${currentUser.id}`)
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setExchangeRequests(data || []);
                } catch (error) {
                    console.error('ì—°ë½ì²˜ êµí™˜ ìš”ì²­ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì—°ë½ì²˜ ê³µìœ  ìŠ¹ì¸
            const approveContactShare = async (requestId, contactInfo) => {
                try {
                    const isExpert = exchangeRequests.find(r => r.id === requestId)?.expert_id === currentUser.id;
                    
                    const updateData = isExpert ? {
                        expert_phone: contactInfo.phone,
                        expert_email: contactInfo.email,
                        expert_preferred_contact: contactInfo.preferred_contact,
                        expert_available_hours: contactInfo.available_hours,
                        expert_consultation_notes: contactInfo.consultation_notes,
                        expert_approved_at: new Date().toISOString(),
                        status: 'approved_by_expert'
                    } : {
                        client_phone: contactInfo.phone,
                        client_email: contactInfo.email,
                        client_preferred_contact: contactInfo.preferred_contact,
                        client_consultation_notes: contactInfo.consultation_notes,
                        client_approved_at: new Date().toISOString(),
                        status: 'approved_by_client'
                    };

                    const { error } = await supabase
                        .from('contact_exchange_requests')
                        .update(updateData)
                        .eq('id', requestId);

                    if (error) throw error;
                    
                    alert('ì—°ë½ì²˜ê°€ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadExchangeRequests();
                    setShowDetailModal(false);
                } catch (error) {
                    console.error('ì—°ë½ì²˜ ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                    alert('ì—°ë½ì²˜ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
            const getStatusBadge = (status, isExpert, request) => {
                const userType = isExpert ? 'expert' : 'client';
                
                switch (status) {
                    case 'pending':
                        return <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">ìŠ¹ì¸ ëŒ€ê¸°ì¤‘</span>;
                    case 'approved_by_expert':
                        return isExpert ? 
                            <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">ë‚´ê°€ ìŠ¹ì¸í•¨</span> :
                            <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">ì „ë¬¸ê°€ ìŠ¹ì¸ë¨</span>;
                    case 'approved_by_client':
                        return isExpert ? 
                            <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">ê³ ê° ìŠ¹ì¸ë¨</span> :
                            <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">ë‚´ê°€ ìŠ¹ì¸í•¨</span>;
                    case 'both_approved':
                        return <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">ì—°ë½ì²˜ êµí™˜ ì™„ë£Œ</span>;
                    case 'declined':
                        return <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">ê±°ì ˆë¨</span>;
                    case 'expired':
                        return <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">ë§Œë£Œë¨</span>;
                    default:
                        return <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">{status}</span>;
                }
            };

            useEffect(() => {
                if (currentUser) {
                    loadExchangeRequests();
                }
            }, [currentUser]);

            if (loading) {
                return (
                    <div className="flex items-center justify-center py-12">
                        <div className="text-center">
                            <div className="text-4xl mb-4">ğŸ“</div>
                            <p className="text-gray-500">ì—°ë½ì²˜ êµí™˜ ìš”ì²­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white p-6 rounded-xl">
                        <h2 className="text-xl font-bold mb-2">ğŸ“ ì—°ë½ì²˜ êµí™˜</h2>
                        <p className="text-green-100">ê²°ì œ ì™„ë£Œëœ ìƒë‹´ì˜ ì—°ë½ì²˜ë¥¼ ì•ˆì „í•˜ê²Œ êµí™˜í•˜ì„¸ìš”</p>
                    </div>

                    {exchangeRequests.length === 0 ? (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">ğŸ“­</div>
                            <h3 className="text-lg font-medium text-gray-800 mb-2">ì—°ë½ì²˜ êµí™˜ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p className="text-gray-600">ì „ë¬¸ê°€ ìƒë‹´ì„ ì˜ˆì•½í•˜ê³  ê²°ì œë¥¼ ì™„ë£Œí•˜ë©´ ì—°ë½ì²˜ êµí™˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {exchangeRequests.map((request) => {
                                const isExpert = request.expert_id === currentUser.id;
                                const otherUser = isExpert ? request.client : request.expert;
                                
                                return (
                                    <div key={request.id} className="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-3 mb-2">
                                                    <h3 className="font-semibold text-gray-800">
                                                        {isExpert ? 'ğŸ‘¤ ' + otherUser.nickname + ' (ê³ ê°)' : 'ğŸ¯ ' + otherUser.nickname + ' (ì „ë¬¸ê°€)'}
                                                    </h3>
                                                    {getStatusBadge(request.status, isExpert, request)}
                                                </div>
                                                
                                                <div className="text-sm text-gray-600 space-y-1">
                                                    <div>ğŸ“… ìƒë‹´ ì¼ì‹œ: {new Date(request.booking.scheduled_time).toLocaleString('ko-KR')}</div>
                                                    <div>ğŸ’¬ ìƒë‹´ ë°©ì‹: {
                                                        request.booking.consultation_type === 'phone' ? 'ğŸ“ ì „í™” ìƒë‹´' :
                                                        request.booking.consultation_type === 'video' ? 'ğŸ“¹ í™”ìƒ ìƒë‹´' : 'ğŸ’¬ ì±„íŒ… ìƒë‹´'
                                                    }</div>
                                                    <div>ğŸ’° ê²°ì œ ê¸ˆì•¡: {request.booking.payment_amount.toLocaleString()}ì›</div>
                                                    <div>â° ë§Œë£Œ ì‹œê°„: {new Date(request.expires_at).toLocaleString('ko-KR')}</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex gap-3 mt-4">
                                            <button
                                                onClick={() => {
                                                    setSelectedRequest(request);
                                                    setShowDetailModal(true);
                                                }}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                            >
                                                ìƒì„¸ë³´ê¸°
                                            </button>
                                            
                                            {request.status === 'pending' || 
                                             (request.status === 'approved_by_client' && isExpert) ||
                                             (request.status === 'approved_by_expert' && !isExpert) ? (
                                                <button
                                                    onClick={() => {
                                                        setSelectedRequest(request);
                                                        setShowDetailModal(true);
                                                    }}
                                                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                                >
                                                    ì—°ë½ì²˜ ê³µìœ 
                                                </button>
                                            ) : null}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* ì—°ë½ì²˜ êµí™˜ ìƒì„¸ ëª¨ë‹¬ */}
                    {showDetailModal && selectedRequest && (
                        <ContactExchangeDetailModal
                            request={selectedRequest}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowDetailModal(false);
                                setSelectedRequest(null);
                            }}
                            onApprove={approveContactShare}
                        />
                    )}
                </div>
            );
        };

        // ì—°ë½ì²˜ êµí™˜ ìƒì„¸ ëª¨ë‹¬
        const ContactExchangeDetailModal = ({ request, currentUser, onClose, onApprove }) => {
            const [contactInfo, setContactInfo] = useState({
                phone: currentUser.phone || '',
                email: currentUser.email || '',
                preferred_contact: 'phone',
                available_hours: '',
                consultation_notes: ''
            });

            const isExpert = request.expert_id === currentUser.id;
            const otherUser = isExpert ? request.client : request.expert;
            const canShare = request.status === 'pending' || 
                           (request.status === 'approved_by_client' && isExpert) ||
                           (request.status === 'approved_by_expert' && !isExpert);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!contactInfo.phone && !contactInfo.email) {
                    alert('ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼ ì¤‘ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }
                onApprove(request.id, contactInfo);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-gray-800">ì—°ë½ì²˜ êµí™˜ ìƒì„¸</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                            >
                                Ã—
                            </button>
                        </div>

                        {/* ìƒë‹´ ì •ë³´ */}
                        <div className="bg-blue-50 p-4 rounded-lg mb-6">
                            <h3 className="font-medium text-blue-800 mb-3">ğŸ“‹ ìƒë‹´ ì •ë³´</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                <div><strong>ìƒëŒ€ë°©:</strong> {otherUser.nickname}</div>
                                <div><strong>ìƒë‹´ ì¼ì‹œ:</strong> {new Date(request.booking.scheduled_time).toLocaleString('ko-KR')}</div>
                                <div><strong>ìƒë‹´ ë°©ì‹:</strong> {
                                    request.booking.consultation_type === 'phone' ? 'ğŸ“ ì „í™”' :
                                    request.booking.consultation_type === 'video' ? 'ğŸ“¹ í™”ìƒ' : 'ğŸ’¬ ì±„íŒ…'
                                }</div>
                                <div><strong>ê²°ì œ ê¸ˆì•¡:</strong> {request.booking.payment_amount.toLocaleString()}ì›</div>
                            </div>
                        </div>

                        {/* êµí™˜ëœ ì—°ë½ì²˜ í‘œì‹œ */}
                        {request.status === 'both_approved' && (
                            <div className="bg-green-50 p-4 rounded-lg mb-6">
                                <h3 className="font-medium text-green-800 mb-3">âœ… êµí™˜ëœ ì—°ë½ì²˜</h3>
                                <div className="space-y-3">
                                    {isExpert ? (
                                        <div>
                                            <div className="text-sm font-medium text-gray-700">ê³ ê° ì—°ë½ì²˜:</div>
                                            <div className="text-sm">ì „í™”: {request.client_phone || 'ë¯¸ì œê³µ'}</div>
                                            <div className="text-sm">ì´ë©”ì¼: {request.client_email || 'ë¯¸ì œê³µ'}</div>
                                            <div className="text-sm">ì„ í˜¸ ì—°ë½ë°©ì‹: {request.client_preferred_contact || 'ë¯¸ì§€ì •'}</div>
                                            {request.client_consultation_notes && (
                                                <div className="text-sm mt-2">
                                                    <strong>ê³ ê° ë©”ì‹œì§€:</strong> {request.client_consultation_notes}
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="text-sm font-medium text-gray-700">ì „ë¬¸ê°€ ì—°ë½ì²˜:</div>
                                            <div className="text-sm">ì „í™”: {request.expert_phone || 'ë¯¸ì œê³µ'}</div>
                                            <div className="text-sm">ì´ë©”ì¼: {request.expert_email || 'ë¯¸ì œê³µ'}</div>
                                            <div className="text-sm">ì„ í˜¸ ì—°ë½ë°©ì‹: {request.expert_preferred_contact || 'ë¯¸ì§€ì •'}</div>
                                            <div className="text-sm">ìƒë‹´ ê°€ëŠ¥ ì‹œê°„: {request.expert_available_hours || 'ë¯¸ì§€ì •'}</div>
                                            {request.expert_consultation_notes && (
                                                <div className="text-sm mt-2">
                                                    <strong>ì „ë¬¸ê°€ ì•ˆë‚´ì‚¬í•­:</strong> {request.expert_consultation_notes}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* ì—°ë½ì²˜ ê³µìœ  í¼ */}
                        {canShare && (
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <h3 className="font-medium text-gray-800 mb-4">ğŸ“ ë‚´ ì—°ë½ì²˜ ê³µìœ </h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            ì „í™”ë²ˆí˜¸
                                        </label>
                                        <input
                                            type="tel"
                                            value={contactInfo.phone}
                                            onChange={(e) => setContactInfo(prev => ({ ...prev, phone: e.target.value }))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="010-1234-5678"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            ì´ë©”ì¼
                                        </label>
                                        <input
                                            type="email"
                                            value={contactInfo.email}
                                            onChange={(e) => setContactInfo(prev => ({ ...prev, email: e.target.value }))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="email@example.com"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        ì„ í˜¸í•˜ëŠ” ì—°ë½ ë°©ì‹
                                    </label>
                                    <select
                                        value={contactInfo.preferred_contact}
                                        onChange={(e) => setContactInfo(prev => ({ ...prev, preferred_contact: e.target.value }))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="phone">ì „í™” ìš°ì„ </option>
                                        <option value="email">ì´ë©”ì¼ ìš°ì„ </option>
                                        <option value="both">ë‘˜ ë‹¤ ê°€ëŠ¥</option>
                                    </select>
                                </div>

                                {isExpert && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            ìƒë‹´ ê°€ëŠ¥ ì‹œê°„
                                        </label>
                                        <input
                                            type="text"
                                            value={contactInfo.available_hours}
                                            onChange={(e) => setContactInfo(prev => ({ ...prev, available_hours: e.target.value }))}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="ì˜ˆ: í‰ì¼ 9-18ì‹œ, ì£¼ë§ ìƒë‹´ ê°€ëŠ¥"
                                        />
                                    </div>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        {isExpert ? 'ìƒë‹´ ì „ ì•ˆë‚´ì‚¬í•­' : 'ì „ë¬¸ê°€ì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€'}
                                    </label>
                                    <textarea
                                        value={contactInfo.consultation_notes}
                                        onChange={(e) => setContactInfo(prev => ({ ...prev, consultation_notes: e.target.value }))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        rows="3"
                                        placeholder={isExpert ? "ìƒë‹´ ì „ ì¤€ë¹„ì‚¬í•­ì´ë‚˜ ì£¼ì˜ì‚¬í•­ì„ ì•Œë ¤ì£¼ì„¸ìš”" : "ì „ë¬¸ê°€ì—ê²Œ ê¶ê¸ˆí•œ ì ì´ë‚˜ ìš”ì²­ì‚¬í•­ì„ ì ì–´ì£¼ì„¸ìš”"}
                                    />
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                    >
                                        ì—°ë½ì²˜ ê³µìœ í•˜ê¸°
                                    </button>
                                </div>
                            </form>
                        )}

                        {!canShare && request.status !== 'both_approved' && (
                            <div className="text-center py-8">
                                <div className="text-4xl mb-2">â³</div>
                                <p className="text-gray-600">ìƒëŒ€ë°©ì˜ ì—°ë½ì²˜ ê³µìœ ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ì‹¤ì‹œê°„ ì±„íŒ… ì»´í¬ë„ŒíŠ¸ - ì „ë¬¸ê°€-ê³ ê° ìƒë‹´ìš© ê°œì„  + WebRTC
        const ChatComponent = ({ currentUser, isAdminUser }) => {
            const [chatRooms, setChatRooms] = useState([]);
            const [selectedRoom, setSelectedRoom] = useState(null);
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [participants, setParticipants] = useState([]);
            const [loading, setLoading] = useState(true);
            const [sending, setSending] = useState(false);
            const [showCreateRoom, setShowCreateRoom] = useState(false);
            const [isExpertConsultation, setIsExpertConsultation] = useState(false);
            
            // WebRTC í†µí™” ê´€ë ¨ ìƒíƒœ
            const [isCallActive, setIsCallActive] = useState(false);
            const [callType, setCallType] = useState(null); // 'audio' | 'video'
            const [localStream, setLocalStream] = useState(null);
            const [remoteStream, setRemoteStream] = useState(null);
            const [peerConnection, setPeerConnection] = useState(null);
            const [isMuted, setIsMuted] = useState(false);
            const [isVideoOff, setIsVideoOff] = useState(false);
            const [callStatus, setCallStatus] = useState('idle'); // 'idle' | 'calling' | 'ringing' | 'connected' | 'ended'
            const [showFileUpload, setShowFileUpload] = useState(false);
            const [uploadingFile, setUploadingFile] = useState(false);
            
            const messagesEndRef = useRef(null);
            const messageSubscription = useRef(null);
            const localVideoRef = useRef(null);
            const remoteVideoRef = useRef(null);
            const fileInputRef = useRef(null);
            const callSubscription = useRef(null);

            // ì±„íŒ…ë°© ëª©ë¡ ë¡œë“œ
            const loadChatRooms = async () => {
                try {
                    const { data, error } = await supabase
                        .from('chat_rooms')
                        .select('*')
                        .eq('is_active', true)
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setChatRooms(data || []);
                    
                    // ì²« ë²ˆì§¸ ì±„íŒ…ë°©ì„ ê¸°ë³¸ ì„ íƒ
                    if (data && data.length > 0) {
                        setSelectedRoom(data[0]);
                    }
                } catch (error) {
                    console.error('ì±„íŒ…ë°© ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì±„íŒ…ë°© ì°¸ì—¬
            const joinRoom = async (room) => {
                try {
                    // ì°¸ì—¬ìë¡œ ì¶”ê°€ (ì´ë¯¸ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸)
                    await supabase
                        .from('chat_participants')
                        .upsert({
                            room_id: room.id,
                            user_id: currentUser.id,
                            is_active: true
                        }, {
                            onConflict: 'room_id,user_id'
                        });
                        
                    setSelectedRoom(room);
                    loadMessages(room.id);
                    loadParticipants(room.id);
                } catch (error) {
                    console.error('ì±„íŒ…ë°© ì°¸ì—¬ ì˜¤ë¥˜:', error);
                }
            };

            // ë©”ì‹œì§€ ë¡œë“œ
            const loadMessages = async (roomId) => {
                try {
                    const { data, error } = await supabase
                        .from('chat_messages')
                        .select('*')
                        .eq('room_id', roomId)
                        .order('created_at', { ascending: true })
                        .limit(100); // ìµœê·¼ 100ê°œ ë©”ì‹œì§€ë§Œ

                    if (error) throw error;
                    setMessages(data || []);
                    
                    // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
                    setTimeout(() => scrollToBottom(), 100);
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            };

            // ì°¸ì—¬ì ë¡œë“œ
            const loadParticipants = async (roomId) => {
                try {
                    const { data, error } = await supabase
                        .from('chat_participants')
                        .select(`
                            *,
                            user_profiles:user_id (
                                nickname,
                                role
                            )
                        `)
                        .eq('room_id', roomId)
                        .eq('is_active', true);

                    if (error) throw error;
                    setParticipants(data || []);
                } catch (error) {
                    console.error('ì°¸ì—¬ì ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            };

            // ë©”ì‹œì§€ ì „ì†¡
            const sendMessage = async (e) => {
                e.preventDefault();
                if (!newMessage.trim() || !selectedRoom || sending) return;

                try {
                    setSending(true);
                    const { error } = await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: selectedRoom.id,
                            user_id: currentUser.id,
                            user_nickname: currentUser.nickname || currentUser.email,
                            message_text: newMessage.trim(),
                            message_type: 'text'
                        });

                    if (error) throw error;
                    setNewMessage('');
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                    alert('ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSending(false);
                }
            };

            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
            const setupRealtimeSubscription = (roomId) => {
                // ê¸°ì¡´ êµ¬ë… í•´ì œ
                if (messageSubscription.current) {
                    messageSubscription.current.unsubscribe();
                }

                // ìƒˆ ë©”ì‹œì§€ êµ¬ë…
                messageSubscription.current = supabase
                    .channel(`chat-${roomId}`)
                    .on('postgres_changes', {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'chat_messages',
                        filter: `room_id=eq.${roomId}`
                    }, (payload) => {
                        const message = payload.new;
                        
                        // WebRTC ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì²˜ë¦¬
                        if (message.message_type === 'webrtc-signal') {
                            try {
                                const signalData = JSON.parse(message.message_text);
                                handleSignalingMessage(signalData);
                            } catch (error) {
                                console.error('ì‹œê·¸ë„ë§ ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:', error);
                            }
                        } else {
                            // ì¼ë°˜ ì±„íŒ… ë©”ì‹œì§€ë§Œ í™”ë©´ì— í‘œì‹œ
                            setMessages(prev => [...prev, message]);
                            setTimeout(() => scrollToBottom(), 100);
                        }
                    })
                    .subscribe();
            };

            useEffect(() => {
                if (currentUser) {
                    loadChatRooms();
                }

                return () => {
                    if (messageSubscription.current) {
                        messageSubscription.current.unsubscribe();
                    }
                    
                    // WebRTC ë¦¬ì†ŒìŠ¤ ì •ë¦¬
                    if (localStream) {
                        localStream.getTracks().forEach(track => track.stop());
                    }
                    if (peerConnection) {
                        peerConnection.close();
                    }
                };
            }, [currentUser]);

            useEffect(() => {
                if (selectedRoom) {
                    setupRealtimeSubscription(selectedRoom.id);
                }
            }, [selectedRoom]);

            // ë©”ì‹œì§€ ì‹œê°„ í¬ë§·
            const formatMessageTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            };

            // WebRTC êµ¬ì„±
            const rtcConfiguration = {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' }
                ]
            };

            // WebRTC í†µí™” ì‹œì‘
            const startCall = async (type) => {
                if (!selectedRoom || selectedRoom.room_type !== 'private') {
                    alert('í”„ë¼ì´ë¹— ìƒë‹´ë°©ì—ì„œë§Œ í†µí™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }

                try {
                    setCallStatus('calling');
                    setCallType(type);
                    
                    // ì‚¬ìš©ì ë¯¸ë””ì–´ ê¶Œí•œ ìš”ì²­
                    const constraints = {
                        audio: true,
                        video: type === 'video'
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    setLocalStream(stream);
                    
                    if (localVideoRef.current && type === 'video') {
                        localVideoRef.current.srcObject = stream;
                    }

                    // PeerConnection ìƒì„±
                    const pc = new RTCPeerConnection(rtcConfiguration);
                    setPeerConnection(pc);

                    // ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ì„ PeerConnectionì— ì¶”ê°€
                    stream.getTracks().forEach(track => {
                        pc.addTrack(track, stream);
                    });

                    // ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹  ì²˜ë¦¬
                    pc.ontrack = (event) => {
                        const [remoteStream] = event.streams;
                        setRemoteStream(remoteStream);
                        if (remoteVideoRef.current) {
                            remoteVideoRef.current.srcObject = remoteStream;
                        }
                    };

                    // ICE candidate ì²˜ë¦¬
                    pc.onicecandidate = async (event) => {
                        if (event.candidate) {
                            await sendSignalingMessage({
                                type: 'ice-candidate',
                                candidate: event.candidate,
                                roomId: selectedRoom.id,
                                from: currentUser.id
                            });
                        }
                    };

                    // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
                    pc.onconnectionstatechange = () => {
                        console.log('Connection state:', pc.connectionState);
                        if (pc.connectionState === 'connected') {
                            setCallStatus('connected');
                            setIsCallActive(true);
                        } else if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {
                            endCall();
                        }
                    };

                    // offer ìƒì„± ë° ì „ì†¡
                    const offer = await pc.createOffer();
                    await pc.setLocalDescription(offer);

                    await sendSignalingMessage({
                        type: 'offer',
                        offer: offer,
                        callType: type,
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });

                } catch (error) {
                    console.error('í†µí™” ì‹œì‘ ì˜¤ë¥˜:', error);
                    alert('í†µí™”ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬/ì¹´ë©”ë¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    setCallStatus('idle');
                }
            };

            // í†µí™” ì¢…ë£Œ
            const endCall = () => {
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    setLocalStream(null);
                }
                
                if (peerConnection) {
                    peerConnection.close();
                    setPeerConnection(null);
                }
                
                setRemoteStream(null);
                setIsCallActive(false);
                setCallStatus('idle');
                setCallType(null);
                setIsMuted(false);
                setIsVideoOff(false);

                // í†µí™” ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡
                if (selectedRoom) {
                    sendSignalingMessage({
                        type: 'end-call',
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });
                }
            };

            // ìŒì†Œê±° í† ê¸€
            const toggleMute = () => {
                if (localStream) {
                    const audioTrack = localStream.getAudioTracks()[0];
                    if (audioTrack) {
                        audioTrack.enabled = !audioTrack.enabled;
                        setIsMuted(!audioTrack.enabled);
                    }
                }
            };

            // ë¹„ë””ì˜¤ í† ê¸€
            const toggleVideo = () => {
                if (localStream && callType === 'video') {
                    const videoTrack = localStream.getVideoTracks()[0];
                    if (videoTrack) {
                        videoTrack.enabled = !videoTrack.enabled;
                        setIsVideoOff(!videoTrack.enabled);
                    }
                }
            };

            // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡ (Supabase ì±„íŒ… ë©”ì‹œì§€ ì´ìš©)
            const sendSignalingMessage = async (signalData) => {
                try {
                    await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: signalData.roomId,
                            user_id: currentUser.id,
                            user_nickname: currentUser.nickname || currentUser.email,
                            message_text: JSON.stringify(signalData),
                            message_type: 'webrtc-signal'
                        });
                } catch (error) {
                    console.error('ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                }
            };

            // WebRTC ì‹œê·¸ë„ë§ ì²˜ë¦¬
            const handleSignalingMessage = async (signalData) => {
                try {
                    switch (signalData.type) {
                        case 'offer':
                            await handleOffer(signalData);
                            break;
                        case 'answer':
                            await handleAnswer(signalData);
                            break;
                        case 'ice-candidate':
                            await handleIceCandidate(signalData);
                            break;
                        case 'end-call':
                            endCall();
                            break;
                    }
                } catch (error) {
                    console.error('ì‹œê·¸ë„ë§ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                }
            };

            // Offer ì²˜ë¦¬
            const handleOffer = async (signalData) => {
                if (!peerConnection && signalData.from !== currentUser.id) {
                    const shouldAccept = confirm('ìŒì„±/ì˜ìƒ í†µí™” ìš”ì²­ì´ ì™”ìŠµë‹ˆë‹¤. ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (!shouldAccept) return;

                    setCallStatus('ringing');
                    setCallType(signalData.callType);

                    // ì‚¬ìš©ì ë¯¸ë””ì–´ ê°€ì ¸ì˜¤ê¸°
                    const constraints = {
                        audio: true,
                        video: signalData.callType === 'video'
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    setLocalStream(stream);

                    if (localVideoRef.current && signalData.callType === 'video') {
                        localVideoRef.current.srcObject = stream;
                    }

                    // PeerConnection ìƒì„±
                    const pc = new RTCPeerConnection(rtcConfiguration);
                    setPeerConnection(pc);

                    stream.getTracks().forEach(track => {
                        pc.addTrack(track, stream);
                    });

                    pc.ontrack = (event) => {
                        const [remoteStream] = event.streams;
                        setRemoteStream(remoteStream);
                        if (remoteVideoRef.current) {
                            remoteVideoRef.current.srcObject = remoteStream;
                        }
                    };

                    pc.onicecandidate = async (event) => {
                        if (event.candidate) {
                            await sendSignalingMessage({
                                type: 'ice-candidate',
                                candidate: event.candidate,
                                roomId: selectedRoom.id,
                                from: currentUser.id
                            });
                        }
                    };

                    pc.onconnectionstatechange = () => {
                        if (pc.connectionState === 'connected') {
                            setCallStatus('connected');
                            setIsCallActive(true);
                        } else if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {
                            endCall();
                        }
                    };

                    // remote description ì„¤ì • ë° answer ìƒì„±
                    await pc.setRemoteDescription(signalData.offer);
                    const answer = await pc.createAnswer();
                    await pc.setLocalDescription(answer);

                    await sendSignalingMessage({
                        type: 'answer',
                        answer: answer,
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });
                }
            };

            // Answer ì²˜ë¦¬
            const handleAnswer = async (signalData) => {
                if (peerConnection && signalData.from !== currentUser.id) {
                    await peerConnection.setRemoteDescription(signalData.answer);
                }
            };

            // ICE Candidate ì²˜ë¦¬
            const handleIceCandidate = async (signalData) => {
                if (peerConnection && signalData.from !== currentUser.id) {
                    await peerConnection.addIceCandidate(signalData.candidate);
                }
            };

            // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file || !selectedRoom) return;

                // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB ì œí•œ)
                if (file.size > 10 * 1024 * 1024) {
                    alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                    return;
                }

                setUploadingFile(true);
                try {
                    // í˜„ì¬ëŠ” Supabase Storage ì—†ì´ íŒŒì¼ ì´ë¦„ë§Œ ë©”ì‹œì§€ë¡œ ì „ì†¡
                    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ê³  Supabase Storage ì„¤ì • í•„ìš”
                    /*
                    const fileName = `${currentUser.id}/${Date.now()}_${file.name}`;
                    const { data, error } = await supabase.storage
                        .from('chat-files')
                        .upload(fileName, file);

                    if (error) throw error;
                    */

                    // ì„ì‹œë¡œ íŒŒì¼ ì •ë³´ë§Œ ë©”ì‹œì§€ë¡œ ì „ì†¡
                    const fileInfo = {
                        name: file.name,
                        size: Math.round(file.size / 1024), // KB ë‹¨ìœ„
                        type: file.type,
                        uploadTime: new Date().toISOString()
                    };

                    // íŒŒì¼ ê³µìœ  ë©”ì‹œì§€ ì „ì†¡
                    await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: selectedRoom.id,
                            user_id: currentUser.id,
                            user_nickname: currentUser.nickname || currentUser.email,
                            message_text: `ğŸ“ ${file.name} (${fileInfo.size}KB)`,
                            message_type: 'file',
                            file_url: null // ì‹¤ì œ Storage ì„¤ì • í›„ì—ëŠ” data.path ì‚¬ìš©
                        });

                    setShowFileUpload(false);
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    setTimeout(() => {
                        alert('íŒŒì¼ì´ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨ ëª¨ë“œ: ì‹¤ì œ íŒŒì¼ì€ ì—…ë¡œë“œë˜ì§€ ì•ŠìŒ)');
                    }, 500);

                } catch (error) {
                    console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setUploadingFile(false);
                    if (fileInputRef.current) {
                        fileInputRef.current.value = '';
                    }
                }
            };

            if (loading) {
                return (
                    <div className="flex items-center justify-center h-96">
                        <div className="text-center">
                            <div className="text-4xl mb-4">ğŸ’¬</div>
                            <p className="text-gray-500">ì±„íŒ…ë°©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            // ì „ë¬¸ê°€ ìƒë‹´ ìš”ì²­ í•¨ìˆ˜
            const requestExpertConsultation = async () => {
                try {
                    const roomName = `${currentUser.nickname || currentUser.email}ë‹˜ì˜ ìƒë‹´ì‹¤`;
                    const { data, error } = await supabase
                        .from('chat_rooms')
                        .insert({
                            name: roomName,
                            description: 'ì „ë¬¸ê°€ì™€ì˜ 1:1 ìƒë‹´ì„ ìœ„í•œ í”„ë¼ì´ë¹— ì±„íŒ…ë°©ì…ë‹ˆë‹¤.',
                            room_type: 'private',
                            created_by: currentUser.id,
                            max_participants: 2
                        })
                        .select()
                        .single();

                    if (error) throw error;
                    
                    // ìƒì„±ëœ ë°©ì— ìë™ ì°¸ì—¬
                    await joinRoom(data);
                    loadChatRooms();
                    setShowCreateRoom(false);
                } catch (error) {
                    console.error('ìƒë‹´ë°© ìƒì„± ì˜¤ë¥˜:', error);
                    alert('ìƒë‹´ë°© ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[700px] flex flex-col lg:flex-row">
                    {/* ì±„íŒ…ë°© ëª©ë¡ (ì™¼ìª½/ìƒë‹¨) */}
                    <div className="w-full lg:w-1/3 border-b lg:border-b-0 lg:border-r border-gray-200 flex flex-col h-48 lg:h-auto">
                        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-4 text-white">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-lg font-bold">ğŸ’¬ ì‹¤ì‹œê°„ ìƒë‹´</h2>
                                    <p className="text-blue-100 text-sm">ì „ë¬¸ê°€ì™€ ì†Œí†µí•˜ì„¸ìš”</p>
                                </div>
                                <button
                                    onClick={() => setShowCreateRoom(true)}
                                    className="px-3 py-1 bg-white bg-opacity-20 rounded-lg text-sm hover:bg-opacity-30 transition-colors"
                                >
                                    + ìƒë‹´ ìš”ì²­
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto">
                            {chatRooms.length === 0 ? (
                                <div className="text-center py-8 px-4">
                                    <div className="text-4xl mb-2">ğŸ”</div>
                                    <p className="text-gray-500 text-sm mb-4">ì•„ì§ ì°¸ì—¬ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                    <button
                                        onClick={() => setShowCreateRoom(true)}
                                        className="text-blue-600 text-sm underline hover:text-blue-700"
                                    >
                                        ì „ë¬¸ê°€ ìƒë‹´ ìš”ì²­í•˜ê¸°
                                    </button>
                                </div>
                            ) : (
                                chatRooms.map((room) => (
                                    <div
                                        key={room.id}
                                        onClick={() => joinRoom(room)}
                                        className={`p-3 cursor-pointer border-b border-gray-100 hover:bg-gray-50 transition-all duration-200 ${
                                            selectedRoom?.id === room.id ? 'bg-blue-50 border-l-4 border-l-blue-500 shadow-sm' : ''
                                        }`}
                                    >
                                        <div className="flex items-start justify-between mb-2">
                                            <h3 className="font-medium text-gray-800 text-sm truncate pr-2">{room.name}</h3>
                                            <span className={`px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0 ${
                                                room.room_type === 'expert' ? 'bg-orange-100 text-orange-700' :
                                                room.room_type === 'private' ? 'bg-purple-100 text-purple-700' :
                                                'bg-green-100 text-green-700'
                                            }`}>
                                                {room.room_type === 'expert' ? 'ğŸ‘¨â€ğŸ’¼' :
                                                 room.room_type === 'private' ? 'ğŸ”’' : 'ğŸ‘¥'}
                                            </span>
                                        </div>
                                        <p className="text-xs text-gray-600 line-clamp-2 mb-2">{room.description}</p>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center text-xs text-gray-500">
                                                <span className="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                                í™œì„± ìƒíƒœ
                                            </div>
                                            <div className="text-xs text-gray-400">
                                                {new Date(room.created_at).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* ì±„íŒ… ì˜ì—­ (ì˜¤ë¥¸ìª½) */}
                    <div className="flex-1 flex flex-col">
                        {selectedRoom ? (
                            <>
                                {/* ì±„íŒ…ë°© í—¤ë” - ì „ë¬¸ê°€ ìƒë‹´ìš© ê°œì„  */}
                                <div className="bg-gradient-to-r from-gray-50 to-blue-50 px-4 py-3 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center space-x-3">
                                            <div className={`w-3 h-3 rounded-full ${
                                                selectedRoom.room_type === 'expert' ? 'bg-orange-400' :
                                                selectedRoom.room_type === 'private' ? 'bg-purple-400' :
                                                'bg-green-400'
                                            } animate-pulse`}></div>
                                            <div>
                                                <h3 className="font-bold text-gray-800 flex items-center">
                                                    {selectedRoom.name}
                                                    {selectedRoom.room_type === 'private' && (
                                                        <span className="ml-2 text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">
                                                            ğŸ”’ í”„ë¼ì´ë¹— ìƒë‹´
                                                        </span>
                                                    )}
                                                </h3>
                                                <p className="text-xs text-gray-600">{selectedRoom.description}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center space-x-4">
                                            <div className="text-right">
                                                <div className="text-sm text-gray-600">
                                                    ğŸ‘¥ {participants.length}ëª…
                                                </div>
                                                {selectedRoom.room_type === 'private' && (
                                                    <div className="text-xs text-green-600 font-medium">
                                                        âœ… ìƒë‹´ ì§„í–‰ì¤‘
                                                    </div>
                                                )}
                                            </div>
                                            {/* ìƒë‹´ ë„êµ¬ ë²„íŠ¼ë“¤ */}
                                            {selectedRoom.room_type === 'private' && (
                                                <div className="flex space-x-1">
                                                    {!isCallActive ? (
                                                        <>
                                                            <button
                                                                onClick={() => startCall('audio')}
                                                                disabled={callStatus !== 'idle'}
                                                                className="p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50"
                                                                title="ìŒì„± í†µí™”"
                                                            >
                                                                ğŸ“
                                                            </button>
                                                            <button
                                                                onClick={() => startCall('video')}
                                                                disabled={callStatus !== 'idle'}
                                                                className="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50"
                                                                title="ì˜ìƒ í†µí™”"
                                                            >
                                                                ğŸ“¹
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <div className="flex space-x-1">
                                                            <button
                                                                onClick={toggleMute}
                                                                className={`p-2 rounded-lg transition-colors ${
                                                                    isMuted 
                                                                        ? 'text-red-600 bg-red-50' 
                                                                        : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                                                                }`}
                                                                title={isMuted ? 'ìŒì†Œê±° í•´ì œ' : 'ìŒì†Œê±°'}
                                                            >
                                                                {isMuted ? 'ğŸ”‡' : 'ğŸ¤'}
                                                            </button>
                                                            {callType === 'video' && (
                                                                <button
                                                                    onClick={toggleVideo}
                                                                    className={`p-2 rounded-lg transition-colors ${
                                                                        isVideoOff 
                                                                            ? 'text-red-600 bg-red-50' 
                                                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                                                                    }`}
                                                                    title={isVideoOff ? 'ë¹„ë””ì˜¤ ì¼œê¸°' : 'ë¹„ë””ì˜¤ ë„ê¸°'}
                                                                >
                                                                    {isVideoOff ? 'ğŸ“µ' : 'ğŸ“¹'}
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={endCall}
                                                                className="p-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors"
                                                                title="í†µí™” ì¢…ë£Œ"
                                                            >
                                                                ğŸ“´
                                                            </button>
                                                        </div>
                                                    )}
                                                    <button
                                                        onClick={() => setShowFileUpload(true)}
                                                        className="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                                        title="íŒŒì¼ ê³µìœ "
                                                    >
                                                        ğŸ“
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* ë¹„ë””ì˜¤ í†µí™” ì˜ì—­ */}
                                {isCallActive && callType === 'video' && (
                                    <div className="bg-black p-4 flex-shrink-0">
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 h-64">
                                            {/* ì›ê²© ë¹„ë””ì˜¤ (ìƒëŒ€ë°©) */}
                                            <div className="relative bg-gray-800 rounded-lg overflow-hidden">
                                                <video
                                                    ref={remoteVideoRef}
                                                    autoPlay
                                                    playsInline
                                                    className="w-full h-full object-cover"
                                                />
                                                <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                                    ìƒëŒ€ë°©
                                                </div>
                                            </div>
                                            
                                            {/* ë¡œì»¬ ë¹„ë””ì˜¤ (ë³¸ì¸) */}
                                            <div className="relative bg-gray-700 rounded-lg overflow-hidden">
                                                <video
                                                    ref={localVideoRef}
                                                    autoPlay
                                                    playsInline
                                                    muted
                                                    className="w-full h-full object-cover"
                                                />
                                                <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                                    ë‚˜
                                                </div>
                                                {isVideoOff && (
                                                    <div className="absolute inset-0 bg-gray-600 flex items-center justify-center">
                                                        <div className="text-white text-center">
                                                            <div className="text-4xl mb-2">ğŸ“µ</div>
                                                            <div>ë¹„ë””ì˜¤ êº¼ì§</div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {/* í†µí™” ìƒíƒœ í‘œì‹œ */}
                                        <div className="text-center text-white mt-2">
                                            {callStatus === 'calling' && 'ğŸ“ í†µí™” ì—°ê²° ì¤‘...'}
                                            {callStatus === 'ringing' && 'ğŸ“ ìƒëŒ€ë°©ì´ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...'}
                                            {callStatus === 'connected' && (
                                                <span className="text-green-400">âœ… í†µí™” ì—°ê²°ë¨</span>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* ìŒì„± í†µí™” ìƒíƒœ í‘œì‹œ */}
                                {isCallActive && callType === 'audio' && (
                                    <div className="bg-gradient-to-r from-green-500 to-blue-500 p-4 text-white text-center flex-shrink-0">
                                        <div className="flex items-center justify-center space-x-4">
                                            <div className="text-2xl animate-pulse">ğŸ“</div>
                                            <div>
                                                <div className="font-medium">ìŒì„± í†µí™” ì§„í–‰ì¤‘</div>
                                                <div className="text-sm opacity-90">
                                                    {callStatus === 'calling' && 'í†µí™” ì—°ê²° ì¤‘...'}
                                                    {callStatus === 'ringing' && 'ìƒëŒ€ë°© ì‘ë‹µ ëŒ€ê¸°ì¤‘...'}
                                                    {callStatus === 'connected' && 'âœ… ì—°ê²°ë¨'}
                                                </div>
                                            </div>
                                            <div className="text-2xl">
                                                {isMuted ? 'ğŸ”‡' : 'ğŸ¤'}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ë©”ì‹œì§€ ì˜ì—­ - ì „ë¬¸ê°€ ìƒë‹´ìš© ê°œì„  */}
                                <div className={`flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 ${
                                    isCallActive ? 'max-h-64' : ''
                                }`}>
                                    {messages.length === 0 ? (
                                        <div className="text-center text-gray-500 mt-16">
                                            <div className="text-6xl mb-4">
                                                {selectedRoom.room_type === 'private' ? 'ğŸ¥' : 'ğŸ’­'}
                                            </div>
                                            <h3 className="text-lg font-medium mb-2">
                                                {selectedRoom.room_type === 'private' ? 'ìƒë‹´ì„ ì‹œì‘í•˜ì„¸ìš”' : 'ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”'}
                                            </h3>
                                            <p className="text-sm">
                                                {selectedRoom.room_type === 'private' 
                                                    ? 'ì „ë¬¸ê°€ì™€ ì•ˆì „í•œ 1:1 ìƒë‹´ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤'
                                                    : 'ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!'
                                                }
                                            </p>
                                        </div>
                                    ) : (
                                        messages.map((message, index) => {
                                            const isMyMessage = message.user_id === currentUser.id;
                                            const isExpertMessage = message.user_nickname && message.user_nickname.includes('ì „ë¬¸ê°€');
                                            const showAvatar = index === 0 || messages[index - 1].user_id !== message.user_id;
                                            
                                            return (
                                                <div
                                                    key={message.id}
                                                    className={`flex items-end space-x-2 ${
                                                        isMyMessage ? 'justify-end flex-row-reverse space-x-reverse' : 'justify-start'
                                                    }`}
                                                >
                                                    {/* í”„ë¡œí•„ ì•„ì´ì½˜ */}
                                                    {showAvatar && !isMyMessage && (
                                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${
                                                            isExpertMessage 
                                                                ? 'bg-orange-100 text-orange-700' 
                                                                : 'bg-blue-100 text-blue-700'
                                                        }`}>
                                                            {isExpertMessage ? 'ğŸ‘¨â€ğŸ’¼' : 'ğŸ‘¤'}
                                                        </div>
                                                    )}
                                                    {showAvatar && isMyMessage && (
                                                        <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                                            ë‚˜
                                                        </div>
                                                    )}
                                                    
                                                    {/* ë©”ì‹œì§€ ë²„ë¸” */}
                                                    <div className={`max-w-xs lg:max-w-md ${!showAvatar ? 'ml-10' : ''}`}>
                                                        {/* ë°œì‹ ì ì´ë¦„ (ì „ë¬¸ê°€ ê°•ì¡°) */}
                                                        {!isMyMessage && showAvatar && (
                                                            <div className={`text-xs font-medium mb-1 ml-1 ${
                                                                isExpertMessage ? 'text-orange-700' : 'text-gray-600'
                                                            }`}>
                                                                {isExpertMessage && 'â­ '}
                                                                {message.user_nickname}
                                                                {isExpertMessage && ' (ì „ë¬¸ê°€)'}
                                                            </div>
                                                        )}
                                                        
                                                        {/* ë©”ì‹œì§€ ë‚´ìš© */}
                                                        <div className={`px-4 py-3 rounded-2xl shadow-sm ${
                                                            isMyMessage
                                                                ? 'bg-blue-500 text-white rounded-br-md'
                                                                : isExpertMessage
                                                                    ? 'bg-orange-50 text-orange-900 border border-orange-200 rounded-bl-md'
                                                                    : 'bg-white text-gray-800 border border-gray-200 rounded-bl-md'
                                                        }`}>
                                                            {message.message_type === 'file' ? (
                                                                <div className="flex items-center space-x-2">
                                                                    <div className="text-2xl">ğŸ“</div>
                                                                    <div className="flex-1">
                                                                        <div className="font-medium">{message.message_text}</div>
                                                                        <button
                                                                            onClick={() => {
                                                                                // ë°ëª¨ ëª¨ë“œ: ì‹¤ì œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ëŒ€ì‹  ì•Œë¦¼ í‘œì‹œ
                                                                                if (message.file_url) {
                                                                                    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì•„ë˜ ì½”ë“œ ì‚¬ìš©
                                                                                    // const { data } = supabase.storage
                                                                                    //     .from('chat-files')
                                                                                    //     .getPublicUrl(message.file_url);
                                                                                    // window.open(data.publicUrl, '_blank');
                                                                                    alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ì‹¤ì œ ë°°í¬ ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤)');
                                                                                } else {
                                                                                    alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ì‹¤ì œ íŒŒì¼ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                                                                                }
                                                                            }}
                                                                            className={`text-xs underline hover:no-underline ${
                                                                                isMyMessage ? 'text-blue-200' : 'text-blue-600'
                                                                            }`}
                                                                        >
                                                                            ë‹¤ìš´ë¡œë“œ (ë°ëª¨)
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="whitespace-pre-wrap break-words leading-relaxed">
                                                                    {message.message_text}
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {/* ì‹œê°„ */}
                                                        <div className={`text-xs mt-1 px-1 ${
                                                            isMyMessage ? 'text-right text-gray-400' : 'text-left text-gray-500'
                                                        }`}>
                                                            {formatMessageTime(message.created_at)}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                    <div ref={messagesEndRef} />
                                </div>

                                {/* ë©”ì‹œì§€ ì…ë ¥ - ì „ë¬¸ê°€ ìƒë‹´ìš© ê°œì„  */}
                                <div className="border-t border-gray-200 bg-white p-4">
                                    {selectedRoom.room_type === 'private' && (
                                        <div className="flex items-center justify-between bg-blue-50 rounded-lg px-3 py-2 mb-3 text-sm">
                                            <div className="flex items-center space-x-2">
                                                <span className="w-2 h-2 bg-green-400 rounded-full"></span>
                                                <span className="text-blue-700 font-medium">ì•ˆì „í•œ 1:1 ìƒë‹´ ì§„í–‰ì¤‘</span>
                                            </div>
                                            <div className="text-xs text-blue-600">
                                                ğŸ”’ ì•”í˜¸í™”ëœ ëŒ€í™”
                                            </div>
                                        </div>
                                    )}
                                    
                                    <form onSubmit={sendMessage} className="space-y-3">
                                        <div className="flex gap-2">
                                            <div className="flex-1 relative">
                                                <input
                                                    type="text"
                                                    value={newMessage}
                                                    onChange={(e) => setNewMessage(e.target.value)}
                                                    placeholder={
                                                        selectedRoom.room_type === 'private' 
                                                            ? "ê¶ê¸ˆí•œ ì ì„ ìì„¸íˆ ë§ì”€í•´ ì£¼ì„¸ìš”..."
                                                            : "ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                                    }
                                                    className="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                    disabled={sending}
                                                    maxLength="1000"
                                                />
                                                <div className="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-400">
                                                    {newMessage.length}/1000
                                                </div>
                                            </div>
                                            <button
                                                type="submit"
                                                disabled={!newMessage.trim() || sending}
                                                className={`px-6 py-3 rounded-xl font-medium transition-all duration-200 ${
                                                    !newMessage.trim() || sending
                                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                        : selectedRoom.room_type === 'private'
                                                            ? 'bg-orange-500 hover:bg-orange-600 text-white shadow-lg hover:shadow-xl'
                                                            : 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl'
                                                }`}
                                            >
                                                {sending ? (
                                                    <div className="flex items-center space-x-2">
                                                        <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                                                        <span>ì „ì†¡ì¤‘</span>
                                                    </div>
                                                ) : (
                                                    'ì „ì†¡ ğŸ“¤'
                                                )}
                                            </button>
                                        </div>
                                        
                                        {/* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ (ìƒë‹´ìš©) */}
                                        {selectedRoom.room_type === 'private' && newMessage === '' && (
                                            <div className="flex flex-wrap gap-2">
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('ì•ˆë…•í•˜ì„¸ìš”! ìƒë‹´ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ‘‹ ì¸ì‚¬
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('ì€í‡´ ê³„íšì— ëŒ€í•´ ìƒë‹´ë°›ê³  ì‹¶ìŠµë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ’° ì€í‡´ ê³„íš
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ê²€í† ë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ“ˆ íˆ¬ì ìƒë‹´
                                                </button>
                                            </div>
                                        )}
                                    </form>
                                </div>
                            </>
                        ) : (
                            <div className="flex items-center justify-center h-full text-gray-500">
                                <div className="text-center max-w-md">
                                    <div className="text-6xl mb-6">ğŸ¥</div>
                                    <h3 className="text-xl font-semibold text-gray-700 mb-4">ì „ë¬¸ê°€ ìƒë‹´ ì‹œì‘í•˜ê¸°</h3>
                                    <p className="text-gray-600 mb-6 leading-relaxed">
                                        ì€í‡´ ê³„íš, íˆ¬ì, ì¬ë¬´ ì„¤ê³„ì— ëŒ€í•´<br/>
                                        ì „ë¬¸ê°€ì™€ ì•ˆì „í•˜ê²Œ ìƒë‹´í•˜ì„¸ìš”
                                    </p>
                                    <button
                                        onClick={() => setShowCreateRoom(true)}
                                        className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl"
                                    >
                                        ğŸš€ ìƒˆ ìƒë‹´ ì‹œì‘í•˜ê¸°
                                    </button>
                                    <div className="mt-4 text-sm text-gray-500">
                                        ğŸ’¡ 1:1 í”„ë¼ì´ë¹— ìƒë‹´ | ğŸ”’ ì•ˆì „í•œ ì•”í˜¸í™” ëŒ€í™”
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* íŒŒì¼ ì—…ë¡œë“œ ëª¨ë‹¬ */}
                    {showFileUpload && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
                                <div className="text-center mb-6">
                                    <div className="text-4xl mb-3">ğŸ“</div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-2">íŒŒì¼ ê³µìœ </h3>
                                    <p className="text-gray-600 text-sm">
                                        ìƒë‹´ ìë£Œë‚˜ ë¬¸ì„œë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>
                                
                                <div className="space-y-4 mb-6">
                                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            onChange={handleFileUpload}
                                            accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.zip"
                                            className="hidden"
                                        />
                                        <button
                                            onClick={() => fileInputRef.current?.click()}
                                            disabled={uploadingFile}
                                            className="text-gray-500 hover:text-blue-600 transition-colors disabled:opacity-50"
                                        >
                                            {uploadingFile ? (
                                                <div className="flex items-center justify-center space-x-2">
                                                    <div className="animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full"></div>
                                                    <span>ì—…ë¡œë“œ ì¤‘...</span>
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="text-4xl mb-2">ğŸ“</div>
                                                    <div className="text-sm">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                                                    <div className="text-xs text-gray-400 mt-1">
                                                        PDF, DOC, ì´ë¯¸ì§€, ZIP íŒŒì¼ ì§€ì›
                                                    </div>
                                                </>
                                            )}
                                        </button>
                                    </div>
                                    
                                    <div className="bg-yellow-50 rounded-lg p-3">
                                        <h4 className="font-medium text-yellow-800 mb-2">ğŸ“‹ ìœ ì˜ì‚¬í•­</h4>
                                        <div className="text-xs text-yellow-700 space-y-1">
                                            <div>â€¢ ìµœëŒ€ íŒŒì¼ í¬ê¸°: 10MB</div>
                                            <div>â€¢ ê°œì¸ì •ë³´ í¬í•¨ íŒŒì¼ì€ ì£¼ì˜í•˜ì„¸ìš”</div>
                                            <div>â€¢ ì—…ë¡œë“œëœ íŒŒì¼ì€ ì•”í˜¸í™” ì €ì¥ë©ë‹ˆë‹¤</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => setShowFileUpload(false)}
                                        disabled={uploadingFile}
                                        className="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors disabled:opacity-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ìƒë‹´ë°© ìƒì„± ëª¨ë‹¬ */}
                    {showCreateRoom && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
                                <div className="text-center mb-6">
                                    <div className="text-4xl mb-3">ğŸ¥</div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-2">ì „ë¬¸ê°€ ìƒë‹´ ìš”ì²­</h3>
                                    <p className="text-gray-600 text-sm">
                                        ì „ë¬¸ê°€ì™€ì˜ 1:1 ìƒë‹´ë°©ì„ ìƒì„±í•©ë‹ˆë‹¤
                                    </p>
                                </div>
                                
                                <div className="space-y-4 mb-6">
                                    <div className="bg-blue-50 rounded-lg p-4">
                                        <div className="flex items-center space-x-3">
                                            <div className="text-2xl">ğŸ‘¤</div>
                                            <div>
                                                <div className="font-medium text-gray-800">
                                                    {currentUser?.nickname || currentUser?.email}
                                                </div>
                                                <div className="text-sm text-gray-600">ìƒë‹´ ì‹ ì²­ì</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-orange-50 rounded-lg p-4">
                                        <h4 className="font-medium text-gray-800 mb-2">ğŸ¯ ìƒë‹´ ê°€ëŠ¥ ë¶„ì•¼</h4>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <div className="text-gray-700">â€¢ ì€í‡´ ê³„íš ì„¤ê³„</div>
                                            <div className="text-gray-700">â€¢ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤</div>
                                            <div className="text-gray-700">â€¢ ì„¸ê¸ˆ ìµœì í™”</div>
                                            <div className="text-gray-700">â€¢ ë³´í—˜ ìƒë‹´</div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-green-50 rounded-lg p-4">
                                        <h4 className="font-medium text-gray-800 mb-2">âœ… ìƒë‹´ í˜œíƒ</h4>
                                        <div className="text-sm space-y-1">
                                            <div className="text-gray-700">â€¢ ì „ë¬¸ê°€ 1:1 ë§ì¶¤ ìƒë‹´</div>
                                            <div className="text-gray-700">â€¢ ì•ˆì „í•œ í”„ë¼ì´ë¹— ëŒ€í™”</div>
                                            <div className="text-gray-700">â€¢ ìë£Œ ê³µìœ  ê°€ëŠ¥</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => setShowCreateRoom(false)}
                                        className="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={requestExpertConsultation}
                                        className="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors shadow-lg"
                                    >
                                        ìƒë‹´ ì‹œì‘í•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ì»´í¬ë„ŒíŠ¸
        const AnnouncementComponent = ({ currentUser, isAdminUser }) => {
            const [announcements, setAnnouncements] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showWriteModal, setShowWriteModal] = useState(false);
            const [selectedAnnouncement, setSelectedAnnouncement] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);

            // ê³µì§€ì‚¬í•­ ëª©ë¡ ë¡œë“œ
            const loadAnnouncements = async () => {
                try {
                    setLoading(true);
                    const { data, error } = await supabase
                        .from('announcements')
                        .select('*')
                        .eq('is_active', true)
                        .order('is_important', { ascending: false })
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setAnnouncements(data || []);
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì¡°íšŒìˆ˜ ì¦ê°€
            const incrementViewCount = async (announcementId) => {
                if (!currentUser || currentUser.isGuest) return;
                
                try {
                    await supabase
                        .from('announcement_views')
                        .upsert({ 
                            announcement_id: announcementId, 
                            user_id: currentUser.id 
                        }, { 
                            onConflict: 'announcement_id,user_id' 
                        });
                } catch (error) {
                    console.error('ì¡°íšŒìˆ˜ ì¦ê°€ ì˜¤ë¥˜:', error);
                }
            };

            useEffect(() => {
                loadAnnouncements();
            }, []);

            // ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸°
            const handleAnnouncementClick = (announcement) => {
                setSelectedAnnouncement(announcement);
                setShowDetailModal(true);
                incrementViewCount(announcement.id);
            };

            // ê³µì§€ì‚¬í•­ ì‚­ì œ (ê´€ë¦¬ìë§Œ)
            const handleDeleteAnnouncement = async (id) => {
                if (!isAdminUser(currentUser)) return;
                
                if (confirm('ì •ë§ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        const { error } = await supabase
                            .from('announcements')
                            .update({ is_active: false })
                            .eq('id', id);

                        if (error) throw error;
                        
                        alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        loadAnnouncements();
                    } catch (error) {
                        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            };

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        {/* í—¤ë” */}
                        <div className="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-8 text-white">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold mb-2">ğŸ“¢ ê³µì§€ì‚¬í•­</h1>
                                    <p className="text-blue-100">
                                        í”Œëœë¹„ì˜ ìƒˆë¡œìš´ ì†Œì‹ê³¼ ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”
                                    </p>
                                </div>
                                {isAdminUser(currentUser) && (
                                    <button
                                        onClick={() => setShowWriteModal(true)}
                                        className="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors"
                                    >
                                        âœï¸ ê³µì§€ ì‘ì„±
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* ê³µì§€ì‚¬í•­ ëª©ë¡ */}
                        <div className="p-6">
                            {loading ? (
                                <div className="text-center py-12">
                                    <div className="text-4xl mb-4">ğŸ“¡</div>
                                    <p className="text-gray-500">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                </div>
                            ) : announcements.length === 0 ? (
                                <div className="text-center py-12">
                                    <div className="text-4xl mb-4">ğŸ“­</div>
                                    <p className="text-gray-500">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {announcements.map((announcement) => (
                                        <div
                                            key={announcement.id}
                                            className={`border rounded-lg p-5 cursor-pointer transition-all hover:shadow-md ${
                                                announcement.is_important
                                                    ? 'border-red-300 bg-red-50 hover:bg-red-100'
                                                    : 'border-gray-200 bg-white hover:bg-gray-50'
                                            }`}
                                            onClick={() => handleAnnouncementClick(announcement)}
                                        >
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        {announcement.is_important && (
                                                            <span className="bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">
                                                                ì¤‘ìš”
                                                            </span>
                                                        )}
                                                        <h3 className="text-lg font-semibold text-gray-800 line-clamp-1">
                                                            {announcement.title}
                                                        </h3>
                                                    </div>
                                                    <p className="text-gray-600 text-sm line-clamp-2 mb-3">
                                                        {announcement.content}
                                                    </p>
                                                    <div className="text-xs text-gray-400">
                                                        {new Date(announcement.created_at).toLocaleDateString('ko-KR', {
                                                            year: 'numeric',
                                                            month: 'long',
                                                            day: 'numeric',
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        })}
                                                    </div>
                                                </div>
                                                {isAdminUser(currentUser) && (
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleDeleteAnnouncement(announcement.id);
                                                        }}
                                                        className="text-red-400 hover:text-red-600 p-1"
                                                        title="ì‚­ì œ"
                                                    >
                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                        </svg>
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */}
                    {showDetailModal && selectedAnnouncement && (
                        <AnnouncementDetailModal
                            announcement={selectedAnnouncement}
                            onClose={() => {
                                setShowDetailModal(false);
                                setSelectedAnnouncement(null);
                            }}
                        />
                    )}

                    {/* ê³µì§€ì‚¬í•­ ì‘ì„± ëª¨ë‹¬ */}
                    {showWriteModal && (
                        <AnnouncementWriteModal
                            currentUser={currentUser}
                            onClose={() => setShowWriteModal(false)}
                            onSuccess={() => {
                                setShowWriteModal(false);
                                loadAnnouncements();
                            }}
                        />
                    )}
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬
        const AnnouncementDetailModal = ({ announcement, onClose }) => {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-xl">
                        <div className="flex justify-between items-start mb-6">
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                    {announcement.is_important && (
                                        <span className="bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">
                                            ì¤‘ìš”
                                        </span>
                                    )}
                                    <h2 className="text-xl font-bold text-gray-800">
                                        {announcement.title}
                                    </h2>
                                </div>
                                <p className="text-sm text-gray-500">
                                    {new Date(announcement.created_at).toLocaleDateString('ko-KR', {
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}
                                </p>
                            </div>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                            >
                                Ã—
                            </button>
                        </div>

                        <div className="prose prose-sm max-w-none">
                            <div className="whitespace-pre-wrap text-gray-700 leading-relaxed">
                                {announcement.content}
                            </div>
                        </div>

                        <div className="mt-6 pt-4 border-t border-gray-200">
                            <button
                                onClick={onClose}
                                className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                í™•ì¸
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ì‘ì„± ëª¨ë‹¬
        const AnnouncementWriteModal = ({ currentUser, onClose, onSuccess }) => {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                is_important: false
            });
            const [submitting, setSubmitting] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.title.trim() || !formData.content.trim()) {
                    alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    setSubmitting(true);
                    const { error } = await supabase
                        .from('announcements')
                        .insert({
                            title: formData.title.trim(),
                            content: formData.content.trim(),
                            is_important: formData.is_important,
                            created_by: currentUser.id
                        });

                    if (error) throw error;

                    alert('ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    onSuccess();
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ë“±ë¡ ì˜¤ë¥˜:', error);
                    alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSubmitting(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-gray-800">ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                            >
                                Ã—
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì œëª© *
                                </label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë‚´ìš© *
                                </label>
                                <textarea
                                    value={formData.content}
                                    onChange={(e) => setFormData(prev => ({ ...prev, content: e.target.value }))}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="10"
                                    placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    required
                                />
                            </div>

                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="is_important"
                                    checked={formData.is_important}
                                    onChange={(e) => setFormData(prev => ({ ...prev, is_important: e.target.checked }))}
                                    className="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"
                                />
                                <label htmlFor="is_important" className="ml-2 text-sm text-gray-700">
                                    ì¤‘ìš” ê³µì§€ì‚¬í•­ìœ¼ë¡œ ì„¤ì • (ìƒë‹¨ì— ê³ ì •ë©ë‹ˆë‹¤)
                                </label>
                            </div>

                            <div className="flex gap-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    type="submit"
                                    disabled={submitting}
                                    className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400"
                                >
                                    {submitting ? 'ë“±ë¡ ì¤‘...' : 'ë“±ë¡í•˜ê¸°'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // ì „ë¬¸ê°€ ì°¾ê¸° ì»´í¬ë„ŒíŠ¸
        const ExpertFinderComponent = ({ currentUser, isAdminUser }) => {
            const [activeCategory, setActiveCategory] = useState('travel');
            const [showBookingModal, setShowBookingModal] = useState(false);
            const [selectedExpert, setSelectedExpert] = useState(null);
            const [showWriteModal, setShowWriteModal] = useState(false);
            const [isExpert, setIsExpert] = useState(false);

            // ì „ë¬¸ê°€ ì—¬ë¶€ í™•ì¸ (ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ )
            useEffect(() => {
                const checkExpertStatus = async () => {
                    if (!currentUser) {
                        setIsExpert(false);
                        return;
                    }

                    // ê´€ë¦¬ìëŠ” ëª¨ë“  ì „ë¬¸ê°€ ê¶Œí•œ ë³´ìœ 
                    if (isAdminUser && isAdminUser(currentUser)) {
                        setIsExpert(true);
                        return;
                    }

                    try {
                        const { data: expertProfile } = await supabase
                            .from('financial_experts')
                            .select('is_verified, is_active')
                            .eq('user_id', currentUser.id)
                            .single();

                        setIsExpert(expertProfile?.is_verified === true && expertProfile?.is_active === true);
                    } catch (error) {
                        setIsExpert(false);
                    }
                };

                checkExpertStatus();
            }, [currentUser]);

            // ê¸€ì“°ê¸° ì™„ë£Œ í›„ ìƒˆë¡œê³ ì¹¨
            const handleWriteSuccess = () => {
                // í•„ìš”ì‹œ ì „ë¬¸ê°€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ë¡œì§ ì¶”ê°€
                console.log('ì „ë¬¸ê°€ ê¸€ ì‘ì„± ì™„ë£Œ');
            };
            
            // 3ëŒ€ ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬ ì •ì˜
            const expertCategories = {
                'travel': {
                    name: 'ì—¬í–‰/ì·¨ë¯¸',
                    icon: 'âœˆï¸',
                    color: 'from-orange-500 to-red-500',
                    bgColor: 'from-orange-50 to-red-50',
                    description: 'ì€í‡´ í›„ ì—¬í–‰ê³¼ ì·¨ë¯¸ìƒí™œ ì „ë¬¸ê°€'
                },
                'legal': {
                    name: 'ì„¸ë¬´/ë²•ë¬´/ìì‚°ê´€ë¦¬',
                    icon: 'ğŸ“‹',
                    color: 'from-blue-500 to-indigo-500',
                    bgColor: 'from-blue-50 to-indigo-50',
                    description: 'ìƒì†, ì„¸ê¸ˆ, ìì‚°ê´€ë¦¬ ì „ë¬¸ê°€ (ìƒë‹´ë§Œ, íŒë§¤ ê¸ˆì§€)'
                },
                'living': {
                    name: 'ì£¼ê±°/ìƒí™œ',
                    icon: 'ğŸ ',
                    color: 'from-green-500 to-emerald-500',
                    bgColor: 'from-green-50 to-emerald-50',
                    description: 'ì€í‡´ í›„ ì£¼ê±°ì™€ ìƒí™œí™˜ê²½ ì„¤ê³„ ì „ë¬¸ê°€'
                }
            };

            // ë”ë¯¸ ì „ë¬¸ê°€ ë°ì´í„°
            const expertData = {
                'travel': [
                    {
                        id: 1,
                        name: 'ê¹€ì—¬í–‰í”Œë˜ë„ˆ',
                        title: 'ì‹œë‹ˆì–´ ì—¬í–‰ ì „ë¬¸ í”Œë˜ë„ˆ',
                        experience: '12ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 156,
                        specialties: ['ì•ˆì „ì—¬í–‰', 'ì˜ë£Œë™í–‰ì—¬í–‰', 'ì¥ê¸°ì²´ë¥˜', 'í•´ì™¸ê±°ì£¼'],
                        price: '60,000ì›/60ë¶„',
                        responseRate: 95,
                        profileImage: 'âœˆï¸'
                    },
                    {
                        id: 2,
                        name: 'ë°•ì·¨ë¯¸ì½”ì¹˜',
                        title: 'ì‹œë‹ˆì–´ ë¼ì´í”„ ì·¨ë¯¸ ì½”ì¹˜',
                        experience: '15ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 203,
                        specialties: ['ì›ì˜ˆ', 'ì‚¬ì§„', 'ìš”ë¦¬', 'ë…ì„œëª¨ì„'],
                        price: '45,000ì›/60ë¶„',
                        responseRate: 92,
                        profileImage: 'ğŸ¨'
                    },
                    {
                        id: 3,
                        name: 'ì´í‰ìƒêµìœ¡ì‚¬',
                        title: 'ì‹œë‹ˆì–´ êµìœ¡ ì „ë¬¸ê°€',
                        experience: '10ë…„ ê²½ë ¥',
                        rating: 4.7,
                        reviews: 134,
                        specialties: ['ë””ì§€í„¸êµìœ¡', 'ì˜¨ë¼ì¸í•™ìŠµ', 'ìê²©ì¦ì·¨ë“'],
                        price: '40,000ì›/45ë¶„',
                        responseRate: 88,
                        profileImage: 'ğŸ“š'
                    }
                ],
                'legal': [
                    {
                        id: 4,
                        name: 'ìµœì„¸ë¬´ì‚¬',
                        title: 'ìƒì†ì„¸ ì ˆì„¸ ì „ë¬¸ ì„¸ë¬´ì‚¬',
                        experience: '20ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 156,
                        specialties: ['ìƒì†ì„¸ ì ˆì„¸', 'ì¦ì—¬ì„¸ ìµœì í™”', 'ì—°ê¸ˆì†Œë“ì„¸'],
                        price: '100,000ì›/60ë¶„',
                        responseRate: 97,
                        profileImage: 'ğŸ“Š'
                    },
                    {
                        id: 5,
                        name: 'ì •ë³€í˜¸ì‚¬',
                        title: 'ìƒì†ì „ë¬¸ ë³€í˜¸ì‚¬',
                        experience: '18ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 134,
                        specialties: ['ìƒì†ë²•ë¥ ', 'ìœ ì–¸ì‘ì„±', 'ê°€ì¡±ì‹ íƒ'],
                        price: '150,000ì›/60ë¶„',
                        responseRate: 94,
                        profileImage: 'âš–ï¸'
                    },
                    {
                        id: 6,
                        name: 'í•œìì‚°ê´€ë¦¬ì‚¬',
                        title: 'CFP ìì‚°ê´€ë¦¬ ìƒë‹´ì‚¬',
                        experience: '25ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 298,
                        specialties: ['ìì‚°ë°°ë¶„ìƒë‹´', 'ì—°ê¸ˆì „ëµì„¤ê³„', 'ë¦¬ìŠ¤í¬ê´€ë¦¬'],
                        price: '120,000ì›/90ë¶„',
                        responseRate: 96,
                        profileImage: 'ğŸ’¼'
                    }
                ],
                'living': [
                    {
                        id: 7,
                        name: 'ìœ¤ë¶€ë™ì‚°ì»¨ì„¤í„´íŠ¸',
                        title: 'ì‹œë‹ˆì–´ ì£¼ê±° ì „ë¬¸ ì»¨ì„¤í„´íŠ¸',
                        experience: '15ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 142,
                        specialties: ['ë‹¤ìš´ì‚¬ì´ì§•', 'ì‹œì„¤ì„ íƒ', 'ì£¼ê±°ë¹„ì ˆì•½', 'ì§€ì—­ë¹„êµ'],
                        price: '80,000ì›/60ë¶„',
                        responseRate: 91,
                        profileImage: 'ğŸ¡'
                    },
                    {
                        id: 8,
                        name: 'ì¡°ê·€ë†ë©˜í† ',
                        title: 'ê·€ë†ê·€ì´Œ ì „ë¬¸ ë©˜í† ',
                        experience: '12ë…„ ê²½ë ¥',
                        rating: 4.7,
                        reviews: 98,
                        specialties: ['ì§€ì—­ì„ íƒ', 'ì •ì°©ì§€ì›', 'ë†ì—…ì‹œì‘', 'ì‹œê³¨ìƒí™œ'],
                        price: '70,000ì›/90ë¶„',
                        responseRate: 89,
                        profileImage: 'ğŸŒ¾'
                    },
                    {
                        id: 9,
                        name: 'ë¬¸ìƒí™œì„¤ê³„ì‚¬',
                        title: 'ì‹œë‹ˆì–´ ë¼ì´í”„ í”Œë˜ë„ˆ',
                        experience: '18ë…„ ê²½ë ¥',
                        rating: 4.6,
                        reviews: 165,
                        specialties: ['ìƒí™œë¹„ê´€ë¦¬', 'ê±´ê°•ê´€ë¦¬', 'ì¸ê°„ê´€ê³„', 'ì¼ìƒì„¤ê³„'],
                        price: '60,000ì›/60ë¶„',
                        responseRate: 93,
                        profileImage: 'ğŸ '
                    }
                ]
            };

            const currentExperts = expertData[activeCategory] || [];
            const currentCategory = expertCategories[activeCategory];

            return (
                <div className={`bg-gradient-to-r ${currentCategory.bgColor} p-6 rounded-lg`}>
                    {/* í—¤ë” */}
                    <div className="mb-6">
                        <div className="text-center mb-4">
                            <h3 className="text-lg md:text-xl font-bold text-gray-800 no-break-korean">
                                ğŸ¯ ê´€ì‹¬ìˆëŠ” ë¶„ì•¼ì˜ ì „ë¬¸ê°€ì—ê²Œ ì •ë³´ë¥¼ ì–»ìœ¼ì„¸ìš”!
                            </h3>
                        </div>
                        
                        {/* ì „ë¬¸ê°€ ì „ìš© ì„œë¹„ìŠ¤ ê²Œì‹œ ì„¹ì…˜ */}
                        {isExpert && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div className="flex flex-col md:flex-row items-center justify-between gap-3">
                                    <div className="text-center md:text-left">
                                        <p className="text-sm font-medium text-blue-800 no-break-korean">
                                            ğŸ’¡ ì „ë¬¸ê°€ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆì–´ìš”!
                                        </p>
                                        <p className="text-xs text-blue-600 mt-1">
                                            ê³ ê°ë“¤ì´ ì˜ˆì•½í•˜ê³  ìƒë‹´ë°›ì„ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setShowWriteModal(true)}
                                        className="px-4 py-2.5 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors shadow-md no-break-korean whitespace-nowrap"
                                        title="ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°"
                                    >
                                        ğŸ“ ë‚´ ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* ì¹´í…Œê³ ë¦¬ íƒ­ */}
                    <div className="grid grid-cols-3 gap-2 mb-6">
                        {Object.entries(expertCategories).map(([key, category]) => (
                            <button
                                key={key}
                                onClick={() => setActiveCategory(key)}
                                className={`p-3 rounded-lg text-center transition-all duration-300 ${
                                    activeCategory === key
                                        ? `bg-gradient-to-r ${category.color} text-white shadow-lg`
                                        : 'bg-white text-gray-600 hover:bg-gray-50'
                                }`}
                            >
                                <div className="text-base md:text-lg mb-1">{category.icon}</div>
                                <div className="font-semibold text-xs leading-tight no-break-korean responsive-text-sm">{category.name}</div>
                            </button>
                        ))}
                    </div>

                    {/* ì „ë¬¸ê°€ ëª©ë¡ */}
                    <div className="space-y-4 mb-6">
                        {currentExperts.map(expert => (
                            <div key={expert.id} className="bg-white rounded-lg p-4 shadow-md">
                                <div className="flex items-start gap-4">
                                    {/* í”„ë¡œí•„ */}
                                    <div className="text-3xl">{expert.profileImage}</div>
                                    
                                    {/* ì •ë³´ */}
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-1">
                                            <h4 className="font-bold text-gray-800 break-keep">{expert.name}</h4>
                                            <div className="flex items-center gap-1">
                                                <span className="text-yellow-500">â­</span>
                                                <span className="text-sm font-medium">{expert.rating}</span>
                                                <span className="text-xs text-gray-500">({expert.reviews})</span>
                                            </div>
                                        </div>
                                        
                                        <p className="text-sm text-gray-600 mb-2 break-keep">{expert.title}</p>
                                        <p className="text-xs text-gray-500 mb-2 break-keep">{expert.experience}</p>
                                        
                                        {/* ì „ë¬¸ë¶„ì•¼ íƒœê·¸ */}
                                        <div className="flex flex-wrap gap-1 mb-3">
                                            {expert.specialties.map((specialty, index) => (
                                                <span key={index} className="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded no-break-korean">
                                                    {specialty}
                                                </span>
                                            ))}
                                        </div>
                                        
                                        {/* í•˜ë‹¨ ì •ë³´ */}
                                        <div className="flex items-center justify-between">
                                            <div className="text-sm">
                                                <span className="font-semibold text-blue-600">{expert.price}</span>
                                                <span className="text-xs text-gray-500 ml-2">ì‘ë‹µë¥  {expert.responseRate}%</span>
                                            </div>
                                            <button 
                                                onClick={() => {
                                                    if (currentUser?.isGuest) {
                                                        setShowSignupModal(true);
                                                        return;
                                                    }
                                                    setSelectedExpert(expert);
                                                    setShowBookingModal(true);
                                                }}
                                                className="px-3 md:px-4 py-2 bg-blue-500 text-white rounded-lg text-xs md:text-sm font-medium hover:bg-blue-600 transition-colors no-break-korean"
                                            >
                                                ìƒë‹´ ì˜ˆì•½
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
                    <div className="bg-white p-4 rounded-lg">
                        <h4 className="font-bold text-gray-800 mb-2">ğŸ›¡ï¸ ì•ˆì „í•œ ì „ë¬¸ê°€ í”Œë«í¼</h4>
                        <div className="text-sm text-gray-600 space-y-1">
                            <p>âœ… ëª¨ë“  ì „ë¬¸ê°€ ìê²©ì¦ ê²€ì¦ ì™„ë£Œ</p>
                            <p>âœ… ê¸ˆìœµìƒí’ˆ íŒë§¤ ì™„ì „ ê¸ˆì§€ (ìˆœìˆ˜ ìƒë‹´ë§Œ)</p>
                            <p>âœ… íˆ¬ëª…í•œ í›„ê¸° ì‹œìŠ¤í…œ</p>
                            <p>âœ… ë¹„ëŒ€ë©´ ìƒë‹´ìœ¼ë¡œ ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ê²Œ</p>
                            <p>ğŸš§ í˜„ì¬ ì‹œë²” ìš´ì˜ ì¤‘ - 2025ë…„ 3ì›” ì •ì‹ ì˜¤í”ˆ ì˜ˆì •</p>
                        </div>
                    </div>
                    
                    {/* ì˜ˆì•½ ëª¨ë‹¬ */}
                    {showBookingModal && selectedExpert && (
                        <ConsultationBookingComponent
                            expert={selectedExpert}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowBookingModal(false);
                                setSelectedExpert(null);
                            }}
                        />
                    )}

                    {/* ì „ë¬¸ê°€ ê¸€ì“°ê¸° ëª¨ë‹¬ */}
                    {showWriteModal && (
                        <ExpertPostWriteModal
                            isOpen={showWriteModal}
                            onClose={() => setShowWriteModal(false)}
                            currentUser={currentUser}
                            onSuccess={handleWriteSuccess}
                            isAdminUser={isAdminUser}
                        />
                    )}
                </div>
            );
        };

        // ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        const PostDetailPage = ({ post, setCurrentView, currentUser, checkCalculationForInteraction, isAdminUser }) => {
            const [replies, setReplies] = useState([]);
            const [newReply, setNewReply] = useState('');
            const [likes, setLikes] = useState(post.likes || 0);
            const [isLiked, setIsLiked] = useState(false);

            // ëŒ“ê¸€ ë¡œë“œ
            useEffect(() => {
                const loadReplies = async () => {
                    try {
                        if (supabase) {
                            const { data, error } = await supabase
                                .from('community_replies')
                                .select('*')
                                .eq('post_id', post.id)
                                .order('created_at', { ascending: true });
                            
                            if (error) throw error;
                            setReplies(data || []);
                        }
                    } catch (error) {
                        console.error('ëŒ“ê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
                        setReplies([]);
                    }
                };

                loadReplies();
            }, [post.id]);

            return (
                <div className="max-w-4xl mx-auto">
                    {/* ë’¤ë¡œê°€ê¸° í—¤ë” */}
                    <div className="flex items-center mb-6">
                        <button 
                            onClick={() => setCurrentView('community')}
                            className="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                            </svg>
                            ì»¤ë®¤ë‹ˆí‹°ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>

                    {/* ê²Œì‹œê¸€ ìƒì„¸ */}
                    <div className="bg-white rounded-lg shadow-md overflow-hidden">
                        <div className="p-6">
                            {/* ì œëª© */}
                            <h1 className="text-2xl font-bold text-gray-800 mb-4">{post.title}</h1>
                            
                            {/* ì‘ì„±ì ì •ë³´ */}
                            <div className="flex items-center text-sm text-gray-500 mb-6">
                                <span className="bg-gray-100 px-2 py-1 rounded mr-2">ìµëª…</span>
                                <span>{new Date(post.created_at).toLocaleDateString()}</span>
                                <span className="mx-2">â€¢</span>
                                <span>ì¡°íšŒ {post.views || 0}</span>
                            </div>
                            
                            {/* ë³¸ë¬¸ */}
                            <div className="prose max-w-none mb-8">
                                <p className="text-gray-800 whitespace-pre-wrap leading-relaxed">{post.content}</p>
                            </div>
                            
                            {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                            <div className="flex items-center space-x-6 py-4 border-t border-gray-200">
                                <button 
                                    onClick={async () => {
                                        if (!checkCalculationForInteraction('like_post')) return;
                                        
                                        try {
                                            const newLikesCount = isLiked ? likes - 1 : likes + 1;
                                            
                                            if (supabase) {
                                                const { error } = await supabase
                                                    .from('community_posts')
                                                    .update({ likes: newLikesCount })
                                                    .eq('id', post.id);
                                                
                                                if (error) throw error;
                                            }
                                            
                                            setLikes(newLikesCount);
                                            setIsLiked(!isLiked);
                                        } catch (error) {
                                            console.error('ì¢‹ì•„ìš” ì˜¤ë¥˜:', error);
                                        }
                                    }}
                                    className={`flex items-center transition-colors ${
                                        isLiked 
                                            ? 'text-blue-600 hover:text-blue-800' 
                                            : 'text-gray-600 hover:text-blue-600'
                                    }`}
                                >
                                    <span className="mr-1">{isLiked ? 'ğŸ‘' : 'ğŸ‘'}</span>
                                    <span>ê³µê° {likes}</span>
                                </button>
                                <button className="flex items-center text-gray-600 hover:text-gray-800 transition-colors">
                                    <span className="mr-1">ğŸ’¬</span>
                                    <span>ëŒ“ê¸€ {replies.length}</span>
                                </button>
                                <button 
                                    onClick={() => {
                                        if (navigator.share) {
                                            navigator.share({
                                                title: post.title,
                                                text: post.content.substring(0, 100) + '...',
                                                url: window.location.href
                                            });
                                        } else {
                                            // í´ë¦½ë³´ë“œì— ë³µì‚¬
                                            navigator.clipboard.writeText(window.location.href)
                                                .then(() => alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                                                .catch(() => {
                                                    // í´ë°±: í…ìŠ¤íŠ¸ ì„ íƒ
                                                    const textArea = document.createElement('textarea');
                                                    textArea.value = window.location.href;
                                                    document.body.appendChild(textArea);
                                                    textArea.select();
                                                    document.execCommand('copy');
                                                    document.body.removeChild(textArea);
                                                    alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                                                });
                                        }
                                    }}
                                    className="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
                                >
                                    <span className="mr-1">ğŸ“¤</span>
                                    <span>ê³µìœ </span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* ëŒ“ê¸€ ì„¹ì…˜ */}
                    <div className="bg-white rounded-lg shadow-md mt-6 p-6">
                        <h3 className="text-lg font-semibold mb-4">ëŒ“ê¸€ {replies.length}ê°œ</h3>
                        
                        {/* ëŒ“ê¸€ ì‘ì„± */}
                        <div className="mb-6">
                            <textarea
                                value={newReply}
                                onChange={(e) => setNewReply(e.target.value)}
                                placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                                className="w-full p-3 border border-gray-200 rounded-lg resize-none"
                                rows="3"
                            />
                            <div className="flex justify-end mt-2">
                                <button
                                    onClick={async () => {
                                        if (!checkCalculationForInteraction('write_reply')) return;
                                        
                                        if (newReply.trim()) {
                                            try {
                                                const replyData = {
                                                    post_id: post.id,
                                                    content: newReply.trim(),
                                                    author_nickname: currentUser?.nickname || currentUser?.email || 'ìµëª…',
                                                    user_hash: currentUser?.user_hash || null,
                                                    is_anonymous: true,
                                                    created_at: new Date().toISOString()
                                                };

                                                if (supabase) {
                                                    const { data, error } = await supabase
                                                        .from('community_replies')
                                                        .insert([replyData])
                                                        .select();
                                                    
                                                    if (error) throw error;
                                                    setReplies([...replies, data[0]]);
                                                } else {
                                                    // ë¡œì»¬ ìƒíƒœì—ë§Œ ì¶”ê°€
                                                    setReplies([...replies, { ...replyData, id: Date.now() }]);
                                                }
                                                
                                                setNewReply('');
                                            } catch (error) {
                                                console.error('ëŒ“ê¸€ ì €ì¥ ì˜¤ë¥˜:', error);
                                                alert('ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                            }
                                        }
                                    }}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm"
                                >
                                    ëŒ“ê¸€ ì‘ì„±
                                </button>
                            </div>
                        </div>

                        {/* ëŒ“ê¸€ ëª©ë¡ */}
                        <div className="space-y-4">
                            {replies.length === 0 ? (
                                <div className="text-center py-8 text-gray-500">
                                    <div className="text-4xl mb-2">ğŸ’¬</div>
                                    <p>ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                                </div>
                            ) : (
                                replies.map((reply, index) => (
                                    <div key={reply.id || index} className="border-b border-gray-100 pb-4">
                                        <div className="flex items-center justify-between text-sm text-gray-500 mb-2">
                                            <div className="flex items-center">
                                                <span className="bg-blue-100 text-blue-600 px-2 py-1 rounded mr-2">
                                                    {reply.author_nickname || 'ìµëª…'}
                                                </span>
                                                <span>{new Date(reply.created_at).toLocaleDateString('ko-KR')} {new Date(reply.created_at).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</span>
                                            </div>
                                        </div>
                                        <p className="text-gray-800 leading-relaxed">{reply.content}</p>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // ì¬ì‚°ì„¸ ê³„ì‚° í•¨ìˆ˜ (2025ë…„ í•œêµ­ ê¸°ì¤€)
        const calculatePropertyTax = (homeValue) => {
            if (!homeValue || homeValue === 0) return 0;
            
            // ì£¼íƒ ê³µì‹œê°€ê²© (ë§Œì› â†’ ì›)
            const publicValue = homeValue * 10000;
            
            // ê³¼ì„¸í‘œì¤€ = ê³µì‹œê°€ê²© Ã— ê³µì •ì‹œì¥ê°€ì•¡ë¹„ìœ¨(60%)
            const taxBase = publicValue * 0.6;
            
            // ì¬ì‚°ì„¸ = ê³¼ì„¸í‘œì¤€ Ã— ì„¸ìœ¨(0.4%) - ëˆ„ì§„ê³µì œ(63ë§Œì›)
            const annualPropertyTax = Math.max(0, (taxBase * 0.004) - 630000);
            
            // ì›” ì¬ì‚°ì„¸
            return Math.round(annualPropertyTax / 12);
        };

        // ì›ë³¸ ê³„ì‚°ê¸° ì™„ì „ í†µí•© (planb-calculator.htmlì—ì„œ ì¶”ì¶œ)
        const OriginalCalculator = ({ savedCalculations = [], onCalculationComplete, setCurrentView, currentUser, showNotification }) => {
            const [calculatorStep, setCalculatorStep] = useState(1);
            const [formData, setFormData] = useState({
                age: '', health: 'ë³´í†µ', mode: 'ê· í˜•',
                housingType: '', // ì£¼ê±°í˜•íƒœ: 'owned_living', 'owned_renting', 'jeonse', 'monthly', 'none'
                financialAssets: '', severancePay: '', 
                // ì£¼ê±° ê´€ë ¨ (ì£¼ê±°í˜•íƒœë³„ë¡œ ë‹¤ë¦„)
                homeValue: '', homeMortgage: '', homeMortgageInterest: '',
                ownedHouseDeposit: '', currentDeposit: '', currentRentType: '', currentRent: '',
                jeonseDeposit: '', monthlyDeposit: '', monthlyRent: '',
                investmentRealEstate: '', investmentLoan: '', investmentLoanInterest: '',
                debt: '', debtInterest: '', depositLoan: '', depositLoanInterest: '', inheritance: '',
                nationalPension: '', privatePension: '', housingPension: '', 
                // ì€í‡´ ì›” ìˆ˜ì…
                rentalIncome: '', workIncome: '', financialIncome: '', otherIncome: ''
            });
            const [calculatorResult, setCalculatorResult] = useState(null);
            const [averageData, setAverageData] = useState(null);
            const [showAssetDetail, setShowAssetDetail] = useState(false);
            const [showInheritanceGuide, setShowInheritanceGuide] = useState(false);
            const [lifeExpectancy, setLifeExpectancy] = useState(100);
            const [enableDownsizing, setEnableDownsizing] = useState(false);
            const [isResultSaved, setIsResultSaved] = useState(false);
            const [expenseData, setExpenseData] = useState({
                food: '', communication: '', utilities: '', medical: '', hobby: '', vehicle: '', etc: ''
            });
            const [showExpenseModal, setShowExpenseModal] = useState(false);

            const handleInputChange = (field, value) => {
                const cleanValue = value === '' ? '' : value;
                setFormData({ ...formData, [field]: cleanValue });
            };

            // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ë©´ì„œ í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            const goToNextStep = (step) => {
                setCalculatorStep(step);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // ë‚˜ì´ ì…ë ¥ ì‹œ í‰ê·  ë°ì´í„° ì—…ë°ì´íŠ¸
            useEffect(() => {
                if (formData.age) {
                    setAverageData(getAverageDataByAge(parseInt(formData.age)));
                }
            }, [formData.age]);

            // ê¸°ëŒ€ìˆ˜ëª… ë³€ê²½ ì‹œ ê³„ì‚° ê²°ê³¼ ì—…ë°ì´íŠ¸ (ì…ë ¥ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)
            useEffect(() => {
                if (calculatorResult && calculatorStep === 4) {
                    calculateResults();
                    setIsResultSaved(false);
                }
            }, [lifeExpectancy, enableDownsizing]);

            const getAverageDataByAge = (age) => {
                if (age >= 60) return { financialAssets: 8000, severancePay: 3000, homeValue: 25000, nationalPension: 120, privatePension: 50, debt: 500 };
                if (age >= 55) return { financialAssets: 6500, severancePay: 4000, homeValue: 28000, nationalPension: 100, privatePension: 40, debt: 800 };
                if (age >= 50) return { financialAssets: 5000, severancePay: 5000, homeValue: 30000, nationalPension: 80, privatePension: 30, debt: 1200 };
                if (age >= 45) return { financialAssets: 3500, severancePay: 3500, homeValue: 32000, nationalPension: 60, privatePension: 20, debt: 1500 };
                return { financialAssets: 2000, severancePay: 2000, homeValue: 25000, nationalPension: 40, privatePension: 10, debt: 1000 };
            };

            const formatResultAmount = (amount) => {
                if (amount >= 100000000) {
                    const ì–µ = Math.floor(amount / 100000000);
                    const ë§Œ = Math.round((amount % 100000000) / 10000);
                    if (ë§Œ === 0) return `${ì–µ}ì–µì›`;
                    return `${ì–µ}ì–µ ${ë§Œ}ë§Œì›`;
                }
                if (amount >= 10000) {
                    return `${Math.round(amount / 10000)}ë§Œì›`;
                }
                return `${Math.round(amount).toLocaleString()}ì›`;
            };
            
            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ì‹œ ì €ì¥ëœ ë°ì´í„° í™•ì¸ë§Œ (ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì•ˆí•¨)
            useEffect(() => {
                const saved = localStorage.getItem('planb_calculation_result');
                if (saved) {
                    // ì €ì¥ëœ ë°ì´í„°ê°€ ìˆë‹¤ëŠ” ê²ƒë§Œ í™•ì¸, ìë™ ë¶ˆëŸ¬ì˜¤ê¸°ëŠ” í•˜ì§€ ì•ŠìŒ
                    console.log('ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.');
                }
            }, []);

            const formatAmount = (value) => {
                if (!value || value === '' || value === '0') return 'ğŸ’° 0ì›';
                const num = parseInt(value);
                if (num >= 10000) return `ğŸ’° ${(num / 10000).toFixed(1)}ì–µì›`;
                if (num >= 1000) return `ğŸ’° ${Math.round(num / 1000)}ì²œë§Œì›`;
                return `ğŸ’° ${num.toLocaleString()}ë§Œì›`;
            };

            // AmountInput ì»´í¬ë„ŒíŠ¸

            // ì›ë³¸ calculateResults í•¨ìˆ˜ (planb-calculator.htmlì—ì„œ ì¶”ì¶œ)
            const calculateResults = () => {
                const age = parseInt(formData.age);
                
                // ìì‚° ê³„ì‚° (ë§Œì› â†’ ì›)
                let housingAsset = 0;
                let housingDebt = 0;
                let monthlyHousingCost = 0;
                
                // ì›” ëŒ€ì¶œ ì´ì (ê°œë³„ í•©ì‚°)
                const monthlyLoanInterest = 
                    ((parseInt(formData.homeMortgageInterest) || 0) + 
                     (parseInt(formData.investmentLoanInterest) || 0) + 
                     (parseInt(formData.debtInterest) || 0) + 
                     (parseInt(formData.depositLoanInterest) || 0)) * 10000;
                
                if (formData.housingType === 'owned_living') {
                    housingAsset = (parseInt(formData.homeValue) || 0) * 10000;
                    housingDebt = (parseInt(formData.homeMortgage) || 0) * 10000;
                } else if (formData.housingType === 'owned_renting') {
                    housingAsset = (parseInt(formData.homeValue) || 0) * 10000;
                    housingDebt = (parseInt(formData.homeMortgage) || 0) * 10000;
                    if (formData.currentRentType === 'monthly') {
                        monthlyHousingCost = (parseInt(formData.currentRent) || 0) * 10000;
                    }
                } else if (formData.housingType === 'jeonse') {
                    housingAsset = (parseInt(formData.jeonseDeposit) || 0) * 10000;
                } else if (formData.housingType === 'monthly') {
                    housingAsset = (parseInt(formData.monthlyDeposit) || 0) * 10000;
                    monthlyHousingCost = (parseInt(formData.monthlyRent) || 0) * 10000;
                }

                const assets = {
                    financial: (parseInt(formData.financialAssets) || 0) * 10000,
                    severance: (parseInt(formData.severancePay) || 0) * 10000,
                    housing: housingAsset,
                    currentDeposit: (parseInt(formData.currentDeposit) || 0) * 10000,
                    housingDebt: housingDebt,
                    monthlyHousingCost: monthlyHousingCost,
                    investment: (parseInt(formData.investmentRealEstate) || 0) * 10000,
                    investmentLoan: (parseInt(formData.investmentLoan) || 0) * 10000,
                    debt: (parseInt(formData.debt) || 0) * 10000,
                    depositLoan: (parseInt(formData.depositLoan) || 0) * 10000,
                    inheritance: (parseInt(formData.inheritance) || 0) * 10000
                };
                
                // ì£¼ê±°í˜•íƒœë³„ ìì‚° ë°˜ì˜ ë¹„ìœ¨
                const housingPensionAmount = (parseInt(formData.housingPension) || 0);
                let housingValueRatio = 0;
                
                if (formData.housingType === 'owned_living') {
                    if (housingPensionAmount > 0) {
                        housingValueRatio = 1.0;
                    } else if (enableDownsizing) {
                        housingValueRatio = 0.75;
                    } else {
                        housingValueRatio = 0;
                    }
                } else if (formData.housingType === 'owned_renting') {
                    if (enableDownsizing) {
                        housingValueRatio = 0.75;
                    } else {
                        housingValueRatio = 0;
                    }
                } else if (formData.housingType === 'jeonse' || formData.housingType === 'monthly') {
                    housingValueRatio = 1.0;
                }
                
                const ownedHouseDepositDebt = (parseInt(formData.ownedHouseDeposit) || 0) * 10000;
                
                // ì£¼íƒ ë§¤ê° ì‹œ ì‹¤ì œ ë§¤ê° ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚°
                let realizedHousingAsset = 0;
                if (formData.housingType === 'owned_living' && enableDownsizing) {
                    realizedHousingAsset = Math.max(0, (assets.housing * housingValueRatio) - assets.housingDebt);
                } else if (formData.housingType === 'owned_renting' && enableDownsizing) {
                    realizedHousingAsset = Math.max(0, (assets.housing * housingValueRatio) - ownedHouseDepositDebt - assets.housingDebt);
                } else {
                    realizedHousingAsset = assets.housing * housingValueRatio;
                }
                
                // ì£¼íƒì—°ê¸ˆ ì„ íƒ ì‹œ ì£¼íƒ ìì‚° ì²˜ë¦¬
                let housingAssetForUsable = realizedHousingAsset;
                if (parseInt(formData.housingPension) > 0) {
                    housingAssetForUsable = 0;
                }
                
                const usableAssetsGross = assets.financial + assets.severance + housingAssetForUsable;
                const usableAssets = usableAssetsGross;
                
                const totalDebts = (enableDownsizing ? 0 : assets.housingDebt) + assets.investmentLoan + assets.debt + assets.depositLoan +
                    (enableDownsizing && formData.housingType === 'owned_renting' ? 0 : ownedHouseDepositDebt);
                
                const unusableAssets = assets.investment + assets.inheritance +
                    (!enableDownsizing && !parseInt(formData.housingPension) && parseInt(formData.homeValue) > 0 ? (parseInt(formData.homeValue) || 0) * 10000 : 0);
                
                const allAssets = assets.financial + assets.severance + assets.housing + assets.currentDeposit + assets.investment + assets.inheritance;
                const totalAssets = Math.max(0, allAssets - totalDebts);
                
                const emergencyFund = assets.financial * 0.1;
                const availableAssets = Math.max(0, usableAssets - emergencyFund);
                
                const yearsToLive = lifeExpectancy - age;
                const annualWithdrawal = availableAssets / yearsToLive;
                const dailyAmount = annualWithdrawal / 365;
                const monthlyAmount = annualWithdrawal / 12;
                
                const monthlyPension = (parseInt(formData.nationalPension) || 0) + (parseInt(formData.privatePension) || 0) + (parseInt(formData.housingPension) || 0);
                const monthlyOtherIncome = (parseInt(formData.rentalIncome) || 0) + (parseInt(formData.workIncome) || 0) + (parseInt(formData.financialIncome) || 0) + (parseInt(formData.otherIncome) || 0);
                
                // ì¬ì‚°ì„¸ ê³„ì‚° (ì£¼íƒ ì†Œìœ ì‹œì—ë§Œ)
                const monthlyPropertyTax = (formData.housingType === 'owned_living' || formData.housingType === 'owned_renting') ? 
                    calculatePropertyTax(parseInt(formData.homeValue) || 0) : 0;
                
                const totalMonthlyAvailable = Math.round(monthlyAmount) + (monthlyPension * 10000) + (monthlyOtherIncome * 10000) - monthlyHousingCost - monthlyLoanInterest - monthlyPropertyTax;
                const totalDailyAvailable = Math.round(totalMonthlyAvailable / 30.4);
                
                const result = {
                    dailyAmount: Math.round(dailyAmount),
                    monthlyAmount: Math.round(monthlyAmount),
                    annualAmount: Math.round(annualWithdrawal),
                    totalDailyAvailable: totalDailyAvailable,
                    totalMonthlyAvailable: Math.round(totalMonthlyAvailable),
                    monthlyLivingCost: Math.round(totalMonthlyAvailable),
                    totalAssets: Math.round(totalAssets / 10000), // ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜
                    assetSufficiencyYears: yearsToLive,
                    housingType: formData.housingType,
                    yearsToLive: yearsToLive,
                    assetBreakdown: {
                        totalAssets, usableAssets, usableAssetsGross, unusableAssets, availableAssets, emergencyFund, totalDebts,
                        financial: assets.financial, severance: assets.severance,
                        housing: assets.housing, realizedHousingAsset: realizedHousingAsset, currentDeposit: assets.currentDeposit, housingDebt: assets.housingDebt, housingValueRatio: housingValueRatio,
                        monthlyHousingCost: assets.monthlyHousingCost,
                        investment: assets.investment, investmentLoan: assets.investmentLoan,
                        debt: assets.debt, inheritance: assets.inheritance, 
                        housingPensionAmount: housingPensionAmount,
                        housingType: formData.housingType,
                        enableDownsizing: enableDownsizing,
                        ownedHouseDepositDebt: ownedHouseDepositDebt
                    },
                    monthlyPension: monthlyPension * 10000,
                    monthlyOtherIncome: monthlyOtherIncome * 10000,
                    monthlyHousingCost: monthlyHousingCost,
                    monthlyLoanInterest: monthlyLoanInterest,
                    monthlyPropertyTax: monthlyPropertyTax,
                    safetyLevel: totalMonthlyAvailable >= 2500000 ? 'ì•ˆì „' : totalMonthlyAvailable >= 1800000 ? 'ë³´í†µ' : 'ì£¼ì˜' // KBê¸ˆìœµ ìµœì†Œ 251ë§Œì›(ì•ˆì „), ì •ë¶€ ì ì • 177ë§Œì›(ë³´í†µ), ì •ë¶€ ìµœì†Œ 124ë§Œì›(ì£¼ì˜)
                };

                setCalculatorResult(result);
                
                // ì„¸ì…˜ ìƒì„±ì„ ìœ„í•œ ì½œë°± í˜¸ì¶œ
                if (onCalculationComplete) {
                    onCalculationComplete(result);
                }
                
                setCalculatorStep(4);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };


            const openExpenseModal = () => {
                setShowExpenseModal(true);
            };

            const closeExpenseModal = () => {
                setShowExpenseModal(false);
            };

            const handleExpenseChange = (field, value) => {
                setExpenseData({ ...expenseData, [field]: value });
            };
            
            // ì§€ì¶œ ì…ë ¥ ì»´í¬ë„ŒíŠ¸ (AmountInputê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼)
            const ExpenseInput = ({ label, field, value, placeholder }) => {
                const formatAmount = (value) => {
                    if (!value || value === '' || value === '0') return 'ğŸ’° 0ì›';
                    const num = parseInt(value);
                    if (num >= 10000) return `ğŸ’° ${(num / 10000).toFixed(1)}ì–µì›`;
                    if (num >= 1000) return `ğŸ’° ${Math.round(num / 1000)}ì²œë§Œì›`;
                    return `ğŸ’° ${num.toLocaleString()}ë§Œì›`;
                };

                const handleInputChange = (e) => {
                    const inputValue = e.target.value;
                    const numValue = inputValue.replace(/[^0-9]/g, '');
                    
                    // ì…ë ¥ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ìƒíƒœ ì—…ë°ì´íŠ¸ (í¬ì»¤ìŠ¤ ìœ ì§€)
                    if (numValue !== value) {
                        handleExpenseChange(field, numValue);
                    }
                };

                return (
                    <div>
                        <label className="block text-xl font-semibold text-gray-800 mb-3">{label}</label>
                        <input
                            type="text"
                            inputMode="numeric"
                            pattern="[0-9]*"
                            value={value}
                            onChange={handleInputChange}
                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg focus:border-blue-500 focus:outline-none"
                            placeholder={placeholder}
                            autoComplete="off"
                        />
                        <div className="text-green-600 font-semibold text-lg mt-1">
                            {formatAmount(value)}
                        </div>
                    </div>
                );
            };

            // 2024ë…„ í†µê³„ì²­ ê°€ê³„ë™í–¥ì¡°ì‚¬ ë°ì´í„° (ë§Œì› ë‹¨ìœ„)
            const getStatKoreaData = () => ({
                food: 41, // ì‹ë£Œí’ˆÂ·ë¹„ì£¼ë¥˜ìŒë£Œ 41.2ë§Œì›
                communication: 14, // í†µì‹ ë¹„ (ì •ë³´í†µì‹  í¬í•¨) 14ë§Œì› ì¶”ì •
                utilities: 35, // ì£¼ê±°Â·ìˆ˜ë„Â·ê´‘ì—´ 35ë§Œì›
                medical: 24, // ë³´ê±´ 23.9ë§Œì›
                hobby: 31, // ì˜¤ë½Â·ë¬¸í™” 31ë§Œì› ì¶”ì •
                vehicle: 33, // êµí†µë¹„ 33.5ë§Œì›
                etc: 20 // ê¸°íƒ€ (ì˜ë¥˜Â·ì‹ ë°œ, ê°€ì •ìš©í’ˆ ë“±) 20ë§Œì› ì¶”ì •
            });
            
            const submitExpenseData = async () => {
                // í†µê³„ì²­ ë°ì´í„°ì™€ ë¹„êµ
                const statData = getStatKoreaData();
                const userTotal = Object.values(expenseData).reduce((sum, val) => sum + (parseInt(val) || 0), 0);
                const statTotal = Object.values(statData).reduce((sum, val) => sum + val, 0);
                
                setExpenseComparison({
                    user: expenseData,
                    stat: statData,
                    userTotal: userTotal,
                    statTotal: statTotal
                });
                
                // ì§€ì¶œë‚´ì—­ì„ DBì— ì €ì¥ (íšŒì›ì¸ ê²½ìš°)
                if (currentUser && !currentUser.isGuest && supabase) {
                    try {
                        // ë¨¼ì € í˜„ì¬ ì‚¬ìš©ìì˜ ìµœì‹  ê³„ì‚° ê²°ê³¼ IDë¥¼ ì°¾ê¸°
                        const { data: calculationData, error: calcError } = await supabase
                            .from('user_calculations')
                            .select('id')
                            .eq('user_id', currentUser.id)
                            .order('created_at', { ascending: false })
                            .limit(1);
                        
                        if (calcError) {
                            console.error('ê³„ì‚° ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', calcError);
                        } else if (calculationData && calculationData.length > 0) {
                            // ì§€ì¶œë‚´ì—­ì„ user_expenses í…Œì´ë¸”ì— ì €ì¥
                            const expensePayload = {
                                calculation_id: calculationData[0].id,
                                food_expenses: parseInt(expenseData.food) || 0,
                                communication_expenses: parseInt(expenseData.communication) || 0,
                                utilities_expenses: parseInt(expenseData.utilities) || 0,
                                living_expenses: parseInt(expenseData.etc) || 0, // ê¸°íƒ€ë¥¼ ìƒí™œë¹„ë¡œ ë§¤í•‘
                                medical_expenses: parseInt(expenseData.medical) || 0,
                                leisure_expenses: parseInt(expenseData.hobby) || 0, // ì·¨ë¯¸Â·ì—¬ê°€ë¥¼ ì—¬ê°€ë¹„ë¡œ ë§¤í•‘
                                transportation_expenses: parseInt(expenseData.vehicle) || 0,
                                miscellaneous_expenses: 0,
                                created_at: new Date().toISOString()
                            };
                            
                            const { error: expenseError } = await supabase
                                .from('user_expenses')
                                .upsert(expensePayload);
                            
                            if (expenseError) {
                                console.error('ì§€ì¶œë‚´ì—­ ì €ì¥ ì‹¤íŒ¨:', expenseError);
                            } else {
                                console.log('ì§€ì¶œë‚´ì—­ DB ì €ì¥ ì„±ê³µ');
                            }
                        }
                    } catch (error) {
                        console.error('ì§€ì¶œë‚´ì—­ ì €ì¥ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    }
                }
                
                setShowExpenseModal(false);
                setShowComparisonModal(true);
            };
            
            const [expenseComparison, setExpenseComparison] = useState(null);
            const [showComparisonModal, setShowComparisonModal] = useState(false);
            
            // ê³„ì‚°ê²°ê³¼ ì €ì¥ í•¨ìˆ˜ 
            const saveCalculationResult = () => {
                if (!calculatorResult) return;
                
                // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìì¸ ê²½ìš° íšŒì›ê°€ì… ì•ˆë‚´ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                if (currentUser?.isGuest) {
                    showNotification(
                        'ê³„ì‚° ê²°ê³¼ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ì‹œê² ì–´ìš”? ğŸ˜Š', 
                        'íšŒì›ê°€ì…í•˜ë©´ ê³„ì‚° ê²°ê³¼ê°€ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤!\n\nâ€¢ ì–¸ì œë“  ë‹¤ì‹œ í™•ì¸ ê°€ëŠ¥\nâ€¢ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¹„ìŠ·í•œ ë¶„ë“¤ê³¼ ì†Œí†µ\nâ€¢ ì „ë¬¸ê°€ ìƒë‹´ ì˜ˆì•½ ê°€ëŠ¥', 
                        'info'
                    );
                    // 3ì´ˆ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                    setTimeout(() => {
                        setCurrentView('login');
                    }, 3000);
                    return;
                }
                
                // íšŒì› ì‚¬ìš©ìì¸ ê²½ìš° ì§ì ‘ ì €ì¥
                const savedResult = {
                    ...calculatorResult,
                    formData: formData,
                    lifeExpectancy: lifeExpectancy,
                    enableDownsizing: enableDownsizing,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem('planb_calculation_result', JSON.stringify(savedResult));
                setIsResultSaved(true);
                
                showNotification('ì €ì¥ ì™„ë£Œ', 'ê³„ì‚°ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾\nì–¸ì œë“  ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
            };
            
            // ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° (localStorage)
            const loadCalculationResult = () => {
                const saved = localStorage.getItem('planb_calculation_result');
                if (saved) {
                    try {
                        const savedData = JSON.parse(saved);
                        setFormData(savedData.formData);
                        setCalculatorResult(savedData);
                        setLifeExpectancy(savedData.lifeExpectancy);
                        setEnableDownsizing(savedData.enableDownsizing);
                        setCalculatorStep(4);
                        setIsResultSaved(true);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        showNotification('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ', 'ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ“Š', 'success');
                    } catch (error) {
                        console.error('ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        showNotification('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } else {
                    showNotification('ì €ì¥ëœ ë°ì´í„° ì—†ìŒ', 'ì•„ì§ ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                }
            };
            

            // ì¶”ê°€ í•„ìˆ˜ í•¨ìˆ˜ë“¤
            const [activeTab, setActiveTab] = useState('expense');

            const joinCommunity = () => {
                showNotification('ì»¤ë®¤ë‹ˆí‹° ì¶œì‹œ ì˜ˆì •', 'ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ì´ ê³§ ì¶œì‹œë©ë‹ˆë‹¤! ğŸ‰\në¹„ìŠ·í•œ ê³ ë¯¼ì„ ê°€ì§„ ë¶„ë“¤ê³¼ ì†Œí†µí•  ìˆ˜ ìˆì–´ìš”.', 'info');
            };

            // ê¸°ëŒ€ìˆ˜ëª… ë³€ê²½ ì‹œ ê²°ê³¼ ì¬ê³„ì‚°
            const recalculateWithLifeExpectancy = () => {
                if (calculatorResult && lifeExpectancy) {
                    const yearsToLive = lifeExpectancy - parseInt(formData.age);
                    const monthlyAmount = calculatorResult.assetBreakdown?.availableAssets ? 
                        Math.floor(calculatorResult.assetBreakdown.availableAssets / yearsToLive / 12) : 0;
                    
                    const totalMonthlyAvailable = monthlyAmount + (calculatorResult.monthlyPension || 0) + 
                        (calculatorResult.monthlyOtherIncome || 0) - (calculatorResult.monthlyHousingCost || 0) - 
                        (calculatorResult.monthlyLoanInterest || 0) - (calculatorResult.monthlyPropertyTax || 0);
                    
                    const updatedResult = {
                        ...calculatorResult,
                        yearsToLive: yearsToLive,
                        monthlyAmount: monthlyAmount,
                        totalMonthlyAvailable: totalMonthlyAvailable,
                        totalDailyAvailable: Math.floor(totalMonthlyAvailable / 30),
                        safetyLevel: totalMonthlyAvailable >= 2500000 ? 'ì•ˆì „' : totalMonthlyAvailable >= 1800000 ? 'ë³´í†µ' : 'ì£¼ì˜'
                    };
                    
                    setCalculatorResult(updatedResult);
                }
            };

            // ê¸°ëŒ€ìˆ˜ëª…ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì¬ê³„ì‚°
            useEffect(() => {
                if (calculatorResult && calculatorStep === 4) {
                    recalculateWithLifeExpectancy();
                }
            }, [lifeExpectancy]);

            // ë‹¤ìš´ì‚¬ì´ì§• ì˜µì…˜ ë³€ê²½ ì‹œ ì¬ê³„ì‚°
            useEffect(() => {
                if (calculatorResult && calculatorStep === 4) {
                    // ë‹¤ìš´ì‚¬ì´ì§• ì˜µì…˜ ë³€ê²½ì‹œ ì¬ê³„ì‚° ìˆ˜í–‰
                    calculateResults();
                }
            }, [enableDownsizing]);

            // 1ë‹¨ê³„ ë Œë”ë§
            if (calculatorStep === 1) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => setCurrentView('main')}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ§® ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê¸°</h1>
                                <p className="text-xl text-gray-600">ë‚˜ì´ì™€ ê±´ê°•ìƒíƒœë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '33%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">1ë‹¨ê³„ / 3ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="space-y-6">
                                    <div className="mb-6">
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ‚ ë‚˜ì´</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            pattern="[0-9]*"
                                            value={formData.age}
                                            onChange={(e) => {
                                                const numValue = e.target.value.replace(/[^0-9]/g, '');
                                                handleInputChange('age', numValue);
                                            }}
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            placeholder=""
                                            autoComplete="off"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ’ª ê±´ê°• ìƒíƒœ</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.health}
                                            onChange={(e) => handleInputChange('health', e.target.value)}
                                        >
                                            <option value="ì–‘í˜¸">ì–‘í˜¸ (ìš´ë™ ê·œì¹™ì , í° ì§ˆë³‘ ì—†ìŒ)</option>
                                            <option value="ë³´í†µ">ë³´í†µ (ì¼ë°˜ì ì¸ ê±´ê°• ìƒíƒœ)</option>
                                            <option value="ì£¼ì˜í•„ìš”">ì£¼ì˜í•„ìš” (ë§Œì„±ì§ˆí™˜ ìˆê±°ë‚˜ ê´€ë¦¬ í•„ìš”)</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ¯ ìƒí™œ ëª¨ë“œ</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.mode}
                                            onChange={(e) => handleInputChange('mode', e.target.value)}
                                        >
                                            <option value="ë³´ìˆ˜ì ">ë³´ìˆ˜ì  (ì•ˆì „ ìš°ì„ , ì—¬ìœ ìê¸ˆ í™•ë³´)</option>
                                            <option value="ê· í˜•">ê· í˜• (í‰ê· ì ì¸ ìƒí™œ ìˆ˜ì¤€ ìœ ì§€)</option>
                                            <option value="ì ê·¹ì ">ì ê·¹ì  (ì—¬ìœ ìˆëŠ” ìƒí™œ, ì·¨ë¯¸í™œë™)</option>
                                        </select>
                                    </div>

                                    <button
                                        onClick={() => goToNextStep(2)}
                                        className="btn-primary w-full text-xl py-4"
                                        disabled={!formData.age || !formData.health || !formData.mode}
                                    >
                                        ë‹¤ìŒ ë‹¨ê³„ â†’
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 2ë‹¨ê³„ ë Œë”ë§ (ìì‚° ì •ë³´)
            if (calculatorStep === 2) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(1)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ì´ì „ ë‹¨ê³„
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ  ìì‚° ì •ë³´</h1>
                                <p className="text-xl text-gray-600">í˜„ì¬ ë³´ìœ í•˜ê³  ê³„ì‹  ìì‚°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '66%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">2ë‹¨ê³„ / 3ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="bg-green-50 border-l-4 border-green-400 p-6 mb-8 rounded-r-lg">
                                    <p className="text-lg text-green-800">
                                        ğŸ˜Š <strong>ì •í™•í•œ ìˆ˜ì¹˜ë¥¼ ëª¨ë¥´ì‹œëŠ” ê²½ìš°ì—ëŠ”</strong><br/>
                                        ì•Œê³  ê³„ì‹  ëŒ€ëµì ì¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
                                    </p>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ  ì£¼ê±° í˜•íƒœ</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.housingType}
                                            onChange={(e) => handleInputChange('housingType', e.target.value)}
                                        >
                                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                            <option value="owned_living">ìê°€ ì†Œìœ  + ê±°ì£¼</option>
                                            <option value="owned_renting">ìê°€ ì†Œìœ  + ì „ì„¸/ì›”ì„¸ ê±°ì£¼</option>
                                            <option value="jeonse">ì „ì„¸</option>
                                            <option value="monthly">ì›”ì„¸</option>
                                            <option value="none">ë¬´ì£¼íƒ</option>
                                        </select>
                                    </div>

                                    <AmountInput
                                        label="ğŸ¦ í˜„ê¸ˆ ë° í˜„ê¸ˆì„± ìì‚° (ì˜ˆê¸ˆÂ·ì ê¸ˆÂ·ì£¼ì‹Â·í€ë“œ ë“±, ë‹¨ìœ„: ë§Œì›)"
                                        value={formData.financialAssets}
                                        onChange={(v) => handleInputChange('financialAssets', v)}
                                        placeholder=""
                                    />

                                    <AmountInput
                                        label="ğŸ’¼ í‡´ì§ê¸ˆ (ì€í‡´ì‹œ ë°›ì„ í‡´ì§ê¸ˆ ë˜ëŠ” í˜„ì¬ ë‚¨ì•„ìˆëŠ” í‡´ì§ê¸ˆ, ë‹¨ìœ„: ë§Œì›)"
                                        value={formData.severancePay}
                                        onChange={(v) => handleInputChange('severancePay', v)}
                                        placeholder=""
                                    />

                                    {/* ì£¼ê±°í˜•íƒœë³„ ì¡°ê±´ë¶€ í•„ë“œ */}
                                    {(formData.housingType === 'owned_living' || formData.housingType === 'owned_renting') && (
                                        <>
                                            <AmountInput
                                                label="ğŸ  ìê°€ ì†Œìœ  ì£¼íƒ ì‹œì„¸ (ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.homeValue}
                                                onChange={(v) => handleInputChange('homeValue', v)}
                                                placeholder=""
                                            />
                                            <AmountInput
                                                label="ğŸ  ì£¼íƒë‹´ë³´ëŒ€ì¶œ ì”ì•¡ (ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.homeMortgage}
                                                onChange={(v) => handleInputChange('homeMortgage', v)}
                                                placeholder=""
                                            />
                                            {formData.homeMortgage && parseInt(formData.homeMortgage) > 0 && (
                                                <div className="space-y-4">
                                                    <AmountInput
                                                        label="ğŸ’³ ì›” ëŒ€ì¶œìƒí™˜ì•¡ (ë§¤ë‹¬ ë‚˜ê°€ëŠ” ëˆ, ë‹¨ìœ„: ë§Œì›)"
                                                        value={formData.homeMortgagePayment}
                                                        onChange={(v) => handleInputChange('homeMortgagePayment', v)}
                                                        placeholder="ì˜ˆ: 50ë§Œì›"
                                                    />
                                                    
                                                    <div className="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                                                        <div className="flex items-center mb-3">
                                                            <input
                                                                type="checkbox"
                                                                id="knowLoanEndYear"
                                                                checked={formData.knowLoanEndYear || false}
                                                                onChange={(e) => handleInputChange('knowLoanEndYear', e.target.checked)}
                                                                onClick={(e) => {
                                                                    const newValue = !formData.knowLoanEndYear;
                                                                    handleInputChange('knowLoanEndYear', newValue);
                                                                }}
                                                                className="mr-2 scale-125"
                                                            />
                                                            <label htmlFor="knowLoanEndYear" className="text-blue-800 font-semibold">
                                                                ğŸ“… ëŒ€ì¶œ ì™„ë£Œ ì˜ˆì •ë…„ë„ë¥¼ ì•Œê³  ìˆì–´ìš”
                                                            </label>
                                                        </div>
                                                        
                                                        {!formData.knowLoanEndYear && (
                                                            <p className="text-blue-700 text-sm">
                                                                â„¹ï¸ ì²´í¬í•˜ì§€ ì•Šìœ¼ë©´ <strong>ë³´ìˆ˜ì ìœ¼ë¡œ ê³„ì‚°</strong>í•©ë‹ˆë‹¤.<br/>
                                                                (ì€í‡´ í›„ì—ë„ ê³„ì† ìƒí™˜í•œë‹¤ê³  ê°€ì •)
                                                            </p>
                                                        )}
                                                    </div>

                                                    {formData.knowLoanEndYear && (
                                                        <div>
                                                            <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ“… ëŒ€ì¶œ ì™„ë£Œ ì˜ˆì •ë…„ë„</label>
                                                            <input
                                                                type="text"
                                                                inputMode="numeric"
                                                                pattern="[0-9]*"
                                                                value={formData.loanEndYear || ''}
                                                                onChange={(e) => {
                                                                    const year = e.target.value.replace(/[^0-9]/g, '');
                                                                    if (year.length <= 4) {
                                                                        handleInputChange('loanEndYear', year);
                                                                    }
                                                                }}
                                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                                placeholder="ì˜ˆ: 2030"
                                                            />
                                                            {formData.loanEndYear && (
                                                                <div className="text-green-600 font-semibold text-lg mt-1">
                                                                    âœ… {formData.loanEndYear}ë…„ ì´í›„ ì›” {formData.homeMortgagePayment ? parseInt(formData.homeMortgagePayment).toLocaleString() : 0}ë§Œì› ì ˆì•½!
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </>
                                    )}

                                    {formData.housingType === 'owned_renting' && (
                                        <>
                                            <AmountInput
                                                label="ğŸ  ë‚´ ì†Œìœ  ì§‘ ì„ì°¨ì¸ ë³´ì¦ê¸ˆ (ë‚´ê°€ ë°›ì€ ë³´ì¦ê¸ˆ, ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.ownedHouseDeposit}
                                                onChange={(v) => handleInputChange('ownedHouseDeposit', v)}
                                                placeholder=""
                                            />

                                            <AmountInput
                                                label="ğŸ  í˜„ì¬ ê±°ì£¼ì§€ ë³´ì¦ê¸ˆ (ë‚´ê°€ ë‚¸ ë³´ì¦ê¸ˆ, ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.currentDeposit}
                                                onChange={(v) => handleInputChange('currentDeposit', v)}
                                                placeholder=""
                                            />
                                            
                                            <AmountInput
                                                label="ğŸ’³ ë³´ì¦ê¸ˆ ëŒ€ì¶œ ì”ì•¡ (ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.depositLoan}
                                                onChange={(v) => handleInputChange('depositLoan', v)}
                                                placeholder=""
                                            />
                                            {formData.depositLoan && parseInt(formData.depositLoan) > 0 && (
                                                <div className="space-y-4">
                                                    <AmountInput
                                                        label="ğŸ’³ ë³´ì¦ê¸ˆ ëŒ€ì¶œ ì›” ìƒí™˜ì•¡ (ë§¤ë‹¬ ë‚˜ê°€ëŠ” ëˆ, ë‹¨ìœ„: ë§Œì›)"
                                                        value={formData.depositLoanPayment}
                                                        onChange={(v) => handleInputChange('depositLoanPayment', v)}
                                                        placeholder="ì˜ˆ: 30ë§Œì›"
                                                    />
                                                    
                                                    <div className="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                                                        <div className="flex items-center mb-3">
                                                            <input
                                                                type="checkbox"
                                                                id="knowDepositLoanEndYear"
                                                                checked={formData.knowDepositLoanEndYear || false}
                                                                onChange={(e) => handleInputChange('knowDepositLoanEndYear', e.target.checked)}
                                                                className="mr-2 scale-125"
                                                            />
                                                            <label htmlFor="knowDepositLoanEndYear" className="text-blue-800 font-semibold">
                                                                ğŸ“… ëŒ€ì¶œ ì™„ë£Œ ì˜ˆì •ë…„ë„ë¥¼ ì•Œê³  ìˆì–´ìš”
                                                            </label>
                                                        </div>
                                                    </div>

                                                    {formData.knowDepositLoanEndYear && (
                                                        <div>
                                                            <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ“… ëŒ€ì¶œ ì™„ë£Œ ì˜ˆì •ë…„ë„</label>
                                                            <input
                                                                type="text"
                                                                inputMode="numeric"
                                                                pattern="[0-9]*"
                                                                value={formData.depositLoanEndYear || ''}
                                                                onChange={(e) => {
                                                                    const year = e.target.value.replace(/[^0-9]/g, '');
                                                                    if (year.length <= 4) {
                                                                        handleInputChange('depositLoanEndYear', year);
                                                                    }
                                                                }}
                                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                                placeholder="ì˜ˆ: 2028"
                                                            />
                                                            {formData.depositLoanEndYear && (
                                                                <div className="text-green-600 font-semibold text-lg mt-1">
                                                                    âœ… {formData.depositLoanEndYear}ë…„ ì´í›„ ì›” {formData.depositLoanPayment ? parseInt(formData.depositLoanPayment).toLocaleString() : 0}ë§Œì› ì ˆì•½!
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            <div className="mb-6">
                                                <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ  í˜„ì¬ ê±°ì£¼ í˜•íƒœ</label>
                                                <select
                                                    className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                    value={formData.currentRentType}
                                                    onChange={(e) => handleInputChange('currentRentType', e.target.value)}
                                                >
                                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                                    <option value="jeonse">ì „ì„¸</option>
                                                    <option value="monthly">ì›”ì„¸</option>
                                                </select>
                                            </div>

                                            {formData.currentRentType === 'monthly' && (
                                                <AmountInput
                                                    label="ğŸ  í˜„ì¬ ê±°ì£¼ì§€ ì›”ì„¸ (ë‚´ê°€ ë‚´ëŠ” ì›”ì„¸, ë‹¨ìœ„: ë§Œì›)"
                                                    value={formData.currentRent}
                                                    onChange={(v) => handleInputChange('currentRent', v)}
                                                    placeholder=""
                                                    />
                                            )}
                                        </>
                                    )}

                                    {formData.housingType === 'jeonse' && (
                                        <AmountInput
                                            label="ğŸ  ì „ì„¸ë³´ì¦ê¸ˆ (ë‹¨ìœ„: ë§Œì›)"
                                            value={formData.jeonseDeposit}
                                            onChange={(v) => handleInputChange('jeonseDeposit', v)}
                                            placeholder=""
                                            averageAmount={0}
                                        />
                                    )}

                                    {formData.housingType === 'monthly' && (
                                        <>
                                            <AmountInput
                                                label="ğŸ  ì›”ì„¸ë³´ì¦ê¸ˆ (ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.monthlyDeposit}
                                                onChange={(v) => handleInputChange('monthlyDeposit', v)}
                                                placeholder=""
                                            />
                                            <AmountInput
                                                label="ğŸ  ì›”ì„¸ (ë‹¨ìœ„: ë§Œì›)"
                                                value={formData.monthlyRent}
                                                onChange={(v) => handleInputChange('monthlyRent', v)}
                                                placeholder=""
                                            />
                                        </>
                                    )}

                                    <AmountInput
                                        label="ğŸ¢ ìˆ˜ìµí˜• ë¶€ë™ì‚° (ì˜¤í”¼ìŠ¤í…”Â·ìƒê°€ ë“±, ë‹¨ìœ„: ë§Œì›)"
                                        value={formData.investmentRealEstate}
                                        onChange={(v) => handleInputChange('investmentRealEstate', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />

                                    <AmountInput
                                        label="ğŸ¢ ìˆ˜ìµí˜• ë¶€ë™ì‚° ëŒ€ì¶œ ì”ì•¡ (ë‹¨ìœ„: ë§Œì›)"
                                        value={formData.investmentLoan}
                                        onChange={(v) => handleInputChange('investmentLoan', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />
                                    {formData.investmentLoan && parseInt(formData.investmentLoan) > 0 && (
                                        <AmountInput
                                            label="ğŸ’³ ìˆ˜ìµí˜• ë¶€ë™ì‚° ëŒ€ì¶œ ì›” ì´ì (ë‹¨ìœ„: ë§Œì›)"
                                            value={formData.investmentLoanInterest}
                                            onChange={(v) => handleInputChange('investmentLoanInterest', v)}
                                            placeholder=""
                                            averageAmount={0}
                                        />
                                    )}

                                    <AmountInput
                                        label="ğŸ’³ ê¸°íƒ€ ëŒ€ì¶œ ì”ì•¡ (ë‹¨ìœ„: ë§Œì›)"
                                        value={formData.debt}
                                        onChange={(v) => handleInputChange('debt', v)}
                                        placeholder=""
                                    />
                                    {formData.debt && parseInt(formData.debt) > 0 && (
                                        <AmountInput
                                            label="ğŸ’³ ê¸°íƒ€ ëŒ€ì¶œ ì›” ì´ì (ë‹¨ìœ„: ë§Œì›)"
                                            value={formData.debtInterest}
                                            onChange={(v) => handleInputChange('debtInterest', v)}
                                            placeholder=""
                                            averageAmount={0}
                                        />
                                    )}

                                    <div className="mb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <label className="block text-xl font-semibold text-gray-800">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì¦ì—¬ ë˜ëŠ” ìƒì† ì˜ˆì •ì•¡ (ë‹¨ìœ„: ë§Œì›)</label>
                                            <button
                                                onClick={() => setShowInheritanceGuide(!showInheritanceGuide)}
                                                className="text-blue-500 bg-blue-50 rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-blue-100"
                                            >
                                                ?
                                            </button>
                                        </div>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            pattern="[0-9]*"
                                            value={formData.inheritance}
                                            onChange={(e) => {
                                                const numValue = e.target.value.replace(/[^0-9]/g, '');
                                                handleInputChange('inheritance', numValue === '' ? '' : numValue);
                                            }}
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            placeholder=""
                                            autoComplete="off"
                                        />
                                        <div className="text-green-600 font-semibold text-lg mt-1">{formatAmount(formData.inheritance)}</div>
                                        
                                        {showInheritanceGuide && (
                                            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-3 rounded-r-lg">
                                                <div className="text-yellow-800">
                                                    <p className="font-semibold mb-2">ğŸ“Š ì°¸ê³  ê°€ì´ë“œë¼ì¸</p>
                                                    <ul className="text-sm space-y-1">
                                                        <li>â€¢ <strong>ìƒì•  í‰ê· :</strong> ì•½ 2,000ë§Œì› (í•œêµ­ì¡°ì„¸ì¬ì •ì—°êµ¬ì› 2022)</li>
                                                        <li>â€¢ <strong>ë¶€ëª¨ 1ì¸ë‹¹:</strong> í‰ê·  1,000ë§Œì› ë‚´ì™¸</li>
                                                        <li>â€¢ <strong>ì‹œê¸°:</strong> ëŒ€ë¶€ë¶„ 50-70ëŒ€ì— ë°›ìŒ</li>
                                                        <li>â€¢ <strong>í˜•íƒœ:</strong> í˜„ê¸ˆ, ë¶€ë™ì‚°, ì£¼ì‹ ë“± ë‹¤ì–‘</li>
                                                    </ul>
                                                    <p className="text-xs mt-2 text-yellow-700">
                                                        * ê°€ì¡± ìƒí™©ì— ë”°ë¼ í° ì°¨ì´ê°€ ìˆìœ¼ë‹ˆ ì˜ˆìƒ ê°€ëŠ¥í•œ ê¸ˆì•¡ë§Œ ì…ë ¥í•˜ì„¸ìš”
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex gap-4 mt-8">
                                        <button
                                            onClick={() => goToNextStep(1)}
                                            className="flex items-center px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200"
                                        >
                                            <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                            </svg>
                                            ì´ì „ ë‹¨ê³„
                                        </button>
                                        <button
                                            onClick={() => goToNextStep(3)}
                                            className="btn-primary flex-1"
                                            disabled={!formData.housingType}
                                        >
                                            ë‹¤ìŒ ë‹¨ê³„ â†’
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 3ë‹¨ê³„ ë Œë”ë§ (ì¶”ê°€ ìˆ˜ì…Â·ì§€ì¶œ)
            if (calculatorStep === 3) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(2)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ì´ì „ ë‹¨ê³„
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ“‹ ì¶”ê°€ ìˆ˜ì…Â·ì§€ì¶œ</h1>
                                <p className="text-xl text-gray-600">ë§¤ë‹¬ ë“¤ì–´ì˜¤ëŠ” ì—°ê¸ˆì´ë‚˜ ë‚˜ê°€ëŠ” ê³ ì •ë¹„ìš© (ì„ íƒì‚¬í•­)</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '100%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">3ë‹¨ê³„ / 3ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="bg-green-50 border-l-4 border-green-400 p-6 mb-8 rounded-r-lg">
                                    <p className="text-lg text-green-800">
                                        ğŸ˜Š <strong>ì •í™•í•œ ìˆ˜ì¹˜ë¥¼ ëª¨ë¥´ì‹œëŠ” ê²½ìš°ì—ëŠ”</strong><br/>
                                        ì•Œê³  ê³„ì‹  ëŒ€ëµì ì¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
                                    </p>
                                </div>

                                <h2 className="text-2xl font-bold mb-6 text-gray-800">ğŸ“ˆ ë§¤ë‹¬ ë°›ëŠ” ì—°ê¸ˆ (ë‹¨ìœ„: ë§Œì›)</h2>
                                
                                <AmountInput
                                    label="ğŸ›ï¸ êµ­ë¯¼ì—°ê¸ˆ (ì›” ìˆ˜ë ¹ì•¡)"
                                    value={formData.nationalPension}
                                    onChange={(v) => handleInputChange('nationalPension', v)}
                                    placeholder=""
                                />
                                
                                <AmountInput
                                    label="ğŸ’° ê°œì¸ì—°ê¸ˆ (ì›” ìˆ˜ë ¹ì•¡)"
                                    value={formData.privatePension}
                                    onChange={(v) => handleInputChange('privatePension', v)}
                                    placeholder=""
                                />
                                
                                <AmountInput
                                    label="ğŸ  ì£¼íƒì—°ê¸ˆ (ì›” ìˆ˜ë ¹ì•¡)"
                                    value={formData.housingPension}
                                    onChange={(v) => handleInputChange('housingPension', v)}
                                    placeholder=""
                                    averageAmount={0}
                                />

                                <h2 className="text-2xl font-bold mb-6 mt-8 text-gray-800">ğŸ’¼ ê¸°íƒ€ ì›” ìˆ˜ì… (ë‹¨ìœ„: ë§Œì›)</h2>
                                
                                <AmountInput
                                    label="ğŸ  ì„ëŒ€ì†Œë“ (ì›” ìˆ˜ë ¹ì•¡)"
                                    value={formData.rentalIncome}
                                    onChange={(v) => handleInputChange('rentalIncome', v)}
                                    placeholder=""
                                    averageAmount={0}
                                />
                                
                                <AmountInput
                                    label="ğŸ’¼ ê·¼ë¡œì†Œë“ (íŒŒíŠ¸íƒ€ì„, ìë¬¸ë£Œ ë“±)"
                                    value={formData.workIncome}
                                    onChange={(v) => handleInputChange('workIncome', v)}
                                    placeholder=""
                                    averageAmount={0}
                                />
                                
                                <AmountInput
                                    label="ğŸ’° ê¸ˆìœµì†Œë“ (ë°°ë‹¹ê¸ˆ, ì´ì ë“±)"
                                    value={formData.financialIncome}
                                    onChange={(v) => handleInputChange('financialIncome', v)}
                                    placeholder=""
                                    averageAmount={0}
                                />
                                
                                <AmountInput
                                    label="ğŸ“š ê¸°íƒ€ì†Œë“ (ê°•ì˜, ë¡œì—´í‹° ë“±)"
                                    value={formData.otherIncome}
                                    onChange={(v) => handleInputChange('otherIncome', v)}
                                    placeholder=""
                                    averageAmount={0}
                                />

                                <div className="flex gap-4 mt-8">
                                    <button
                                        onClick={() => goToNextStep(2)}
                                        className="flex items-center px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200"
                                    >
                                        <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                        </svg>
                                        ì´ì „ ë‹¨ê³„
                                    </button>
                                    <button
                                        onClick={calculateResults}
                                        className="btn-primary flex-1"
                                    >
                                        ğŸš€ ì€í‡´ìƒí™œë¹„ ê³„ì‚°í•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ê²°ê³¼ í™”ë©´ (ì›ë³¸ì—ì„œ ì¶”ì¶œí•œ ì™„ì „í•œ ë²„ì „)
            if (calculatorStep === 4 && calculatorResult) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(3)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ‰ ì€í‡´ìƒí™œë¹„ ê³„ì‚° ì™„ë£Œ!</h1>
                            </div>

                            <div className="card mb-6">
                                <div className="text-center">
                                    <div className="text-5xl font-bold text-blue-600 mb-4">
                                        í•˜ë£¨ {formatResultAmount(calculatorResult.totalDailyAvailable)}
                                    </div>
                                    <div className="text-3xl text-gray-600 mb-4">
                                        ì›” {formatResultAmount(calculatorResult.totalMonthlyAvailable)}
                                    </div>
                                    
                                    {/* ì•ˆì „ ìˆ˜ì¤€ í‘œì‹œ */}
                                    <div className={`inline-block px-6 py-3 rounded-full text-white font-bold text-lg mb-4 ${
                                        calculatorResult.safetyLevel === 'ì•ˆì „' ? 'bg-green-500' :
                                        calculatorResult.safetyLevel === 'ë³´í†µ' ? 'bg-yellow-500' : 'bg-red-500'
                                    }`}>
                                        {calculatorResult.safetyLevel} ìˆ˜ì¤€
                                    </div>
                                    
                                    {/* ê¸°ëŒ€ìˆ˜ëª… ì¡°ì • */}
                                    <div className="bg-blue-50 p-4 rounded-lg mb-4 max-w-md mx-auto">
                                        <div className="flex items-center justify-center gap-3 mb-2">
                                            <span className="text-sm font-medium text-blue-800">ê¸°ëŒ€ìˆ˜ëª…:</span>
                                            <div className="flex items-center gap-2">
                                                <button 
                                                    onClick={() => setLifeExpectancy(Math.max(70, lifeExpectancy - 5))}
                                                    className="w-8 h-8 bg-blue-200 hover:bg-blue-300 rounded-full flex items-center justify-center text-blue-700 font-bold"
                                                >
                                                    -
                                                </button>
                                                <span className="font-bold text-lg text-blue-600 min-w-[50px] text-center">{lifeExpectancy}ì„¸</span>
                                                <button 
                                                    onClick={() => setLifeExpectancy(Math.min(110, lifeExpectancy + 5))}
                                                    className="w-8 h-8 bg-blue-200 hover:bg-blue-300 rounded-full flex items-center justify-center text-blue-700 font-bold"
                                                >
                                                    +
                                                </button>
                                            </div>
                                        </div>
                                        <div className="text-xs text-blue-600 text-center">
                                            {formData.age}ì„¸ë¶€í„° {lifeExpectancy}ì„¸ê¹Œì§€ ({lifeExpectancy - parseInt(formData.age)}ë…„ê°„) ìì‚° ë³´ì¡´
                                        </div>
                                    </div>

                                    
                                    {/* ê³„ì‚° ê²°ê³¼ ì €ì¥ */}
                                    {!isResultSaved ? (
                                        <div className="text-center mb-6">
                                            <button
                                                onClick={saveCalculationResult}
                                                className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                                            >
                                                ğŸ’¾ ë‚´ ê³„ì‚°ê²°ê³¼ ì €ì¥í•˜ê¸°
                                            </button>
                                            <div className="text-sm text-blue-600 mt-2 font-medium">
                                                ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•˜ë©´ ë‚˜ì™€ ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ê³¼ ì´ì•¼ê¸°í•  ìˆ˜ ìˆì–´ìš”!
                                            </div>
                                            <div className="text-sm text-gray-500 mt-1">
                                                ì–¸ì œë“ ì§€ ë‹¤ì‹œ ê³„ì‚°í•˜ê³  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center mb-6">
                                            <div className="inline-block px-6 py-3 bg-green-100 text-green-800 rounded-lg font-semibold">
                                                âœ… ê³„ì‚°ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
                                            </div>
                                            <div className="text-sm text-gray-500 mt-2">
                                                ì–¸ì œë“ ì§€ ë‹¤ì‹œ ê³„ì‚°í•˜ê³  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                            </div>
                                            <div className="text-sm text-blue-600 mt-1 font-medium">
                                                ğŸ‘‡ ì•„ë˜ì—ì„œ ë¹„ìŠ·í•œ ë¶„ë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”
                                            </div>
                                        </div>
                                    )}
                                    
                                </div>
                            </div>
                            
                            {/* ì»¤ë®¤ë‹ˆí‹° ì„¹ì…˜ - ì €ì¥ í›„ì—ë§Œ í‘œì‹œ */}
                            {isResultSaved && (
                                <div className="card mb-6">
                                    <h3 className="text-xl font-bold mb-4">ğŸ‘¥ ë‚˜ì™€ ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”</h3>
                                
                                    {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
                                    <div className="grid grid-cols-3 gap-2 mb-6">
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'expense' 
                                                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('expense')}
                                        >
                                            ğŸ“Š ì§€ì¶œë‚´ì—­ ê³µìœ 
                                        </button>
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'community' 
                                                    ? 'bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200 animate-pulse'
                                            }`}
                                            onClick={() => setActiveTab('community')}
                                        >
                                            ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬
                                        </button>
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'expert' 
                                                    ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('expert')}
                                        >
                                            ğŸ” ì „ë¬¸ê°€ ì°¾ê¸°
                                        </button>
                                    </div>

                                    {/* ì§€ì¶œë‚´ì—­ ê³µìœ  íƒ­ */}
                                    {activeTab === 'expense' && (
                                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    ğŸ’° <strong>ì§€ì¶œë‚´ì—­ ì…ë ¥</strong> í›„<br/>
                                                    ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ì´ ì–´ë–»ê²Œ ëˆì„ ì“°ê³  ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ì‹ë¹„ëŠ” ì–¼ë§ˆê°€ ì ë‹¹í• ê¹Œìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ë‹¤ë¥¸ì‚¬ëŒì€ ì˜ë£Œë¹„ë¥¼ ì–¼ë§ˆë‚˜ ì“¸ê¹Œìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ì·¨ë¯¸Â·ì—¬ê°€ë¹„ í˜„ì‹¤ì ì¸ ê¸°ì¤€ì€?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ì°¨ëŸ‰ìœ ì§€ë¹„ëŠ” ì–¼ë§ˆë‚˜ ë‚˜ì˜¬ê¹Œìš”?"</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-purple-100 p-3 rounded-lg mb-4 text-center">
                                                <p className="text-purple-800 font-semibold">
                                                    ğŸ“ˆ <strong>ë” ë‚˜ì€ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•´ì„œë§Œ ìµëª…ìœ¼ë¡œ í™œìš©ë©ë‹ˆë‹¤</strong>
                                                </p>
                                                <p className="text-purple-700 text-sm">ë‚´ ë˜ë˜ì˜ ì‹¤ì œ ì§€ì¶œ íŒ¨í„´ì„ í™•ì¸í•˜ì„¸ìš”</p>
                                            </div>
                                            
                                            <button
                                                onClick={openExpenseModal}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                ğŸ“ ì§€ì¶œë‚´ì—­ ì…ë ¥í•˜ê¸°
                                            </button>
                                        </div>
                                    )}

                                    {/* ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ íƒ­ */}
                                    {activeTab === 'community' && (
                                        <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    ğŸ¤ <strong>ìµëª… ë¼ì´í”„ìŠ¤íƒ€ì¼ ì»¤ë®¤ë‹ˆí‹°</strong>ì—ì„œ<br/>
                                                    ë¹„ìŠ·í•œ ìì‚°ê³¼ ë‚˜ì´ëŒ€({formData.age}ì„¸)ì˜ ì‚¬ëŒë“¤ê³¼ ì†”ì§í•œ ê²½í—˜ì„ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ì‹¤ì œë¡œ ì´ ëˆìœ¼ë¡œ ì‚´ ìˆ˜ ìˆë‚˜ìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ìš©ë“¤ì€ ë­ê°€ ìˆë‚˜ìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ì–´ë–¤ ì„œë¹„ìŠ¤ë“¤ì„ ì‹¤ì œë¡œ ì´ìš©í•˜ì‹œë‚˜ìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ì€í‡´ ìƒí™œì˜ í˜„ì‹¤ì ì¸ íŒë“¤"</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-green-100 p-3 rounded-lg mb-4 text-center">
                                                <p className="text-green-800 font-semibold">
                                                    âœ¨ <strong>ê¸ˆìœµìƒí’ˆ íŒë§¤ëŠ” ì¼ì²´ ì—†ìŠµë‹ˆë‹¤</strong> âœ¨
                                                </p>
                                                <p className="text-green-700 text-sm">ìˆœìˆ˜ ë¼ì´í”„ìŠ¤íƒ€ì¼ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤</p>
                                            </div>
                                            
                                            <button
                                                onClick={joinCommunity}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                ğŸ¤ ìµëª… ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬í•˜ê¸°
                                            </button>
                                        </div>
                                    )}

                                    {/* ì „ë¬¸ê°€ ì°¾ê¸° íƒ­ */}
                                    {activeTab === 'expert' && (
                                        <ExpertFinderComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                                    )}
                                </div>
                            )}

                            <div className="card mb-6">
                                <h3 className="text-xl font-bold mb-4">ğŸ’° ìˆ˜ì… êµ¬ì„±</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span>ìì‚°ì„ í™œìš©í•œ ìƒí™œë¹„:</span>
                                        <div className="flex items-center gap-2">
                                            <span className="font-bold">{formatResultAmount(calculatorResult.monthlyAmount)}/ì›”</span>
                                            <button
                                                onClick={() => setShowAssetDetail(!showAssetDetail)}
                                                className="text-white text-sm px-3 py-2 bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors font-semibold shadow-md animate-pulse"
                                            >
                                                {showAssetDetail ? 'ğŸ“Š ê³„ì‚°ê³¼ì • ìˆ¨ê¸°ê¸°' : 'ğŸ“Š ê³„ì‚°ê³¼ì • ë³´ê¸°'}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {!showAssetDetail && (
                                        <div className="text-center mt-2">
                                            <p className="text-xs text-blue-600">ğŸ’¡ ê³„ì‚°ê³¼ì •ì„ ë³´ì‹œë©´ ìì‚° ë¶„ë¥˜ì™€ ì£¼íƒ ë§¤ê° ì˜µì…˜ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                        </div>
                                    )}

                                    {/* ìì‚° ê³„ì‚° ìƒì„¸ ì„¤ëª… */}
                                    {showAssetDetail && (
                                        <div className="bg-blue-50 p-4 rounded-lg mt-3 space-y-3 text-sm">
                                            <div className="font-semibold text-blue-800 mb-2">ğŸ“Š ê³„ì‚° ê³¼ì •</div>
                                            
                                            <div className="space-y-3">
                                                <div className="bg-white p-3 rounded-lg">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <span className="font-medium">â€¢ ìˆœ ìì‚°:</span>
                                                        <span className="font-bold">{formatResultAmount(calculatorResult.assetBreakdown?.totalAssets || 0)}</span>
                                                    </div>
                                                    <p className="text-xs text-gray-600 mb-3">ì…ë ¥í•˜ì‹  ëª¨ë“  ìì‚°ì„ ìƒí™œë¹„ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ìì‚°ê³¼ ì“¸ ìˆ˜ ì—†ëŠ” ìì‚°ìœ¼ë¡œ êµ¬ë¶„í–ˆìŠµë‹ˆë‹¤</p>
                                                    
                                                    {/* ìì‚° êµ¬ë¶„ í…Œì´ë¸” */}
                                                    <div className="grid grid-cols-2 gap-3 text-xs">
                                                        {/* ëˆì´ ë‚˜ì˜¤ëŠ” ìì‚° */}
                                                        <div className="bg-green-50 p-2 rounded border border-green-200">
                                                            <div className="font-semibold text-green-800 mb-2">ğŸ’° ìƒí™œë¹„ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ìì‚°</div>
                                                            <div className="space-y-1 text-green-700">
                                                                {parseInt(formData.financialAssets) > 0 && <div>â€¢ í˜„ê¸ˆì„± ìì‚°: {formatResultAmount(parseInt(formData.financialAssets) * 10000)}</div>}
                                                                {parseInt(formData.severancePay) > 0 && <div>â€¢ í‡´ì§ê¸ˆ: {formatResultAmount(parseInt(formData.severancePay) * 10000)}</div>}
                                                                {formData.homeValue && parseInt(formData.homeValue) > 0 && enableDownsizing && (
                                                                    <div>â€¢ ì£¼íƒ (ë§¤ê°): {formatResultAmount(calculatorResult.assetBreakdown?.realizedHousingAsset || 0)}</div>
                                                                )}
                                                                {parseInt(formData.housingPension) > 0 && (
                                                                    <div>â€¢ ì£¼íƒ (ì£¼íƒì—°ê¸ˆ): {formatResultAmount(parseInt(formData.homeValue) * 10000)}</div>
                                                                )}
                                                                {formData.jeonseDeposit && parseInt(formData.jeonseDeposit) > 0 && <div>â€¢ ì „ì„¸ë³´ì¦ê¸ˆ: {formatResultAmount(parseInt(formData.jeonseDeposit) * 10000)}</div>}
                                                                {formData.monthlyDeposit && parseInt(formData.monthlyDeposit) > 0 && <div>â€¢ ì›”ì„¸ë³´ì¦ê¸ˆ: {formatResultAmount(parseInt(formData.monthlyDeposit) * 10000)}</div>}
                                                            </div>
                                                        </div>
                                                        
                                                        {/* ëˆì´ ë‚˜ì˜¤ì§€ ì•ŠëŠ” ìì‚° */}
                                                        <div className="bg-gray-50 p-2 rounded border border-gray-200">
                                                            <div className="font-semibold text-gray-800 mb-2">ğŸ  ìƒí™œë¹„ë¡œ ì“¸ ìˆ˜ ì—†ëŠ” ìì‚°</div>
                                                            <div className="space-y-1 text-gray-600">
                                                                {formData.homeValue && parseInt(formData.homeValue) > 0 && !enableDownsizing && !parseInt(formData.housingPension) && (
                                                                    <div>â€¢ {formData.housingType === 'owned_living' ? 'ê±°ì£¼ìš©' : 'ì„ëŒ€ìš©'} ì£¼íƒ: {formatResultAmount(parseInt(formData.homeValue) * 10000)}</div>
                                                                )}
                                                                {formData.investmentRealEstate && parseInt(formData.investmentRealEstate) > 0 && (
                                                                    <div>â€¢ ìˆ˜ìµí˜• ë¶€ë™ì‚°: {formatResultAmount(parseInt(formData.investmentRealEstate) * 10000)}</div>
                                                                )}
                                                                {formData.currentDeposit && parseInt(formData.currentDeposit) > 0 && <div>â€¢ ê±°ì£¼ì§€ ë³´ì¦ê¸ˆ: {formatResultAmount(parseInt(formData.currentDeposit) * 10000)}</div>}
                                                                {formData.inheritance && parseInt(formData.inheritance) > 0 && <div>â€¢ ì¦ì—¬/ìƒì† ì˜ˆì •: {formatResultAmount(parseInt(formData.inheritance) * 10000)}</div>}
                                                                {(!formData.homeValue || parseInt(formData.homeValue) === 0 || 
                                                                  (formData.housingType === 'owned_living' && (enableDownsizing || parseInt(formData.housingPension))) ||
                                                                  (formData.housingType === 'owned_renting' && enableDownsizing)) && 
                                                                 (!formData.inheritance || parseInt(formData.inheritance) === 0) &&
                                                                 (!formData.currentDeposit || parseInt(formData.currentDeposit) === 0) && (
                                                                    <div className="text-gray-400 italic">í•´ë‹¹ ì—†ìŒ</div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* ë¶€ì±„ ì°¨ê° */}
                                                    {((formData.debt && parseInt(formData.debt) > 0) || (formData.homeMortgage && parseInt(formData.homeMortgage) > 0) || (formData.investmentLoan && parseInt(formData.investmentLoan) > 0) || (formData.depositLoan && parseInt(formData.depositLoan) > 0) || (formData.ownedHouseDeposit && parseInt(formData.ownedHouseDeposit) > 0)) && (
                                                        <div className="mt-3 p-2 bg-red-50 rounded border border-red-200">
                                                            <div className="font-semibold text-red-800 mb-1 text-xs">ğŸ’³ ë¶€ì±„ ì°¨ê°</div>
                                                            <div className="space-y-1 text-xs text-red-700">
                                                                {formData.debt && parseInt(formData.debt) > 0 && <div>â€¢ ê¸°íƒ€ ëŒ€ì¶œ: -{formatResultAmount(parseInt(formData.debt) * 10000)}</div>}
                                                                {formData.homeMortgage && parseInt(formData.homeMortgage) > 0 && <div>â€¢ ì£¼íƒëŒ€ì¶œ: -{formatResultAmount(parseInt(formData.homeMortgage) * 10000)}</div>}
                                                                {formData.investmentLoan && parseInt(formData.investmentLoan) > 0 && <div>â€¢ íˆ¬ìëŒ€ì¶œ: -{formatResultAmount(parseInt(formData.investmentLoan) * 10000)}</div>}
                                                                {formData.depositLoan && parseInt(formData.depositLoan) > 0 && <div>â€¢ ë³´ì¦ê¸ˆ ëŒ€ì¶œ: -{formatResultAmount(parseInt(formData.depositLoan) * 10000)}</div>}
                                                                {formData.ownedHouseDeposit && parseInt(formData.ownedHouseDeposit) > 0 && <div>â€¢ ì„ì°¨ì¸ ë³´ì¦ê¸ˆ: -{formatResultAmount(parseInt(formData.ownedHouseDeposit) * 10000)}</div>}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>

                                                {/* ì£¼íƒ ë§¤ê° ì˜µì…˜ */}
                                                {(formData.housingType === 'owned_living' || formData.housingType === 'owned_renting') && !parseInt(formData.housingPension) && (
                                                    <div className="bg-orange-50 p-3 rounded-lg border-l-4 border-orange-300 mt-3">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <span className="text-sm font-medium text-orange-800">ğŸ  ì£¼íƒ ë§¤ê° ì˜µì…˜</span>
                                                            <label className="flex items-center gap-2 cursor-pointer">
                                                                <input 
                                                                    type="checkbox" 
                                                                    checked={enableDownsizing}
                                                                    onChange={(e) => setEnableDownsizing(e.target.checked)}
                                                                    className="w-4 h-4 text-orange-600 rounded focus:ring-orange-500"
                                                                />
                                                                <span className="text-sm font-medium text-orange-800">ë§¤ê°í–ˆì„ ë•Œ ìƒí™œë¹„ ê³„ì‚°í•˜ê¸°</span>
                                                            </label>
                                                        </div>
                                                        <div className="text-xs text-orange-600">
                                                            ì£¼íƒì„ ë§¤ê°í•˜ë©´ ë” ë§ì€ ì€í‡´ìƒí™œë¹„ë¥¼ í™•ë³´í•  ìˆ˜ ìˆì–´ìš”.
                                                        </div>
                                                    </div>
                                                )}

                                                <div className="bg-white p-3 rounded-lg">
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="font-medium">â€¢ ë¹„ìƒìê¸ˆ ì œì™¸:</span>
                                                        <span className="font-bold text-red-600">-{formatResultAmount(calculatorResult.assetBreakdown?.emergencyFund || 0)}</span>
                                                    </div>
                                                    <p className="text-xs text-gray-600">ì˜ˆìƒì¹˜ ëª»í•œ ì˜ë£Œë¹„ ë“±ì„ ìœ„í•´ í˜„ê¸ˆì„± ìì‚°ì˜ 10%ë¥¼ ë¹„ìƒìê¸ˆìœ¼ë¡œ ë³´ì¡´í•©ë‹ˆë‹¤</p>
                                                </div>

                                                <div className="bg-white p-3 rounded-lg">
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="font-medium">â€¢ ìƒí™œë¹„ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ìì‚°:</span>
                                                        <span className="font-bold text-green-600">{formatResultAmount(calculatorResult.assetBreakdown?.availableAssets || 0)}</span>
                                                    </div>
                                                    <p className="text-xs text-gray-600">ë¹„ìƒìê¸ˆê¹Œì§€ ì°¨ê°í•˜ê³  ê¸°ëŒ€ìˆ˜ëª…ê¹Œì§€ ì†Œë¹„í•  ìˆ˜ ìˆëŠ” ìì‚°ì…ë‹ˆë‹¤</p>
                                                </div>

                                                <div className="bg-white p-3 rounded-lg">
                                                    <div className="flex justify-between items-center mb-1">
                                                        <span className="font-medium">â€¢ ì†Œë¹„ ì˜ˆìƒ ê¸°ê°„:</span>
                                                        <span className="font-bold text-blue-600">{calculatorResult.yearsToLive || 0}ë…„</span>
                                                    </div>
                                                    <p className="text-xs text-gray-600">í˜„ì¬ ë‚˜ì´ë¶€í„° ê¸°ëŒ€ìˆ˜ëª…ê¹Œì§€ ìì‚°ì„ ì†Œë¹„í•˜ëŠ” ê¸°ê°„ì…ë‹ˆë‹¤</p>
                                                </div>

                                                <div className="bg-blue-100 p-3 rounded-lg border-t-2 border-blue-300">
                                                    <div className="text-center font-bold text-green-600 text-lg">
                                                        ì†Œë¹„ ê°€ëŠ¥í•œ ìì‚°ì€ ì—°ê°„ {formatResultAmount(calculatorResult.monthlyAmount * 12)}, ì›”ê°„ {formatResultAmount(calculatorResult.monthlyAmount)} ì…ë‹ˆë‹¤.
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="text-xs text-blue-700 mt-3 p-3 bg-blue-100 rounded border-l-4 border-blue-400">
                                                ğŸ’¡ <strong>ê³„ì‚° ê³µì‹:</strong> ìƒí™œë¹„ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ìì‚° Ã· ì†Œë¹„ì˜ˆìƒê¸°ê°„ Ã· 12ê°œì›” = ì›” ì‚¬ìš© ê°€ëŠ¥ ê¸ˆì•¡<br/>
                                                <div className="mt-2 p-2 bg-yellow-50 rounded border border-yellow-200">
                                                    <strong>âš ï¸ ì¤‘ìš”:</strong> ì´ ê³„ì‚°ì€ <strong>{lifeExpectancy}ì„¸ê¹Œì§€</strong> ìì‚°ì„ ì†Œë¹„í•œë‹¤ê³  ê°€ì •í•˜ê³  ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.(íˆ¬ììˆ˜ìµë¥ ì„ ë°°ì œ)
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {calculatorResult.monthlyPension > 0 && (
                                        <div className="flex justify-between text-green-700">
                                            <span>+ ì—°ê¸ˆ ìˆ˜ì…:</span>
                                            <span className="font-bold">+{formatResultAmount(calculatorResult.monthlyPension)}/ì›”</span>
                                        </div>
                                    )}
                                    {calculatorResult.monthlyOtherIncome > 0 && (
                                        <div className="flex justify-between text-green-700">
                                            <span>+ ê¸°íƒ€ ì›” ìˆ˜ì…:</span>
                                            <span className="font-bold">+{formatResultAmount(calculatorResult.monthlyOtherIncome)}/ì›”</span>
                                        </div>
                                    )}
                                    {calculatorResult.monthlyHousingCost > 0 && (
                                        <div className="flex justify-between text-red-700">
                                            <span>- ì›”ì„¸ ì§€ì¶œ:</span>
                                            <span className="font-bold">-{formatResultAmount(calculatorResult.monthlyHousingCost)}/ì›”</span>
                                        </div>
                                    )}
                                    {calculatorResult.monthlyLoanInterest > 0 && (
                                        <div className="flex justify-between text-red-700">
                                            <span>- ì›” ëŒ€ì¶œ ì´ì:</span>
                                            <span className="font-bold">-{formatResultAmount(calculatorResult.monthlyLoanInterest)}/ì›”</span>
                                        </div>
                                    )}
                                    {calculatorResult.monthlyPropertyTax > 0 && (
                                        <div className="flex justify-between text-red-700">
                                            <span>- ì›” ì¬ì‚°ì„¸:</span>
                                            <span className="font-bold">-{formatResultAmount(calculatorResult.monthlyPropertyTax)}/ì›”</span>
                                        </div>
                                    )}
                                    <div className="flex justify-between font-bold pt-2 border-t border-blue-200 text-lg">
                                        <span>ì›”ê°„ ì´ ì€í‡´ìƒí™œë¹„:</span>
                                        <span className="text-blue-600">{formatResultAmount(calculatorResult.totalMonthlyAvailable)}/ì›”</span>
                                    </div>
                                </div>
                            </div>


                            <div className="text-center space-y-3">
                                <button
                                    onClick={() => goToNextStep(1)}
                                    className="text-gray-500 underline hover:text-gray-700"
                                >
                                    ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°
                                </button>
                            </div>

                            {/* ì§€ì¶œë‚´ì—­ ì…ë ¥ ëª¨ë‹¬ */}
                            {showExpenseModal && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 pt-8">
                                    <div className="bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto relative">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-2xl font-bold text-center flex-1">ğŸ“Š ì›” ì§€ì¶œë‚´ì—­ ì…ë ¥</h3>
                                            <button
                                                onClick={closeExpenseModal}
                                                className="text-gray-500 hover:text-gray-700 text-2xl font-bold ml-4"
                                            >
                                                Ã—
                                            </button>
                                        </div>
                                        <div className="space-y-6">
                                            <ExpenseInput
                                                label="ğŸ½ï¸ ì‹ë¹„"
                                                field="food"
                                                value={expenseData.food}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸ“± í†µì‹ ë¹„"
                                                field="communication"
                                                value={expenseData.communication}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸ’¡ ê³µê³¼ê¸ˆ"
                                                field="utilities"
                                                value={expenseData.utilities}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸ¥ ì˜ë£Œë¹„"
                                                field="medical"
                                                value={expenseData.medical}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸ¯ ì·¨ë¯¸Â·ì—¬ê°€ë¹„"
                                                field="hobby"
                                                value={expenseData.hobby}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸš— ì°¨ëŸ‰ìœ ì§€ë¹„ (ê¸°ë¦„ê°’ ë“±)"
                                                field="vehicle"
                                                value={expenseData.vehicle}
                                                placeholder=""
                                            />
                                            <ExpenseInput
                                                label="ğŸ“¦ ê¸°íƒ€"
                                                field="etc"
                                                value={expenseData.etc}
                                                placeholder=""
                                            />
                                        </div>
                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={closeExpenseModal}
                                                className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
                                            >
                                                ì·¨ì†Œ
                                            </button>
                                            <button
                                                onClick={submitExpenseData}
                                                className="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                            >
                                                ì €ì¥
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* ì§€ì¶œë‚´ì—­ ë¹„êµ ê²°ê³¼ ëª¨ë‹¬ */}
                            {showComparisonModal && expenseComparison && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-90vh overflow-y-auto relative">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-2xl font-bold text-center flex-1">ğŸ“Š ì§€ì¶œ íŒ¨í„´ ë¹„êµ ê²°ê³¼</h3>
                                            <button
                                                onClick={() => setShowComparisonModal(false)}
                                                className="text-gray-500 hover:text-gray-700 text-2xl font-bold ml-4"
                                            >
                                                Ã—
                                            </button>
                                        </div>
                                        
                                        {/* ì „ì²´ ë¹„êµ */}
                                        <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-6">
                                            <div className="grid grid-cols-2 gap-4 text-center">
                                                <div>
                                                    <p className="text-sm text-gray-600 mb-1">ë‚´ ì§€ì¶œ ì´ì•¡</p>
                                                    <p className="text-2xl font-bold text-blue-600">{expenseComparison.userTotal.toLocaleString()}ë§Œì›</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-600 mb-1">í†µê³„ì²­ í‰ê·  (2024ë…„)</p>
                                                    <p className="text-2xl font-bold text-purple-600">{expenseComparison.statTotal.toLocaleString()}ë§Œì›</p>
                                                </div>
                                            </div>
                                            
                                            <div className="text-center mt-4">
                                                {expenseComparison.userTotal > expenseComparison.statTotal ? (
                                                    <p className="text-red-600 font-semibold">
                                                        ğŸ“ˆ í‰ê· ë³´ë‹¤ {(expenseComparison.userTotal - expenseComparison.statTotal).toLocaleString()}ë§Œì› ë” ì§€ì¶œ
                                                    </p>
                                                ) : expenseComparison.userTotal < expenseComparison.statTotal ? (
                                                    <p className="text-green-600 font-semibold">
                                                        ğŸ“‰ í‰ê· ë³´ë‹¤ {(expenseComparison.statTotal - expenseComparison.userTotal).toLocaleString()}ë§Œì› ì ˆì•½
                                                    </p>
                                                ) : (
                                                    <p className="text-gray-600 font-semibold">
                                                        âœ… í‰ê· ê³¼ ë™ì¼í•œ ìˆ˜ì¤€
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {/* í•­ëª©ë³„ ë¹„êµ */}
                                        <div className="space-y-3">
                                            <h4 className="text-lg font-bold mb-3">í•­ëª©ë³„ ìƒì„¸ ë¹„êµ</h4>
                                            
                                            {Object.entries({
                                                food: 'ğŸ½ï¸ ì‹ë¹„',
                                                communication: 'ğŸ“± í†µì‹ ë¹„', 
                                                utilities: 'ğŸ’¡ ê³µê³¼ê¸ˆ',
                                                medical: 'ğŸ¥ ì˜ë£Œë¹„',
                                                hobby: 'ğŸ¯ ì·¨ë¯¸Â·ì—¬ê°€ë¹„',
                                                vehicle: 'ğŸš— ì°¨ëŸ‰ìœ ì§€ë¹„',
                                                etc: 'ğŸ“¦ ê¸°íƒ€'
                                            }).map(([key, label]) => {
                                                const userAmount = parseInt(expenseComparison.user[key]) || 0;
                                                const statAmount = expenseComparison.stat[key];
                                                const difference = userAmount - statAmount;
                                                const percentage = statAmount > 0 ? Math.round((difference / statAmount) * 100) : 0;
                                                
                                                return (
                                                    <div key={key} className="border rounded-lg p-4">
                                                        <div className="flex justify-between items-center mb-2">
                                                            <span className="font-semibold">{label}</span>
                                                            <span className={`text-sm font-bold ${
                                                                difference > 0 ? 'text-red-600' : 
                                                                difference < 0 ? 'text-green-600' : 'text-gray-600'
                                                            }`}>
                                                                {difference > 0 ? `+${difference}ë§Œì›` : 
                                                                 difference < 0 ? `${difference}ë§Œì›` : 'Â±0ë§Œì›'}
                                                                {percentage !== 0 && ` (${percentage > 0 ? '+' : ''}${percentage}%)`}
                                                            </span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span>ë‚´ ì§€ì¶œ: <strong>{userAmount.toLocaleString()}ë§Œì›</strong></span>
                                                            <span>í‰ê· : <strong>{statAmount.toLocaleString()}ë§Œì›</strong></span>
                                                        </div>
                                                        
                                                        {/* ë¹„êµ ë°” */}
                                                        <div className="mt-2 bg-gray-200 rounded-full h-2 relative">
                                                            <div 
                                                                className="bg-purple-400 h-2 rounded-full" 
                                                                style={{width: `${Math.min(100, (statAmount / Math.max(userAmount, statAmount)) * 100)}%`}}
                                                            ></div>
                                                            <div 
                                                                className="bg-blue-500 h-2 rounded-full absolute top-0" 
                                                                style={{width: `${Math.min(100, (userAmount / Math.max(userAmount, statAmount)) * 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        
                                        <div className="text-xs text-gray-500 mt-4 p-3 bg-gray-50 rounded">
                                            ğŸ“Š ê¸°ì¤€: í†µê³„ì²­ 2024ë…„ ê°€ê³„ë™í–¥ì¡°ì‚¬ (ì „êµ­ í‰ê· )
                                        </div>
                                        
                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={() => setShowComparisonModal(false)}
                                                className="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600"
                                            >
                                                í™•ì¸
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                        </div>
                    </div>
                );
            }

            return <div>ì˜ëª»ëœ ë‹¨ê³„ì…ë‹ˆë‹¤.</div>;
        };

        // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì ê´€ë¦¬
        const createGuestUser = () => {
            const guestId = crypto.randomUUID();
            const guestNickname = authManager.nicknameGen.generate();
            const guestUser = {
                id: guestId,
                email: null,
                nickname: guestNickname,
                isGuest: true,
                createdAt: new Date().toISOString()
            };
            localStorage.setItem('planb_guest_user', JSON.stringify(guestUser));
            return guestUser;
        };

        // ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
        const PlanBApp = () => {
            const [currentView, setCurrentView] = useState('login'); // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì‹œì‘
            const [selectedPost, setSelectedPost] = useState(null); // ì„ íƒëœ ê²Œì‹œê¸€ ìƒíƒœ
            const [savedCalculations, setSavedCalculations] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isGuest, setIsGuest] = useState(false);
            const [authMode, setAuthMode] = useState('login'); // 'login' ë˜ëŠ” 'signup'
            const [showAuthForm, setShowAuthForm] = useState(false); // ì›°ì»´ í˜ì´ì§€ì—ì„œ í¼ í‘œì‹œ ì—¬ë¶€
            const [showGuestConfirmModal, setShowGuestConfirmModal] = useState(false);
            const [showCommunityAccessModal, setShowCommunityAccessModal] = useState(false);
            const [showCalculationRequiredModal, setShowCalculationRequiredModal] = useState(false);
            const [showNotificationModal, setShowNotificationModal] = useState(false);
            const [notificationContent, setNotificationContent] = useState({ title: '', message: '', type: 'info' });
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [showSignupModal, setShowSignupModal] = useState(false);
            const [showSaveResultSignupModal, setShowSaveResultSignupModal] = useState(false);
            const [lastActivity, setLastActivity] = useState(Date.now());

            // ì™¸ë¶€ í´ë¦­ì‹œ ë©”ë‰´ ë‹«ê¸°
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showMobileMenu && !event.target.closest('nav')) {
                        setShowMobileMenu(false);
                    }
                };
                
                document.addEventListener('click', handleClickOutside);
                return () => document.removeEventListener('click', handleClickOutside);
            }, [showMobileMenu]);

            // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ê´€ë¦¬
            useEffect(() => {
                const SESSION_TIMEOUT = 30 * 60 * 1000; // 30ë¶„

                const updateActivity = () => {
                    setLastActivity(Date.now());
                };

                const checkInactivity = () => {
                    if (currentUser && !isGuest && (Date.now() - lastActivity > SESSION_TIMEOUT)) {
                        handleLogout();
                        showNotification('ì„¸ì…˜ ë§Œë£Œ', 'ë³´ì•ˆì„ ìœ„í•´ 30ë¶„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'warning');
                    }
                };

                // ì‚¬ìš©ì í™œë™ ê°ì§€ ì´ë²¤íŠ¸
                const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                events.forEach(event => {
                    document.addEventListener(event, updateActivity, true);
                });

                // 5ë¶„ë§ˆë‹¤ ë¹„í™œì„± ì‹œê°„ ì²´í¬
                const inactivityTimer = setInterval(checkInactivity, 5 * 60 * 1000);

                return () => {
                    events.forEach(event => {
                        document.removeEventListener(event, updateActivity, true);
                    });
                    clearInterval(inactivityTimer);
                };
            }, [currentUser, isGuest, lastActivity]);
            
            // í†µí•© ì•Œë¦¼ ëª¨ë‹¬ í•¨ìˆ˜
            const showNotification = (title, message, type = 'info') => {
                setNotificationContent({ title, message, type });
                setShowNotificationModal(true);
            };

            // ì…ë ¥ê°’ ê²€ì¦ í•¨ìˆ˜ë“¤
            const validateUserInput = {
                email: (input) => {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return emailRegex.test(input) && input.length <= 100;
                },
                phone: (input) => {
                    const phoneRegex = /^010-\d{4}-\d{4}$/;
                    return phoneRegex.test(input);
                },
                businessNumber: (input) => {
                    const businessRegex = /^\d{3}-\d{2}-\d{5}$/;
                    return businessRegex.test(input);
                },
                name: (input) => {
                    return input && input.length >= 2 && input.length <= 20 && 
                           /^[ê°€-í£a-zA-Z\s]+$/.test(input);
                },
                password: (input) => {
                    return input && input.length >= 8 && input.length <= 100 &&
                           /^(?=.*[a-zA-Z])(?=.*[0-9])|(?=.*[a-zA-Z])(?=.*[!@#$%^&*])|(?=.*[0-9])(?=.*[!@#$%^&*])/.test(input);
                },
                text: (input, maxLength = 1000) => {
                    return input && input.length > 0 && input.length <= maxLength &&
                           !/[<>'"&]/.test(input); // XSS ë°©ì§€
                }
            };
            
            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
            useEffect(() => {
                initializeApp();
            }, []);

            const initializeApp = async () => {
                try {
                    // ê²ŒìŠ¤íŠ¸ ë°ì´í„° ì´ˆê¸°í™” (ì¼íšŒì„± ì‚¬ìš©)
                    localStorage.removeItem('planb_guest_user');
                    localStorage.removeItem('planb_calculation_result');
                    
                    // ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒí–ˆëŠ”ì§€ í™•ì¸
                    const userLoggedOut = localStorage.getItem('planb_user_logged_out');
                    if (userLoggedOut === 'true') {
                        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì´ë¯€ë¡œ ìë™ ë¡œê·¸ì¸ ê±´ë„ˆë›°ê¸°
                        console.log('ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•œ ìƒíƒœì…ë‹ˆë‹¤');
                        return;
                    }
                    
                    // í˜„ì¬ ì‚¬ìš©ì í™•ì¸ (íšŒì›ë§Œ)
                    const user = await authManager.getCurrentUser();
                    if (user) {
                        setCurrentUser(user);
                        setIsAuthenticated(true);
                        setCurrentView('main');
                        const isAdmin = isAdminUser(user);
                        console.log(`ìë™ ë¡œê·¸ì¸ ì™„ë£Œ${isAdmin ? ' (ê´€ë¦¬ì)' : ' (ì¼ë°˜ ì‚¬ìš©ì)'}`);
                        
                        // ê¸°ì¡´ ê³„ì‚° ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
                        loadSavedCalculations();
                    }
                    // ê²ŒìŠ¤íŠ¸ëŠ” í•­ìƒ welcome í™”ë©´ë¶€í„° ì‹œì‘
                } catch (error) {
                    console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                }
            };
            
            // ì¸ì¦ ì„±ê³µ í•¸ë“¤ëŸ¬
            const handleAuthSuccess = async (user) => {
                // ë¡œê·¸ì¸ ì„±ê³µì‹œ ë¡œê·¸ì•„ì›ƒ í”Œë˜ê·¸ ì œê±°
                localStorage.removeItem('planb_user_logged_out');
                
                // ê¸°ì¡´ ê²ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìˆë‹¤ë©´ íšŒì› ê³„ì •ìœ¼ë¡œ ì´ê´€
                const guestCalculation = localStorage.getItem('planb_calculation_result');
                
                setCurrentUser(user);
                setIsAuthenticated(true);
                setIsGuest(false);
                setCurrentView('main');
                
                const isAdmin = isAdminUser(user);
                console.log(`ë¡œê·¸ì¸ ì„±ê³µ${isAdmin ? ' (ê´€ë¦¬ì)' : ' (ì¼ë°˜ ì‚¬ìš©ì)'}`);
                loadSavedCalculations();
                
                // ê²ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
                localStorage.removeItem('planb_guest_user');
                
                // ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ê°€ ìˆì—ˆë‹¤ë©´ ì‹¤ì œë¡œ DBì— ì €ì¥
                if (guestCalculation) {
                    try {
                        const calculationData = JSON.parse(guestCalculation);
                        
                        // Supabaseì— ì‹¤ì œ ì €ì¥
                        if (supabase) {
                            const { error } = await supabase
                                .from('user_calculations')
                                .upsert({
                                    user_id: user.id,
                                    user_hash: null, // íšŒì›ì€ user_hash ë¶ˆí•„ìš”
                                    age: calculationData.formData?.age,
                                    age_group: calculationData.formData?.ageGroup,
                                    health_status: calculationData.formData?.health,
                                    life_mode: calculationData.formData?.lifeMode,
                                    housing_type: calculationData.formData?.housingType,
                                    housing_value: calculationData.formData?.homeValue ? parseInt(calculationData.formData.homeValue) * 10000 : 0,
                                    financial_assets: calculationData.formData?.financialAssets ? parseInt(calculationData.formData.financialAssets) * 10000 : 0,
                                    severance_pay: calculationData.formData?.severancePay ? parseInt(calculationData.formData.severancePay) * 10000 : 0,
                                    debt: calculationData.formData?.debt ? parseInt(calculationData.formData.debt) * 10000 : 0,
                                    national_pension: calculationData.formData?.nationalPension ? parseInt(calculationData.formData.nationalPension) * 10000 : 0,
                                    private_pension: calculationData.formData?.privatePension ? parseInt(calculationData.formData.privatePension) * 10000 : 0,
                                    calculation_result: calculationData,
                                    updated_at: new Date().toISOString()
                                });
                            
                            if (error) {
                                console.error('ê³„ì‚° ê²°ê³¼ DB ì €ì¥ ì‹¤íŒ¨:', error);
                            } else {
                                console.log('ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ DB ì €ì¥ ì„±ê³µ');
                            }
                        }
                        
                        setTimeout(() => {
                            showNotification(
                                'íšŒì›ê°€ì… ì™„ë£Œ!', 
                                'ê³„ì‚° ê²°ê³¼ê°€ íšŒì› ê³„ì •ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì–¸ì œë“  ë‹¤ì‹œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš” ğŸ’¾', 
                                'success'
                            );
                        }, 1000);
                        
                    } catch (error) {
                        console.error('ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                        setTimeout(() => {
                            showNotification(
                                'íšŒì›ê°€ì… ì™„ë£Œ!', 
                                'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì‚° ê²°ê³¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ ì–¸ì œë“  ë‹¤ì‹œ ê³„ì‚°í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.', 
                                'success'
                            );
                        }, 1000);
                    }
                }
            };
            
            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹œì‘ í•¸ë“¤ëŸ¬
            const handleGuestStart = () => {
                setShowGuestConfirmModal(true);
            };
            
            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ í™•ì¸ í›„ ì‹œì‘
            const confirmGuestStart = () => {
                const guestUser = createGuestUser();
                setCurrentUser(guestUser);
                setIsGuest(true);
                setCurrentView('main');
                setShowGuestConfirmModal(false);
                console.log(`ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹œì‘: ${guestUser.nickname}`);
            };
            
            
            // ë¡œê·¸ì•„ì›ƒ í•¸ë“¤ëŸ¬
            const handleLogout = async () => {
                if (isGuest) {
                    // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì¢…ë£Œ
                    localStorage.removeItem('planb_guest_user');
                    localStorage.removeItem('planb_calculation_result');
                    setCurrentUser(null);
                    setIsGuest(false);
                    setCurrentView('login');
                    setSavedCalculations([]);
                } else {
                    // íšŒì› ë¡œê·¸ì•„ì›ƒ
                    const result = await authManager.signOut();
                    if (result.success) {
                        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¥¼ localStorageì— ì €ì¥
                        localStorage.setItem('planb_user_logged_out', 'true');
                        
                        setCurrentUser(null);
                        setIsAuthenticated(false);
                        setCurrentView('login');
                        setSavedCalculations([]);
                        localStorage.removeItem('planb_calculation_result');
                        console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ - ìë™ ë¡œê·¸ì¸ ë¹„í™œì„±í™”');
                    }
                }
            };
            
            // ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
            const loadSavedCalculations = () => {
                const saved = localStorage.getItem('planb_calculation_result');
                if (saved) {
                    // ì €ì¥ëœ ê³„ì‚° ê²°ê³¼ê°€ ìˆìœ¼ë©´ ê³„ì‚°ê¸° í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì—¬ ê²°ê³¼ í‘œì‹œ
                    setSavedCalculations([JSON.parse(saved)]);
                }
                // ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ì–´ë„ ì •ìƒì ì¸ ìƒí™©ì´ë¯€ë¡œ alert ì œê±°
            };

            // ê³„ì‚° ì™„ë£Œì‹œ ê²°ê³¼ ì €ì¥ ë° ì»¤ë®¤ë‹ˆí‹° ì•ˆë‚´
            const handleCalculationComplete = async (calculationResult) => {
                try {
                    // ê³„ì‚° ê²°ê³¼ë¥¼ localStorageì™€ Supabaseì— ì €ì¥
                    localStorage.setItem('planb_calculation_result', JSON.stringify(calculationResult));
                    
                    if (currentUser) {
                        // íšŒì›ì¸ ê²½ìš° Supabaseì—ë„ ì €ì¥
                        const { error } = await supabase
                            .from('user_calculations')
                            .upsert({
                                user_id: currentUser.id,
                                calculation_data: calculationResult,
                                updated_at: new Date().toISOString()
                            });
                        
                        if (error) {
                            console.error('ê³„ì‚° ê²°ê³¼ ì €ì¥ ì˜¤ë¥˜:', error);
                        }
                    }
                    
                    // ê³„ì‚° ì™„ë£Œ - ë³„ë„ ì•ˆë‚´ ì—†ì´ ì¡°ìš©íˆ ì™„ë£Œ
                    
                } catch (error) {
                    console.error('ê³„ì‚° ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                }
            };

            // ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì²´í¬ (ëª¨ë“  ì‚¬ìš©ìê°€ ëª©ë¡ ë³´ê¸° ê°€ëŠ¥, ìƒí˜¸ì‘ìš©ë§Œ ì œí•œ)
            const handleCommunityAccess = () => {
                console.log('ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì‹œë„:', { isAuthenticated, isGuest, currentUser });
                
                // ê²ŒìŠ¤íŠ¸, íšŒì› ëª¨ë‘ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ë³´ê¸° í—ˆìš©
                // ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë§Œ ë¡œê·¸ì¸ ìœ ë„
                if (!isAuthenticated && !isGuest) {
                    console.log('ë¡œê·¸ì¸ í¼ í‘œì‹œ');
                    setAuthMode('login');
                    setCurrentView('login');
                    setShowAuthForm(true);
                    return;
                }
                
                console.log('ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ë¡œ ì´ë™');
                setCurrentView('community');
            };
            
            // ê´€ë¦¬ì ê³„ì • ëª©ë¡ (ê°œë°œì/í…ŒìŠ¤íŠ¸ ê³„ì •)
            const isAdminUser = (user) => {
                if (!user || !user.email) return false;
                const adminEmails = [
                    'jwpaparoy@gmail.com',  // ê°œë°œì ê³„ì •
                    'knwwhr@gmail.com'      // ê´€ë¦¬ì ê³„ì •
                ];
                return adminEmails.includes(user.email.toLowerCase());
            };

            // ì‚¬ìš©ì íƒ€ì… í™•ì¸ í•¨ìˆ˜ (async) - ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ 
            const getUserType = async (user) => {
                if (!user) return 'guest';
                
                // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì í™•ì¸
                if (user.isGuest) return 'guest';
                
                // ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œì„ ê°€ì§€ë¯€ë¡œ 'admin' ë°˜í™˜í•˜ì§€ë§Œ UIì—ì„œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥
                if (isAdminUser(user)) return 'admin';
                
                // Supabaseì—ì„œ expert_profiles í…Œì´ë¸” ì¡°íšŒí•˜ì—¬ ì „ë¬¸ê°€ ì—¬ë¶€ í™•ì¸
                try {
                    const { data: expertProfile, error } = await supabase
                        .from('financial_experts')
                        .select('id, verification_status')
                        .eq('email', user.email)
                        .single();
                    
                    if (expertProfile && expertProfile.verification_status === 'approved') {
                        return 'expert';
                    }
                } catch (error) {
                    // expert_profilesì— ì—†ìœ¼ë©´ ì¼ë°˜íšŒì›
                    console.log('Expert profile not found, user is regular member');
                }
                
                return 'member';
            };

            // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜ë“¤
            const hasAdminAccess = (user) => isAdminUser(user);
            const hasMemberAccess = (user) => user && (isAdminUser(user) || !isGuest);
            const hasExpertAccess = async (user) => {
                if (!user) return false;
                if (isAdminUser(user)) return true; // ê´€ë¦¬ìëŠ” ì „ë¬¸ê°€ ê¶Œí•œ í¬í•¨
                
                try {
                    const { data: expertProfile } = await supabase
                        .from('financial_experts')
                        .select('verification_status')
                        .eq('email', user.email)
                        .single();
                    return expertProfile?.verification_status === 'approved';
                } catch {
                    return false;
                }
            };

            // ì‚¬ìš©ì íƒ€ì…ë³„ í‘œì‹œ ì´ë¦„
            const getUserTypeName = (userType) => {
                switch(userType) {
                    case 'admin': return 'ê´€ë¦¬ì';
                    case 'expert': return 'ì „ë¬¸ê°€';
                    case 'member': return 'ì¼ë°˜íšŒì›';
                    default: return 'ê²ŒìŠ¤íŠ¸';
                }
            };

            // ì»¤ë®¤ë‹ˆí‹° ìƒí˜¸ì‘ìš© ì²´í¬ (ìƒì„¸ë³´ê¸°/ê¸€ì“°ê¸°)
            const checkCalculationForInteraction = (action) => {
                // ê²ŒìŠ¤íŠ¸ì¸ ê²½ìš° íšŒì›ê°€ì… ìœ ë„
                if (isGuest) {
                    setShowCommunityAccessModal(true);
                    return false;
                }
                
                // ê´€ë¦¬ì ê³„ì •ì¸ ê²½ìš° ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ í—ˆìš©
                if (isAdminUser(currentUser)) {
                    console.log('ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ í—ˆìš©:', currentUser.email);
                    return true;
                }
                
                // ì¼ë°˜ íšŒì›ì¸ ê²½ìš° ê³„ì‚° ì™„ë£Œ ì²´í¬
                const hasCalculation = localStorage.getItem('planb_calculation_result');
                if (!hasCalculation) {
                    setShowCalculationRequiredModal(true);
                    return false;
                }
                return true;
            };

            // ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° í•¸ë“¤ëŸ¬ (í”„ë¡œê·¸ë ˆì‹œë¸Œ ì ‘ê·¼)
            const handlePostClick = (post) => {
                // ê³„ì‚° ì™„ë£Œ ì—¬ë¶€ ì²´í¬
                if (!checkCalculationForInteraction('view_post')) {
                    return; // ëª¨ë‹¬ì´ í‘œì‹œë¨
                }
                
                // ê³„ì‚° ì™„ë£Œëœ ì‚¬ìš©ìë§Œ ìƒì„¸ë³´ê¸° ê°€ëŠ¥
                setSelectedPost(post);
                setCurrentView('post-detail');
            };


            // ë¡œê·¸ì¸ í™”ë©´ (ê¸°ë³¸ í™”ë©´)
            if (currentView === 'login') {
                return (
                    <AuthComponent 
                        onAuthSuccess={handleAuthSuccess} 
                        initialMode="login"
                        generateGuestUser={createGuestUser}
                    />
                );
            }


            // ë§ˆì´í˜ì´ì§€
            if (currentView === 'mypage') {
                return (
                    <MyPageComponent 
                        currentUser={currentUser}
                        onClose={() => setCurrentView('main')}
                        getUserType={getUserType}
                        getUserTypeName={getUserTypeName}
                        isAdminUser={isAdminUser}
                        isGuest={isGuest}
                    />
                );
            }
            

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
                    <nav className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                {/* ë¡œê³  */}
                                <div 
                                    className="text-xl font-bold text-blue-600 cursor-pointer"
                                    onClick={() => setCurrentView('main')}
                                >
                                    í”Œëœë¹„
                                </div>

                                {/* í–„ë²„ê±° ë²„íŠ¼ */}
                                <button
                                    onClick={() => setShowMobileMenu(!showMobileMenu)}
                                    className="p-2 rounded-md text-gray-600 hover:text-blue-600 hover:bg-gray-100 transition-colors"
                                >
                                    <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        {showMobileMenu ? (
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        ) : (
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                        )}
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        {/* ì‚¬ì´ë“œë°” ë©”ë‰´ */}
                        {showMobileMenu && (
                            <>
                                {/* ì‚¬ì´ë“œë°” ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
                                <div 
                                    className="fixed inset-0 bg-black bg-opacity-50 z-40"
                                    onClick={() => setShowMobileMenu(false)}
                                />
                                
                                {/* ì‚¬ì´ë“œë°” */}
                                <div className="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out">
                                    {/* ì‚¬ì´ë“œë°” í—¤ë” */}
                                    <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-blue-50">
                                        <div className="flex items-center space-x-2">
                                            <div className="text-xl font-bold text-blue-600">í”Œëœë¹„</div>
                                            <span className="text-xs text-gray-500">ë©”ë‰´</span>
                                        </div>
                                        <button
                                            onClick={() => setShowMobileMenu(false)}
                                            className="p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    {/* ì‚¬ì´ë“œë°” ì»¨í…ì¸  */}
                                    <div className="flex flex-col h-full">
                                        {/* ì‚¬ìš©ì ì •ë³´ ì˜ì—­ì„ ìƒë‹¨ìœ¼ë¡œ ì´ë™ */}
                                        <div className="border-b border-gray-200 p-4 bg-gray-50">
                                            {isGuest ? (
                                                <>
                                                    <div className="px-3 py-2 text-amber-600 font-medium flex items-center text-sm">
                                                        <span className="mr-2 text-base">ğŸŒŸ</span>
                                                        <div className="flex-1 min-w-0">
                                                            <span className="truncate">{currentUser?.nickname}</span>
                                                            <div className="text-xs text-amber-500">(ê²ŒìŠ¤íŠ¸ ëª¨ë“œ - ê³„ì‚°ê¸° ì „ìš©)</div>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2 mt-2">
                                                        <button
                                                            onClick={() => {
                                                                setAuthMode('signup');
                                                                setCurrentView('login');
                                                                setShowAuthForm(true);
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">âœ¨</span>
                                                            íšŒì›ê°€ì…
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                handleLogout();
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-red-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">ğŸšª</span>
                                                            ë‚˜ê°€ê¸°
                                                        </button>
                                                    </div>
                                                </>
                                            ) : currentUser ? (
                                                <>
                                                    <div className="px-3 py-2 text-gray-700 font-medium flex items-center text-sm">
                                                        <span className="mr-2 text-base">
                                                            {isAdminUser(currentUser) ? 'ğŸ‘‘' : 'ğŸ‘¤'}
                                                        </span>
                                                        <div className="flex-1 min-w-0">
                                                            <div className="truncate">{currentUser?.nickname || currentUser?.email}</div>
                                                            {isAdminUser(currentUser) && (
                                                                <span className="text-red-500 text-xs bg-red-100 px-1 py-0.5 rounded mt-1 inline-block">ìŠˆí¼ê´€ë¦¬ì</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2 mt-2">
                                                        <button
                                                            onClick={() => {
                                                                setCurrentView('mypage');
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-blue-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">âš™ï¸</span>
                                                            ë§ˆì´í˜ì´ì§€
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                handleLogout();
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-red-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">ğŸšª</span>
                                                            ë¡œê·¸ì•„ì›ƒ
                                                        </button>
                                                    </div>
                                                </>
                                            ) : (
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('login');
                                                        setCurrentView('login');
                                                        setShowAuthForm(true);
                                                        setShowMobileMenu(false);
                                                    }}
                                                    className="w-full px-3 py-2 rounded-md bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center justify-center text-sm"
                                                >
                                                    <span className="mr-2 text-base">ğŸ”‘</span>
                                                    ë¡œê·¸ì¸
                                                </button>
                                            )}
                                        </div>

                                        {/* ë©”ì¸ ë©”ë‰´ë“¤ */}
                                        <div className="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                                            {/* ê³„ì‚°ê¸°ëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê³µê°œ */}
                                            <button
                                                className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                    currentView === 'calculator' 
                                                        ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                        : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                }`}
                                                onClick={() => {
                                                    setCurrentView('calculator');
                                                    setShowMobileMenu(false);
                                                }}
                                            >
                                                <span className="mr-3 text-base">ğŸ§®</span>
                                                ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê¸°
                                            </button>
                                            
                                            {/* ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í‘œì‹œ */}
                                            {!isGuest && (
                                                <>
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'community' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            handleCommunityAccess();
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ’¬</span>
                                                        ì»¤ë®¤ë‹ˆí‹°
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'experts' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            setCurrentView('experts');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ”</span>
                                                        ì „ë¬¸ê°€ ì°¾ê¸°
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'announcements' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            setCurrentView('announcements');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ“¢</span>
                                                        ê³µì§€ì‚¬í•­
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'chat' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            // ì±„íŒ…ì€ íšŒì›ë§Œ ê°€ëŠ¥ 
                                                            if (!checkCalculationForInteraction('chat_access')) {
                                                                return;
                                                            }
                                                            setCurrentView('chat');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ’¬</span>
                                                        ì‹¤ì‹œê°„ ì±„íŒ…
                                                    </button>
                                                </>
                                            )}
                                            
                                            {/* ê²ŒìŠ¤íŠ¸ì—ê²Œë§Œ í‘œì‹œë˜ëŠ” ì•ˆë‚´ */}
                                            {isGuest && (
                                                <div className="px-3 py-4 border border-blue-200 rounded-lg bg-blue-50">
                                                    <div className="text-sm text-blue-600 mb-2 font-medium">ğŸŒŸ ê²ŒìŠ¤íŠ¸ ëª¨ë“œ</div>
                                                    <p className="text-xs text-blue-500 mb-3">í˜„ì¬ ê³„ì‚°ê¸°ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë” ë§ì€ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë ¤ë©´ íšŒì›ê°€ì…í•˜ì„¸ìš”!</p>
                                                    <div className="text-xs text-blue-400">
                                                        <div>â€¢ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬</div>
                                                        <div>â€¢ ì „ë¬¸ê°€ ìƒë‹´</div>
                                                        <div>â€¢ ê°œì¸ ë°ì´í„° ì €ì¥</div>
                                                        <div>â€¢ ê³„ì‚° ê¸°ë¡ ê´€ë¦¬</div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </nav>
                    
                    {/* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {currentView === 'main' && (
                            <div className="text-center">
                                <div className="mb-8">
                                    <h1 className="text-4xl font-bold text-gray-800 mb-4">
                                        í”Œëœë¹„
                                    </h1>
                                    <p className="text-xl text-gray-600 mb-2">
                                        í–‰ë³µí•œ ì€í‡´ìƒí™œì˜ ì‹œì‘
                                    </p>
                                    
                                    {/* ì‚¬ìš©ì í™˜ì˜ ë©”ì‹œì§€ */}
                                    {currentUser && (
                                        <div className="text-lg text-blue-700 font-medium mb-6">
                                            ì•ˆë…•í•˜ì„¸ìš”, {currentUser.nickname || currentUser.email.split('@')[0]}ë‹˜! ğŸ‘‹
                                            {isAdminUser(currentUser) && (
                                                <span className="ml-2 text-red-600 text-sm">
                                                    ğŸ‘‘ ìŠˆí¼ê´€ë¦¬ì
                                                </span>
                                            )}
                                        </div>
                                    )}
                                    
                                    {/* ë©”ì¸ í™”ë©´ ê³µì§€ì‚¬í•­ ë°°ë„ˆ */}
                                    <div 
                                        className="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-8 cursor-pointer hover:bg-blue-100 transition-colors max-w-2xl mx-auto"
                                        onClick={() => setCurrentView('announcements')}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3">
                                                <div className="text-blue-600">
                                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                                                    </svg>
                                                </div>
                                                <div className="flex-1">
                                                    <span className="text-sm font-medium text-blue-900">
                                                        ğŸ“¢ ìƒˆë¡œìš´ ì „ë¬¸ê°€ ë§¤ì¹­ ì„œë¹„ìŠ¤ ì˜¤í”ˆ! WebRTC ì˜ìƒí†µí™”ê¹Œì§€ ì§€ì› 
                                                    </span>
                                                </div>
                                            </div>
                                            <div className="text-blue-400">
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* ê¸°ëŠ¥ ì¹´ë“œë“¤ - í•µì‹¬ ì„œë¹„ìŠ¤ë§Œ í‘œì‹œ */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 max-w-4xl mx-auto">
                                    {/* 1. ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê¸° */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2" 
                                         onClick={() => setCurrentView('calculator')}>
                                        <div className="text-5xl mb-4">ğŸ§®</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            ì€í‡´ìƒí™œë¹„ ê³„ì‚°ê¸°
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ë‚´ ìì‚°ìœ¼ë¡œ í‰ìƒ ì–¼ë§ˆë‚˜ ì“¸ ìˆ˜ ìˆëŠ”ì§€<br/>
                                            ì •í™•íˆ ê³„ì‚°í•´ë³´ì„¸ìš”
                                        </p>
                                        <div className="text-blue-600 font-semibold text-sm">
                                            ğŸ’¡ ë¬´ë£Œ ê³„ì‚°ê¸°
                                        </div>
                                    </div>
                                    
                                    {/* 2. ì»¤ë®¤ë‹ˆí‹° */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2"
                                         onClick={handleCommunityAccess}>
                                        <div className="text-5xl mb-4">ğŸ‘¥</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            ì»¤ë®¤ë‹ˆí‹°
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ê°™ì€ ê³ ë¯¼ì„ ê°€ì§„ ë¶„ë“¤ê³¼<br/>
                                            ê²½í—˜ê³¼ ì •ë³´ë¥¼ ê³µìœ í•˜ì„¸ìš”
                                        </p>
                                        <div className="text-purple-600 font-semibold text-sm">
                                            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ íšŒì› ì „ìš©
                                        </div>
                                    </div>
                                    
                                    {/* 3. ì „ë¬¸ê°€ ìƒë‹´ */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2"
                                         onClick={() => setCurrentView('experts')}>
                                        <div className="text-5xl mb-4">ğŸ¯</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            ì „ë¬¸ê°€ ìƒë‹´
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ğŸ“ ìŒì„±í†µí™” ğŸ“¹ ì˜ìƒí†µí™”<br/>
                                            ì „ë¬¸ê°€ì™€ ì‹¤ì‹œê°„ 1:1 ìƒë‹´
                                        </p>
                                        <div className="text-orange-600 font-semibold text-sm">
                                            ğŸš€ WebRTC ì§€ì›
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        )}
                        
                        {currentView === 'calculator' && <OriginalCalculator savedCalculations={savedCalculations} onCalculationComplete={handleCalculationComplete} setCurrentView={setCurrentView} currentUser={currentUser} showNotification={showNotification} />}
                        
                        
                        {currentView === 'community' && <CommunityApp setCurrentView={setCurrentView} currentUser={currentUser} checkCalculationForInteraction={checkCalculationForInteraction} handlePostClick={handlePostClick} isAdminUser={isAdminUser} />}
                        {currentView === 'post-detail' && selectedPost && <PostDetailPage post={selectedPost} setCurrentView={setCurrentView} currentUser={currentUser} checkCalculationForInteraction={checkCalculationForInteraction} isAdminUser={isAdminUser} />}
                        
                        {/* ì „ë¬¸ê°€ ì°¾ê¸° í˜ì´ì§€ - ê²ŒìŠ¤íŠ¸ ì ‘ê·¼ì œí•œ ì¶”ê°€ */}
                        {currentView === 'experts' && (
                            isGuest ? (
                                <div className="min-h-screen bg-gray-50 py-8">
                                    <div className="max-w-md mx-auto">
                                        <div className="bg-white rounded-2xl shadow-lg p-8">
                                            <div className="text-center">
                                                <div className="text-4xl mb-4">ğŸ”</div>
                                                <h3 className="text-lg font-bold text-gray-900 mb-3">
                                                    ê¶ê¸ˆí•˜ì‹œì£ ? <br/> ì€í‡´ìƒí™œë¹„ë¥¼ ë¨¼ì € ê³„ì‚°í•´ë³´ì„¸ìš” ğŸ˜Š
                                                </h3>
                                                <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                                    <strong>ìì‹ ì˜ ìƒí™©ì„ ì•Œì•„ì•¼ ì „ë¬¸ê°€ì—ê²Œ ë” ë‚˜ì€ ìƒë‹´ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</strong><br/><br/>
                                                    3ë¶„ë§Œ ê³„ì‚°í•´ë³´ì‹œë©´ ì „ë¬¸ê°€ë“¤ì„<br/>
                                                    ë§Œë‚˜ê³  ìƒë‹´ë°›ì„ ìˆ˜ ìˆì–´ìš”!
                                                </p>
                                                <div className="space-y-3">
                                                    <button
                                                        onClick={() => {
                                                            setCurrentView('calculator');
                                                        }}
                                                        className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                                    >
                                                        ğŸ§® ë°”ë¡œ ê³„ì‚°í•˜ëŸ¬ ê°€ê¸°
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setAuthMode('signup');
                                                            setCurrentView('login');
                                                            setShowAuthForm(true);
                                                        }}
                                                        className="w-full px-4 py-3 border border-blue-600 text-blue-600 rounded-lg font-medium hover:bg-blue-50 transition-colors text-sm"
                                                    >
                                                        âœ¨ íšŒì›ê°€ì…í•˜ê¸°
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="max-w-6xl mx-auto">
                                    <div className="card">
                                        <ExpertFinderComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                                    </div>
                                </div>
                            )
                        )}

                        {/* ê³µì§€ì‚¬í•­ í˜ì´ì§€ - ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥ */}
                        {currentView === 'announcements' && (
                            <div className="max-w-6xl mx-auto">
                                <div className="card">
                                    <AnnouncementComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                                </div>
                            </div>
                        )}

                        {/* ì‹¤ì‹œê°„ ì±„íŒ… í˜ì´ì§€ - íšŒì›ë§Œ ì ‘ê·¼ ê°€ëŠ¥ */}
                        {currentView === 'chat' && (
                            <div className="max-w-6xl mx-auto">
                                <ChatComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                            </div>
                        )}
                    </main>
                    
                    {/* ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì œí•œ ëª¨ë‹¬ */}
                    {showCommunityAccessModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowCommunityAccessModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ”’</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ëŠ” íšŒì›ë§Œ ê°€ëŠ¥í•´ìš” ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        ê²Œì‹œê¸€ì€ ë³´ì…¨ëŠ”ë° ì–´ë– ì„¸ìš”?<br/>
                                        <strong>ë” ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹œì£ ?</strong><br/><br/>
                                        íšŒì›ê°€ì…í•˜ì‹œë©´ ë‹¤ë¥¸ ë¶„ë“¤ê³¼<br/>
                                        ì†Œí†µí•˜ê³  ì •ë³´ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ìš”!
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowCommunityAccessModal(false);
                                                setAuthMode('signup');
                                                setCurrentView('login');
                                                setShowAuthForm(true);
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            ğŸ“ íšŒì›ê°€ì…í•˜ê³ <br/>
                                            ìƒì„¸ë‚´ìš© ë³´ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowCommunityAccessModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ê³„ì‚° í•„ìš” ì•ˆë‚´ ëª¨ë‹¬ */}
                    {showCalculationRequiredModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowCalculationRequiredModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ§®</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ê¶ê¸ˆí•˜ì‹œì£ ? <br/> ì€í‡´ìƒí™œë¹„ë¥¼ ë¨¼ì € ê³„ì‚°í•´ë³´ì„¸ìš” ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>ì€í‡´ í›„ ìƒí™œë¹„ë¡œ ì–¼ë§ˆì”© ì¨ì•¼í• ê¹Œìš”?</strong><br/><br/>
                                        3ë¶„ë§Œ ê³„ì‚°í•´ë³´ì‹œë©´ ë” ì¬ë¯¸ìˆê²Œ<br/>
                                        ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”!
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowCalculationRequiredModal(false);
                                                setCurrentView('calculator');
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            ğŸ§® ë°”ë¡œ ê³„ì‚°í•˜ëŸ¬ ê°€ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowCalculationRequiredModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* íšŒì›ê°€ì… ìœ ë„ ëª¨ë‹¬ (ì „ë¬¸ê°€ ìƒë‹´ìš©) */}
                    {showSignupModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowSignupModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ‘¤</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ì „ë¬¸ê°€ ìƒë‹´ì„ ì´ìš©í•˜ì‹œë ¤ë©´<br/>íšŒì›ê°€ì…ì´ í•„ìš”í•´ìš” ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>1:1 ê°œì¸ ë§ì¶¤ ì „ë¬¸ê°€ ìƒë‹´</strong><br/><br/>
                                        ê²€ì¦ëœ ê¸ˆìœµ ì „ë¬¸ê°€ì™€ ì§ì ‘ ìƒë‹´í•˜ê³ <br/>
                                        ê°œì¸í™”ëœ ì€í‡´ì„¤ê³„ë¥¼ ë°›ì•„ë³´ì„¸ìš”!
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowSignupModal(false);
                                                setCurrentView('login');
                                                setAuthMode('signup');
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            âœ¨ ì§€ê¸ˆ íšŒì›ê°€ì…í•˜ê¸°
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowSignupModal(false);
                                                setCurrentView('calculator');
                                            }}
                                            className="w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors text-sm"
                                        >
                                            ğŸ§® ê³ ë¯¼í•´ë³´ê³  ê³„ì‚°ë¶€í„° í•˜ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowSignupModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‹¤ìŒì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ê³„ì‚° ê²°ê³¼ ì €ì¥ìš© íšŒì›ê°€ì… ëª¨ë‹¬ */}
                    {showSaveResultSignupModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowSaveResultSignupModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ’¾</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ê³„ì‚° ê²°ê³¼ë¥¼ ì•ˆì „í•˜ê²Œ<br/>ì €ì¥í•˜ì‹œê² ì–´ìš”? ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>íšŒì›ê°€ì…í•˜ë©´ ê³„ì‚° ê²°ê³¼ê°€ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤!</strong><br/><br/>
                                        â€¢ ì–¸ì œë“  ë‹¤ì‹œ í™•ì¸ ê°€ëŠ¥<br/>
                                        â€¢ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¹„ìŠ·í•œ ë¶„ë“¤ê³¼ ì†Œí†µ<br/>
                                        â€¢ ì „ë¬¸ê°€ ìƒë‹´ ì˜ˆì•½ ê°€ëŠ¥<br/>
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowSaveResultSignupModal(false);
                                                setCurrentView('login');
                                                setAuthMode('signup');
                                            }}
                                            className="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transition-colors text-sm"
                                        >
                                            ğŸ’¾ íšŒì›ê°€ì…í•˜ê³  ì €ì¥í•˜ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowSaveResultSignupModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* í†µí•© ì•Œë¦¼ ëª¨ë‹¬ */}
                    {showNotificationModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowNotificationModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">
                                        {notificationContent.type === 'success' ? 'âœ…' : 
                                         notificationContent.type === 'error' ? 'âŒ' : 
                                         notificationContent.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                                    </div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        {notificationContent.title}
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed whitespace-pre-line">
                                        {notificationContent.message}
                                    </p>
                                    <button
                                        onClick={() => setShowNotificationModal(false)}
                                        className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                    >
                                        í™•ì¸
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* í‘¸í„° */}
                    <footer className="bg-gray-800 text-white mt-16">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div className="text-center">
                                <h3 className="text-xl font-bold mb-4">í”Œëœë¹„</h3>
                                <p className="text-gray-300 mb-4">
                                    ë“ ë“ í•œ ì€í‡´ë¥¼ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼
                                </p>
                                <div className="text-gray-400 text-sm">
                                    Â© 2025 í”Œëœë¹„. All rights reserved.
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        // AuthManagerëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆìŒ
        
        // React ì•± ë Œë”ë§
        console.log('React ë° ReactDOM ë¡œë“œë¨:', { React, ReactDOM });
        console.log('Root element ì°¾ê¸°:', document.getElementById('root'));
        
        // React ì•± ë°”ë¡œ ë Œë”ë§
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<PlanBApp />);
            console.log('React ì•± ë Œë”ë§ ì„±ê³µ');
        } catch (error) {
            console.error('React ì•± ë Œë”ë§ ì—ëŸ¬:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <h1>í”Œëœë¹„</h1>
                    <p style="color: red;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                    <p style="color: red; font-size: 12px;">${error.message}</p>
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            `;
        }
    </script>
</body>
</html>