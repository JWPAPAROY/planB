<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>노후생활비 계산기 - 플랜비 커뮤니티</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            background-color: #f8fafc;
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 16px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-community {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab-button {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .tab-button.active {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        .tab-button:not(.active) {
            background: #f3f4f6;
            color: #6b7280;
        }
        .community-post {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
        }
        .anonymous-badge {
            background: #6b7280;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .asset-badge {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .region-badge {
            background: #f59e0b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .reply {
            background: #f8fafc;
            border-left: 3px solid #d1d5db;
            margin-left: 20px;
            padding: 12px;
            margin-top: 8px;
            border-radius: 6px;
        }
        .service-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            background: white;
            transition: all 0.3s;
        }
        .service-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }
        .dday-badge {
            background: #dc2626;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // === 완전한 계산기 로직 (planb-2.0-final.html에서 가져옴) ===

        // 안전 인출율 계산
        const calculateSafeWithdrawalRate = (age, health, mode, lifeExpectancy = 100) => {
            // 기대수명에 따른 기본 인출율 조정
            const yearsToLive = lifeExpectancy - age;
            let baseRate = 0.035;
            
            // 기대수명이 길수록 보수적으로, 짧을수록 적극적으로
            if (yearsToLive >= 45) baseRate = 0.032;      // 45년 이상: 매우 보수적
            else if (yearsToLive >= 35) baseRate = 0.035; // 35-44년: 기본
            else if (yearsToLive >= 25) baseRate = 0.039; // 25-34년: 약간 적극적
            else if (yearsToLive >= 15) baseRate = 0.042; // 15-24년: 적극적
            else baseRate = 0.045;                        // 15년 미만: 매우 적극적
            
            const adjustments = {
                health: { '양호': 1.05, '보통': 1.0, '주의필요': 0.95 },
                mode: { '보수적': 0.85, '균형': 1.0, '적극적': 1.15 }
            };
            
            return baseRate * adjustments.health[health] * adjustments.mode[mode];
        };

        // 나이별 평균 데이터
        const getAverageDataByAge = (age) => {
            if (age >= 65) {
                return { financialAssets: 8500, severancePay: 0, homeValue: 28000, nationalPension: 80, privatePension: 35, debt: 800 };
            } else if (age >= 55) {
                return { financialAssets: 12000, severancePay: 4500, homeValue: 35000, nationalPension: 120, privatePension: 65, debt: 2200 };
            } else if (age >= 45) {
                return { financialAssets: 8500, severancePay: 7000, homeValue: 40000, nationalPension: 140, privatePension: 85, debt: 3500 };
            } else {
                return { financialAssets: 5000, severancePay: 3000, homeValue: 30000, nationalPension: 100, privatePension: 50, debt: 2500 };
            }
        };

        // 금액 포맷팅
        const formatAmount = (value) => {
            if (!value || value === '' || value === '0') return '💰 0원';
            const num = parseInt(value);
            if (num >= 10000) return `💰 ${(num / 10000).toFixed(1)}억원`;
            if (num >= 1000) return `💰 ${Math.round(num / 1000)}천만원`;
            return `💰 ${num.toLocaleString()}만원`;
        };

        const formatResultAmount = (amount) => {
            if (amount < 0) {
                return `-${formatResultAmount(-amount)}`;
            }
            
            const 억 = Math.floor(amount / 100000000);
            const 만 = Math.round((amount % 100000000) / 10000);
            
            if (억 >= 1) {
                if (만 === 0) {
                    return `${억}억원`;
                } else {
                    return `${억}억 ${만}만원`;
                }
            } else {
                return `${만}만원`;
            }
        };

        // AmountInput 컴포넌트
        const AmountInput = ({ label, value, onChange, placeholder, averageAmount }) => (
            <div className="mb-6">
                <label className="block text-xl font-semibold text-gray-800 mb-3">{label}</label>
                <input
                    type="text"
                    inputMode="numeric"
                    pattern="[0-9]*"
                    value={value}
                    onChange={(e) => {
                        const numValue = e.target.value.replace(/[^0-9]/g, '');
                        onChange(numValue === '' ? '' : numValue);
                    }}
                    onDragStart={(e) => e.preventDefault()}
                    onDrop={(e) => e.preventDefault()}
                    onDragOver={(e) => e.preventDefault()}
                    className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                    placeholder={placeholder}
                    autoComplete="off"
                    autoCorrect="off"
                    spellCheck="false"
                    draggable="false"
                    style={{ userSelect: 'text' }}
                />
                <div className="text-green-600 font-semibold text-lg mt-1">{formatAmount(value)}</div>
                {averageAmount > 0 && (
                    <div className="text-sm text-blue-600 mt-1">
                        📊 내 나이또래 평균: {averageAmount.toLocaleString()}만원 (통계청 가계금융복지조사 2023)
                    </div>
                )}
            </div>
        );

        // 샘플 커뮤니티 데이터
        const samplePosts = [
            {
                id: 1,
                author: "은퇴준비생57",
                authorProfile: { age: 57, assets: "2-5억", region: "서울", lifestyle: "균형" },
                title: "3억 자산으로 정말 안전한 은퇴가 가능할까요?",
                content: "계산기로 돌려보니 월 100만원 정도 나오는데, 실제로 이 금액으로 살 수 있을지 막막합니다. 비슷한 처지에서 은퇴하신 분들 경험담 부탁드려요.",
                timestamp: "2시간 전",
                likes: 12,
                replies: [
                    {
                        author: "자유인62",
                        authorProfile: { age: 62, assets: "2-5억", region: "부산", lifestyle: "보수적" },
                        content: "저도 비슷한 자산으로 3년째 은퇴생활 중인데요. 월 100만원으로 충분히 가능합니다. 다만 여행이나 큰 지출은 별도로 준비해야 해요.",
                        timestamp: "1시간 전",
                        likes: 8
                    },
                    {
                        author: "현실주의59",
                        authorProfile: { age: 59, assets: "2-5억", region: "경기", lifestyle: "균형" },
                        content: "의료비를 좀 더 여유있게 잡으시길 권해요. 50대 후반부터 건강검진에서 이것저것 나오기 시작하더라고요.",
                        timestamp: "30분 전",
                        likes: 5
                    }
                ]
            },
            {
                id: 2,
                author: "전세살이64",
                authorProfile: { age: 64, assets: "5천만-2억", region: "인천", lifestyle: "보수적" },
                title: "전세 살면서 노후 준비, 이게 맞나 싶어요",
                content: "1억 전세에 살면서 나머지 자산 8천으로 노후를 준비하고 있는데... 주변에서는 자가를 마련하라고 하네요. 솔직한 조언 부탁합니다.",
                timestamp: "5시간 전",
                likes: 18,
                replies: [
                    {
                        author: "평생전세러66",
                        authorProfile: { age: 66, assets: "5천만-2억", region: "서울", lifestyle: "보수적" },
                        content: "저는 평생 전세 살았는데 후회 없어요. 관리비, 수리비 등 숨은 비용 생각하면 전세가 나을 수도 있어요. 본인 라이프스타일에 맞춰 선택하세요.",
                        timestamp: "3시간 전",
                        likes: 10
                    }
                ]
            },
            {
                id: 3,
                author: "조기은퇴꿈나무53",
                authorProfile: { age: 53, assets: "5-10억", region: "대구", lifestyle: "적극적" },
                title: "50대 초반 조기 은퇴, 무모한 선택일까요?",
                content: "부동산 2채 + 금융자산으로 총 7억 정도. 계산기로는 월 200만원 나오는데 정말 퇴사해도 될지... 조기 은퇴하신 분들 현실적인 얘기 들려주세요.",
                timestamp: "8시간 전",
                likes: 25,
                replies: []
            }
        ];

        // 샘플 서비스 제휴사 데이터
        const partnerServices = {
            "생활케어": [
                { 
                    name: "시니어 홈케어", 
                    description: "주 2회 방문 청소 + 생활 도움", 
                    price: "월 25만원부터",
                    dday: 7,
                    rating: 4.8,
                    reviews: 156,
                    discount: "플랜비 회원 10% 할인",
                    detailFeatures: ["집안 청소", "세탁 및 정리", "간단한 요리 도움", "외출 동행"],
                    realReviews: ["혼자 살기 힘들었는데 큰 도움이 돼요", "직원분이 친절하고 꼼꼼해요"]
                },
                { 
                    name: "실버푸드", 
                    description: "영양사 설계 시니어 맞춤 반찬", 
                    price: "월 12만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.6,
                    reviews: 89,
                    discount: "첫 달 50% 할인",
                    detailFeatures: ["영양사 메뉴 설계", "저염·저당 맞춤", "주 2회 배송", "냉동 보관 용이"],
                    realReviews: ["혼자 요리하기 힘든데 영양가 있어서 좋아요", "간이 적당하고 맛있어요"]
                },
                { 
                    name: "생활용품 배송", 
                    description: "시니어 필수 생활용품 정기 배송", 
                    price: "월 8만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.4,
                    reviews: 142,
                    discount: "3개월 구독 시 20% 할인",
                    detailFeatures: ["화장지·세제 등 생필품", "의료용품 포함", "월 1회 정기 배송", "개별 맞춤 구성"],
                    realReviews: ["무거운 것들 직접 사지 않아도 돼서 편해요", "필요한 것만 골라서 배송해줘요"]
                },
                { 
                    name: "시니어 IT 서포트", 
                    description: "스마트폰·컴퓨터 사용법 1:1 교육", 
                    price: "회당 3만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.7,
                    reviews: 78,
                    discount: "5회 패키지 시 20% 할인",
                    detailFeatures: ["방문 교육", "스마트폰 기본 사용법", "온라인 쇼핑 도움", "문제 해결 전화 지원"],
                    realReviews: ["선생님이 차근차근 알려주셔서 이해하기 쉬워요", "이제 손자와 영상통화도 할 수 있어요"]
                }
            ],
            "건강관리": [
                { 
                    name: "종합건강검진", 
                    description: "50+ 특화 프리미엄 검진 패키지", 
                    price: "35만원 (정가 50만원)",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.9,
                    reviews: 203,
                    discount: "플랜비 회원 특가",
                    detailFeatures: ["암 정밀검사", "심뇌혈관 검사", "골다공증 검사", "영양상담 포함"],
                    realReviews: ["검사가 꼼꼼하고 결과 설명도 자세해요", "예약도 편하고 대기시간이 짧아요"]
                },
                { 
                    name: "방문 물리치료", 
                    description: "관절·근육 맞춤 재활 치료", 
                    price: "회당 5만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.6,
                    reviews: 134,
                    discount: "10회 패키지 시 15% 할인",
                    detailFeatures: ["전문 물리치료사 방문", "개별 맞춤 운동법", "통증 완화 치료", "재활 운동 교육"],
                    realReviews: ["무릎 통증이 많이 좋아졌어요", "집에서 받을 수 있어서 편리해요"]
                },
                { 
                    name: "시니어 헬스케어", 
                    description: "맞춤형 건강 관리 프로그램", 
                    price: "월 15만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.5,
                    reviews: 97,
                    discount: "6개월 등록 시 1개월 무료",
                    detailFeatures: ["개인별 운동 프로그램", "영양 관리 상담", "건강 수치 모니터링", "응급상황 대응"],
                    realReviews: ["체계적으로 관리받으니 건강해진 기분이에요", "운동 강도가 적당해서 좋아요"]
                },
                { 
                    name: "치매 예방 인지훈련", 
                    description: "두뇌 활동 증진 전문 프로그램", 
                    price: "월 12만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.8,
                    reviews: 156,
                    discount: "첫 달 체험 50% 할인",
                    detailFeatures: ["인지능력 평가", "맞춤 훈련 프로그램", "그룹 활동 참여", "진전도 정기 평가"],
                    realReviews: ["기억력이 좋아진 것 같아요", "다른 분들과 함께 해서 재미있어요"]
                }
            ],
            "여행": [
                { 
                    name: "시니어 국내 여행", 
                    description: "60+ 전용 안전하고 편안한 국내 여행", 
                    price: "1박2일 18만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.7,
                    reviews: 167,
                    discount: "동반자 할인 20%",
                    detailFeatures: ["의료진 동행", "휠체어 접근 가능", "소그룹 맞춤 일정", "간편한 짐 서비스"],
                    realReviews: ["안전하고 편안해요", "동년배끼리 재미있어요", "가이드가 세심해요"]
                },
                { 
                    name: "온천 힐링 여행", 
                    description: "건강한 온천과 휴양을 결합한 여행", 
                    price: "2박3일 25만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.6,
                    reviews: 143,
                    discount: "조기 예약 시 15% 할인",
                    detailFeatures: ["프리미엄 온천 이용", "건강식 제공", "족욕·마사지 포함", "여유로운 일정"],
                    realReviews: ["몸도 마음도 힐링됐어요", "온천이 정말 좋더라구요", "음식도 건강하고 맛있어요"]
                },
                { 
                    name: "문화유적 탐방", 
                    description: "역사와 문화를 배우는 교육형 여행", 
                    price: "당일 8만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.4,
                    reviews: 89,
                    discount: "3회 이상 참여 시 10% 할인",
                    detailFeatures: ["전문 문화해설사 동행", "편안한 버스 이동", "박물관·유적지 투어", "역사 자료집 제공"],
                    realReviews: ["새로운 것을 많이 배웠어요", "해설사님이 재미있게 설명해주세요", "또 참여하고 싶어요"]
                },
                { 
                    name: "시니어 크루즈", 
                    description: "편안한 바다 여행과 선상 액티비티", 
                    price: "3박4일 45만원부터",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.8,
                    reviews: 201,
                    discount: "얼리버드 30% 할인",
                    detailFeatures: ["프리미엄 객실", "선상 문화공연", "건강한 뷔페", "의료진 상주"],
                    realReviews: ["평생 잊지 못할 경험이었어요", "서비스가 정말 좋아요", "바다 보며 힐링했어요"]
                }
            ],
            "시니어 일자리": [
                { 
                    name: "경비·관리 일자리", 
                    description: "아파트 경비·관리사무소 근무", 
                    price: "월 180만원~220만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.3,
                    reviews: 312,
                    discount: "취업 성공 시 축하금 50만원",
                    detailFeatures: ["4대보험 완비", "주말 교대근무", "경력 무관", "시니어 친화 환경"],
                    realReviews: ["동년배들과 일해서 편해요", "일이 어렵지 않아서 좋아요", "적정한 수입이 생겨서 만족해요"]
                },
                { 
                    name: "시니어 상담사", 
                    description: "전화·온라인 고객상담 업무", 
                    price: "시급 1만2천원~1만5천원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.5,
                    reviews: 198,
                    discount: "교육 수료 시 취업 보장",
                    detailFeatures: ["재택 근무 가능", "유연한 시간 선택", "친절 교육 제공", "정기 상담 지원"],
                    realReviews: ["집에서 일할 수 있어서 좋아요", "시간 조절이 자유로워요", "사람들과 대화하는 게 즐거워요"]
                },
                { 
                    name: "공원·환경 관리", 
                    description: "공원 청소·환경 정비 업무", 
                    price: "월 160만원~200만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.1,
                    reviews: 267,
                    discount: "3개월 근무 시 장기근속 수당",
                    detailFeatures: ["야외 활동", "건강 증진", "4대보험", "근무복 지급"],
                    realReviews: ["야외에서 일하니 건강해져요", "운동도 되고 수입도 생겨요", "보람찬 일이에요"]
                },
                { 
                    name: "시니어 멘토링", 
                    description: "경력 기반 후배 지도·상담", 
                    price: "회당 5만원~10만원",
                    dday: Math.floor(Math.random() * 30) + 1,
                    rating: 4.7,
                    reviews: 124,
                    discount: "정기 멘토 등록 시 20% 추가 수당",
                    detailFeatures: ["경력 활용", "유연한 스케줄", "온·오프라인 선택", "전문성 인정"],
                    realReviews: ["제 경험을 나눌 수 있어서 뿌듯해요", "젊은 친구들과 소통하는 게 즐거워요", "시간당 수입이 괜찮아요"]
                }
            ]
        };

        function PlanBCommunityApp() {
            const [currentView, setCurrentView] = useState('calculator'); // calculator, community, services
            const [calculatorStep, setCalculatorStep] = useState(1);
            const [formData, setFormData] = useState({
                age: '', health: '보통', mode: '균형',
                housingType: '', // 주거형태: 'owned', 'jeonse', 'monthly', 'none'
                financialAssets: '', severancePay: '', 
                // 주거 관련 (주거형태별로 다름)
                homeValue: '', homeMortgage: '', jeonseDeposit: '', monthlyDeposit: '', monthlyRent: '',
                investmentRealEstate: '', investmentLoan: '', debt: '', inheritance: '',
                nationalPension: '', privatePension: '', housingPension: '', 
                // 노후 월 수입
                rentalIncome: '', workIncome: '', financialIncome: '', otherIncome: '',
                // 월 지출
                basicLiving: '', communication: '', medical: '',
                // 월 이자 지출
                homeMortgageInterest: '', investmentLoanInterest: '', debtInterest: '', depositLoanInterest: '',
                // 보증금 대출
                depositLoan: ''
            });
            const [calculatorResult, setCalculatorResult] = useState(null);
            const [averageData, setAverageData] = useState(null);
            const [selectedPost, setSelectedPost] = useState(null);
            const [communityTab, setCommunityTab] = useState('posts'); // posts, write, myprofile
            const [serviceTab, setServiceTab] = useState('생활케어'); // 생활케어, 건강관리, 여행, 시니어 일자리
            const [showExpenseModal, setShowExpenseModal] = useState(false);
            const [activeTab, setActiveTab] = useState('expense'); // expense, community
            const [showAssetDetail, setShowAssetDetail] = useState(false);
            const [showInheritanceGuide, setShowInheritanceGuide] = useState(false);
            const [lifeExpectancy, setLifeExpectancy] = useState(100);
            const [enableDownsizing, setEnableDownsizing] = useState(false);
            const [isResultSaved, setIsResultSaved] = useState(false);
            const [expenseData, setExpenseData] = useState({
                food: '',
                communication: '',
                utilities: '',
                living: '',
                medical: '',
                hobby: ''
            });

            const handleInputChange = (field, value) => {
                // 빈 문자열일 때 0으로 변환하지 않음
                const cleanValue = value === '' ? '' : value;
                setFormData({ ...formData, [field]: cleanValue });
            };

            // 나이 입력 시 평균 데이터 업데이트
            useEffect(() => {
                if (formData.age) {
                    setAverageData(getAverageDataByAge(parseInt(formData.age)));
                }
            }, [formData.age]);

            // 기대수명 변경 시 계산 결과 업데이트
            useEffect(() => {
                if (calculatorResult && formData.age) {
                    // 계산 다시 수행
                    calculateResults();
                    // 설정 변경 시 저장 상태 초기화
                    setIsResultSaved(false);
                }
            }, [lifeExpectancy, enableDownsizing]);

            // 계산 결과 저장 함수
            const saveCalculationResult = () => {
                if (calculatorResult) {
                    // 로컬 스토리지에 저장
                    const savedResult = {
                        ...calculatorResult,
                        formData: formData,
                        lifeExpectancy: lifeExpectancy,
                        enableDownsizing: enableDownsizing,
                        savedAt: new Date().toISOString()
                    };
                    localStorage.setItem('planb_calculation_result', JSON.stringify(savedResult));
                    setIsResultSaved(true);
                    
                    // 프로필 데이터 업데이트 (월 노후생활비)
                    const existingProfile = JSON.parse(localStorage.getItem('planb_user_profile') || '{}');
                    const updatedProfile = {
                        ...existingProfile,
                        monthlyRetirementFund: calculatorResult.totalMonthlyAvailable,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('planb_user_profile', JSON.stringify(updatedProfile));
                }
            };

            const calculateResults = () => {
                const age = parseInt(formData.age);
                
                // 자산 계산 (만원 → 원)
                // 주거형태별 자산 계산
                let housingAsset = 0;
                let housingDebt = 0;
                let monthlyHousingCost = 0;
                
                // 월 대출 이자 (개별 합산)
                const monthlyLoanInterest = 
                    ((parseInt(formData.homeMortgageInterest) || 0) + 
                     (parseInt(formData.investmentLoanInterest) || 0) + 
                     (parseInt(formData.debtInterest) || 0) + 
                     (parseInt(formData.depositLoanInterest) || 0)) * 10000;
                
                if (formData.housingType === 'owned_living') {
                    // 자가 소유 + 거주: 집값 - 대출
                    housingAsset = (parseInt(formData.homeValue) || 0) * 10000;
                    housingDebt = (parseInt(formData.homeMortgage) || 0) * 10000;
                } else if (formData.housingType === 'owned_renting') {
                    // 자가 소유 + 전세/월세 거주: 소유한 집은 임대용 자산으로 계산
                    housingAsset = (parseInt(formData.homeValue) || 0) * 10000;
                    housingDebt = (parseInt(formData.homeMortgage) || 0) * 10000;
                    if (formData.currentRentType === 'monthly') {
                        monthlyHousingCost = (parseInt(formData.currentRent) || 0) * 10000;
                    }
                } else if (formData.housingType === 'jeonse') {
                    // 전세: 보증금만 자산
                    housingAsset = (parseInt(formData.jeonseDeposit) || 0) * 10000;
                } else if (formData.housingType === 'monthly') {
                    // 월세: 보증금만 자산, 월세는 지출
                    housingAsset = (parseInt(formData.monthlyDeposit) || 0) * 10000;
                    monthlyHousingCost = (parseInt(formData.monthlyRent) || 0) * 10000;
                }
                // 무주택('none')은 주거 관련 자산 0
                
                const assets = {
                    financial: (parseInt(formData.financialAssets) || 0) * 10000,
                    severance: (parseInt(formData.severancePay) || 0) * 10000,
                    housing: housingAsset,
                    currentDeposit: (parseInt(formData.currentDeposit) || 0) * 10000,
                    housingDebt: housingDebt,
                    monthlyHousingCost: monthlyHousingCost,
                    investment: (parseInt(formData.investmentRealEstate) || 0) * 10000,
                    investmentLoan: (parseInt(formData.investmentLoan) || 0) * 10000,
                    debt: (parseInt(formData.debt) || 0) * 10000,
                    depositLoan: (parseInt(formData.depositLoan) || 0) * 10000,
                    inheritance: (parseInt(formData.inheritance) || 0) * 10000
                };
                
                // 주거형태별 자산 반영 비율
                const housingPensionAmount = (parseInt(formData.housingPension) || 0);
                let housingValueRatio = 0;
                
                if (formData.housingType === 'owned_living') {
                    // 자가 + 거주: 주택연금 있으면 100%, 주택 매각시 75%(양도세+수수료 고려), 없으면 0%
                    if (housingPensionAmount > 0) {
                        housingValueRatio = 1.0;
                    } else if (enableDownsizing) {
                        housingValueRatio = 0.75; // 주택 매각 시 양도세+수수료 25% 차감
                    } else {
                        housingValueRatio = 0; // 거주용 주택은 생활비로 사용 불가
                    }
                } else if (formData.housingType === 'owned_renting') {
                    // 자가 + 전세/월세 거주: 주택 매각시 75%, 아니면 0%
                    if (enableDownsizing) {
                        housingValueRatio = 0.75; // 주택 매각 시 양도세+수수료 25% 차감
                    } else {
                        housingValueRatio = 0; // 임대용 주택도 매각하지 않으면 생활비로 사용 불가
                    }
                } else if (formData.housingType === 'jeonse' || formData.housingType === 'monthly') {
                    // 전세/월세: 보증금은 100% 자산
                    housingValueRatio = 1.0;
                }
                // 무주택: 0% (자동으로 0)
                
                // 상속/증여 예정액과 임차인 보증금은 처음부터 제외
                const ownedHouseDepositDebt = (parseInt(formData.ownedHouseDeposit) || 0) * 10000; // 임차인 보증금 (돌려줘야 할 돈)
                
                // 주택 매각 시 실제 매각 가능 금액 계산
                let realizedHousingAsset = 0;
                if (formData.housingType === 'owned_living' && enableDownsizing) {
                    // 자가 거주 + 주택 매각: (집값 × 75%) - 주택담보대출
                    realizedHousingAsset = Math.max(0, (assets.housing * housingValueRatio) - assets.housingDebt);
                } else if (formData.housingType === 'owned_renting' && enableDownsizing) {
                    // 자가 소유 + 전세/월세 거주 + 주택 매각: (집값 × 75%) - 임차인보증금 - 주택담보대출
                    realizedHousingAsset = Math.max(0, (assets.housing * housingValueRatio) - ownedHouseDepositDebt - assets.housingDebt);
                } else {
                    // 일반적인 경우: 기존 로직 유지 (매각하지 않으면 0)
                    realizedHousingAsset = assets.housing * housingValueRatio;
                }
                
                // 주택연금 선택 시 주택 자산 처리
                let housingAssetForUsable = realizedHousingAsset;
                if (parseInt(formData.housingPension) > 0) {
                    // 주택연금 선택 시 해당 주택은 자산에서 완전 배제 (소득으로 전환)
                    housingAssetForUsable = 0;
                }
                
                // 생활비로 쓸 수 있는 자산 계산 (부채 차감 전)
                // 거주지 보증금은 생활비로 쓸 수 없는 자산이므로 제외
                const usableAssetsGross = assets.financial + assets.severance + housingAssetForUsable;
                
                // 생활비로 쓸 수 있는 자산 (부채 차감 안 함)
                const usableAssets = usableAssetsGross;
                
                // 부채 정보 (참고용)
                const totalDebts = (enableDownsizing ? 0 : assets.housingDebt) + assets.investmentLoan + assets.debt + assets.depositLoan +
                    (enableDownsizing && formData.housingType === 'owned_renting' ? 0 : ownedHouseDepositDebt);
                
                // 디버깅용 - 나중에 제거
                console.log('계산 확인:', {
                    '현금성자산': assets.financial,
                    '퇴직금': assets.severance,
                    '주택매각금': realizedHousingAsset,
                    '거주지보증금': assets.currentDeposit,
                    '주택연금': parseInt(formData.housingPension) > 0 ? (parseInt(formData.homeValue) || 0) * 10000 : 0,
                    usableAssetsGross,
                    '주택대출': assets.housingDebt,
                    '투자대출': assets.investmentLoan,
                    '기타대출': assets.debt,
                    '임차인보증금': enableDownsizing && formData.housingType === 'owned_renting' ? 0 : ownedHouseDepositDebt,
                    totalDebts, 
                    usableAssets,
                    emergencyFund: assets.financial * 0.1
                });
                
                // 생활비로 쓸 수 없는 자산 계산
                const unusableAssets = assets.investment + assets.inheritance +
                    (!enableDownsizing && !parseInt(formData.housingPension) && parseInt(formData.homeValue) > 0 ? (parseInt(formData.homeValue) || 0) * 10000 : 0);
                
                // 총자산 = 모든 자산의 합 - 부채
                const allAssets = assets.financial + assets.severance + assets.housing + assets.currentDeposit + assets.investment + assets.inheritance;
                const totalAssets = Math.max(0, allAssets - totalDebts);
                
                // 디버깅용
                console.log('총자산 계산:', {
                    '현금성자산': assets.financial,
                    '퇴직금': assets.severance, 
                    '주택자산': assets.housing,
                    '거주지보증금': assets.currentDeposit,
                    '수익형부동산': assets.investment,
                    '증여상속': assets.inheritance,
                    'allAssets': allAssets,
                    'totalDebts': totalDebts,
                    'totalAssets': totalAssets
                });
                
                // 비상자금은 현금성 자산의 10%
                const emergencyFund = assets.financial * 0.1;
                const availableAssets = Math.max(0, usableAssets - emergencyFund);
                
                // 단순 소진 계산 (투자수익률 배제)
                const yearsToLive = lifeExpectancy - age;
                const annualWithdrawal = availableAssets / yearsToLive;
                const dailyAmount = annualWithdrawal / 365;
                const monthlyAmount = annualWithdrawal / 12;
                
                // 연금 수입 (참고용)
                const monthlyPension = (parseInt(formData.nationalPension) || 0) + (parseInt(formData.privatePension) || 0) + (parseInt(formData.housingPension) || 0);
                
                // 노후 월 수입 (참고용)
                const monthlyOtherIncome = (parseInt(formData.rentalIncome) || 0) + (parseInt(formData.workIncome) || 0) + (parseInt(formData.financialIncome) || 0) + (parseInt(formData.otherIncome) || 0);
                
                // 총 가용 지출 금액 = 생활비로 쓸 수 있는 자산 + 연금 수입 + 기타 월 수입 - 월세 - 대출이자 (모두 원 단위)
                const totalMonthlyAvailable = Math.round(monthlyAmount) + (monthlyPension * 10000) + (monthlyOtherIncome * 10000) - monthlyHousingCost - monthlyLoanInterest;
                const totalDailyAvailable = Math.round(totalMonthlyAvailable / 30.4);
                
                // 디버깅용 - 나중에 제거  
                console.log('setCalculatorResult 호출:', { usableAssets, availableAssets });
                
                setCalculatorResult({
                    // 생활비로 쓸 수 있는 자산
                    dailyAmount: Math.round(dailyAmount),
                    monthlyAmount: Math.round(monthlyAmount),
                    annualAmount: Math.round(annualWithdrawal),
                    
                    // 총 가용 지출 금액 (자산 + 연금 + 기타 수입)
                    totalDailyAvailable: totalDailyAvailable,
                    totalMonthlyAvailable: Math.round(totalMonthlyAvailable),
                    
                    yearsToLive: yearsToLive,
                    
                    // 자산 세부사항
                    assetBreakdown: {
                        totalAssets, usableAssets, usableAssetsGross, unusableAssets, availableAssets, emergencyFund, totalDebts,
                        financial: assets.financial, severance: assets.severance,
                        housing: assets.housing, realizedHousingAsset: realizedHousingAsset, currentDeposit: assets.currentDeposit, housingDebt: assets.housingDebt, housingValueRatio: housingValueRatio,
                        monthlyHousingCost: assets.monthlyHousingCost,
                        investment: assets.investment, investmentLoan: assets.investmentLoan,
                        debt: assets.debt, inheritance: assets.inheritance, 
                        housingPensionAmount: housingPensionAmount,
                        housingType: formData.housingType,
                        enableDownsizing: enableDownsizing,
                        ownedHouseDepositDebt: ownedHouseDepositDebt
                    },
                    
                    // 참고 정보
                    monthlyPension: monthlyPension * 10000,
                    monthlyOtherIncome: monthlyOtherIncome * 10000,
                    monthlyHousingCost: monthlyHousingCost,
                    monthlyLoanInterest: monthlyLoanInterest,
                    
                    safetyLevel: totalMonthlyAvailable >= 3000000 ? '안전' : totalMonthlyAvailable >= 1500000 ? '보통' : '주의'
                });
                
                // 프로필 업데이트 (계산기 결과 연동)
                const currentProfile = JSON.parse(localStorage.getItem('planb_profile') || '{}');
                const updatedProfile = {
                    ...currentProfile,
                    age: parseInt(formData.age),
                    assets: getAssetGroup(totalAssets),
                    lifestyle: formData.mode, // 생활모드
                    health: formData.health, // 건강상태
                    monthlyRetirementBudget: Math.round(totalMonthlyAvailable / 10000) // 월 노후생활비 (만원 단위)
                };
                localStorage.setItem('planb_profile', JSON.stringify(updatedProfile));
                
                setCalculatorStep(4);
            };

            const getAssetGroup = (assets) => {
                if (assets >= 1000000) return "10억 이상";
                if (assets >= 500000) return "5-10억";
                if (assets >= 200000) return "2-5억";
                if (assets >= 50000) return "5천만-2억";
                return "5천만 미만";
            };

            const joinCommunity = () => {
                // 계산 결과를 바탕으로 커뮤니티 프로필 생성
                const profile = {
                    age: formData.age,
                    assets: getAssetGroup(parseInt(formData.assets)),
                    region: formData.region,
                    lifestyle: formData.lifestyle,
                    monthlyBudget: calculatorResult.monthlyAmount,
                    joinDate: new Date().toLocaleDateString()
                };
                
                localStorage.setItem('planb_profile', JSON.stringify(profile));
                setCurrentView('community');
            };

            const openExpenseModal = () => {
                setShowExpenseModal(true);
            };

            const closeExpenseModal = () => {
                setShowExpenseModal(false);
            };

            const handleExpenseChange = (field, value) => {
                setExpenseData({ ...expenseData, [field]: value });
            };

            const submitExpenseData = () => {
                // Here we would normally submit to a backend
                alert('지출내역이 저장되었습니다! 이제 비슷한 사람들의 지출 패턴을 확인할 수 있습니다.');
                setShowExpenseModal(false);
                // Could redirect to a comparison view or show analytics
            };

            const renderCalculator = () => {
                if (calculatorStep === 1) {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">🧮 노후생활비 계산기</h1>
                                    <p className="text-xl text-gray-600">나이와 건강상태를 입력해주세요</p>
                                    <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                        <div className="bg-blue-600 h-4 rounded-full" style={{width: '33%'}}></div>
                                    </div>
                                    <p className="text-lg text-gray-500 mt-3">1단계 / 3단계</p>
                                </div>

                                <div className="card">
                                    <div className="space-y-6">
                                        <div className="mb-6">
                                            <label className="block text-xl font-semibold text-gray-800 mb-3">🎂 나이</label>
                                            <input
                                                type="text"
                                                inputMode="numeric"
                                                pattern="[0-9]*"
                                                value={formData.age}
                                                onChange={(e) => {
                                                    const numValue = e.target.value.replace(/[^0-9]/g, '');
                                                    handleInputChange('age', Math.max(0, numValue));
                                                }}
                                                onDragStart={(e) => e.preventDefault()}
                                                onDrop={(e) => e.preventDefault()}
                                                onDragOver={(e) => e.preventDefault()}
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                placeholder=""
                                                autoComplete="off"
                                                autoCorrect="off"
                                                spellCheck="false"
                                                draggable="false"
                                                style={{ userSelect: 'text' }}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xl font-semibold text-gray-800 mb-3">💪 건강 상태</label>
                                            <select
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                value={formData.health}
                                                onChange={(e) => handleInputChange('health', e.target.value)}
                                            >
                                                <option value="양호">양호 (운동 규칙적, 큰 질병 없음)</option>
                                                <option value="보통">보통 (일반적인 건강 상태)</option>
                                                <option value="주의필요">주의필요 (만성질환 있거나 관리 필요)</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-xl font-semibold text-gray-800 mb-3">🎯 생활 모드</label>
                                            <select
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                value={formData.mode}
                                                onChange={(e) => handleInputChange('mode', e.target.value)}
                                            >
                                                <option value="보수적">보수적 (안전 우선, 여유자금 확보)</option>
                                                <option value="균형">균형 (평균적인 생활 수준 유지)</option>
                                                <option value="적극적">적극적 (여유있는 생활, 취미활동)</option>
                                            </select>
                                        </div>

                                        <button
                                            onClick={() => setCalculatorStep(2)}
                                            className="btn-primary w-full text-xl py-4"
                                            disabled={!formData.age || !formData.health || !formData.mode}
                                        >
                                            다음 단계 →
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (calculatorStep === 2) {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">🏠 자산 정보</h1>
                                    <p className="text-xl text-gray-600">현재 보유하고 계신 자산을 입력해주세요</p>
                                    <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                        <div className="bg-blue-600 h-4 rounded-full" style={{width: '66%'}}></div>
                                    </div>
                                    <p className="text-lg text-gray-500 mt-3">2단계 / 3단계</p>
                                </div>

                                <div className="card">
                                    <div className="bg-green-50 border-l-4 border-green-400 p-6 mb-8 rounded-r-lg">
                                        <p className="text-lg text-green-800">
                                            😊 <strong>정확한 수치를 모르시는 경우에는</strong><br/>
                                            알고 계신 대략적인 금액을 입력하시면 됩니다.
                                        </p>
                                    </div>

                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-xl font-semibold text-gray-800 mb-3">🏠 주거 형태</label>
                                            <select
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                value={formData.housingType}
                                                onChange={(e) => handleInputChange('housingType', e.target.value)}
                                            >
                                                <option value="">선택하세요</option>
                                                <option value="owned_living">자가 소유 + 거주</option>
                                                <option value="owned_renting">자가 소유 + 전세/월세 거주</option>
                                                <option value="jeonse">전세</option>
                                                <option value="monthly">월세</option>
                                                <option value="none">무주택</option>
                                            </select>
                                        </div>

                                        <AmountInput
                                            label="🏦 현금 및 현금성 자산 (예금·적금·주식·펀드 등, 단위: 만원)"
                                            value={formData.financialAssets}
                                            onChange={(v) => handleInputChange('financialAssets', v)}
                                            placeholder=""
                                            averageAmount={averageData?.financialAssets || 0}
                                        />

                                        <AmountInput
                                            label="💼 퇴직금 (은퇴시 받을 퇴직금 또는 현재 남아있는 퇴직금, 단위: 만원)"
                                            value={formData.severancePay}
                                            onChange={(v) => handleInputChange('severancePay', v)}
                                            placeholder=""
                                            averageAmount={averageData?.severancePay || 0}
                                        />

                                        {/* 주거형태별 조건부 필드 */}
                                        {(formData.housingType === 'owned_living' || formData.housingType === 'owned_renting') && (
                                            <>
                                                <AmountInput
                                                    label="🏠 자가 소유 주택 시세 (단위: 만원)"
                                                    value={formData.homeValue}
                                                    onChange={(v) => handleInputChange('homeValue', v)}
                                                    placeholder=""
                                                    averageAmount={averageData?.homeValue || 0}
                                                />
                                                <AmountInput
                                                    label="🏠 주택담보대출 잔액 (단위: 만원)"
                                                    value={formData.homeMortgage}
                                                    onChange={(v) => handleInputChange('homeMortgage', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />
                                                {formData.homeMortgage && parseInt(formData.homeMortgage) > 0 && (
                                                    <AmountInput
                                                        label="💳 주택담보대출 월 이자 (단위: 만원)"
                                                        value={formData.homeMortgageInterest}
                                                        onChange={(v) => handleInputChange('homeMortgageInterest', v)}
                                                        placeholder=""
                                                        averageAmount={0}
                                                    />
                                                )}
                                            </>
                                        )}

                                        {formData.housingType === 'owned_renting' && (
                                            <>

                                                <AmountInput
                                                    label="🏠 내 소유 집 임차인 보증금 (내가 받은 보증금, 단위: 만원)"
                                                    value={formData.ownedHouseDeposit}
                                                    onChange={(v) => handleInputChange('ownedHouseDeposit', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />

                                                <AmountInput
                                                    label="🏠 현재 거주지 보증금 (내가 낸 보증금, 단위: 만원)"
                                                    value={formData.currentDeposit}
                                                    onChange={(v) => handleInputChange('currentDeposit', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />
                                                
                                                <AmountInput
                                                    label="💳 보증금 대출 잔액 (단위: 만원)"
                                                    value={formData.depositLoan}
                                                    onChange={(v) => handleInputChange('depositLoan', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />
                                                {formData.depositLoan && parseInt(formData.depositLoan) > 0 && (
                                                    <AmountInput
                                                        label="💳 보증금 대출 월 이자 (단위: 만원)"
                                                        value={formData.depositLoanInterest}
                                                        onChange={(v) => handleInputChange('depositLoanInterest', v)}
                                                        placeholder=""
                                                        averageAmount={0}
                                                    />
                                                )}

                                                <div className="mb-6">
                                                    <label className="block text-xl font-semibold text-gray-800 mb-3">🏠 현재 거주 형태</label>
                                                    <select
                                                        className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                        value={formData.currentRentType}
                                                        onChange={(e) => handleInputChange('currentRentType', e.target.value)}
                                                    >
                                                        <option value="">선택하세요</option>
                                                        <option value="jeonse">전세</option>
                                                        <option value="monthly">월세</option>
                                                    </select>
                                                </div>

                                                {formData.currentRentType === 'monthly' && (
                                                    <AmountInput
                                                        label="🏠 현재 거주지 월세 (내가 내는 월세, 단위: 만원)"
                                                        value={formData.currentRent}
                                                        onChange={(v) => handleInputChange('currentRent', v)}
                                                        placeholder=""
                                                        averageAmount={0}
                                                    />
                                                )}
                                            </>
                                        )}

                                        {formData.housingType === 'jeonse' && (
                                            <AmountInput
                                                label="🏠 전세보증금 (단위: 만원)"
                                                value={formData.jeonseDeposit}
                                                onChange={(v) => handleInputChange('jeonseDeposit', v)}
                                                placeholder=""
                                                averageAmount={0}
                                            />
                                        )}

                                        {formData.housingType === 'monthly' && (
                                            <>
                                                <AmountInput
                                                    label="🏠 월세보증금 (단위: 만원)"
                                                    value={formData.monthlyDeposit}
                                                    onChange={(v) => handleInputChange('monthlyDeposit', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />
                                                <AmountInput
                                                    label="🏠 월세 (단위: 만원)"
                                                    value={formData.monthlyRent}
                                                    onChange={(v) => handleInputChange('monthlyRent', v)}
                                                    placeholder=""
                                                    averageAmount={0}
                                                />
                                            </>
                                        )}

                                        <AmountInput
                                            label="🏢 수익형 부동산 (오피스텔·상가 등, 단위: 만원)"
                                            value={formData.investmentRealEstate}
                                            onChange={(v) => handleInputChange('investmentRealEstate', v)}
                                            placeholder=""
                                            averageAmount={0}
                                        />

                                        <AmountInput
                                            label="🏢 수익형 부동산 대출 잔액 (단위: 만원)"
                                            value={formData.investmentLoan}
                                            onChange={(v) => handleInputChange('investmentLoan', v)}
                                            placeholder=""
                                            averageAmount={0}
                                        />
                                        {formData.investmentLoan && parseInt(formData.investmentLoan) > 0 && (
                                            <AmountInput
                                                label="💳 수익형 부동산 대출 월 이자 (단위: 만원)"
                                                value={formData.investmentLoanInterest}
                                                onChange={(v) => handleInputChange('investmentLoanInterest', v)}
                                                placeholder=""
                                                averageAmount={0}
                                            />
                                        )}

                                        <AmountInput
                                            label="💳 기타 대출 잔액 (단위: 만원)"
                                            value={formData.debt}
                                            onChange={(v) => handleInputChange('debt', v)}
                                            placeholder=""
                                            averageAmount={averageData?.debt || 0}
                                        />
                                        {formData.debt && parseInt(formData.debt) > 0 && (
                                            <AmountInput
                                                label="💳 기타 대출 월 이자 (단위: 만원)"
                                                value={formData.debtInterest}
                                                onChange={(v) => handleInputChange('debtInterest', v)}
                                                placeholder=""
                                                averageAmount={0}
                                            />
                                        )}

                                        <div className="mb-6">
                                            <div className="flex items-center gap-2 mb-3">
                                                <label className="block text-xl font-semibold text-gray-800">👨‍👩‍👧‍👦 가족 증여 또는 상속 예정액 (단위: 만원)</label>
                                                <button
                                                    onClick={() => setShowInheritanceGuide(!showInheritanceGuide)}
                                                    className="text-blue-500 bg-blue-50 rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-blue-100"
                                                >
                                                    ?
                                                </button>
                                            </div>
                                            <input
                                                type="text"
                                                inputMode="numeric"
                                                pattern="[0-9]*"
                                                value={formData.inheritance}
                                                onChange={(e) => {
                                                    const numValue = e.target.value.replace(/[^0-9]/g, '');
                                                    handleInputChange('inheritance', numValue === '' ? '' : numValue);
                                                }}
                                                onDragStart={(e) => e.preventDefault()}
                                                onDrop={(e) => e.preventDefault()}
                                                onDragOver={(e) => e.preventDefault()}
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                                placeholder=""
                                                autoComplete="off"
                                                autoCorrect="off"
                                                spellCheck="false"
                                                draggable="false"
                                            />
                                            <div className="text-green-600 font-semibold text-lg mt-1">{formatAmount(formData.inheritance)}</div>
                                            
                                            {showInheritanceGuide && (
                                                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-3 rounded-r-lg">
                                                    <div className="text-yellow-800">
                                                        <p className="font-semibold mb-2">📊 참고 가이드라인</p>
                                                        <ul className="text-sm space-y-1">
                                                            <li>• <strong>생애 평균:</strong> 약 2,000만원 (한국조세재정연구원 2022)</li>
                                                            <li>• <strong>부모 1인당:</strong> 평균 1,000만원 내외</li>
                                                            <li>• <strong>시기:</strong> 대부분 50-70대에 받음</li>
                                                            <li>• <strong>형태:</strong> 현금, 부동산, 주식 등 다양</li>
                                                        </ul>
                                                        <p className="text-xs mt-2 text-yellow-700">
                                                            * 가족 상황에 따라 큰 차이가 있으니 예상 가능한 금액만 입력하세요
                                                        </p>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        <div className="flex gap-4 mt-8">
                                            <button
                                                onClick={() => setCalculatorStep(1)}
                                                className="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold"
                                            >
                                                ← 이전 단계
                                            </button>
                                            <button
                                                onClick={() => setCalculatorStep(3)}
                                                className="btn-primary flex-1"
                                                disabled={!formData.housingType}
                                            >
                                                다음 단계 →
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (calculatorStep === 3) {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">📋 추가 수입·지출</h1>
                                    <p className="text-xl text-gray-600">매달 들어오는 연금이나 나가는 고정비용 (선택사항)</p>
                                    <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                        <div className="bg-blue-600 h-4 rounded-full" style={{width: '100%'}}></div>
                                    </div>
                                    <p className="text-lg text-gray-500 mt-3">3단계 / 3단계</p>
                                </div>

                                <div className="card">
                                    <div className="bg-green-50 border-l-4 border-green-400 p-6 mb-8 rounded-r-lg">
                                        <p className="text-lg text-green-800">
                                            😊 <strong>정확한 수치를 모르시는 경우에는</strong><br/>
                                            알고 계신 대략적인 금액을 입력하시면 됩니다.
                                        </p>
                                    </div>

                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">📈 매달 받는 연금 (단위: 만원)</h2>
                                    
                                    <AmountInput
                                        label="🏛️ 국민연금 (월 수령액)"
                                        value={formData.nationalPension}
                                        onChange={(v) => handleInputChange('nationalPension', v)}
                                        placeholder=""
                                        averageAmount={averageData?.nationalPension || 0}
                                    />
                                    
                                    <AmountInput
                                        label="💰 개인연금 (월 수령액)"
                                        value={formData.privatePension}
                                        onChange={(v) => handleInputChange('privatePension', v)}
                                        placeholder=""
                                        averageAmount={averageData?.privatePension || 0}
                                    />
                                    
                                    <AmountInput
                                        label="🏠 주택연금 (월 수령액)"
                                        value={formData.housingPension}
                                        onChange={(v) => handleInputChange('housingPension', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />

                                    <h2 className="text-2xl font-bold mb-6 mt-8 text-gray-800">💼 기타 월 수입 (단위: 만원)</h2>
                                    
                                    <AmountInput
                                        label="🏠 임대소득 (월 수령액)"
                                        value={formData.rentalIncome}
                                        onChange={(v) => handleInputChange('rentalIncome', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />
                                    
                                    <AmountInput
                                        label="💼 근로소득 (파트타임, 자문료 등)"
                                        value={formData.workIncome}
                                        onChange={(v) => handleInputChange('workIncome', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />
                                    
                                    <AmountInput
                                        label="💰 금융소득 (배당금, 이자 등)"
                                        value={formData.financialIncome}
                                        onChange={(v) => handleInputChange('financialIncome', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />
                                    
                                    <AmountInput
                                        label="📚 기타소득 (강의, 로열티 등)"
                                        value={formData.otherIncome}
                                        onChange={(v) => handleInputChange('otherIncome', v)}
                                        placeholder=""
                                        averageAmount={0}
                                    />


                                    <div className="flex gap-4 mt-8">
                                        <button
                                            onClick={() => setCalculatorStep(2)}
                                            className="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold"
                                        >
                                            ← 이전 단계
                                        </button>
                                        <button
                                            onClick={calculateResults}
                                            className="btn-primary flex-1"
                                        >
                                            🚀 노후생활비 계산하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (calculatorStep === 4 && calculatorResult) {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">🎉 노후생활비 계산 완료!</h1>
                                </div>

                                <div className="card mb-6">
                                    <div className="text-center">
                                        <div className="text-5xl font-bold text-blue-600 mb-4">
                                            하루 {formatResultAmount(calculatorResult.totalDailyAvailable)}
                                        </div>
                                        <div className="text-3xl text-gray-600 mb-4">
                                            월 {formatResultAmount(calculatorResult.totalMonthlyAvailable)}
                                        </div>
                                        
                                        {/* 안전 수준 표시 */}
                                        <div className={`inline-block px-6 py-3 rounded-full text-white font-bold text-lg mb-4 ${
                                            calculatorResult.safetyLevel === '안전' ? 'bg-green-500' :
                                            calculatorResult.safetyLevel === '보통' ? 'bg-yellow-500' : 'bg-red-500'
                                        }`}>
                                            {calculatorResult.safetyLevel} 수준
                                        </div>
                                        
                                        {/* 기대수명 조정 */}
                                        <div className="bg-blue-50 p-4 rounded-lg mb-4 max-w-md mx-auto">
                                            <div className="flex items-center justify-center gap-3 mb-2">
                                                <span className="text-sm font-medium text-blue-800">기대수명:</span>
                                                <div className="flex items-center gap-2">
                                                    <button 
                                                        onClick={() => setLifeExpectancy(Math.max(70, lifeExpectancy - 5))}
                                                        className="w-8 h-8 bg-blue-200 hover:bg-blue-300 rounded-full flex items-center justify-center text-blue-700 font-bold"
                                                    >
                                                        -
                                                    </button>
                                                    <span className="font-bold text-lg text-blue-600 min-w-[50px] text-center">{lifeExpectancy}세</span>
                                                    <button 
                                                        onClick={() => setLifeExpectancy(Math.min(110, lifeExpectancy + 5))}
                                                        className="w-8 h-8 bg-blue-200 hover:bg-blue-300 rounded-full flex items-center justify-center text-blue-700 font-bold"
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="text-xs text-blue-600 text-center">
                                                {formData.age}세부터 {lifeExpectancy}세까지 ({lifeExpectancy - parseInt(formData.age)}년간) 자산 보존
                                            </div>
                                        </div>

                                        
                                        {/* 계산 결과 저장 */}
                                        {!isResultSaved ? (
                                            <div className="text-center mb-6">
                                                <button
                                                    onClick={saveCalculationResult}
                                                    className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                                                >
                                                    💾 내 계산결과 저장하기
                                                </button>
                                                <div className="text-sm text-blue-600 mt-2 font-medium">
                                                    계산 결과를 저장하면 나와 비슷한 사람들과 이야기할 수 있어요!
                                                </div>
                                                <div className="text-sm text-gray-500 mt-1">
                                                    언제든지 다시 계산하고 업데이트 할 수 있습니다
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-center mb-6">
                                                <div className="inline-block px-6 py-3 bg-green-100 text-green-800 rounded-lg font-semibold">
                                                    ✅ 계산결과가 저장되었습니다!
                                                </div>
                                                <div className="text-sm text-gray-500 mt-2">
                                                    언제든지 다시 계산하고 업데이트 할 수 있습니다
                                                </div>
                                                <div className="text-sm text-blue-600 mt-1 font-medium">
                                                    👇 아래에서 비슷한 분들과 소통해보세요
                                                </div>
                                            </div>
                                        )}
                                        
                                    </div>
                                </div>


                                <div className="card mb-6">
                                    <h3 className="text-xl font-bold mb-4">💰 수입 구성</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span>자산을 활용한 생활비:</span>
                                            <div className="flex items-center gap-2">
                                                <span className="font-bold">{formatResultAmount(calculatorResult.monthlyAmount)}/월</span>
                                                <button
                                                    onClick={() => setShowAssetDetail(!showAssetDetail)}
                                                    className="text-white text-sm px-3 py-2 bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors font-semibold shadow-md animate-pulse"
                                                >
                                                    {showAssetDetail ? '📊 계산과정 숨기기' : '📊 계산과정 보기'}
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {!showAssetDetail && (
                                            <div className="text-center mt-2">
                                                <p className="text-xs text-blue-600">💡 계산과정을 보시면 자산 분류와 주택 매각 옵션을 확인할 수 있습니다</p>
                                            </div>
                                        )}

                                        {/* 자산 계산 상세 설명 */}
                                        {showAssetDetail && (
                                            <div className="bg-blue-50 p-4 rounded-lg mt-3 space-y-3 text-sm">
                                                <div className="font-semibold text-blue-800 mb-2">📊 계산 과정</div>
                                                
                                                <div className="space-y-3">
                                                    <div className="bg-white p-3 rounded-lg">
                                                        <div className="flex justify-between items-center mb-3">
                                                            <span className="font-medium">• 순 자산:</span>
                                                            <span className="font-bold">{formatResultAmount(calculatorResult.assetBreakdown?.totalAssets || 0)}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600 mb-3">입력하신 모든 자산을 생활비로 쓸 수 있는 자산과 쓸 수 없는 자산으로 구분했습니다</p>
                                                        
                                                        {/* 자산 구분 테이블 */}
                                                        <div className="grid grid-cols-2 gap-3 text-xs">
                                                            {/* 돈이 나오는 자산 */}
                                                            <div className="bg-green-50 p-2 rounded border border-green-200">
                                                                <div className="font-semibold text-green-800 mb-2">💰 생활비로 쓸 수 있는 자산</div>
                                                                <div className="space-y-1 text-green-700">
                                                                    {parseInt(formData.financialAssets) > 0 && <div>• 현금성 자산: {formatResultAmount(parseInt(formData.financialAssets) * 10000)}</div>}
                                                                    {parseInt(formData.severancePay) > 0 && <div>• 퇴직금: {formatResultAmount(parseInt(formData.severancePay) * 10000)}</div>}
                                                                    {formData.homeValue && parseInt(formData.homeValue) > 0 && enableDownsizing && (
                                                                        <div>• 주택 (매각): {formatResultAmount(calculatorResult.assetBreakdown?.realizedHousingAsset || 0)}</div>
                                                                    )}
                                                                    {parseInt(formData.housingPension) > 0 && (
                                                                        <div>• 주택 (주택연금): {formatResultAmount(parseInt(formData.homeValue) * 10000)}</div>
                                                                    )}
                                                                    {formData.jeonseDeposit && parseInt(formData.jeonseDeposit) > 0 && <div>• 전세보증금: {formatResultAmount(parseInt(formData.jeonseDeposit) * 10000)}</div>}
                                                                    {formData.monthlyDeposit && parseInt(formData.monthlyDeposit) > 0 && <div>• 월세보증금: {formatResultAmount(parseInt(formData.monthlyDeposit) * 10000)}</div>}
                                                                </div>
                                                            </div>
                                                            
                                                            {/* 돈이 나오지 않는 자산 */}
                                                            <div className="bg-gray-50 p-2 rounded border border-gray-200">
                                                                <div className="font-semibold text-gray-800 mb-2">🏠 생활비로 쓸 수 없는 자산</div>
                                                                <div className="space-y-1 text-gray-600">
                                                                    {formData.homeValue && parseInt(formData.homeValue) > 0 && !enableDownsizing && !parseInt(formData.housingPension) && (
                                                                        <div>• {formData.housingType === 'owned_living' ? '거주용' : '임대용'} 주택: {formatResultAmount(parseInt(formData.homeValue) * 10000)}</div>
                                                                    )}
                                                                    {formData.investmentRealEstate && parseInt(formData.investmentRealEstate) > 0 && (
                                                                        <div>• 수익형 부동산: {formatResultAmount(parseInt(formData.investmentRealEstate) * 10000)}</div>
                                                                    )}
                                                                    {formData.currentDeposit && parseInt(formData.currentDeposit) > 0 && <div>• 거주지 보증금: {formatResultAmount(parseInt(formData.currentDeposit) * 10000)}</div>}
                                                                    {formData.inheritance && parseInt(formData.inheritance) > 0 && <div>• 증여/상속 예정: {formatResultAmount(parseInt(formData.inheritance) * 10000)}</div>}
                                                                    {(!formData.homeValue || parseInt(formData.homeValue) === 0 || 
                                                                      (formData.housingType === 'owned_living' && (enableDownsizing || parseInt(formData.housingPension))) ||
                                                                      (formData.housingType === 'owned_renting' && enableDownsizing)) && 
                                                                     (!formData.inheritance || parseInt(formData.inheritance) === 0) &&
                                                                     (!formData.currentDeposit || parseInt(formData.currentDeposit) === 0) && (
                                                                        <div className="text-gray-400 italic">해당 없음</div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* 부채 차감 */}
                                                        {((formData.debt && parseInt(formData.debt) > 0) || (formData.homeMortgage && parseInt(formData.homeMortgage) > 0) || (formData.investmentLoan && parseInt(formData.investmentLoan) > 0) || (formData.depositLoan && parseInt(formData.depositLoan) > 0) || (formData.ownedHouseDeposit && parseInt(formData.ownedHouseDeposit) > 0)) && (
                                                            <div className="mt-3 p-2 bg-red-50 rounded border border-red-200">
                                                                <div className="font-semibold text-red-800 mb-1 text-xs">💳 부채 차감</div>
                                                                <div className="space-y-1 text-xs text-red-700">
                                                                    {formData.debt && parseInt(formData.debt) > 0 && <div>• 기타 대출: -{formatResultAmount(parseInt(formData.debt) * 10000)}</div>}
                                                                    {formData.homeMortgage && parseInt(formData.homeMortgage) > 0 && <div>• 주택대출: -{formatResultAmount(parseInt(formData.homeMortgage) * 10000)}</div>}
                                                                    {formData.investmentLoan && parseInt(formData.investmentLoan) > 0 && <div>• 투자대출: -{formatResultAmount(parseInt(formData.investmentLoan) * 10000)}</div>}
                                                                    {formData.depositLoan && parseInt(formData.depositLoan) > 0 && <div>• 보증금 대출: -{formatResultAmount(parseInt(formData.depositLoan) * 10000)}</div>}
                                                                    {formData.ownedHouseDeposit && parseInt(formData.ownedHouseDeposit) > 0 && <div>• 임차인 보증금: -{formatResultAmount(parseInt(formData.ownedHouseDeposit) * 10000)}</div>}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>

                                                    {/* 주택 매각 옵션 */}
                                                    {(formData.housingType === 'owned_living' || formData.housingType === 'owned_renting') && !parseInt(formData.housingPension) && (
                                                        <div className="bg-orange-50 p-3 rounded-lg border-l-4 border-orange-300 mt-3">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <span className="text-sm font-medium text-orange-800">🏠 주택 매각 옵션</span>
                                                                <label className="flex items-center gap-2 cursor-pointer">
                                                                    <input 
                                                                        type="checkbox" 
                                                                        checked={enableDownsizing}
                                                                        onChange={(e) => setEnableDownsizing(e.target.checked)}
                                                                        className="w-4 h-4 text-orange-600 rounded focus:ring-orange-500"
                                                                    />
                                                                    <span className="text-sm font-medium text-orange-800">매각했을 때 생활비 계산하기</span>
                                                                </label>
                                                            </div>
                                                            <div className="text-xs text-orange-600">
                                                                주택을 매각하면 더 많은 노후생활비를 확보할 수 있어요.
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* 주택 매각 옵션 표시 */}
                                                    {calculatorResult.assetBreakdown?.enableDownsizing && (calculatorResult.assetBreakdown?.housingType === 'owned_living' || calculatorResult.assetBreakdown?.housingType === 'owned_renting') && (
                                                        <div className="bg-orange-50 p-3 rounded-lg border-l-4 border-orange-300">
                                                            <div className="flex items-center gap-2 mb-1">
                                                                <span className="text-orange-600">🏠</span>
                                                                <span className="font-medium text-orange-800">주택 매각 옵션 적용</span>
                                                            </div>
                                                            <p className="text-xs text-orange-700">
                                                                주택을 매각하여 현금화합니다 (보수적 계산을 위해 양도세+수수료 25% 차감 후 
                                                                {calculatorResult.assetBreakdown?.housingType === 'owned_living' ? 
                                                                    `, 주택담보대출 ${formatResultAmount(calculatorResult.assetBreakdown?.housingDebt || 0)} 추가 차감하여` :
                                                                    `, 임차인 보증금 ${formatResultAmount(calculatorResult.assetBreakdown?.ownedHouseDepositDebt || 0)}, 주택담보대출 ${formatResultAmount(calculatorResult.assetBreakdown?.housingDebt || 0)} 추가 차감하여`
                                                                } {formatResultAmount(calculatorResult.assetBreakdown?.realizedHousingAsset || 0)} 활용)
                                                            </p>
                                                        </div>
                                                    )}

                                                    <div className="bg-white p-3 rounded-lg">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-medium">• 비상자금 제외:</span>
                                                            <span className="font-bold text-red-600">-{formatResultAmount(calculatorResult.assetBreakdown?.emergencyFund || 0)}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600">예상치 못한 의료비 등을 위해 현금성 자산의 10%를 비상자금으로 보존합니다</p>
                                                    </div>

                                                    <div className="bg-white p-3 rounded-lg">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-medium">• 생활비로 쓸 수 있는 자산:</span>
                                                            <span className="font-bold text-green-600">{formatResultAmount(calculatorResult.assetBreakdown?.availableAssets || 0)}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600">비상자금까지 차감하고 기대수명까지 소비할 수 있는 자산입니다</p>
                                                    </div>

                                                    <div className="bg-white p-3 rounded-lg">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-medium">• 소비 예상 기간:</span>
                                                            <span className="font-bold text-blue-600">{calculatorResult.yearsToLive || 0}년</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600">현재 나이부터 기대수명까지 자산을 소비하는 기간입니다</p>
                                                    </div>

                                                    <div className="bg-blue-100 p-3 rounded-lg border-t-2 border-blue-300">
                                                        <div className="text-center font-bold text-green-600 text-lg">
                                                            소비 가능한 자산은 연간 {formatResultAmount(calculatorResult.monthlyAmount * 12)}, 월간 {formatResultAmount(calculatorResult.monthlyAmount)} 입니다.
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="text-xs text-blue-700 mt-3 p-3 bg-blue-100 rounded border-l-4 border-blue-400">
                                                    💡 <strong>계산 공식:</strong> 생활비로 쓸 수 있는 자산 ÷ 소비예상기간 ÷ 12개월 = 월 사용 가능 금액<br/>
                                                    <div className="mt-2 p-2 bg-yellow-50 rounded border border-yellow-200">
                                                        <strong>⚠️ 중요:</strong> 이 계산은 <strong>{lifeExpectancy}세까지</strong> 자산을 소비한다고 가정하고 계산되었습니다.(투자수익률을 배제)
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {calculatorResult.monthlyPension > 0 && (
                                            <div className="flex justify-between text-green-700">
                                                <span>+ 연금 수입:</span>
                                                <span className="font-bold">+{formatResultAmount(calculatorResult.monthlyPension)}/월</span>
                                            </div>
                                        )}
                                        {calculatorResult.monthlyOtherIncome > 0 && (
                                            <div className="flex justify-between text-green-700">
                                                <span>+ 기타 월 수입:</span>
                                                <span className="font-bold">+{formatResultAmount(calculatorResult.monthlyOtherIncome)}/월</span>
                                            </div>
                                        )}
                                        {calculatorResult.monthlyHousingCost > 0 && (
                                            <div className="flex justify-between text-red-700">
                                                <span>- 월세 지출:</span>
                                                <span className="font-bold">-{formatResultAmount(calculatorResult.monthlyHousingCost)}/월</span>
                                            </div>
                                        )}
                                        {calculatorResult.monthlyLoanInterest > 0 && (
                                            <div className="flex justify-between text-red-700">
                                                <span>- 월 대출 이자:</span>
                                                <span className="font-bold">-{formatResultAmount(calculatorResult.monthlyLoanInterest)}/월</span>
                                            </div>
                                        )}
                                        <div className="flex justify-between font-bold pt-2 border-t border-blue-200 text-lg">
                                            <span>월간 총 노후생활비:</span>
                                            <span className="text-blue-600">{formatResultAmount(calculatorResult.totalMonthlyAvailable)}/월</span>
                                        </div>
                                    </div>
                                </div>

                                {/* 커뮤니티 섹션 - 저장 후에만 표시 */}
                                {isResultSaved && (
                                    <div className="card mb-6">
                                        <h3 className="text-xl font-bold mb-4">👥 나와 비슷한 사람들과 소통해보세요</h3>
                                    
                                    {/* 탭 네비게이션 */}
                                    <div className="flex gap-2 mb-6">
                                        <button
                                            className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all duration-300 ${
                                                activeTab === 'expense' 
                                                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('expense')}
                                        >
                                            📊 지출내역 공유
                                        </button>
                                        <button
                                            className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all duration-300 ${
                                                activeTab === 'community' 
                                                    ? 'bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200 animate-pulse'
                                            }`}
                                            onClick={() => setActiveTab('community')}
                                        >
                                            💬 커뮤니티 참여
                                        </button>
                                    </div>

                                    {/* 지출내역 공유 탭 */}
                                    {activeTab === 'expense' && (
                                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    💰 <strong>지출내역 입력</strong> 후<br/>
                                                    비슷한 사람들이 어떻게 돈을 쓰고 있는지 확인할 수 있습니다.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"식비는 얼마가 적당할까요?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"다른사람은 의료비를 얼마나 쓸까요?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"취미·여가비 현실적인 기준은?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"생활비는 얼마가 적정할까요?"</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-purple-100 p-3 rounded-lg mb-4 text-center">
                                                <p className="text-purple-800 font-semibold">
                                                    📈 <strong>더 나은 서비스 제공을 위해서만 익명으로 활용됩니다</strong>
                                                </p>
                                                <p className="text-purple-700 text-sm">내 또래의 실제 지출 패턴을 확인하세요</p>
                                            </div>
                                            
                                            <button
                                                onClick={openExpenseModal}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                📝 지출내역 입력하기
                                            </button>
                                        </div>
                                    )}

                                    {/* 커뮤니티 참여 탭 */}
                                    {activeTab === 'community' && (
                                        <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    🤝 <strong>익명 라이프스타일 커뮤니티</strong>에서<br/>
                                                    비슷한 자산과 나이대({formData.age}세)의 사람들과 솔직한 경험을 나누어보세요.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"실제로 이 돈으로 살 수 있나요?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"예상치 못한 비용들은 뭐가 있나요?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"어떤 서비스들을 실제로 이용하시나요?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"노후 생활의 현실적인 팁들"</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-green-100 p-3 rounded-lg mb-4 text-center">
                                                <p className="text-green-800 font-semibold">
                                                    ✨ <strong>금융상품 판매는 일체 없습니다</strong> ✨
                                                </p>
                                                <p className="text-green-700 text-sm">순수 라이프스타일 커뮤니티입니다</p>
                                            </div>
                                            
                                            <div className="text-sm text-gray-500 mb-3 text-center">
                                                💡 만원 미만은 절사하여 표시됩니다
                                            </div>
                                            
                                            <button
                                                onClick={joinCommunity}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                🤝 익명 커뮤니티<br/>참여하기
                                            </button>
                                        </div>
                                    )}
                                    </div>
                                )}

                                <div className="text-center">
                                    <button
                                        onClick={() => setCalculatorStep(1)}
                                        className="text-gray-500 underline hover:text-gray-700"
                                    >
                                        다시 계산하기
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }
            };

            const renderCommunity = () => {
                if (communityTab === 'posts') {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-4xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">💬 노후생활 이모저모</h1>
                                    <p className="text-xl text-gray-600">익명으로 진짜 이야기를 나누는 공간</p>
                                </div>

                                {/* 탭 네비게이션 */}
                                <div className="flex gap-4 mb-6">
                                    <button 
                                        className={`tab-button ${communityTab === 'posts' ? 'active' : ''}`}
                                        onClick={() => setCommunityTab('posts')}
                                    >
                                        📝 게시글
                                    </button>
                                    <button 
                                        className={`tab-button ${communityTab === 'write' ? 'active' : ''}`}
                                        onClick={() => setCommunityTab('write')}
                                    >
                                        ✍️ 글쓰기
                                    </button>
                                </div>

                                {/* 게시글 목록 */}
                                <div className="space-y-4">
                                    {samplePosts.map(post => (
                                        <div key={post.id} className="community-post">
                                            <div className="flex items-center gap-2 mb-2">
                                                <span className="anonymous-badge">{post.author}</span>
                                                <span className="asset-badge">{post.authorProfile.assets}</span>
                                                <span className="region-badge">{post.authorProfile.region}</span>
                                                <span className="text-sm text-gray-500">{post.authorProfile.age}세</span>
                                                <span className="text-sm text-gray-500">• {post.timestamp}</span>
                                            </div>
                                            <h3 className="font-bold text-lg mb-2">{post.title}</h3>
                                            <p className="text-gray-700 mb-3">{post.content}</p>
                                            <div className="flex items-center gap-4 text-sm text-gray-500">
                                                <span>👍 {post.likes}</span>
                                                <span>💬 {post.replies.length}</span>
                                                <button 
                                                    className="text-green-600 hover:underline"
                                                    onClick={() => setSelectedPost(selectedPost === post.id ? null : post.id)}
                                                >
                                                    {selectedPost === post.id ? '숨기기' : '댓글 보기'}
                                                </button>
                                            </div>

                                            {/* 댓글 */}
                                            {selectedPost === post.id && post.replies.map((reply, idx) => (
                                                <div key={idx} className="reply">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className="anonymous-badge text-xs">{reply.author}</span>
                                                        <span className="asset-badge text-xs">{reply.authorProfile.assets}</span>
                                                        <span className="region-badge text-xs">{reply.authorProfile.region}</span>
                                                        <span className="text-xs text-gray-500">{reply.authorProfile.age}세</span>
                                                        <span className="text-xs text-gray-500">• {reply.timestamp}</span>
                                                    </div>
                                                    <p className="text-sm text-gray-700 mb-1">{reply.content}</p>
                                                    <span className="text-xs text-gray-500">👍 {reply.likes}</span>
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    );
                }

                if (communityTab === 'write') {
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="mb-4">
                                    <button
                                        onClick={() => setCommunityTab('posts')}
                                        className="flex items-center gap-2 text-gray-600 hover:text-blue-600 font-semibold"
                                    >
                                        ← 게시글로 돌아가기
                                    </button>
                                </div>
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">✍️ 솔직한 이야기 나누기</h1>
                                    <p className="text-xl text-gray-600">익명으로 진짜 고민을 털어놓으세요</p>
                                </div>

                                <div className="card">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block font-semibold mb-2">제목</label>
                                            <input
                                                type="text"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg"
                                                placeholder="예: 5억 자산으로 정말 안전한 은퇴가 가능할까요?"
                                            />
                                        </div>
                                        <div>
                                            <label className="block font-semibold mb-2">내용</label>
                                            <textarea
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg"
                                                rows="8"
                                                placeholder="솔직한 고민이나 경험을 자유롭게 적어주세요. 구체적인 금액이나 상황을 공유할수록 더 도움이 되는 답변을 받을 수 있어요."
                                            />
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <p className="text-blue-800 text-sm">
                                                💡 <strong>팁:</strong> "실제로 월 얼마나 쓰시나요?", "예상치 못한 비용이 뭐가 있나요?" 같은 구체적인 질문일수록 많은 분들이 답변해주세요.
                                            </p>
                                        </div>
                                        <button className="btn-primary w-full">
                                            📝 익명으로 글 올리기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (communityTab === 'myprofile') {
                    const profile = JSON.parse(localStorage.getItem('planb_profile') || '{}');
                    return (
                        <div className="min-h-screen py-8 px-4">
                            <div className="max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-3">👤 내 익명 프로필</h1>
                                    <p className="text-xl text-gray-600">커뮤니티에서 사용되는 정보입니다</p>
                                </div>

                                <div className="card">
                                    <div className="space-y-4">
                                        <div className="flex items-center gap-2">
                                            <span className="anonymous-badge">{profile.nickname || '플랜비사용자'}</span>
                                            <span className="text-gray-500">가입일: {profile.joinDate}</span>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">나이</p>
                                                <p className="font-bold">{profile.age || '-'}세</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">자산규모</p>
                                                <p className="font-bold">{profile.assets || '-'}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">건강상태</p>
                                                <p className="font-bold">{profile.health || '-'}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">생활모드</p>
                                                <p className="font-bold">{profile.lifestyle || '-'}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">지역</p>
                                                <p className="font-bold">{profile.region || '서울'}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-sm text-gray-600">성별</p>
                                                <p className="font-bold">{profile.gender || '남성'}</p>
                                            </div>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <p className="text-blue-800">
                                                <strong>💰 월 노후생활비:</strong> {(profile.monthlyRetirementBudget || 0).toLocaleString()}만원
                                            </p>
                                            {profile.monthlyRetirementBudget > 0 && (
                                                <p className="text-xs text-blue-600 mt-1">
                                                    계산기 결과 기준 (자산 + 연금 + 기타수입 - 고정지출)
                                                </p>
                                            )}
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg">
                                            <p className="text-green-800 text-sm">
                                                🔒 <strong>개인정보 보호:</strong> 모든 정보는 익명으로 처리되며, 개인을 식별할 수 있는 정보는 저장되지 않습니다.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }
            };

            const renderServices = () => {
                const tabs = ['생활케어', '건강관리', '여행', '시니어 일자리'];
                const currentServices = partnerServices[serviceTab];

                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">🛍️ 시니어 맞춤 서비스</h1>
                                <p className="text-xl text-gray-600">플랜비 커뮤니티로 검증하는 시니어 라이프케어</p>
                            </div>

                            <div className="bg-green-50 border-l-4 border-green-400 p-4 mb-8">
                                <p className="text-green-800">
                                    📝 <strong>후기 남기기:</strong> 서비스를 이용하신 후 커뮤니티에서 솔직한 후기를 남겨주세요. 
                                    다른 분들에게 큰 도움이 됩니다!
                                </p>
                            </div>

                            {/* 탭 네비게이션 */}
                            <div className="flex gap-4 mb-8 overflow-x-auto">
                                {tabs.map(tab => (
                                    <button
                                        key={tab}
                                        className={`tab-button whitespace-nowrap ${serviceTab === tab ? 'active' : ''}`}
                                        onClick={() => setServiceTab(tab)}
                                    >
                                        {tab === '생활케어' && '🏠'} {tab === '건강관리' && '🏥'} {tab === '여행' && '✈️'} {tab === '시니어 일자리' && '💼'} {tab}
                                    </button>
                                ))}
                            </div>

                            {/* 현재 탭의 서비스들 */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {currentServices.map((service, serviceIdx) => (
                                    <div key={serviceIdx} className="service-card">
                                        <div className="flex items-center gap-2 mb-2">
                                            <h3 className="font-bold text-lg">{service.name}</h3>
                                            <span className="dday-badge">D-{service.dday}</span>
                                        </div>
                                        <p className="text-gray-600 mb-2">{service.description}</p>
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="text-yellow-500">⭐</span>
                                            <span className="font-semibold">{service.rating}</span>
                                            <span className="text-gray-500">({service.reviews}개 후기)</span>
                                        </div>
                                        <div className="mb-2">
                                            <span className="font-bold text-blue-600">{service.price}</span>
                                        </div>
                                        {service.discount && (
                                            <div className="bg-red-50 text-red-700 p-2 rounded text-sm mb-3">
                                                🎉 {service.discount}
                                            </div>
                                        )}
                                        <div className="space-y-2">
                                            <div className="bg-blue-50 p-2 rounded text-xs">
                                                <strong>포함사항:</strong> {service.detailFeatures.join(', ')}
                                            </div>
                                            <div className="bg-gray-50 p-2 rounded text-xs">
                                                <strong>실제 후기:</strong> "{service.realReviews[0]}", "{service.realReviews[1]}"
                                            </div>
                                            <div className="flex gap-2">
                                                <button className="btn-primary w-full text-sm py-2">
                                                    상세보기 및 신청
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* 상단 네비게이션 */}
                    <nav className="bg-white shadow-sm border-b">
                        <div className="max-w-6xl mx-auto px-4">
                            <div className="flex justify-between items-center h-16">
                                <div className="font-bold text-xl text-blue-600">행복한 노후생활의 시작, 플랜비</div>
                                <div className="flex gap-6">
                                    <button 
                                        className={`px-4 py-2 rounded-lg font-semibold ${currentView === 'calculator' ? 'bg-blue-100 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}
                                        onClick={() => setCurrentView('calculator')}
                                    >
                                        🧮 노후생활비 계산기
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-lg font-semibold ${currentView === 'community' ? 'bg-blue-100 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}
                                        onClick={() => setCurrentView('community')}
                                    >
                                        💬 커뮤니티
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-lg font-semibold ${currentView === 'services' ? 'bg-blue-100 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}
                                        onClick={() => setCurrentView('services')}
                                    >
                                        🛍️ 시니어 맞춤 서비스
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-lg font-semibold ${communityTab === 'myprofile' ? 'bg-blue-100 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}
                                        onClick={() => {
                                            setCurrentView('community');
                                            setCommunityTab('myprofile');
                                        }}
                                    >
                                        👤 내 프로필
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* 메인 콘텐츠 */}
                    {currentView === 'calculator' && renderCalculator()}
                    {currentView === 'community' && renderCommunity()}
                    {currentView === 'services' && renderServices()}

                    {/* 지출 내역 입력 모달 */}
                    {showExpenseModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <div className="p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800">📊 월간 지출내역</h2>
                                        <button
                                            onClick={closeExpenseModal}
                                            className="text-gray-500 hover:text-gray-700 text-2xl"
                                        >
                                            ×
                                        </button>
                                    </div>
                                    
                                    <p className="text-gray-600 mb-6">실제 월간 지출 금액을 입력해주세요. (단위: 만원)</p>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">🍽️ 식비</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.food}
                                                onChange={(e) => handleExpenseChange('food', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">외식비, 식료품비 포함</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">📱 통신비</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.communication}
                                                onChange={(e) => handleExpenseChange('communication', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">휴대폰, 인터넷, TV 등</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">💰 공과금</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.utilities}
                                                onChange={(e) => handleExpenseChange('utilities', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">아파트 관리비, 전기가스수도 등</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">🏠 생활비</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.living}
                                                onChange={(e) => handleExpenseChange('living', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">교통비, 생필품, 의류 등</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">🏥 의료비</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.medical}
                                                onChange={(e) => handleExpenseChange('medical', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">병원비, 약값, 건강보조식품 등</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-lg font-semibold text-gray-700 mb-2">🎨 취미·여가</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg text-lg [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                                                value={expenseData.hobby}
                                                onChange={(e) => handleExpenseChange('hobby', e.target.value)}
                                            />
                                            <p className="text-sm text-green-600 mt-1">여행, 취미활동, 문화생활 등</p>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-blue-50 p-4 rounded-lg mt-6">
                                        <p className="text-blue-800 font-semibold text-sm">
                                            💡 <strong>입력하신 정보는 익명으로 처리됩니다</strong>
                                        </p>
                                        <p className="text-blue-700 text-sm mt-1">
                                            비슷한 연령대와 자산 규모의 사람들과 비교 분석하여 제공됩니다.
                                        </p>
                                        <p className="text-blue-700 text-sm mt-2">
                                            🔒 <strong>개인정보 보호:</strong> 세금은 소득과 관련되는 민감정보이므로 수집하지 않습니다.
                                        </p>
                                    </div>
                                    
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            onClick={closeExpenseModal}
                                            className="flex-1 py-3 bg-gray-300 text-gray-700 rounded-lg font-semibold"
                                        >
                                            취소
                                        </button>
                                        <button
                                            onClick={submitExpenseData}
                                            className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold"
                                        >
                                            저장하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 하단 카피라이트 */}
                    <footer className="bg-gray-800 text-white py-8 text-center">
                        <p className="text-gray-400">
                            행복한 노후생활의 시작, 플랜비 | 
                            금융상품 판매 없음 | 라이프스타일 커뮤니티 중심 서비스
                        </p>
                        <p className="text-gray-500 text-sm mt-2">
                            모든 정보는 익명으로 처리되며 개인정보는 보호됩니다
                        </p>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<PlanBCommunityApp />, document.getElementById('root'));
    </script>
</body>
</html>